/*! For license information please see main.267d41e7.js.LICENSE.txt */
(()=>{var e={49:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function D(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},D.prototype=v.prototype;var E=y.prototype=new D;E.constructor=y,m(E,v.prototype),E.isPureReactComponent=!0;var A=Array.isArray,C=Object.prototype.hasOwnProperty,_={current:null},b={key:!0,ref:!0,__self:!0,__source:!0};function x(e,t,r){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,i)&&!b.hasOwnProperty(i)&&(a[i]=t[i]);var u=arguments.length-2;if(1===u)a.children=r;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];a.children=l}if(e&&e.defaultProps)for(i in u=e.defaultProps)void 0===a[i]&&(a[i]=u[i]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:_.current}}function F(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var w=/\/+/g;function S(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===a?"."+S(u,0):a,A(o)?(i="",null!=e&&(i=e.replace(w,"$&/")+"/"),T(o,t,i,"",function(e){return e})):null!=o&&(F(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(w,"$&/")+"/")+e)),t.push(o)),1;if(u=0,a=""===a?".":a+":",A(e))for(var l=0;l<e.length;l++){var c=a+S(s=e[l],l);u+=T(s,t,i,c,o)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)u+=T(s=s.value,t,i,c=a+S(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function M(e,t,n){if(null==e)return e;var r=[],i=0;return T(e,r,"","",function(e){return t.call(n,e,i++)}),r}function B(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},N={transition:null},R={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:N,ReactCurrentOwner:_};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:M,forEach:function(e,t,n){M(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return M(e,function(){t++}),t},toArray:function(e){return M(e,function(e){return e})||[]},only:function(e){if(!F(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=o,t.PureComponent=y,t.StrictMode=a,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=_.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)C.call(t,l)&&!b.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){u=Array(l);for(var c=0;c<l;c++)u[c]=arguments[c+2];i.children=u}return{$$typeof:n,type:e.type,key:a,ref:o,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=x,t.createFactory=function(e){var t=x.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=F,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:B}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},78:(e,t,n)=>{e.exports=function(e,t){if(!e)throw new Error("Graph structure cannot be undefined");var a=(t&&t.createSimulator||n(389))(t);if(Array.isArray(t))throw new Error("Physics settings is expected to be an object");var o=e.version>19?function(t){var n=e.getLinks(t);return n?1+n.size/3:1}:function(t){var n=e.getLinks(t);return n?1+n.length/3:1};t&&"function"===typeof t.nodeMass&&(o=t.nodeMass);var s=new Map,u={},l=0,c=a.settings.springTransform||i;l=0,e.forEachNode(function(e){g(e.id),l+=1}),e.forEachLink(D),e.on("changed",m);var h=!1,d={step:function(){if(0===l)return p(!0),!0;var e=a.step();d.lastMove=e,d.fire("step");var t=e/l<=.01;return p(t),t},getNodePosition:function(e){return A(e).pos},setNodePosition:function(e){var t=A(e);t.setPosition.apply(t,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(e){var t=u[e];if(t)return{from:t.from.pos,to:t.to.pos}},getGraphRect:function(){return a.getBBox()},forEachBody:f,pinNode:function(e,t){A(e.id).isPinned=!!t},isNodePinned:function(e){return A(e.id).isPinned},dispose:function(){e.off("changed",m),d.fire("disposed")},getBody:function(e){return s.get(e)},getSpring:function(t,n){var r;if(void 0===n)r="object"!==typeof t?t:t.id;else{var i=e.hasLink(t,n);if(!i)return;r=i.id}return u[r]},getForceVectorLength:function(){var e=0,t=0;return f(function(n){e+=Math.abs(n.force.x),t+=Math.abs(n.force.y)}),Math.sqrt(e*e+t*t)},simulator:a,graph:e,lastMove:0};return r(d),d;function p(e){var t;h!==e&&(h=e,t=e,d.fire("stable",t))}function f(e){s.forEach(e)}function m(t){for(var n=0;n<t.length;++n){var r=t[n];"add"===r.changeType?(r.node&&g(r.node.id),r.link&&D(r.link)):"remove"===r.changeType&&(r.node&&v(r.node),r.link&&y(r.link))}l=e.getNodesCount()}function g(t){var n=s.get(t);if(!n){var r=e.getNode(t);if(!r)throw new Error("initBody() was called with unknown node id");var i=r.position;if(!i){var o=function(e){var t=[];if(!e.links)return t;for(var n=Math.min(e.links.length,2),r=0;r<n;++r){var i=e.links[r],a=i.fromId!==e.id?s.get(i.fromId):s.get(i.toId);a&&a.pos&&t.push(a)}return t}(r);i=a.getBestNewBodyPosition(o)}(n=a.addBodyAt(i)).id=t,s.set(t,n),E(t),function(e){return e&&(e.isPinned||e.data&&e.data.isPinned)}(r)&&(n.isPinned=!0)}}function v(e){var t=e.id,n=s.get(t);n&&(s.delete(t),a.removeBody(n))}function D(e){E(e.fromId),E(e.toId);var t=s.get(e.fromId),n=s.get(e.toId),r=a.addSpring(t,n,e.length);c(e,r),u[e.id]=r}function y(t){var n=u[t.id];if(n){var r=e.getNode(t.fromId),i=e.getNode(t.toId);r&&E(r.id),i&&E(i.id),delete u[t.id],a.removeSpring(n)}}function E(e){var t=s.get(e);if(t.mass=o(e),Number.isNaN(t.mass))throw new Error("Node mass should be a number")}function A(e){var t=s.get(e);return t||(g(e),t=s.get(e)),t}},e.exports.simulator=n(389);var r=n(180);function i(){}},119:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(345)},180:e=>{e.exports=function(e){!function(e){if(!e)throw new Error("Eventify cannot use falsy object as events subject");for(var t=["on","fire","off"],n=0;n<t.length;++n)if(e.hasOwnProperty(t[n]))throw new Error("Subject cannot be eventified, since it already has property '"+t[n]+"'")}(e);var t=function(e){var t=Object.create(null);return{on:function(n,r,i){if("function"!==typeof r)throw new Error("callback is expected to be a function");var a=t[n];return a||(a=t[n]=[]),a.push({callback:r,ctx:i}),e},off:function(n,r){if("undefined"===typeof n)return t=Object.create(null),e;if(t[n])if("function"!==typeof r)delete t[n];else for(var i=t[n],a=0;a<i.length;++a)i[a].callback===r&&i.splice(a,1);return e},fire:function(n){var r,i=t[n];if(!i)return e;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var a=0;a<i.length;++a){var o=i[a];o.callback.apply(o.ctx,r)}return e}}}(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e}},260:(e,t,n)=>{const r=n(911);function i(e){let t=r(e);return"\n  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');\n\n  return {\n    update: function(body) {\n      ".concat(t("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6}),"\n    }\n  };\n")}e.exports=function(e){let t=i(e);return new Function("options",t)},e.exports.generateCreateDragForceFunctionBody=i},284:(e,t,n)=>{e.exports=function(e){let t=i(e);return new Function("bodies","settings","random",t)},e.exports.generateFunctionBody=i;const r=n(911);function i(e){let t=r(e);return"\n  var boundingBox = {\n    ".concat(t("min_{var}: 0, max_{var}: 0,",{indent:4}),"\n  };\n\n  return {\n    box: boundingBox,\n\n    update: updateBoundingBox,\n\n    reset: resetBoundingBox,\n\n    getBestNewPosition: function (neighbors) {\n      var ").concat(t("base_{var} = 0",{join:", "}),";\n\n      if (neighbors.length) {\n        for (var i = 0; i < neighbors.length; ++i) {\n          let neighborPos = neighbors[i].pos;\n          ").concat(t("base_{var} += neighborPos.{var};",{indent:10}),"\n        }\n\n        ").concat(t("base_{var} /= neighbors.length;",{indent:8}),"\n      } else {\n        ").concat(t("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8}),"\n      }\n\n      var springLength = settings.springLength;\n      return {\n        ").concat(t("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8}),"\n      };\n    }\n  };\n\n  function updateBoundingBox() {\n    var i = bodies.length;\n    if (i === 0) return; // No bodies - no borders.\n\n    ").concat(t("var max_{var} = -Infinity;",{indent:4}),"\n    ").concat(t("var min_{var} = Infinity;",{indent:4}),"\n\n    while(i--) {\n      // this is O(n), it could be done faster with quadtree, if we check the root node bounds\n      var bodyPos = bodies[i].pos;\n      ").concat(t("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6}),"\n      ").concat(t("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6}),"\n    }\n\n    ").concat(t("boundingBox.min_{var} = min_{var};",{indent:4}),"\n    ").concat(t("boundingBox.max_{var} = max_{var};",{indent:4}),"\n  }\n\n  function resetBoundingBox() {\n    ").concat(t("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4}),"\n  }\n")}},302:e=>{function t(e){return new n("number"===typeof e?e:+new Date)}function n(e){this.seed=e}function r(e){return Math.sqrt(2*Math.PI/e)*Math.pow(1/Math.E*(e+1/(12*e-1/(10*e))),e)}function i(){var e=this.seed;return e=4294967295&(3042594569^(e=(e=4294967295&((e=(e=4294967295&(3345072700^(e=e+2127912214+(e<<12)&4294967295)^e>>>19))+374761393+(e<<5)&4294967295)+3550635116^e<<9))+4251993797+(e<<3)&4294967295)^e>>>16),this.seed=e,(268435455&e)/268435456}e.exports=t,e.exports.random=t,e.exports.randomIterator=function(e,n){var r=n||t();if("function"!==typeof r.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(t){var n,i,a;for(n=e.length-1;n>0;--n)i=r.next(n+1),a=e[i],e[i]=e[n],e[n]=a,t(a);e.length&&t(e[0])},shuffle:function(){var t,n,i;for(t=e.length-1;t>0;--t)n=r.next(t+1),i=e[n],e[n]=e[t],e[t]=i;return e}}},n.prototype.next=function(e){return Math.floor(this.nextDouble()*e)},n.prototype.nextDouble=i,n.prototype.uniform=i,n.prototype.gaussian=function(){var e,t,n;do{e=(t=2*this.nextDouble()-1)*t+(n=2*this.nextDouble()-1)*n}while(e>=1||0===e);return t*Math.sqrt(-2*Math.log(e)/e)},n.prototype.random=i,n.prototype.levy=function(){var e=1.5,t=Math.pow(r(2.5)*Math.sin(Math.PI*e/2)/(r(1.25)*e*Math.pow(2,.25)),1/e);return this.gaussian()*t/Math.pow(Math.abs(this.gaussian()),1/e)}},305:(e,t,n)=>{const r=n(911);function i(e,t){return"\n".concat(o(e,t),"\n").concat(a(e),"\nreturn {Body: Body, Vector: Vector};\n")}function a(e){let t=r(e),n=t("{var}",{join:", "});return"\nfunction Body(".concat(n,") {\n  this.isPinned = false;\n  this.pos = new Vector(").concat(n,");\n  this.force = new Vector();\n  this.velocity = new Vector();\n  this.mass = 1;\n\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.reset = function() {\n  this.force.reset();\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.setPosition = function (").concat(n,") {\n  ").concat(t("this.pos.{var} = {var} || 0;",{indent:2}),"\n};")}function o(e,t){let n=r(e),i="";t&&(i="".concat(n("\n   var v{var};\nObject.defineProperty(this, '{var}', {\n  set: function(v) { \n    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n    v{var} = v; \n  },\n  get: function() { return v{var}; }\n});")));let a=n("{var}",{join:", "});return"function Vector(".concat(a,") {\n  ").concat(i,"\n    if (typeof arguments[0] === 'object') {\n      // could be another vector\n      let v = arguments[0];\n      ").concat(n('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4}),"\n      ").concat(n("this.{var} = v.{var};",{indent:4}),"\n    } else {\n      ").concat(n('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4}),"\n    }\n  }\n  \n  Vector.prototype.reset = function () {\n    ").concat(n("this.{var} = ",{join:""}),"0;\n  };")}e.exports=function(e,t){let n=i(e,t),{Body:r}=new Function(n)();return r},e.exports.generateCreateBodyFunctionBody=i,e.exports.getVectorCode=o,e.exports.getBodyCode=a},340:(e,t,n)=>{"use strict";e.exports=n(761)},345:(e,t,n)=>{"use strict";var r=n(950),i=n(340);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function D(e){return e[1].toUpperCase()}function y(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,D);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,D);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,D);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),C=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),w=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var I,k=Object.assign;function O(e){if(void 0===I)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);I=t&&t[1]||""}return"\n"+I+e}var U=!1;function z(e,t){if(!e||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var u="\n"+i[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{U=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?O(e):""}function V(e){switch(e.tag){case 5:return O(e.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case C:return"Portal";case x:return"Profiler";case b:return"StrictMode";case T:return"Suspense";case M:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case w:return(e.displayName||"Context")+".Consumer";case F:return(e._context.displayName||"Context")+".Provider";case S:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case B:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===b?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function j(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return k({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=j(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function Q(e,t){$(e,t);var n=j(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,j(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+j(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return k({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:j(n)}}function ae(e,t){var n=j(t.value),r=j(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ce,he=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ce(e,t)})}:ce);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ve=k({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function De(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function Ae(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,_e=null,be=null;function xe(e){if(e=yi(e)){if("function"!==typeof Ce)throw Error(a(280));var t=e.stateNode;t&&(t=Ai(t),Ce(e.stateNode,e.type,t))}}function Fe(e){_e?be?be.push(e):be=[e]:_e=e}function we(){if(_e){var e=_e,t=be;if(be=_e=null,xe(e),t)for(e=0;e<t.length;e++)xe(t[e])}}function Se(e,t){return e(t)}function Te(){}var Me=!1;function Be(e,t,n){if(Me)return e(t,n);Me=!0;try{return Se(e,t,n)}finally{Me=!1,(null!==_e||null!==be)&&(Te(),we())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=Ai(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Ne=!1;if(c)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(ce){Ne=!1}function Le(e,t,n,r,i,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Ie=!1,ke=null,Oe=!1,Ue=null,ze={onError:function(e){Ie=!0,ke=e}};function Ve(e,t,n,r,i,a,o,s,u){Ie=!1,ke=null,Le.apply(ze,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function je(e){if(Ge(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return je(i),e;if(o===r)return je(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=o;break}if(u===r){s=!0,r=i,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=i;break}if(u===r){s=!0,r=o,n=i;break}u=u.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Xe=i.unstable_scheduleCallback,Ke=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Je=i.unstable_requestPaint,$e=i.unstable_now,Qe=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var lt=64,ct=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=ht(s):0!==(a&=o)&&(r=ht(a))}else 0!==(o=n&~i)?r=ht(o):0!==a&&(r=ht(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function Dt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var yt=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var At,Ct,_t,bt,xt,Ft=!1,wt=[],St=null,Tt=null,Mt=null,Bt=new Map,Pt=new Map,Nt=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":St=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":Mt=null;break;case"pointerover":case"pointerout":Bt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function It(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=yi(t))&&Ct(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function kt(e){var t=Di(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void xt(e.priority,function(){_t(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yi(n))&&Ct(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ee=r,n.target.dispatchEvent(r),Ee=null,t.shift()}return!0}function Ut(e,t,n){Ot(e)&&n.delete(t)}function zt(){Ft=!1,null!==St&&Ot(St)&&(St=null),null!==Tt&&Ot(Tt)&&(Tt=null),null!==Mt&&Ot(Mt)&&(Mt=null),Bt.forEach(Ut),Pt.forEach(Ut)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ft||(Ft=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,zt)))}function Gt(e){function t(t){return Vt(t,e)}if(0<wt.length){Vt(wt[0],e);for(var n=1;n<wt.length;n++){var r=wt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==St&&Vt(St,e),null!==Tt&&Vt(Tt,e),null!==Mt&&Vt(Mt,e),Bt.forEach(t),Pt.forEach(t),n=0;n<Nt.length;n++)(r=Nt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Nt.length&&null===(n=Nt[0]).blockedOn;)kt(n),null===n.blockedOn&&Nt.shift()}var Ht=E.ReactCurrentBatchConfig,jt=!0;function Wt(e,t,n,r){var i=yt,a=Ht.transition;Ht.transition=null;try{yt=1,Xt(e,t,n,r)}finally{yt=i,Ht.transition=a}}function qt(e,t,n,r){var i=yt,a=Ht.transition;Ht.transition=null;try{yt=4,Xt(e,t,n,r)}finally{yt=i,Ht.transition=a}}function Xt(e,t,n,r){if(jt){var i=Yt(e,t,n,r);if(null===i)jr(e,t,r,Kt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return St=It(St,e,t,n,r,i),!0;case"dragenter":return Tt=It(Tt,e,t,n,r,i),!0;case"mouseover":return Mt=It(Mt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Bt.set(a,It(Bt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Pt.set(a,It(Pt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Rt.indexOf(e)){for(;null!==i;){var a=yi(i);if(null!==a&&At(a),null===(a=Yt(e,t,n,r))&&jr(e,t,r,Kt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else jr(e,t,r,null,n)}}var Kt=null;function Yt(e,t,n,r){if(Kt=null,null!==(e=Di(e=Ae(r))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var $t=null,Qt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Qt,r=n.length,i="value"in $t?$t.value:$t.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return k(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=an(ln),hn=k({},ln,{view:0,detail:0}),dn=an(hn),pn=k({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),fn=an(pn),mn=an(k({},pn,{dataTransfer:0})),gn=an(k({},hn,{relatedTarget:0})),vn=an(k({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),Dn=k({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(Dn),En=an(k({},ln,{data:0})),An={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function xn(){return bn}var Fn=k({},hn,{key:function(e){if(e.key){var t=An[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Cn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),wn=an(Fn),Sn=an(k({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=an(k({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xn})),Mn=an(k({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Bn=k({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=an(Bn),Nn=[9,13,27,32],Rn=c&&"CompositionEvent"in window,Ln=null;c&&"documentMode"in document&&(Ln=document.documentMode);var In=c&&"TextEvent"in window&&!Ln,kn=c&&(!Rn||Ln&&8<Ln&&11>=Ln),On=String.fromCharCode(32),Un=!1;function zn(e,t){switch(e){case"keyup":return-1!==Nn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Wn(e,t,n,r){Fe(r),0<(t=qr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Xn=null;function Kn(e){Or(e,0)}function Yn(e){if(X(Ei(e)))return e}function Jn(e,t){if("change"===e)return t}var $n=!1;if(c){var Qn;if(c){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Qn=Zn}else Qn=!1;$n=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Xn=qn=null)}function nr(e){if("value"===e.propertyName&&Yn(Xn)){var t=[];Wn(t,Xn,e,Ae(e)),Be(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Xn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Xn)}function ar(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=cr(n,a);var o=cr(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=c&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,Dr=null,yr=!1;function Er(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==gr||gr!==K(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Dr&&ur(Dr,r)||(Dr=r,0<(r=qr(vr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function Ar(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Cr={animationend:Ar("Animation","AnimationEnd"),animationiteration:Ar("Animation","AnimationIteration"),animationstart:Ar("Animation","AnimationStart"),transitionend:Ar("Transition","TransitionEnd")},_r={},br={};function xr(e){if(_r[e])return _r[e];if(!Cr[e])return e;var t,n=Cr[e];for(t in n)if(n.hasOwnProperty(t)&&t in br)return _r[e]=n[t];return e}c&&(br=document.createElement("div").style,"AnimationEvent"in window||(delete Cr.animationend.animation,delete Cr.animationiteration.animation,delete Cr.animationstart.animation),"TransitionEvent"in window||delete Cr.transitionend.transition);var Fr=xr("animationend"),wr=xr("animationiteration"),Sr=xr("animationstart"),Tr=xr("transitionend"),Mr=new Map,Br="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Mr.set(e,t),u(t,[e])}for(var Nr=0;Nr<Br.length;Nr++){var Rr=Br[Nr];Pr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Pr(Fr,"onAnimationEnd"),Pr(wr,"onAnimationIteration"),Pr(Sr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Tr,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ir=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function kr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,u,l){if(Ve.apply(this,arguments),Ie){if(!Ie)throw Error(a(198));var c=ke;Ie=!1,ke=null,Oe||(Oe=!0,Ue=c)}}(r,t,void 0,e),e.currentTarget=null}function Or(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&i.isPropagationStopped())break e;kr(i,s,l),a=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,l=s.currentTarget,s=s.listener,u!==a&&i.isPropagationStopped())break e;kr(i,s,l),a=u}}}if(Oe)throw e=Ue,Oe=!1,Ue=null,e}function Ur(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function Gr(e){if(!e[Vr]){e[Vr]=!0,o.forEach(function(t){"selectionchange"!==t&&(Ir.has(t)||zr(t,!1,e),zr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,zr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Jt(t)){case 1:var i=Wt;break;case 4:i=qt;break;default:i=Xt}n=i.bind(null,t,n,e),i=void 0,!Ne||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function jr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=Di(s)))return;if(5===(u=o.tag)||6===u){r=a=o;continue e}s=s.parentNode}}r=r.return}Be(function(){var r=a,i=Ae(n),o=[];e:{var s=Mr.get(e);if(void 0!==s){var u=cn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=wn;break;case"focusin":l="focus",u=gn;break;case"focusout":l="blur",u=gn;break;case"beforeblur":case"afterblur":u=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Tn;break;case Fr:case wr:case Sr:u=vn;break;case Tr:u=Mn;break;case"scroll":u=dn;break;case"wheel":u=Pn;break;case"copy":case"cut":case"paste":u=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Sn}var c=0!==(4&t),h=!c&&"scroll"===e,d=c?null!==s?s+"Capture":null:s;c=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Pe(f,d))&&c.push(Wr(f,m,p)))),h)break;f=f.return}0<c.length&&(s=new u(s,l,null,n,i),o.push({event:s,listeners:c}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Ee||!(l=n.relatedTarget||n.fromElement)||!Di(l)&&!l[fi])&&(u||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(l=(l=n.relatedTarget||n.toElement)?Di(l):null)&&(l!==(h=Ge(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=r),u!==l)){if(c=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(c=Sn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==u?s:Ei(u),p=null==l?s:Ei(l),(s=new c(m,f+"leave",u,n,i)).target=h,s.relatedTarget=p,m=null,Di(i)===r&&((c=new c(d,f+"enter",l,n,i)).target=p,c.relatedTarget=h,m=c),h=m,u&&l)e:{for(d=l,f=0,p=c=u;p;p=Xr(p))f++;for(p=0,m=d;m;m=Xr(m))p++;for(;0<f-p;)c=Xr(c),f--;for(;0<p-f;)d=Xr(d),p--;for(;f--;){if(c===d||null!==d&&c===d.alternate)break e;c=Xr(c),d=Xr(d)}c=null}else c=null;null!==u&&Kr(o,s,u,c,!1),null!==l&&null!==h&&Kr(o,h,l,c,!0)}if("select"===(u=(s=r?Ei(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var g=Jn;else if(jn(s))if($n)g=or;else{g=ir;var v=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ar);switch(g&&(g=g(e,r))?Wn(o,g,n,i):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=r?Ei(r):window,e){case"focusin":(jn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,Dr=null);break;case"focusout":Dr=vr=gr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,Er(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":Er(o,n,i)}var D;if(Rn)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Gn?zn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(kn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Gn&&(D=en()):(Qt="value"in($t=i)?$t.value:$t.textContent,Gn=!0)),0<(v=qr(r,y)).length&&(y=new En(y,e,null,n,i),o.push({event:y,listeners:v}),D?y.data=D:null!==(D=Vn(n))&&(y.data=D))),(D=In?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Un=!0,On);case"textInput":return(e=t.data)===On&&Un?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Rn&&zn(e,t)?(e=en(),Zt=Qt=$t=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return kn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(i=new En("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=D))}Or(o,t)})}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Pe(e,n))&&r.unshift(Wr(e,a,i)),null!=(a=Pe(e,t))&&r.push(Wr(e,a,i))),e=e.return}return r}function Xr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==l&&(s=l,i?null!=(u=Pe(n,a))&&o.unshift(Wr(n,u,s)):i||null!=(u=Pe(n,a))&&o.push(Wr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function $r(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Jr,"")}function Qr(e,t,n){if(t=$r(t),$r(e)!==t&&n)throw Error(a(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,oi="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout(function(){throw e})}function ui(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Gt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Gt(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ci(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,pi="__reactProps$"+hi,fi="__reactContainer$"+hi,mi="__reactEvents$"+hi,gi="__reactListeners$"+hi,vi="__reactHandles$"+hi;function Di(e){var t=e[di];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ci(e);null!==e;){if(n=e[di])return n;e=ci(e)}return t}n=(e=n).parentNode}return null}function yi(e){return!(e=e[di]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ei(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function Ai(e){return e[pi]||null}var Ci=[],_i=-1;function bi(e){return{current:e}}function xi(e){0>_i||(e.current=Ci[_i],Ci[_i]=null,_i--)}function Fi(e,t){_i++,Ci[_i]=e.current,e.current=t}var wi={},Si=bi(wi),Ti=bi(!1),Mi=wi;function Bi(e,t){var n=e.type.contextTypes;if(!n)return wi;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ni(){xi(Ti),xi(Si)}function Ri(e,t,n){if(Si.current!==wi)throw Error(a(168));Fi(Si,t),Fi(Ti,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,H(e)||"Unknown",i));return k({},n,r)}function Ii(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||wi,Mi=Si.current,Fi(Si,e),Fi(Ti,Ti.current),!0}function ki(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Li(e,t,Mi),r.__reactInternalMemoizedMergedChildContext=e,xi(Ti),xi(Si),Fi(Si,e)):xi(Ti),Fi(Ti,n)}var Oi=null,Ui=!1,zi=!1;function Vi(e){null===Oi?Oi=[e]:Oi.push(e)}function Gi(){if(!zi&&null!==Oi){zi=!0;var e=0,t=yt;try{var n=Oi;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Oi=null,Ui=!1}catch(i){throw null!==Oi&&(Oi=Oi.slice(e+1)),Xe(Ze,Gi),i}finally{yt=t,zi=!1}}return null}var Hi=[],ji=0,Wi=null,qi=0,Xi=[],Ki=0,Yi=null,Ji=1,$i="";function Qi(e,t){Hi[ji++]=qi,Hi[ji++]=Wi,Wi=e,qi=t}function Zi(e,t,n){Xi[Ki++]=Ji,Xi[Ki++]=$i,Xi[Ki++]=Yi,Yi=e;var r=Ji;e=$i;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var a=32-ot(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Ji=1<<32-ot(t)+i|n<<i|r,$i=a+e}else Ji=1<<a|n<<i|r,$i=e}function ea(e){null!==e.return&&(Qi(e,1),Zi(e,1,0))}function ta(e){for(;e===Wi;)Wi=Hi[--ji],Hi[ji]=null,qi=Hi[--ji],Hi[ji]=null;for(;e===Yi;)Yi=Xi[--Ki],Xi[Ki]=null,$i=Xi[--Ki],Xi[Ki]=null,Ji=Xi[--Ki],Xi[Ki]=null}var na=null,ra=null,ia=!1,aa=null;function oa(e,t){var n=Bl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yi?{id:Ji,overflow:$i}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Bl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function ua(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function la(e){if(ia){var t=ra;if(t){var n=t;if(!sa(e,t)){if(ua(e))throw Error(a(418));t=li(n.nextSibling);var r=na;t&&sa(e,t)?oa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(ua(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function ca(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ha(e){if(e!==na)return!1;if(!ia)return ca(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(ua(e))throw da(),Error(a(418));for(;t;)oa(e,t),t=li(t.nextSibling)}if(ca(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?li(e.stateNode.nextSibling):null;return!0}function da(){for(var e=ra;e;)e=li(e.nextSibling)}function pa(){ra=na=null,ia=!1}function fa(e){null===aa?aa=[e]:aa.push(e)}var ma=E.ReactCurrentBatchConfig;function ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function va(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Da(e){return(0,e._init)(e._payload)}function ya(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Nl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=kl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===_?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===P&&Da(a)===t.type)?((r=i(t,n.props)).ref=ga(e,t,n),r.return=e,r):((r=Rl(n.type,n.key,n.props,null,e.mode,r)).ref=ga(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ol(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){return null===t||7!==t.tag?((t=Ll(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=kl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case A:return(n=Rl(t.type,t.key,t.props,null,e.mode,n)).ref=ga(e,null,t),n.return=e,n;case C:return(t=Ol(t,e.mode,n)).return=e,t;case P:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Ll(t,e.mode,n,null)).return=e,t;va(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case A:return n.key===i?l(e,t,n,r):null;case C:return n.key===i?c(e,t,n,r):null;case P:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:h(e,t,n,r,null);va(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case A:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case C:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case P:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return h(t,e=e.get(n)||null,r,i,null);va(t,r)}return null}function m(i,a,s,u){for(var l=null,c=null,h=a,m=a=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=p(i,h,s[m],u);if(null===v){null===h&&(h=g);break}e&&h&&null===v.alternate&&t(i,h),a=o(v,a,m),null===c?l=v:c.sibling=v,c=v,h=g}if(m===s.length)return n(i,h),ia&&Qi(i,m),l;if(null===h){for(;m<s.length;m++)null!==(h=d(i,s[m],u))&&(a=o(h,a,m),null===c?l=h:c.sibling=h,c=h);return ia&&Qi(i,m),l}for(h=r(i,h);m<s.length;m++)null!==(g=f(h,i,m,s[m],u))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),a=o(g,a,m),null===c?l=g:c.sibling=g,c=g);return e&&h.forEach(function(e){return t(i,e)}),ia&&Qi(i,m),l}function g(i,s,u,l){var c=L(u);if("function"!==typeof c)throw Error(a(150));if(null==(u=c.call(u)))throw Error(a(151));for(var h=c=null,m=s,g=s=0,v=null,D=u.next();null!==m&&!D.done;g++,D=u.next()){m.index>g?(v=m,m=null):v=m.sibling;var y=p(i,m,D.value,l);if(null===y){null===m&&(m=v);break}e&&m&&null===y.alternate&&t(i,m),s=o(y,s,g),null===h?c=y:h.sibling=y,h=y,m=v}if(D.done)return n(i,m),ia&&Qi(i,g),c;if(null===m){for(;!D.done;g++,D=u.next())null!==(D=d(i,D.value,l))&&(s=o(D,s,g),null===h?c=D:h.sibling=D,h=D);return ia&&Qi(i,g),c}for(m=r(i,m);!D.done;g++,D=u.next())null!==(D=f(m,i,g,D.value,l))&&(e&&null!==D.alternate&&m.delete(null===D.key?g:D.key),s=o(D,s,g),null===h?c=D:h.sibling=D,h=D);return e&&m.forEach(function(e){return t(i,e)}),ia&&Qi(i,g),c}return function e(r,a,o,u){if("object"===typeof o&&null!==o&&o.type===_&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case A:e:{for(var l=o.key,c=a;null!==c;){if(c.key===l){if((l=o.type)===_){if(7===c.tag){n(r,c.sibling),(a=i(c,o.props.children)).return=r,r=a;break e}}else if(c.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===P&&Da(l)===c.type){n(r,c.sibling),(a=i(c,o.props)).ref=ga(r,c,o),a.return=r,r=a;break e}n(r,c);break}t(r,c),c=c.sibling}o.type===_?((a=Ll(o.props.children,r.mode,u,o.key)).return=r,r=a):((u=Rl(o.type,o.key,o.props,null,r.mode,u)).ref=ga(r,a,o),u.return=r,r=u)}return s(r);case C:e:{for(c=o.key;null!==a;){if(a.key===c){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Ol(o,r.mode,u)).return=r,r=a}return s(r);case P:return e(r,a,(c=o._init)(o._payload),u)}if(te(o))return m(r,a,o,u);if(L(o))return g(r,a,o,u);va(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,o)).return=r,r=a):(n(r,a),(a=kl(o,r.mode,u)).return=r,r=a),s(r)):n(r,a)}}var Ea=ya(!0),Aa=ya(!1),Ca=bi(null),_a=null,ba=null,xa=null;function Fa(){xa=ba=_a=null}function wa(e){var t=Ca.current;xi(Ca),e._currentValue=t}function Sa(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ta(e,t){_a=e,xa=ba=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ys=!0),e.firstContext=null)}function Ma(e){var t=e._currentValue;if(xa!==e)if(e={context:e,memoizedValue:t,next:null},null===ba){if(null===_a)throw Error(a(308));ba=e,_a.dependencies={lanes:0,firstContext:e}}else ba=ba.next=e;return t}var Ba=null;function Pa(e){null===Ba?Ba=[e]:Ba.push(e)}function Na(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Pa(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ra(e,r)}function Ra(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var La=!1;function Ia(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ka(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Oa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ua(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Su)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ra(e,n)}return null===(i=r.interleaved)?(t.next=t,Pa(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ra(e,n)}function za(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Dt(e,n)}}function Va(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ga(e,t,n,r){var i=e.updateQueue;La=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var u=s,l=u.next;u.next=null,null===o?a=l:o.next=l,o=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==a){var h=i.baseState;for(o=0,c=l=u=null,s=a;;){var d=s.lane,p=s.eventTime;if((r&d)===d){null!==c&&(c=c.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(d=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break e;h=k({},h,d);break e;case 2:La=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=p,u=h):c=c.next=p,o|=d;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(d=s).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===c&&(u=h),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Iu|=o,e.lanes=o,e.memoizedState=h}}function Ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var ja={},Wa=bi(ja),qa=bi(ja),Xa=bi(ja);function Ka(e){if(e===ja)throw Error(a(174));return e}function Ya(e,t){switch(Fi(Xa,t),Fi(qa,e),Fi(Wa,ja),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}xi(Wa),Fi(Wa,t)}function Ja(){xi(Wa),xi(qa),xi(Xa)}function $a(e){Ka(Xa.current);var t=Ka(Wa.current),n=ue(t,e.type);t!==n&&(Fi(qa,e),Fi(Wa,n))}function Qa(e){qa.current===e&&(xi(Wa),xi(qa))}var Za=bi(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function no(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=E.ReactCurrentDispatcher,io=E.ReactCurrentBatchConfig,ao=0,oo=null,so=null,uo=null,lo=!1,co=!1,ho=0,po=0;function fo(){throw Error(a(321))}function mo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function go(e,t,n,r,i,o){if(ao=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?Zo:es,e=n(r,i),co){o=0;do{if(co=!1,ho=0,25<=o)throw Error(a(301));o+=1,uo=so=null,t.updateQueue=null,ro.current=ts,e=n(r,i)}while(co)}if(ro.current=Qo,t=null!==so&&null!==so.next,ao=0,uo=so=oo=null,lo=!1,t)throw Error(a(300));return e}function vo(){var e=0!==ho;return ho=0,e}function Do(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===uo?oo.memoizedState=uo=e:uo=uo.next=e,uo}function yo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===uo?oo.memoizedState:uo.next;if(null!==t)uo=t,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===uo?oo.memoizedState=uo=e:uo=uo.next=e}return uo}function Eo(e,t){return"function"===typeof t?t(e):t}function Ao(e){var t=yo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=so,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var u=s=null,l=null,c=o;do{var h=c.lane;if((ao&h)===h)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(u=l=d,s=r):l=l.next=d,oo.lanes|=h,Iu|=h}c=c.next}while(null!==c&&c!==o);null===l?s=r:l.next=u,sr(r,t.memoizedState)||(ys=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,oo.lanes|=o,Iu|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Co(e){var t=yo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,t.memoizedState)||(ys=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function _o(){}function bo(e,t){var n=oo,r=yo(),i=t(),o=!sr(r.memoizedState,i);if(o&&(r.memoizedState=i,ys=!0),r=r.queue,Io(wo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==uo&&1&uo.memoizedState.tag){if(n.flags|=2048,Bo(9,Fo.bind(null,n,r,i,t),void 0,null),null===Tu)throw Error(a(349));0!==(30&ao)||xo(n,t,i)}return i}function xo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Fo(e,t,n,r){t.value=n,t.getSnapshot=r,So(t)&&To(e)}function wo(e,t,n){return n(function(){So(t)&&To(e)})}function So(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function To(e){var t=Ra(e,1);null!==t&&nl(t,e,1,-1)}function Mo(e){var t=Do();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eo,lastRenderedState:e},t.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[t.memoizedState,e]}function Bo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Po(){return yo().memoizedState}function No(e,t,n,r){var i=Do();oo.flags|=e,i.memoizedState=Bo(1|t,n,void 0,void 0===r?null:r)}function Ro(e,t,n,r){var i=yo();r=void 0===r?null:r;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==r&&mo(r,o.deps))return void(i.memoizedState=Bo(t,n,a,r))}oo.flags|=e,i.memoizedState=Bo(1|t,n,a,r)}function Lo(e,t){return No(8390656,8,e,t)}function Io(e,t){return Ro(2048,8,e,t)}function ko(e,t){return Ro(4,2,e,t)}function Oo(e,t){return Ro(4,4,e,t)}function Uo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ro(4,4,Uo.bind(null,t,e),n)}function Vo(){}function Go(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ho(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function jo(e,t,n){return 0===(21&ao)?(e.baseState&&(e.baseState=!1,ys=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),oo.lanes|=n,Iu|=n,e.baseState=!0),t)}function Wo(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=io.transition;io.transition={};try{e(!1),t()}finally{yt=n,io.transition=r}}function qo(){return yo().memoizedState}function Xo(e,t,n){var r=tl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Yo(e))Jo(t,n);else if(null!==(n=Na(e,t,n,r))){nl(n,e,r,el()),$o(n,t,r)}}function Ko(e,t,n){var r=tl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yo(e))Jo(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(i.next=i,Pa(t)):(i.next=u.next,u.next=i),void(t.interleaved=i)}}catch(l){}null!==(n=Na(e,t,i,r))&&(nl(n,e,r,i=el()),$o(n,t,r))}}function Yo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Jo(e,t){co=lo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function $o(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Dt(e,n)}}var Qo={readContext:Ma,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useInsertionEffect:fo,useLayoutEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useMutableSource:fo,useSyncExternalStore:fo,useId:fo,unstable_isNewReconciler:!1},Zo={readContext:Ma,useCallback:function(e,t){return Do().memoizedState=[e,void 0===t?null:t],e},useContext:Ma,useEffect:Lo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,No(4194308,4,Uo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return No(4194308,4,e,t)},useInsertionEffect:function(e,t){return No(4,2,e,t)},useMemo:function(e,t){var n=Do();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Do();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Xo.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Do().memoizedState=e},useState:Mo,useDebugValue:Vo,useDeferredValue:function(e){return Do().memoizedState=e},useTransition:function(){var e=Mo(!1),t=e[0];return e=Wo.bind(null,e[1]),Do().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=oo,i=Do();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Tu)throw Error(a(349));0!==(30&ao)||xo(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Lo(wo.bind(null,r,o,e),[e]),r.flags|=2048,Bo(9,Fo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Do(),t=Tu.identifierPrefix;if(ia){var n=$i;t=":"+t+"R"+(n=(Ji&~(1<<32-ot(Ji)-1)).toString(32)+n),0<(n=ho++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=po++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Ma,useCallback:Go,useContext:Ma,useEffect:Io,useImperativeHandle:zo,useInsertionEffect:ko,useLayoutEffect:Oo,useMemo:Ho,useReducer:Ao,useRef:Po,useState:function(){return Ao(Eo)},useDebugValue:Vo,useDeferredValue:function(e){return jo(yo(),so.memoizedState,e)},useTransition:function(){return[Ao(Eo)[0],yo().memoizedState]},useMutableSource:_o,useSyncExternalStore:bo,useId:qo,unstable_isNewReconciler:!1},ts={readContext:Ma,useCallback:Go,useContext:Ma,useEffect:Io,useImperativeHandle:zo,useInsertionEffect:ko,useLayoutEffect:Oo,useMemo:Ho,useReducer:Co,useRef:Po,useState:function(){return Co(Eo)},useDebugValue:Vo,useDeferredValue:function(e){var t=yo();return null===so?t.memoizedState=e:jo(t,so.memoizedState,e)},useTransition:function(){return[Co(Eo)[0],yo().memoizedState]},useMutableSource:_o,useSyncExternalStore:bo,useId:qo,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=k({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:k({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),a=Oa(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,i))&&(nl(t,e,i,r),za(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),a=Oa(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,i))&&(nl(t,e,i,r),za(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),r=tl(e),i=Oa(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Ua(e,i,r))&&(nl(t,e,r,n),za(t,e,r))}};function as(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(i,a))}function os(e,t,n){var r=!1,i=wi,a=t.contextType;return"object"===typeof a&&null!==a?a=Ma(a):(i=Pi(t)?Mi:Si.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Bi(e,i):wi),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=is,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&is.enqueueReplaceState(t,t.state,null)}function us(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Ia(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=Ma(a):(a=Pi(t)?Mi:Si.current,i.context=Bi(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&is.enqueueReplaceState(i,i.state,null),Ga(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function cs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Oa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ju||(ju=!0,Wu=r),hs(0,t)},n}function fs(e,t,n){(n=Oa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){hs(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!==typeof r&&(null===qu?qu=new Set([this]):qu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=xl.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Oa(-1,1)).tag=2,Ua(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var Ds=E.ReactCurrentOwner,ys=!1;function Es(e,t,n,r){t.child=null===e?Aa(t,null,n,r):Ea(t,e.child,n,r)}function As(e,t,n,r,i){n=n.render;var a=t.ref;return Ta(t,i),r=go(e,t,n,r,a,i),n=vo(),null===e||ys?(ia&&n&&ea(t),t.flags|=1,Es(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,js(e,t,i))}function Cs(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Pl(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rl(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,_s(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return js(e,t,i)}return t.flags|=1,(e=Nl(a,r)).ref=t.ref,e.return=t,t.child=e}function _s(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ur(a,r)&&e.ref===t.ref){if(ys=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,js(e,t,i);0!==(131072&e.flags)&&(ys=!0)}}return Fs(e,t,n,r,i)}function bs(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fi(Nu,Pu),Pu|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Fi(Nu,Pu),Pu|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Fi(Nu,Pu),Pu|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Fi(Nu,Pu),Pu|=r;return Es(e,t,i,n),t.child}function xs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Fs(e,t,n,r,i){var a=Pi(n)?Mi:Si.current;return a=Bi(t,a),Ta(t,i),n=go(e,t,n,r,a,i),r=vo(),null===e||ys?(ia&&r&&ea(t),t.flags|=1,Es(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,js(e,t,i))}function ws(e,t,n,r,i){if(Pi(n)){var a=!0;Ii(t)}else a=!1;if(Ta(t,i),null===t.stateNode)Hs(e,t),os(t,n,r),us(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ma(l):l=Bi(t,l=Pi(n)?Mi:Si.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==l)&&ss(t,o,r,l),La=!1;var d=t.memoizedState;o.state=d,Ga(t,r,o,i),u=t.memoizedState,s!==r||d!==u||Ti.current||La?("function"===typeof c&&(rs(t,n,c,r),u=t.memoizedState),(s=La||as(t,n,s,r,d,u,l))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,ka(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),o.props=l,h=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ma(u):u=Bi(t,u=Pi(n)?Mi:Si.current);var p=n.getDerivedStateFromProps;(c="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==u)&&ss(t,o,r,u),La=!1,d=t.memoizedState,o.state=d,Ga(t,r,o,i);var f=t.memoizedState;s!==h||d!==f||Ti.current||La?("function"===typeof p&&(rs(t,n,p,r),f=t.memoizedState),(l=La||as(t,n,l,r,d,f,u)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=u,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ss(e,t,n,r,a,i)}function Ss(e,t,n,r,i,a){xs(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&ki(t,n,!1),js(e,t,a);r=t.stateNode,Ds.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Ea(t,e.child,null,a),t.child=Ea(t,null,s,a)):Es(e,t,s,a),t.memoizedState=r.state,i&&ki(t,n,!0),t.child}function Ts(e){var t=e.stateNode;t.pendingContext?Ri(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ri(0,t.context,!1),Ya(e,t.containerInfo)}function Ms(e,t,n,r,i){return pa(),fa(i),t.flags|=256,Es(e,t,n,r),t.child}var Bs,Ps,Ns,Rs,Ls={dehydrated:null,treeContext:null,retryLane:0};function Is(e){return{baseLanes:e,cachePool:null,transitions:null}}function ks(e,t,n){var r,i=t.pendingProps,o=Za.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Fi(Za,1&o),null===e)return la(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=i.children,e=i.fallback,s?(i=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Il(u,i,0,null),e=Ll(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Is(n),t.memoizedState=Ls,e):Os(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,s){if(n)return 256&t.flags?(t.flags&=-257,Us(e,t,s,r=cs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Il({mode:"visible",children:r.children},i,0,null),(o=Ll(o,i,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Ea(t,e.child,null,s),t.child.memoizedState=Is(s),t.memoizedState=Ls,o);if(0===(1&t.mode))return Us(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var u=r.dgst;return r=u,Us(e,t,s,r=cs(o=Error(a(419)),r,void 0))}if(u=0!==(s&e.childLanes),ys||u){if(null!==(r=Tu)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Ra(e,i),nl(r,e,i,-1))}return ml(),Us(e,t,s,r=cs(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=wl.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,ra=li(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&(Xi[Ki++]=Ji,Xi[Ki++]=$i,Xi[Ki++]=Yi,Ji=e.id,$i=e.overflow,Yi=t),t=Os(t,r.children),t.flags|=4096,t)}(e,t,u,i,r,o,n);if(s){s=i.fallback,u=t.mode,r=(o=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&u)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Nl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Nl(r,s):(s=Ll(s,u,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,u=null===(u=e.child.memoizedState)?Is(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Ls,i}return e=(s=e.child).sibling,i=Nl(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Os(e,t){return(t=Il({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Us(e,t,n,r){return null!==r&&fa(r),Ea(t,e.child,null,n),(e=Os(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Sa(e.return,t,n)}function Vs(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Gs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Es(e,t,r.children,n),0!==(2&(r=Za.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zs(e,n,t);else if(19===e.tag)zs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Fi(Za,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===eo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Vs(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===eo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Vs(t,!0,n,null,a);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Hs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function js(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Iu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Nl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Nl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ws(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xs(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(t),null;case 1:case 17:return Pi(t.type)&&Ni(),qs(t),null;case 3:return r=t.stateNode,Ja(),xi(Ti),xi(Si),no(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ha(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(ol(aa),aa=null))),Ps(e,t),qs(t),null;case 5:Qa(t);var i=Ka(Xa.current);if(n=t.type,null!==e&&null!=t.stateNode)Ns(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return qs(t),null}if(e=Ka(Wa.current),ha(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[di]=t,r[pi]=o,e=0!==(1&t.mode),n){case"dialog":Ur("cancel",r),Ur("close",r);break;case"iframe":case"object":case"embed":Ur("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)Ur(Lr[i],r);break;case"source":Ur("error",r);break;case"img":case"image":case"link":Ur("error",r),Ur("load",r);break;case"details":Ur("toggle",r);break;case"input":J(r,o),Ur("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ur("invalid",r);break;case"textarea":ie(r,o),Ur("invalid",r)}for(var u in De(n,o),i=null,o)if(o.hasOwnProperty(u)){var l=o[u];"children"===u?"string"===typeof l?r.textContent!==l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",""+l]):s.hasOwnProperty(u)&&null!=l&&"onScroll"===u&&Ur("scroll",r)}switch(n){case"input":q(r),Z(r,o,!0);break;case"textarea":q(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[di]=t,e[pi]=r,Bs(e,t,!1,!1),t.stateNode=e;e:{switch(u=ye(n,r),n){case"dialog":Ur("cancel",e),Ur("close",e),i=r;break;case"iframe":case"object":case"embed":Ur("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)Ur(Lr[i],e);i=r;break;case"source":Ur("error",e),i=r;break;case"img":case"image":case"link":Ur("error",e),Ur("load",e),i=r;break;case"details":Ur("toggle",e),i=r;break;case"input":J(e,r),i=Y(e,r),Ur("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=k({},r,{value:void 0}),Ur("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Ur("invalid",e)}for(o in De(n,i),l=i)if(l.hasOwnProperty(o)){var c=l[o];"style"===o?ge(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&he(e,c):"children"===o?"string"===typeof c?("textarea"!==n||""!==c)&&de(e,c):"number"===typeof c&&de(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=c&&"onScroll"===o&&Ur("scroll",e):null!=c&&y(e,o,c,u))}switch(n){case"input":q(e),Z(e,r,!1);break;case"textarea":q(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+j(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qs(t),null;case 6:if(e&&null!=t.stateNode)Rs(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Ka(Xa.current),Ka(Wa.current),ha(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(o=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return qs(t),null;case 13:if(xi(Za),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))da(),pa(),t.flags|=98560,o=!1;else if(o=ha(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[di]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qs(t),o=!1}else null!==aa&&(ol(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Za.current)?0===Ru&&(Ru=3):ml())),null!==t.updateQueue&&(t.flags|=4),qs(t),null);case 4:return Ja(),Ps(e,t),null===e&&Gr(t.stateNode.containerInfo),qs(t),null;case 10:return wa(t.type._context),qs(t),null;case 19:if(xi(Za),null===(o=t.memoizedState))return qs(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)Ws(o,!1);else{if(0!==Ru||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=eo(e))){for(t.flags|=128,Ws(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Fi(Za,1&Za.current|2),t.child}e=e.sibling}null!==o.tail&&$e()>Gu&&(t.flags|=128,r=!0,Ws(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ws(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ia)return qs(t),null}else 2*$e()-o.renderingStartTime>Gu&&1073741824!==n&&(t.flags|=128,r=!0,Ws(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=$e(),t.sibling=null,n=Za.current,Fi(Za,r?1&n|2:1&n),t):(qs(t),null);case 22:case 23:return hl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Pu)&&(qs(t),6&t.subtreeFlags&&(t.flags|=8192)):qs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ks(e,t){switch(ta(t),t.tag){case 1:return Pi(t.type)&&Ni(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ja(),xi(Ti),xi(Si),no(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Qa(t),null;case 13:if(xi(Za),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return xi(Za),null;case 4:return Ja(),null;case 10:return wa(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Bs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ps=function(){},Ns=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Ka(Wa.current);var a,o=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),o=[];break;case"select":i=k({},i,{value:void 0}),r=k({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(c in De(n,r),n=null,i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&null!=i[c])if("style"===c){var u=i[c];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(u=null!=i?i[c]:void 0,r.hasOwnProperty(c)&&l!==u&&(null!=l||null!=u))if("style"===c)if(u){for(a in u)!u.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&u[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(o=o||[]).push(c,l)):"children"===c?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&Ur("scroll",e),o||u===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Rs=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ys=!1,Js=!1,$s="function"===typeof WeakSet?WeakSet:Set,Qs=null;function Zs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){bl(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){bl(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&eu(t,n,a)}i=i.next}while(i!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function au(e){var t=e.alternate;null!==t&&(e.alternate=null,au(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[di],delete t[pi],delete t[mi],delete t[gi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ou(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ou(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var cu=null,hu=!1;function du(e,t,n){for(n=n.child;null!==n;)pu(e,t,n),n=n.sibling}function pu(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:Js||Zs(n,t);case 6:var r=cu,i=hu;cu=null,du(e,t,n),hu=i,null!==(cu=r)&&(hu?(e=cu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cu.removeChild(n.stateNode));break;case 18:null!==cu&&(hu?(e=cu,n=n.stateNode,8===e.nodeType?ui(e.parentNode,n):1===e.nodeType&&ui(e,n),Gt(e)):ui(cu,n.stateNode));break;case 4:r=cu,i=hu,cu=n.stateNode.containerInfo,hu=!0,du(e,t,n),cu=r,hu=i;break;case 0:case 11:case 14:case 15:if(!Js&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&eu(n,t,o),i=i.next}while(i!==r)}du(e,t,n);break;case 1:if(!Js&&(Zs(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){bl(n,t,s)}du(e,t,n);break;case 21:du(e,t,n);break;case 22:1&n.mode?(Js=(r=Js)||null!==n.memoizedState,du(e,t,n),Js=r):du(e,t,n);break;default:du(e,t,n)}}function fu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $s),t.forEach(function(t){var r=Sl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function mu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:cu=u.stateNode,hu=!1;break e;case 3:case 4:cu=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===cu)throw Error(a(160));pu(o,s,i),cu=null,hu=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(c){bl(i,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gu(t,e),t=t.sibling}function gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mu(t,e),vu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(g){bl(e,e.return,g)}try{nu(5,e,e.return)}catch(g){bl(e,e.return,g)}}break;case 1:mu(t,e),vu(e),512&r&&null!==n&&Zs(n,n.return);break;case 5:if(mu(t,e),vu(e),512&r&&null!==n&&Zs(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(g){bl(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===u&&"radio"===o.type&&null!=o.name&&$(i,o),ye(u,s);var c=ye(u,o);for(s=0;s<l.length;s+=2){var h=l[s],d=l[s+1];"style"===h?ge(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):y(i,h,d,c)}switch(u){case"input":Q(i,o);break;case"textarea":ae(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ne(i,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[pi]=o}catch(g){bl(e,e.return,g)}}break;case 6:if(mu(t,e),vu(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(g){bl(e,e.return,g)}}break;case 3:if(mu(t,e),vu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){bl(e,e.return,g)}break;case 4:default:mu(t,e),vu(e);break;case 13:mu(t,e),vu(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Vu=$e())),4&r&&fu(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Js=(c=Js)||h,mu(t,e),Js=c):mu(t,e),vu(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!h&&0!==(1&e.mode))for(Qs=e,h=e.child;null!==h;){for(d=Qs=h;null!==Qs;){switch(f=(p=Qs).child,p.tag){case 0:case 11:case 14:case 15:nu(4,p,p.return);break;case 1:Zs(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){bl(r,n,g)}}break;case 5:Zs(p,p.return);break;case 22:if(null!==p.memoizedState){Au(d);continue}}null!==f?(f.return=p,Qs=f):Au(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,c?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=d.stateNode,s=void 0!==(l=d.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,u.style.display=me("display",s))}catch(g){bl(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){bl(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:mu(t,e),vu(e),4&r&&fu(e);case 21:}}function vu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ou(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),lu(e,su(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;uu(e,su(e),o);break;default:throw Error(a(161))}}catch(s){bl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Du(e,t,n){Qs=e,yu(e,t,n)}function yu(e,t,n){for(var r=0!==(1&e.mode);null!==Qs;){var i=Qs,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Ys;if(!o){var s=i.alternate,u=null!==s&&null!==s.memoizedState||Js;s=Ys;var l=Js;if(Ys=o,(Js=u)&&!l)for(Qs=i;null!==Qs;)u=(o=Qs).child,22===o.tag&&null!==o.memoizedState?Cu(i):null!==u?(u.return=o,Qs=u):Cu(i);for(;null!==a;)Qs=a,yu(a,t,n),a=a.sibling;Qs=i,Ys=s,Js=l}Eu(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,Qs=a):Eu(e)}}function Eu(e){for(;null!==Qs;){var t=Qs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Js||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Js)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Ha(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ha(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Gt(d)}}}break;default:throw Error(a(163))}Js||512&t.flags&&iu(t)}catch(p){bl(t,t.return,p)}}if(t===e){Qs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qs=n;break}Qs=t.return}}function Au(e){for(;null!==Qs;){var t=Qs;if(t===e){Qs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qs=n;break}Qs=t.return}}function Cu(e){for(;null!==Qs;){var t=Qs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){bl(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(u){bl(t,i,u)}}var a=t.return;try{iu(t)}catch(u){bl(t,a,u)}break;case 5:var o=t.return;try{iu(t)}catch(u){bl(t,o,u)}}}catch(u){bl(t,t.return,u)}if(t===e){Qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Qs=s;break}Qs=t.return}}var _u,bu=Math.ceil,xu=E.ReactCurrentDispatcher,Fu=E.ReactCurrentOwner,wu=E.ReactCurrentBatchConfig,Su=0,Tu=null,Mu=null,Bu=0,Pu=0,Nu=bi(0),Ru=0,Lu=null,Iu=0,ku=0,Ou=0,Uu=null,zu=null,Vu=0,Gu=1/0,Hu=null,ju=!1,Wu=null,qu=null,Xu=!1,Ku=null,Yu=0,Ju=0,$u=null,Qu=-1,Zu=0;function el(){return 0!==(6&Su)?$e():-1!==Qu?Qu:Qu=$e()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Su)&&0!==Bu?Bu&-Bu:null!==ma.transition?(0===Zu&&(Zu=mt()),Zu):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function nl(e,t,n,r){if(50<Ju)throw Ju=0,$u=null,Error(a(185));vt(e,n,r),0!==(2&Su)&&e===Tu||(e===Tu&&(0===(2&Su)&&(ku|=n),4===Ru&&sl(e,Bu)),rl(e,r),1===n&&0===Su&&0===(1&t.mode)&&(Gu=$e()+500,Ui&&Gi()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,u=i[o];-1===u?0!==(s&n)&&0===(s&r)||(i[o]=pt(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=dt(e,e===Tu?Bu:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Ui=!0,Vi(e)}(ul.bind(null,e)):Vi(ul.bind(null,e)),oi(function(){0===(6&Su)&&Gi()}),n=null;else{switch(Et(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Tl(n,il.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function il(e,t){if(Qu=-1,Zu=0,0!==(6&Su))throw Error(a(327));var n=e.callbackNode;if(Cl()&&e.callbackNode!==n)return null;var r=dt(e,e===Tu?Bu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gl(e,r);else{t=r;var i=Su;Su|=2;var o=fl();for(Tu===e&&Bu===t||(Hu=null,Gu=$e()+500,dl(e,t));;)try{Dl();break}catch(u){pl(e,u)}Fa(),xu.current=o,Su=i,null!==Mu?t=0:(Tu=null,Bu=0,t=Ru)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(r=i,t=al(e,i))),1===t)throw n=Lu,dl(e,0),sl(e,r),rl(e,$e()),n;if(6===t)sl(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!sr(a(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gl(e,r))&&(0!==(o=ft(e))&&(r=o,t=al(e,o))),1===t))throw n=Lu,dl(e,0),sl(e,r),rl(e,$e()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:Al(e,zu,Hu);break;case 3:if(sl(e,r),(130023424&r)===r&&10<(t=Vu+500-$e())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){el(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(Al.bind(null,e,zu,Hu),t);break}Al(e,zu,Hu);break;case 4:if(sl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=$e()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*bu(r/1960))-r)){e.timeoutHandle=ri(Al.bind(null,e,zu,Hu),r);break}Al(e,zu,Hu);break;default:throw Error(a(329))}}}return rl(e,$e()),e.callbackNode===n?il.bind(null,e):null}function al(e,t){var n=Uu;return e.current.memoizedState.isDehydrated&&(dl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=zu,zu=n,null!==t&&ol(t)),e}function ol(e){null===zu?zu=e:zu.push.apply(zu,e)}function sl(e,t){for(t&=~Ou,t&=~ku,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function ul(e){if(0!==(6&Su))throw Error(a(327));Cl();var t=dt(e,0);if(0===(1&t))return rl(e,$e()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=al(e,r))}if(1===n)throw n=Lu,dl(e,0),sl(e,t),rl(e,$e()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Al(e,zu,Hu),rl(e,$e()),null}function ll(e,t){var n=Su;Su|=1;try{return e(t)}finally{0===(Su=n)&&(Gu=$e()+500,Ui&&Gi())}}function cl(e){null!==Ku&&0===Ku.tag&&0===(6&Su)&&Cl();var t=Su;Su|=1;var n=wu.transition,r=yt;try{if(wu.transition=null,yt=1,e)return e()}finally{yt=r,wu.transition=n,0===(6&(Su=t))&&Gi()}}function hl(){Pu=Nu.current,xi(Nu)}function dl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Mu)for(n=Mu.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ni();break;case 3:Ja(),xi(Ti),xi(Si),no();break;case 5:Qa(r);break;case 4:Ja();break;case 13:case 19:xi(Za);break;case 10:wa(r.type._context);break;case 22:case 23:hl()}n=n.return}if(Tu=e,Mu=e=Nl(e.current,null),Bu=Pu=t,Ru=0,Lu=null,Ou=ku=Iu=0,zu=Uu=null,null!==Ba){for(t=0;t<Ba.length;t++)if(null!==(r=(n=Ba[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}Ba=null}return e}function pl(e,t){for(;;){var n=Mu;try{if(Fa(),ro.current=Qo,lo){for(var r=oo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}lo=!1}if(ao=0,uo=so=oo=null,co=!1,ho=0,Fu.current=null,null===n||null===n.return){Ru=1,Lu=t,Mu=null;break}e:{var o=e,s=n.return,u=n,l=t;if(t=Bu,u.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l,h=u,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,vs(f,s,u,0,t),1&f.mode&&ms(o,c,t),l=c;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(0===(1&t)){ms(o,c,t),ml();break e}l=Error(a(426))}else if(ia&&1&u.mode){var v=gs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,u,0,t),fa(ls(l,u));break e}}o=l=ls(l,u),4!==Ru&&(Ru=2),null===Uu?Uu=[o]:Uu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Va(o,ps(0,l,t));break e;case 1:u=l;var D=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof D.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===qu||!qu.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Va(o,fs(o,u,t));break e}}o=o.return}while(null!==o)}El(n)}catch(E){t=E,Mu===n&&null!==n&&(Mu=n=n.return);continue}break}}function fl(){var e=xu.current;return xu.current=Qo,null===e?Qo:e}function ml(){0!==Ru&&3!==Ru&&2!==Ru||(Ru=4),null===Tu||0===(268435455&Iu)&&0===(268435455&ku)||sl(Tu,Bu)}function gl(e,t){var n=Su;Su|=2;var r=fl();for(Tu===e&&Bu===t||(Hu=null,dl(e,t));;)try{vl();break}catch(i){pl(e,i)}if(Fa(),Su=n,xu.current=r,null!==Mu)throw Error(a(261));return Tu=null,Bu=0,Ru}function vl(){for(;null!==Mu;)yl(Mu)}function Dl(){for(;null!==Mu&&!Ye();)yl(Mu)}function yl(e){var t=_u(e.alternate,e,Pu);e.memoizedProps=e.pendingProps,null===t?El(e):Mu=t,Fu.current=null}function El(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,Pu)))return void(Mu=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Mu=n);if(null===e)return Ru=6,void(Mu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Mu=t);Mu=t=e}while(null!==t);0===Ru&&(Ru=5)}function Al(e,t,n){var r=yt,i=wu.transition;try{wu.transition=null,yt=1,function(e,t,n,r){do{Cl()}while(null!==Ku);if(0!==(6&Su))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,o),e===Tu&&(Mu=Tu=null,Bu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xu||(Xu=!0,Tl(tt,function(){return Cl(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=wu.transition,wu.transition=null;var s=yt;yt=1;var u=Su;Su|=4,Fu.current=null,function(e,t){if(ei=jt,pr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(A){n=null;break e}var s=0,u=-1,l=-1,c=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==i&&3!==d.nodeType||(u=s+i),d!==o||0!==r&&3!==d.nodeType||(l=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++c===i&&(u=s),p===o&&++h===r&&(l=s),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},jt=!1,Qs=t;null!==Qs;)if(e=(t=Qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qs=e;else for(;null!==Qs;){t=Qs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,D=t.stateNode,y=D.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),v);D.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(a(163))}}catch(A){bl(t,t.return,A)}if(null!==(e=t.sibling)){e.return=t.return,Qs=e;break}Qs=t.return}m=tu,tu=!1}(e,n),gu(n,e),fr(ti),jt=!!ei,ti=ei=null,e.current=n,Du(n,e,i),Je(),Su=u,yt=s,wu.transition=o}else e.current=n;if(Xu&&(Xu=!1,Ku=e,Yu=i),o=e.pendingLanes,0===o&&(qu=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rl(e,$e()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ju)throw ju=!1,e=Wu,Wu=null,e;0!==(1&Yu)&&0!==e.tag&&Cl(),o=e.pendingLanes,0!==(1&o)?e===$u?Ju++:(Ju=0,$u=e):Ju=0,Gi()}(e,t,n,r)}finally{wu.transition=i,yt=r}return null}function Cl(){if(null!==Ku){var e=Et(Yu),t=wu.transition,n=yt;try{if(wu.transition=null,yt=16>e?16:e,null===Ku)var r=!1;else{if(e=Ku,Ku=null,Yu=0,0!==(6&Su))throw Error(a(331));var i=Su;for(Su|=4,Qs=e.current;null!==Qs;){var o=Qs,s=o.child;if(0!==(16&Qs.flags)){var u=o.deletions;if(null!==u){for(var l=0;l<u.length;l++){var c=u[l];for(Qs=c;null!==Qs;){var h=Qs;switch(h.tag){case 0:case 11:case 15:nu(8,h,o)}var d=h.child;if(null!==d)d.return=h,Qs=d;else for(;null!==Qs;){var p=(h=Qs).sibling,f=h.return;if(au(h),h===c){Qs=null;break}if(null!==p){p.return=f,Qs=p;break}Qs=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Qs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Qs=s;else e:for(;null!==Qs;){if(0!==(2048&(o=Qs).flags))switch(o.tag){case 0:case 11:case 15:nu(9,o,o.return)}var D=o.sibling;if(null!==D){D.return=o.return,Qs=D;break e}Qs=o.return}}var y=e.current;for(Qs=y;null!==Qs;){var E=(s=Qs).child;if(0!==(2064&s.subtreeFlags)&&null!==E)E.return=s,Qs=E;else e:for(s=y;null!==Qs;){if(0!==(2048&(u=Qs).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(C){bl(u,u.return,C)}if(u===s){Qs=null;break e}var A=u.sibling;if(null!==A){A.return=u.return,Qs=A;break e}Qs=u.return}}if(Su=i,Gi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(C){}r=!0}return r}finally{yt=n,wu.transition=t}}return!1}function _l(e,t,n){e=Ua(e,t=ps(0,t=ls(n,t),1),1),t=el(),null!==e&&(vt(e,1,t),rl(e,t))}function bl(e,t,n){if(3===e.tag)_l(e,e,n);else for(;null!==t;){if(3===t.tag){_l(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===qu||!qu.has(r))){t=Ua(t,e=fs(t,e=ls(n,e),1),1),e=el(),null!==t&&(vt(t,1,e),rl(t,e));break}}t=t.return}}function xl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Tu===e&&(Bu&n)===n&&(4===Ru||3===Ru&&(130023424&Bu)===Bu&&500>$e()-Vu?dl(e,0):Ou|=n),rl(e,t)}function Fl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=el();null!==(e=Ra(e,t))&&(vt(e,t,n),rl(e,n))}function wl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Fl(e,n)}function Sl(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Fl(e,n)}function Tl(e,t){return Xe(e,t)}function Ml(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bl(e,t,n,r){return new Ml(e,t,n,r)}function Pl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Nl(e,t){var n=e.alternate;return null===n?((n=Bl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rl(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Pl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case _:return Ll(n.children,i,o,t);case b:s=8,i|=8;break;case x:return(e=Bl(12,n,t,2|i)).elementType=x,e.lanes=o,e;case T:return(e=Bl(13,n,t,i)).elementType=T,e.lanes=o,e;case M:return(e=Bl(19,n,t,i)).elementType=M,e.lanes=o,e;case N:return Il(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case F:s=10;break e;case w:s=9;break e;case S:s=11;break e;case B:s=14;break e;case P:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Bl(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Ll(e,t,n,r){return(e=Bl(7,e,r,t)).lanes=n,e}function Il(e,t,n,r){return(e=Bl(22,e,r,t)).elementType=N,e.lanes=n,e.stateNode={isHidden:!1},e}function kl(e,t,n){return(e=Bl(6,e,null,t)).lanes=n,e}function Ol(e,t,n){return(t=Bl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ul(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function zl(e,t,n,r,i,a,o,s,u){return e=new Ul(e,t,n,s,u),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Bl(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ia(a),e}function Vl(e){if(!e)return wi;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Pi(n))return Li(e,n,t)}return t}function Gl(e,t,n,r,i,a,o,s,u){return(e=zl(n,r,!0,e,0,a,0,s,u)).context=Vl(null),n=e.current,(a=Oa(r=el(),i=tl(n))).callback=void 0!==t&&null!==t?t:null,Ua(n,a,i),e.current.lanes=i,vt(e,i,r),rl(e,r),e}function Hl(e,t,n,r){var i=t.current,a=el(),o=tl(i);return n=Vl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Oa(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ua(i,t,o))&&(nl(e,i,o,a),za(e,i,o)),o}function jl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){Wl(e,t),(e=e.alternate)&&Wl(e,t)}_u=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ti.current)ys=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ys=!1,function(e,t,n){switch(t.tag){case 3:Ts(t),pa();break;case 5:$a(t);break;case 1:Pi(t.type)&&Ii(t);break;case 4:Ya(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Fi(Ca,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Fi(Za,1&Za.current),t.flags|=128,null):0!==(n&t.child.childLanes)?ks(e,t,n):(Fi(Za,1&Za.current),null!==(e=js(e,t,n))?e.sibling:null);Fi(Za,1&Za.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Gs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Fi(Za,Za.current),r)break;return null;case 22:case 23:return t.lanes=0,bs(e,t,n)}return js(e,t,n)}(e,t,n);ys=0!==(131072&e.flags)}else ys=!1,ia&&0!==(1048576&t.flags)&&Zi(t,qi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Hs(e,t),e=t.pendingProps;var i=Bi(t,Si.current);Ta(t,n),i=go(null,t,r,e,i,n);var o=vo();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(o=!0,Ii(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ia(t),i.updater=is,t.stateNode=i,i._reactInternals=t,us(t,r,e,n),t=Ss(null,t,r,!0,o,n)):(t.tag=0,ia&&o&&ea(t),Es(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Hs(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Pl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===S)return 11;if(e===B)return 14}return 2}(r),e=ns(r,e),i){case 0:t=Fs(null,t,r,e,n);break e;case 1:t=ws(null,t,r,e,n);break e;case 11:t=As(null,t,r,e,n);break e;case 14:t=Cs(null,t,r,ns(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Fs(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 1:return r=t.type,i=t.pendingProps,ws(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 3:e:{if(Ts(t),null===e)throw Error(a(387));r=t.pendingProps,i=(o=t.memoizedState).element,ka(e,t),Ga(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ms(e,t,r,n,i=ls(Error(a(423)),t));break e}if(r!==i){t=Ms(e,t,r,n,i=ls(Error(a(424)),t));break e}for(ra=li(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=Aa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pa(),r===i){t=js(e,t,n);break e}Es(e,t,r,n)}t=t.child}return t;case 5:return $a(t),null===e&&la(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==o&&ni(r,o)&&(t.flags|=32),xs(e,t),Es(e,t,s,n),t.child;case 6:return null===e&&la(t),null;case 13:return ks(e,t,n);case 4:return Ya(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ea(t,null,r,n):Es(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,As(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 7:return Es(e,t,t.pendingProps,n),t.child;case 8:case 12:return Es(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,Fi(Ca,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===i.children&&!Ti.current){t=js(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var l=u.firstContext;null!==l;){if(l.context===r){if(1===o.tag){(l=Oa(-1,n&-n)).tag=2;var c=o.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Sa(o.return,n,t),u.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Sa(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}Es(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ta(t,n),r=r(i=Ma(i)),t.flags|=1,Es(e,t,r,n),t.child;case 14:return i=ns(r=t.type,t.pendingProps),Cs(e,t,r,i=ns(r.type,i),n);case 15:return _s(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ns(r,i),Hs(e,t),t.tag=1,Pi(r)?(e=!0,Ii(t)):e=!1,Ta(t,n),os(t,r,i),us(t,r,i,n),Ss(null,t,r,!0,e,n);case 19:return Gs(e,t,n);case 22:return bs(e,t,n)}throw Error(a(156,t.tag))};var Xl="function"===typeof reportError?reportError:function(e){console.error(e)};function Kl(e){this._internalRoot=e}function Yl(e){this._internalRoot=e}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $l(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ql(){}function Zl(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof i){var s=i;i=function(){var e=jl(o);s.call(e)}}Hl(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=jl(o);a.call(e)}}var o=Gl(t,r,e,0,null,!1,0,"",Ql);return e._reactRootContainer=o,e[fi]=o.current,Gr(8===e.nodeType?e.parentNode:e),cl(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=jl(u);s.call(e)}}var u=zl(e,0,!1,null,0,!1,0,"",Ql);return e._reactRootContainer=u,e[fi]=u.current,Gr(8===e.nodeType?e.parentNode:e),cl(function(){Hl(t,u,n,r)}),u}(n,t,e,i,r);return jl(o)}Yl.prototype.render=Kl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Hl(e,t,null,null)},Yl.prototype.unmount=Kl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cl(function(){Hl(null,e,null,null)}),t[fi]=null}},Yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=bt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Nt.length&&0!==t&&t<Nt[n].priority;n++);Nt.splice(n,0,e),0===n&&kt(e)}},At=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(Dt(t,1|n),rl(t,$e()),0===(6&Su)&&(Gu=$e()+500,Gi()))}break;case 13:cl(function(){var t=Ra(e,1);if(null!==t){var n=el();nl(t,e,1,n)}}),ql(e,1)}},Ct=function(e){if(13===e.tag){var t=Ra(e,134217728);if(null!==t)nl(t,e,134217728,el());ql(e,134217728)}},_t=function(e){if(13===e.tag){var t=tl(e),n=Ra(e,t);if(null!==n)nl(n,e,t,el());ql(e,t)}},bt=function(){return yt},xt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},Ce=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Ai(r);if(!i)throw Error(a(90));X(r),Q(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Se=ll,Te=cl;var ec={usingClientEntryPoint:!1,Events:[yi,Ei,Ai,Fe,we,ll]},tc={findFiberByHostInstance:Di,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nc={bundleType:tc.bundleType,version:tc.version,rendererPackageName:tc.rendererPackageName,rendererConfig:tc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{it=rc.inject(nc),at=rc}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ec,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jl(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:C,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jl(e))throw Error(a(299));var n=!1,r="",i=Xl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=zl(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Gr(8===e.nodeType?e.parentNode:e),new Kl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return cl(e)},t.hydrate=function(e,t,n){if(!$l(t))throw Error(a(200));return Zl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jl(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=Xl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gl(t,null,e,1,null!=n?n:null,i,0,o,s),e[fi]=t.current,Gr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Yl(t)},t.render=function(e,t,n){if(!$l(t))throw Error(a(200));return Zl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!$l(e))throw Error(a(40));return!!e._reactRootContainer&&(cl(function(){Zl(null,null,e,!1,function(){e._reactRootContainer=null,e[fi]=null})}),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!$l(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Zl(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},352:(e,t,n)=>{"use strict";var r=n(119);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},389:(e,t,n)=>{e.exports=function(e){var t=n(405),h=n(947),d=n(180);if(e){if(void 0!==e.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==e.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}e=h(e,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var p=l[e.dimensions];if(!p){var f=e.dimensions;p={Body:r(f,e.debug),createQuadTree:i(f),createBounds:a(f),createDragForce:o(f),createSpringForce:s(f),integrate:u(f)},l[f]=p}var m=p.Body,g=p.createQuadTree,v=p.createBounds,D=p.createDragForce,y=p.createSpringForce,E=p.integrate,A=n(302).random(42),C=[],_=[],b=g(e,A),x=v(C,e,A),F=y(e,A),w=D(e),S=[],T=new Map,M=0;N("nbody",function(){if(0===C.length)return;b.insertBodies(C);var e=C.length;for(;e--;){var t=C[e];t.isPinned||(t.reset(),b.updateBodyForce(t),w.update(t))}}),N("spring",function(){var e=_.length;for(;e--;)F.update(_[e])});var B={bodies:C,quadTree:b,springs:_,settings:e,addForce:N,removeForce:function(e){var t=S.indexOf(T.get(e));if(t<0)return;S.splice(t,1),T.delete(e)},getForces:function(){return T},step:function(){for(var t=0;t<S.length;++t)S[t](M);var n=E(C,e.timeStep,e.adaptiveTimeStepWeight);return M+=1,n},addBody:function(e){if(!e)throw new Error("Body is required");return C.push(e),e},addBodyAt:function(e){if(!e)throw new Error("Body position is required");var t=(e=>new m(e))(e);return C.push(t),t},removeBody:function(e){if(e){var t=C.indexOf(e);if(!(t<0))return C.splice(t,1),0===C.length&&x.reset(),!0}},addSpring:function(e,n,r,i){if(!e||!n)throw new Error("Cannot add null spring to force simulator");"number"!==typeof r&&(r=-1);var a=new t(e,n,r,i>=0?i:-1);return _.push(a),a},getTotalMovement:function(){return 0},removeSpring:function(e){if(e){var t=_.indexOf(e);return t>-1?(_.splice(t,1),!0):void 0}},getBestNewBodyPosition:function(e){return x.getBestNewPosition(e)},getBBox:P,getBoundingBox:P,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(t){return void 0!==t?(e.gravity=t,b.options({gravity:t}),this):e.gravity},theta:function(t){return void 0!==t?(e.theta=t,b.options({theta:t}),this):e.theta},random:A};return function(e,t){for(var n in e)c(e,t,n)}(e,B),d(B),B;function P(){return x.update(),x.box}function N(e,t){if(T.has(e))throw new Error("Force "+e+" is already added");T.set(e,t),S.push(t)}};var r=n(305),i=n(446),a=n(284),o=n(260),s=n(501),u=n(856),l={};function c(e,t,n){if(e.hasOwnProperty(n)&&"function"!==typeof t[n]){var r=Number.isFinite(e[n]);t[n]=r?function(r){if(void 0!==r){if(!Number.isFinite(r))throw new Error("Value of "+n+" should be a valid number.");return e[n]=r,t}return e[n]}:function(r){return void 0!==r?(e[n]=r,t):e[n]}}}},405:e=>{e.exports=function(e,t,n,r){this.from=e,this.to=t,this.length=n,this.coefficient=r}},414:(e,t,n)=>{"use strict";e.exports=n(654)},446:(e,t,n)=>{const r=n(911),i=n(635);function a(e){let t=r(e),n=Math.pow(2,e);return"\n".concat("\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n","\n").concat(l(e),"\n").concat(o(e),"\n").concat(u(e),"\n").concat(s(e),"\n\nfunction createQuadTree(options, random) {\n  options = options || {};\n  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;\n  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;\n\n  var gravity = options.gravity;\n  var updateQueue = [];\n  var insertStack = new InsertStack();\n  var theta = options.theta;\n\n  var nodesCache = [];\n  var currentInCache = 0;\n  var root = newNode();\n\n  return {\n    insertBodies: insertBodies,\n\n    /**\n     * Gets root node if it is present\n     */\n    getRoot: function() {\n      return root;\n    },\n\n    updateBodyForce: update,\n\n    options: function(newOptions) {\n      if (newOptions) {\n        if (typeof newOptions.gravity === 'number') {\n          gravity = newOptions.gravity;\n        }\n        if (typeof newOptions.theta === 'number') {\n          theta = newOptions.theta;\n        }\n\n        return this;\n      }\n\n      return {\n        gravity: gravity,\n        theta: theta\n      };\n    }\n  };\n\n  function newNode() {\n    // To avoid pressure on GC we reuse nodes.\n    var node = nodesCache[currentInCache];\n    if (node) {\n").concat(function(e){let t=[];for(let r=0;r<n;++r)t.push("".concat(e,"quad").concat(r," = null;"));return t.join("\n")}("      node."),"\n      node.body = null;\n      node.mass = ").concat(t("node.mass_{var} = ",{join:""}),"0;\n      ").concat(t("node.min_{var} = node.max_{var} = ",{join:""}),"0;\n    } else {\n      node = new QuadNode();\n      nodesCache[currentInCache] = node;\n    }\n\n    ++currentInCache;\n    return node;\n  }\n\n  function update(sourceBody) {\n    var queue = updateQueue;\n    var v;\n    ").concat(t("var d{var};",{indent:4}),"\n    var r; \n    ").concat(t("var f{var} = 0;",{indent:4}),"\n    var queueLength = 1;\n    var shiftIdx = 0;\n    var pushIdx = 1;\n\n    queue[0] = root;\n\n    while (queueLength) {\n      var node = queue[shiftIdx];\n      var body = node.body;\n\n      queueLength -= 1;\n      shiftIdx += 1;\n      var differentBody = (body !== sourceBody);\n      if (body && differentBody) {\n        // If the current node is a leaf node (and it is not source body),\n        // calculate the force exerted by the current node on body, and add this\n        // amount to body's net force.\n        ").concat(t("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8}),"\n        r = Math.sqrt(").concat(t("d{var} * d{var}",{join:" + "}),");\n\n        if (r === 0) {\n          // Poor man's protection against zero distance.\n          ").concat(t("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10}),"\n          r = Math.sqrt(").concat(t("d{var} * d{var}",{join:" + "}),");\n        }\n\n        // This is standard gravitation force calculation but we divide\n        // by r^3 to save two operations when normalizing force vector.\n        v = gravity * body.mass * sourceBody.mass / (r * r * r);\n        ").concat(t("f{var} += v * d{var};",{indent:8}),"\n      } else if (differentBody) {\n        // Otherwise, calculate the ratio s / r,  where s is the width of the region\n        // represented by the internal node, and r is the distance between the body\n        // and the node's center-of-mass\n        ").concat(t("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8}),"\n        r = Math.sqrt(").concat(t("d{var} * d{var}",{join:" + "}),");\n\n        if (r === 0) {\n          // Sorry about code duplication. I don't want to create many functions\n          // right away. Just want to see performance first.\n          ").concat(t("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10}),"\n          r = Math.sqrt(").concat(t("d{var} * d{var}",{join:" + "}),");\n        }\n        // If s / r < \u03b8, treat this internal node as a single body, and calculate the\n        // force it exerts on sourceBody, and add this amount to sourceBody's net force.\n        if ((node.max_").concat(i(0)," - node.min_").concat(i(0),") / r < theta) {\n          // in the if statement above we consider node's width only\n          // because the region was made into square during tree creation.\n          // Thus there is no difference between using width or height.\n          v = gravity * node.mass * sourceBody.mass / (r * r * r);\n          ").concat(t("f{var} += v * d{var};",{indent:10}),"\n        } else {\n          // Otherwise, run the procedure recursively on each of the current node's children.\n\n          // I intentionally unfolded this loop, to save several CPU cycles.\n").concat(function(){let e=Array(11).join(" "),t=[];for(let r=0;r<n;++r)t.push(e+"if (node.quad".concat(r,") {")),t.push(e+"  queue[pushIdx] = node.quad".concat(r,";")),t.push(e+"  queueLength += 1;"),t.push(e+"  pushIdx += 1;"),t.push(e+"}");return t.join("\n")}(),"\n        }\n      }\n    }\n\n    ").concat(t("sourceBody.force.{var} += f{var};",{indent:4}),"\n  }\n\n  function insertBodies(bodies) {\n    ").concat(t("var {var}min = Number.MAX_VALUE;",{indent:4}),"\n    ").concat(t("var {var}max = Number.MIN_VALUE;",{indent:4}),"\n    var i = bodies.length;\n\n    // To reduce quad tree depth we are looking for exact bounding box of all particles.\n    while (i--) {\n      var pos = bodies[i].pos;\n      ").concat(t("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6}),"\n      ").concat(t("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6}),"\n    }\n\n    // Makes the bounds square.\n    var maxSideLength = -Infinity;\n    ").concat(t("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4}),"\n\n    currentInCache = 0;\n    root = newNode();\n    ").concat(t("root.min_{var} = {var}min;",{indent:4}),"\n    ").concat(t("root.max_{var} = {var}min + maxSideLength;",{indent:4}),"\n\n    i = bodies.length - 1;\n    if (i >= 0) {\n      root.body = bodies[i];\n    }\n    while (i--) {\n      insert(bodies[i], root);\n    }\n  }\n\n  function insert(newBody) {\n    insertStack.reset();\n    insertStack.push(root, newBody);\n\n    while (!insertStack.isEmpty()) {\n      var stackItem = insertStack.pop();\n      var node = stackItem.node;\n      var body = stackItem.body;\n\n      if (!node.body) {\n        // This is internal node. Update the total mass of the node and center-of-mass.\n        ").concat(t("var {var} = body.pos.{var};",{indent:8}),"\n        node.mass += body.mass;\n        ").concat(t("node.mass_{var} += body.mass * {var};",{indent:8}),"\n\n        // Recursively insert the body in the appropriate quadrant.\n        // But first find the appropriate quadrant.\n        var quadIdx = 0; // Assume we are in the 0's quad.\n        ").concat(t("var min_{var} = node.min_{var};",{indent:8}),"\n        ").concat(t("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8}),"\n\n").concat(function(t){let n=[],r=Array(t+1).join(" ");for(let a=0;a<e;++a)n.push(r+"if (".concat(i(a)," > max_").concat(i(a),") {")),n.push(r+"  quadIdx = quadIdx + ".concat(Math.pow(2,a),";")),n.push(r+"  min_".concat(i(a)," = max_").concat(i(a),";")),n.push(r+"  max_".concat(i(a)," = node.max_").concat(i(a),";")),n.push(r+"}");return n.join("\n")}(8),"\n\n        var child = getChild(node, quadIdx);\n\n        if (!child) {\n          // The node is internal but this quadrant is not taken. Add\n          // subnode to it.\n          child = newNode();\n          ").concat(t("child.min_{var} = min_{var};",{indent:10}),"\n          ").concat(t("child.max_{var} = max_{var};",{indent:10}),"\n          child.body = body;\n\n          setChild(node, quadIdx, child);\n        } else {\n          // continue searching in this quadrant.\n          insertStack.push(child, body);\n        }\n      } else {\n        // We are trying to add to the leaf node.\n        // We have to convert current leaf into internal node\n        // and continue adding two nodes.\n        var oldBody = node.body;\n        node.body = null; // internal nodes do not cary bodies\n\n        if (isSamePosition(oldBody.pos, body.pos)) {\n          // Prevent infinite subdivision by bumping one node\n          // anywhere in this quadrant\n          var retriesCount = 3;\n          do {\n            var offset = random.nextDouble();\n            ").concat(t("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12}),"\n\n            ").concat(t("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12}),"\n            retriesCount -= 1;\n            // Make sure we don't bump it out of the box. If we do, next iteration should fix it\n          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));\n\n          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {\n            // This is very bad, we ran out of precision.\n            // if we do not return from the method we'll get into\n            // infinite loop here. So we sacrifice correctness of layout, and keep the app running\n            // Next layout iteration should get larger bounding box in the first step and fix this\n            return;\n          }\n        }\n        // Next iteration should subdivide node further.\n        insertStack.push(node, oldBody);\n        insertStack.push(node, body);\n      }\n    }\n  }\n}\nreturn createQuadTree;\n\n")}function o(e){let t=r(e);return"\n  function isSamePosition(point1, point2) {\n    ".concat(t("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2}),"\n  \n    return ").concat(t("d{var} < 1e-8",{join:" && "}),";\n  }  \n")}function s(e){var t=Math.pow(2,e);return"\nfunction setChild(node, idx, child) {\n  ".concat(function(){let e=[];for(let n=0;n<t;++n){let t=0===n?"  ":"  else ";e.push("".concat(t,"if (idx === ").concat(n,") node.quad").concat(n," = child;"))}return e.join("\n")}(),"\n}")}function u(e){return"function getChild(node, idx) {\n".concat(function(){let t=[],n=Math.pow(2,e);for(let e=0;e<n;++e)t.push("  if (idx === ".concat(e,") return node.quad").concat(e,";"));return t.join("\n")}(),"\n  return null;\n}")}function l(e){let t=r(e),n=Math.pow(2,e);return"\nfunction QuadNode() {\n  // body stored inside this node. In quad tree only leaf nodes (by construction)\n  // contain bodies:\n  this.body = null;\n\n  // Child nodes are stored in quads. Each quad is presented by number:\n  // 0 | 1\n  // -----\n  // 2 | 3\n".concat(function(e){let t=[];for(let r=0;r<n;++r)t.push("".concat(e,"quad").concat(r," = null;"));return t.join("\n")}("  this."),"\n\n  // Total mass of current node\n  this.mass = 0;\n\n  // Center of mass coordinates\n  ").concat(t("this.mass_{var} = 0;",{indent:2}),"\n\n  // bounding box coordinates\n  ").concat(t("this.min_{var} = 0;",{indent:2}),"\n  ").concat(t("this.max_{var} = 0;",{indent:2}),"\n}\n")}function c(){return"\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n"}e.exports=function(e){let t=a(e);return new Function(t)()},e.exports.generateQuadTreeFunctionBody=a,e.exports.getInsertStackCode=c,e.exports.getQuadNodeCode=l,e.exports.isSamePosition=o,e.exports.getChildBodyCode=u,e.exports.setChildBodyCode=s},488:(e,t,n)=>{"use strict";var r=n(959);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},501:(e,t,n)=>{const r=n(911);function i(e){let t=r(e);return"\n  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');\n  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');\n\n  return {\n    /**\n     * Updates forces acting on a spring\n     */\n    update: function (spring) {\n      var body1 = spring.from;\n      var body2 = spring.to;\n      var length = spring.length < 0 ? options.springLength : spring.length;\n      ".concat(t("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6}),"\n      var r = Math.sqrt(").concat(t("d{var} * d{var}",{join:" + "}),");\n\n      if (r === 0) {\n        ").concat(t("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8}),"\n        r = Math.sqrt(").concat(t("d{var} * d{var}",{join:" + "}),");\n      }\n\n      var d = r - length;\n      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;\n\n      ").concat(t("body1.force.{var} += coefficient * d{var}",{indent:6}),";\n      body1.springCount += 1;\n      body1.springLength += r;\n\n      ").concat(t("body2.force.{var} -= coefficient * d{var}",{indent:6}),";\n      body2.springCount += 1;\n      body2.springLength += r;\n    }\n  };\n")}e.exports=function(e){let t=i(e);return new Function("options","random",t)},e.exports.generateCreateSpringForceFunctionBody=i},635:e=>{e.exports=function(e){return 0===e?"x":1===e?"y":2===e?"z":"c"+(e+1)}},654:(e,t,n)=>{"use strict";var r=n(950),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,c=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},761:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>a(u,n))l<i&&0>a(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<i&&0>a(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,D="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=r(c);null!==t;){if(null===t.callback)i(c);else{if(!(t.startTime<=e))break;i(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function A(e){if(g=!1,E(e),!m)if(null!==r(l))m=!0,N(C);else{var t=r(c);null!==t&&R(A,t.startTime-e)}}function C(e,n){m=!1,g&&(g=!1,D(F),F=-1),f=!0;var a=p;try{for(E(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!T());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(l)&&i(l),E(n)}else i(l);d=r(l)}if(null!==d)var u=!0;else{var h=r(c);null!==h&&R(A,h.startTime-n),u=!1}return u}finally{d=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,b=!1,x=null,F=-1,w=5,S=-1;function T(){return!(t.unstable_now()-S<w)}function M(){if(null!==x){var e=t.unstable_now();S=e;var n=!0;try{n=x(!0,e)}finally{n?_():(b=!1,x=null)}}else b=!1}if("function"===typeof y)_=function(){y(M)};else if("undefined"!==typeof MessageChannel){var B=new MessageChannel,P=B.port2;B.port1.onmessage=M,_=function(){P.postMessage(null)}}else _=function(){v(M,0)};function N(e){x=e,b||(b=!0,_())}function R(e,n){F=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,N(C))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(c,e),null===r(l)&&e===r(c)&&(g?(D(F),F=-1):g=!0,R(A,a-o))):(e.sortIndex=s,n(l,e),m||f||(m=!0,N(C))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},856:(e,t,n)=>{const r=n(911);function i(e){let t=r(e);return"\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ".concat(t("var d{var} = 0, t{var} = 0;",{indent:2}),"\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ").concat(t("body.velocity.{var} += coeff * body.force.{var};",{indent:4}),"\n    ").concat(t("var v{var} = body.velocity.{var};",{indent:4}),"\n    var v = Math.sqrt(").concat(t("v{var} * v{var}",{join:" + "}),");\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ").concat(t("body.velocity.{var} = v{var} / v;",{indent:6}),"\n    }\n\n    ").concat(t("d{var} = timeStep * body.velocity.{var};",{indent:4}),"\n\n    ").concat(t("body.pos.{var} += d{var};",{indent:4}),"\n\n    ").concat(t("t{var} += Math.abs(d{var});",{indent:4}),"\n  }\n\n  return (").concat(t("t{var} * t{var}",{join:" + "}),")/length;\n")}e.exports=function(e){let t=i(e);return new Function("bodies","timeStep","adaptiveTimeStepWeight",t)},e.exports.generateIntegratorFunctionBody=i},907:(e,t,n)=>{e.exports=function(e){"uniqueLinkId"in(e=e||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),e.multigraph=e.uniqueLinkId);void 0===e.multigraph&&(e.multigraph=!1);if("function"!==typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var t=new Map,n=new Map,u={},l=0,c=e.multigraph?function(e,t,n){var r=s(e,t),i=u.hasOwnProperty(r);if(i||x(e,t)){i||(u[r]=0);var a="@"+ ++u[r];r=s(e+a,t+a)}return new o(e,t,n,r)}:function(e,t,r){var i=s(e,t),a=n.get(i);if(a)return a.data=r,a;return new o(e,t,r,i)},h=[],d=F,p=F,f=F,m=F,g={version:20,addNode:y,addLink:function(e,t,r){f();var i=E(e)||y(e),o=E(t)||y(t),s=c(e,t,r),u=n.has(s.id);n.set(s.id,s),a(i,s),e!==t&&a(o,s);return d(s,u?"update":"add"),m(),s},removeLink:function(e,t){void 0!==t&&(e=x(e,t));return b(e)},removeNode:A,getNode:E,getNodeCount:C,getLinkCount:_,getEdgeCount:_,getLinksCount:_,getNodesCount:C,getLinks:function(e){var t=E(e);return t?t.links:null},forEachNode:T,forEachLinkedNode:function(e,n,r){var i=E(e);if(i&&i.links&&"function"===typeof n)return r?function(e,n,r){var i=e.values(),a=i.next();for(;!a.done;){var o=a.value;if(o.fromId===n&&r(t.get(o.toId),o))return!0;a=i.next()}}(i.links,e,n):function(e,n,r){var i=e.values(),a=i.next();for(;!a.done;){var o=a.value,s=o.fromId===n?o.toId:o.fromId;if(r(t.get(s),o))return!0;a=i.next()}}(i.links,e,n)},forEachLink:function(e){if("function"===typeof e)for(var t=n.values(),r=t.next();!r.done;){if(e(r.value))return!0;r=t.next()}},beginUpdate:f,endUpdate:m,clear:function(){f(),T(function(e){A(e.id)}),m()},hasLink:x,hasNode:E,getLink:x};return r(g),function(){var e=g.on;function t(){return g.beginUpdate=f=w,g.endUpdate=m=S,d=v,p=D,g.on=e,e.apply(g,arguments)}g.on=t}(),g;function v(e,t){h.push({link:e,changeType:t})}function D(e,t){h.push({node:e,changeType:t})}function y(e,n){if(void 0===e)throw new Error("Invalid node identifier");f();var r=E(e);return r?(r.data=n,p(r,"update")):(r=new i(e,n),p(r,"add")),t.set(e,r),m(),r}function E(e){return t.get(e)}function A(e){var n=E(e);if(!n)return!1;f();var r=n.links;return r&&(r.forEach(b),n.links=null),t.delete(e),p(n,"remove"),m(),!0}function C(){return t.size}function _(){return n.size}function b(e){if(!e)return!1;if(!n.get(e.id))return!1;f(),n.delete(e.id);var t=E(e.fromId),r=E(e.toId);return t&&t.links.delete(e),r&&r.links.delete(e),d(e,"remove"),m(),!0}function x(e,t){if(void 0!==e&&void 0!==t)return n.get(s(e,t))}function F(){}function w(){l+=1}function S(){0===(l-=1)&&h.length>0&&(g.fire("changed",h),h.length=0)}function T(e){if("function"!==typeof e)throw new Error("Function is expected to iterate over graph nodes. You passed "+e);for(var n=t.values(),r=n.next();!r.done;){if(e(r.value))return!0;r=n.next()}}};var r=n(180);function i(e,t){this.id=e,this.links=null,this.data=t}function a(e,t){e.links?e.links.add(t):e.links=new Set([t])}function o(e,t,n,r){this.fromId=e,this.toId=t,this.data=n,this.id=r}function s(e,t){return e.toString()+"\ud83d\udc49 "+t.toString()}},911:(e,t,n)=>{const r=n(635);e.exports=function(e){return function(t,n){let i=n&&n.indent||0,a=n&&void 0!==n.join?n.join:"\n",o=Array(i+1).join(" "),s=[];for(let u=0;u<e;++u){let e=r(u),n=0===u?"":o;s.push(n+t.replace(/{var}/g,e))}return s.join(a)}}},942:(e,t,n)=>{e.exports=n(488)()},947:e=>{e.exports=function e(t,n){var r;t||(t={});if(n)for(r in n)if(n.hasOwnProperty(r)){var i=t.hasOwnProperty(r),a=typeof n[r];!i||typeof t[r]!==a?t[r]=n[r]:"object"===a&&(t[r]=e(t[r],n[r]))}return t}},950:(e,t,n)=>{"use strict";e.exports=n(49)},959:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+".8a2585ff.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="biological-pathways-viz:";n.l=(r,i,a,o)=>{if(e[r])e[r].push(i);else{var s,u;if(void 0!==a)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var h=l[c];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+a){s=h;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=r),e[r]=[i];var d=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach(e=>e(n)),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),u&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/gaia_app/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var a=new Promise((n,r)=>i=e[t]=[n,r]);r.push(i[2]=a);var o=n.p+n.u(t),s=new Error;n.l(o,r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,i[1](s)}},"chunk-"+t,t)}};var t=(t,r)=>{var i,a,o=r[0],s=r[1],u=r[2],l=0;if(o.some(t=>0!==e[t])){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(u)u(n)}for(t&&t(r);l<o.length;l++)a=o[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkbiological_pathways_viz=self.webpackChunkbiological_pathways_viz||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e=n(950),t=n(352);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function a(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(){}function l(e){return null==e?u:function(){return this.querySelector(e)}}function c(){return[]}function h(e){return null==e?c:function(){return this.querySelectorAll(e)}}function d(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}function p(e){return function(){return this.matches(e)}}function f(e){return function(t){return t.matches(e)}}var m=Array.prototype.find;function g(){return this.firstElementChild}var v=Array.prototype.filter;function D(){return Array.from(this.children)}function y(e){return new Array(e.length)}function E(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function A(e,t,n,r,i,a){for(var o,s=0,u=t.length,l=a.length;s<l;++s)(o=t[s])?(o.__data__=a[s],r[s]=o):n[s]=new E(e,a[s]);for(;s<u;++s)(o=t[s])&&(i[s]=o)}function C(e,t,n,r,i,a,o){var s,u,l,c=new Map,h=t.length,d=a.length,p=new Array(h);for(s=0;s<h;++s)(u=t[s])&&(p[s]=l=o.call(u,u.__data__,s,t)+"",c.has(l)?i[s]=u:c.set(l,u));for(s=0;s<d;++s)l=o.call(e,a[s],s,a)+"",(u=c.get(l))?(r[s]=u,u.__data__=a[s],c.delete(l)):n[s]=new E(e,a[s]);for(s=0;s<h;++s)(u=t[s])&&c.get(p[s])===u&&(i[s]=u)}function _(e){return e.__data__}function b(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function x(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}E.prototype={constructor:E,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var F="http://www.w3.org/1999/xhtml";const w={svg:"http://www.w3.org/2000/svg",xhtml:F,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function S(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),w.hasOwnProperty(t)?{space:w[t],local:e}:e}function T(e){return function(){this.removeAttribute(e)}}function M(e){return function(){this.removeAttributeNS(e.space,e.local)}}function B(e,t){return function(){this.setAttribute(e,t)}}function P(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function N(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function R(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function L(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function I(e){return function(){this.style.removeProperty(e)}}function k(e,t,n){return function(){this.style.setProperty(e,t,n)}}function O(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function U(e,t){return e.style.getPropertyValue(t)||L(e).getComputedStyle(e,null).getPropertyValue(t)}function z(e){return function(){delete this[e]}}function V(e,t){return function(){this[e]=t}}function G(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function H(e){return e.trim().split(/^|\s+/)}function j(e){return e.classList||new W(e)}function W(e){this._node=e,this._names=H(e.getAttribute("class")||"")}function q(e,t){for(var n=j(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function X(e,t){for(var n=j(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function K(e){return function(){q(this,e)}}function Y(e){return function(){X(this,e)}}function J(e,t){return function(){(t.apply(this,arguments)?q:X)(this,e)}}function $(){this.textContent=""}function Q(e){return function(){this.textContent=e}}function Z(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function ee(){this.innerHTML=""}function te(e){return function(){this.innerHTML=e}}function ne(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function re(){this.nextSibling&&this.parentNode.appendChild(this)}function ie(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ae(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===F&&t.documentElement.namespaceURI===F?t.createElement(e):t.createElementNS(n,e)}}function oe(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function se(e){var t=S(e);return(t.local?oe:ae)(t)}function ue(){return null}function le(){var e=this.parentNode;e&&e.removeChild(this)}function ce(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function he(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function de(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function pe(e,t,n){return function(){var r,i=this.__on,a=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var o=0,s=i.length;o<s;++o)if((r=i[o]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=n),void(r.value=t);this.addEventListener(e.type,a,n),r={type:e.type,name:e.name,value:t,listener:a,options:n},i?i.push(r):this.__on=[r]}}function fe(e,t,n){var r=L(e),i=r.CustomEvent;"function"===typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function me(e,t){return function(){return fe(this,e,t)}}function ge(e,t){return function(){return fe(this,e,t.apply(this,arguments))}}W.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var ve=[null];function De(e,t){this._groups=e,this._parents=t}function ye(){return new De([[document.documentElement]],ve)}De.prototype=ye.prototype={constructor:De,select:function(e){"function"!==typeof e&&(e=l(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,s=t[i],u=s.length,c=r[i]=new Array(u),h=0;h<u;++h)(a=s[h])&&(o=e.call(a,a.__data__,h,s))&&("__data__"in a&&(o.__data__=a.__data__),c[h]=o);return new De(r,this._parents)},selectAll:function(e){e="function"===typeof e?d(e):h(e);for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,s=t[a],u=s.length,l=0;l<u;++l)(o=s[l])&&(r.push(e.call(o,o.__data__,l,s)),i.push(o));return new De(r,i)},selectChild:function(e){return this.select(null==e?g:function(e){return function(){return m.call(this.children,e)}}("function"===typeof e?e:f(e)))},selectChildren:function(e){return this.selectAll(null==e?D:function(e){return function(){return v.call(this.children,e)}}("function"===typeof e?e:f(e)))},filter:function(e){"function"!==typeof e&&(e=p(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,u=r[i]=[],l=0;l<s;++l)(a=o[l])&&e.call(a,a.__data__,l,o)&&u.push(a);return new De(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,_);var n=t?C:A,r=this._parents,i=this._groups;"function"!==typeof e&&(e=function(e){return function(){return e}}(e));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=r[l],h=i[l],d=h.length,p=b(e.call(c,c&&c.__data__,l,r)),f=p.length,m=s[l]=new Array(f),g=o[l]=new Array(f);n(c,h,m,g,u[l]=new Array(d),p,t);for(var v,D,y=0,E=0;y<f;++y)if(v=m[y]){for(y>=E&&(E=y+1);!(D=g[E])&&++E<f;);v._next=D||null}}return(o=new De(o,r))._enter=s,o._exit=u,o},enter:function(){return new De(this._enter||this._groups.map(y),this._parents)},exit:function(){return new De(this._exit||this._groups.map(y),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,a=this.exit();return"function"===typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),u=0;u<o;++u)for(var l,c=n[u],h=r[u],d=c.length,p=s[u]=new Array(d),f=0;f<d;++f)(l=c[f]||h[f])&&(p[f]=l);for(;u<i;++u)s[u]=n[u];return new De(s,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=x);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],u=s.length,l=i[a]=new Array(u),c=0;c<u;++c)(o=s[c])&&(l[c]=o);l.sort(t)}return new De(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,s=a.length;o<s;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},attr:function(e,t){var n=S(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?M:T:"function"===typeof t?n.local?R:N:n.local?P:B)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?I:"function"===typeof t?O:k)(e,t,null==n?"":n)):U(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?z:"function"===typeof t?G:V)(e,t)):this.node()[e]},classed:function(e,t){var n=H(e+"");if(arguments.length<2){for(var r=j(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"===typeof t?J:t?K:Y)(n,t))},text:function(e){return arguments.length?this.each(null==e?$:("function"===typeof e?Z:Q)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?ee:("function"===typeof e?ne:te)(e)):this.node().innerHTML},raise:function(){return this.each(re)},lower:function(){return this.each(ie)},append:function(e){var t="function"===typeof e?e:se(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"===typeof e?e:se(e),r=null==t?ue:"function"===typeof t?t:l(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(le)},clone:function(e){return this.select(e?he:ce)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?pe:de,r=0;r<o;++r)this.each(s(a[r],t,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;l<c;++l)for(r=0,u=s[l];r<o;++r)if((i=a[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"===typeof t?ge:me)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],a=0,o=i.length;a<o;++a)(r=i[a])&&(yield r)}};const Ee=ye;var Ae={value:()=>{}};function Ce(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new _e(r)}function _e(e){this._=e}function be(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function xe(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Ae,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}_e.prototype=Ce.prototype={constructor:_e,on:function(e,t){var n,r,i=this._,a=(r=i,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),o=-1,s=a.length;if(!(arguments.length<2)){if(null!=t&&"function"!==typeof t)throw new Error("invalid callback: "+t);for(;++o<s;)if(n=(e=a[o]).type)i[n]=xe(i[n],e.name,t);else if(null==t)for(n in i)i[n]=xe(i[n],e.name,null);return this}for(;++o<s;)if((n=(e=a[o]).type)&&(n=be(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new _e(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};const Fe=Ce;var we,Se,Te=0,Me=0,Be=0,Pe=0,Ne=0,Re=0,Le="object"===typeof performance&&performance.now?performance:Date,Ie="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ke(){return Ne||(Ie(Oe),Ne=Le.now()+Re)}function Oe(){Ne=0}function Ue(){this._call=this._time=this._next=null}function ze(e,t,n){var r=new Ue;return r.restart(e,t,n),r}function Ve(){Ne=(Pe=Le.now())+Re,Te=Me=0;try{!function(){ke(),++Te;for(var e,t=we;t;)(e=Ne-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Te}()}finally{Te=0,function(){var e,t,n=we,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:we=t);Se=e,He(r)}(),Ne=0}}function Ge(){var e=Le.now(),t=e-Pe;t>1e3&&(Re-=t,Pe=e)}function He(e){Te||(Me&&(Me=clearTimeout(Me)),e-Ne>24?(e<1/0&&(Me=setTimeout(Ve,e-Le.now()-Re)),Be&&(Be=clearInterval(Be))):(Be||(Pe=Le.now(),Be=setInterval(Ge,1e3)),Te=1,Ie(Ve)))}function je(e,t,n){var r=new Ue;return t=null==t?0:+t,r.restart(n=>{r.stop(),e(n+t)},t,n),r}Ue.prototype=ze.prototype={constructor:Ue,restart:function(e,t,n){if("function"!==typeof e)throw new TypeError("callback is not a function");n=(null==n?ke():+n)+(null==t?0:+t),this._next||Se===this||(Se?Se._next=this:we=this,Se=this),this._call=e,this._time=n,He()},stop:function(){this._call&&(this._call=null,this._time=1/0,He())}};var We=Fe("start","end","cancel","interrupt"),qe=[];function Xe(e,t,n,r,i,a){var o=e.__transition;if(o){if(n in o)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function a(e){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=e&&o(e-n.delay)}function o(a){var l,c,h,d;if(1!==n.state)return u();for(l in i)if((d=i[l]).name===n.name){if(3===d.state)return je(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete i[l]):+l<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete i[l])}if(je(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(a))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),l=0,c=-1;l<h;++l)(d=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++c]=d);r.length=c+1}}function s(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(u),n.state=5,1),a=-1,o=r.length;++a<o;)r[a].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=ze(a,0,n.time)}(e,n,{name:t,index:r,group:i,on:We,tween:qe,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function Ke(e,t){var n=Je(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Ye(e,t){var n=Je(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Je(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function $e(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Qe,Ze=180/Math.PI,et={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function tt(e,t,n,r,i,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*Ze,skewX:Math.atan(u)*Ze,scaleX:o,scaleY:s}}function nt(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],u=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var u=o.push("translate(",null,t,null,n);s.push({i:u-4,x:$e(e,i)},{i:u-2,x:$e(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:$e(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,u),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:$e(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,u),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:$e(e,n)},{i:s-2,x:$e(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(e){for(var t,n=-1,r=u.length;++n<r;)s[(t=u[n]).i]=t.x(e);return s.join("")}}}var rt=nt(function(e){const t=new("function"===typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?et:tt(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),it=nt(function(e){return null==e?et:(Qe||(Qe=document.createElementNS("http://www.w3.org/2000/svg","g")),Qe.setAttribute("transform",e),(e=Qe.transform.baseVal.consolidate())?tt((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):et)},", ",")",")");function at(e,t){var n,r;return function(){var i=Ye(this,e),a=i.tween;if(a!==n)for(var o=0,s=(r=n=a).length;o<s;++o)if(r[o].name===t){(r=r.slice()).splice(o,1);break}i.tween=r}}function ot(e,t,n){var r,i;if("function"!==typeof n)throw new Error;return function(){var a=Ye(this,e),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:t,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===t){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function st(e,t,n){var r=e._id;return e.each(function(){var e=Ye(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Je(e,r).value[t]}}function ut(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function lt(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function ct(){}var ht=.7,dt=1/ht,pt="\\s*([+-]?\\d+)\\s*",ft="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",mt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gt=/^#([0-9a-f]{3,8})$/,vt=new RegExp("^rgb\\(".concat(pt,",").concat(pt,",").concat(pt,"\\)$")),Dt=new RegExp("^rgb\\(".concat(mt,",").concat(mt,",").concat(mt,"\\)$")),yt=new RegExp("^rgba\\(".concat(pt,",").concat(pt,",").concat(pt,",").concat(ft,"\\)$")),Et=new RegExp("^rgba\\(".concat(mt,",").concat(mt,",").concat(mt,",").concat(ft,"\\)$")),At=new RegExp("^hsl\\(".concat(ft,",").concat(mt,",").concat(mt,"\\)$")),Ct=new RegExp("^hsla\\(".concat(ft,",").concat(mt,",").concat(mt,",").concat(ft,"\\)$")),_t={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function bt(){return this.rgb().formatHex()}function xt(){return this.rgb().formatRgb()}function Ft(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=gt.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?wt(t):3===n?new Mt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?St(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?St(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=vt.exec(e))?new Mt(t[1],t[2],t[3],1):(t=Dt.exec(e))?new Mt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=yt.exec(e))?St(t[1],t[2],t[3],t[4]):(t=Et.exec(e))?St(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=At.exec(e))?It(t[1],t[2]/100,t[3]/100,1):(t=Ct.exec(e))?It(t[1],t[2]/100,t[3]/100,t[4]):_t.hasOwnProperty(e)?wt(_t[e]):"transparent"===e?new Mt(NaN,NaN,NaN,0):null}function wt(e){return new Mt(e>>16&255,e>>8&255,255&e,1)}function St(e,t,n,r){return r<=0&&(e=t=n=NaN),new Mt(e,t,n,r)}function Tt(e,t,n,r){return 1===arguments.length?function(e){return e instanceof ct||(e=Ft(e)),e?new Mt((e=e.rgb()).r,e.g,e.b,e.opacity):new Mt}(e):new Mt(e,t,n,null==r?1:r)}function Mt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Bt(){return"#".concat(Lt(this.r)).concat(Lt(this.g)).concat(Lt(this.b))}function Pt(){const e=Nt(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(Rt(this.r),", ").concat(Rt(this.g),", ").concat(Rt(this.b)).concat(1===e?")":", ".concat(e,")"))}function Nt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Rt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Lt(e){return((e=Rt(e))<16?"0":"")+e.toString(16)}function It(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ot(e,t,n,r)}function kt(e){if(e instanceof Ot)return new Ot(e.h,e.s,e.l,e.opacity);if(e instanceof ct||(e=Ft(e)),!e)return new Ot;if(e instanceof Ot)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new Ot(o,s,u,e.opacity)}function Ot(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Ut(e){return(e=(e||0)%360)<0?e+360:e}function zt(e){return Math.max(0,Math.min(1,e||0))}function Vt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Gt(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}ut(ct,Ft,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:bt,formatHex:bt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return kt(this).formatHsl()},formatRgb:xt,toString:xt}),ut(Mt,Tt,lt(ct,{brighter(e){return e=null==e?dt:Math.pow(dt,e),new Mt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?ht:Math.pow(ht,e),new Mt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Mt(Rt(this.r),Rt(this.g),Rt(this.b),Nt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Bt,formatHex:Bt,formatHex8:function(){return"#".concat(Lt(this.r)).concat(Lt(this.g)).concat(Lt(this.b)).concat(Lt(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:Pt,toString:Pt})),ut(Ot,function(e,t,n,r){return 1===arguments.length?kt(e):new Ot(e,t,n,null==r?1:r)},lt(ct,{brighter(e){return e=null==e?dt:Math.pow(dt,e),new Ot(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?ht:Math.pow(ht,e),new Ot(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Mt(Vt(e>=240?e-240:e+120,i,r),Vt(e,i,r),Vt(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Ot(Ut(this.h),zt(this.s),zt(this.l),Nt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Nt(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(Ut(this.h),", ").concat(100*zt(this.s),"%, ").concat(100*zt(this.l),"%").concat(1===e?")":", ".concat(e,")"))}}));const Ht=e=>()=>e;function jt(e,t){return function(n){return e+n*t}}function Wt(e){return 1===(e=+e)?qt:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Ht(isNaN(t)?n:t)}}function qt(e,t){var n=t-e;return n?jt(e,n):Ht(isNaN(e)?t:e)}const Xt=function e(t){var n=Wt(t);function r(e,t){var r=n((e=Tt(e)).r,(t=Tt(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=qt(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function Kt(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=Tt(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}Kt(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return Gt((n-r/t)*t,o,i,a,s)}}),Kt(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return Gt((n-r/t)*t,i,a,o,s)}});var Yt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jt=new RegExp(Yt.source,"g");function $t(e,t){var n,r,i,a=Yt.lastIndex=Jt.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=Yt.exec(e))&&(r=Jt.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:$e(n,r)})),a=Jt.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function Qt(e,t){var n;return("number"===typeof t?$e:t instanceof Ft?Xt:(n=Ft(t))?(t=n,Xt):$t)(e,t)}function Zt(e){return function(){this.removeAttribute(e)}}function en(e){return function(){this.removeAttributeNS(e.space,e.local)}}function tn(e,t,n){var r,i,a=n+"";return function(){var o=this.getAttribute(e);return o===a?null:o===r?i:i=t(r=o,n)}}function nn(e,t,n){var r,i,a=n+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===a?null:o===r?i:i=t(r=o,n)}}function rn(e,t,n){var r,i,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttribute(e))===(s=u+"")?null:o===r&&s===i?a:(i=s,a=t(r=o,u));this.removeAttribute(e)}}function an(e,t,n){var r,i,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttributeNS(e.space,e.local))===(s=u+"")?null:o===r&&s===i?a:(i=s,a=t(r=o,u));this.removeAttributeNS(e.space,e.local)}}function on(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,i)),n}return i._value=t,i}function sn(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,i)),n}return i._value=t,i}function un(e,t){return function(){Ke(this,e).delay=+t.apply(this,arguments)}}function ln(e,t){return t=+t,function(){Ke(this,e).delay=t}}function cn(e,t){return function(){Ye(this,e).duration=+t.apply(this,arguments)}}function hn(e,t){return t=+t,function(){Ye(this,e).duration=t}}var dn=Ee.prototype.constructor;function pn(e){return function(){this.style.removeProperty(e)}}var fn=0;function mn(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function gn(){return++fn}var vn=Ee.prototype;mn.prototype=function(e){return Ee().transition(e)}.prototype={constructor:mn,select:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=l(e));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var s,u,c=r[o],h=c.length,d=a[o]=new Array(h),p=0;p<h;++p)(s=c[p])&&(u=e.call(s,s.__data__,p,c))&&("__data__"in s&&(u.__data__=s.__data__),d[p]=u,Xe(d[p],t,n,p,d,Je(s,n)));return new mn(a,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=h(e));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var u,l=r[s],c=l.length,d=0;d<c;++d)if(u=l[d]){for(var p,f=e.call(u,u.__data__,d,l),m=Je(u,n),g=0,v=f.length;g<v;++g)(p=f[g])&&Xe(p,t,n,g,f,m);a.push(f),o.push(u)}return new mn(a,o,t,n)},selectChild:vn.selectChild,selectChildren:vn.selectChildren,filter:function(e){"function"!==typeof e&&(e=p(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,u=r[i]=[],l=0;l<s;++l)(a=o[l])&&e.call(a,a.__data__,l,o)&&u.push(a);return new mn(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u,l=t[s],c=n[s],h=l.length,d=o[s]=new Array(h),p=0;p<h;++p)(u=l[p]||c[p])&&(d[p]=u);for(;s<r;++s)o[s]=t[s];return new mn(o,this._parents,this._name,this._id)},selection:function(){return new dn(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=gn(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],u=s.length,l=0;l<u;++l)if(o=s[l]){var c=Je(o,t);Xe(o,e,n,l,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new mn(r,this._parents,e,n)},call:vn.call,nodes:vn.nodes,node:vn.node,size:vn.size,empty:vn.empty,each:vn.each,on:function(e,t){var n=this._id;return arguments.length<2?Je(this.node(),n).on.on(e):this.each(function(e,t,n){var r,i,a=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?Ke:Ye;return function(){var o=a(this,e),s=o.on;s!==r&&(i=(r=s).copy()).on(t,n),o.on=i}}(n,e,t))},attr:function(e,t){var n=S(e),r="transform"===n?it:Qt;return this.attrTween(e,"function"===typeof t?(n.local?an:rn)(n,r,st(this,"attr."+e,t)):null==t?(n.local?en:Zt)(n):(n.local?nn:tn)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!==typeof t)throw new Error;var r=S(e);return this.tween(n,(r.local?on:sn)(r,t))},style:function(e,t,n){var r="transform"===(e+="")?rt:Qt;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var a=U(this,e),o=(this.style.removeProperty(e),U(this,e));return a===o?null:a===n&&o===r?i:i=t(n=a,r=o)}}(e,r)).on("end.style."+e,pn(e)):"function"===typeof t?this.styleTween(e,function(e,t,n){var r,i,a;return function(){var o=U(this,e),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(e),u=s=U(this,e)),o===u?null:o===r&&u===i?a:(i=u,a=t(r=o,s))}}(e,r,st(this,"style."+e,t))).each(function(e,t){var n,r,i,a,o="style."+t,s="end."+o;return function(){var u=Ye(this,e),l=u.on,c=null==u.value[o]?a||(a=pn(t)):void 0;l===n&&i===c||(r=(n=l).copy()).on(s,i=c),u.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,a=n+"";return function(){var o=U(this,e);return o===a?null:o===r?i:i=t(r=o,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!==typeof t)throw new Error;return this.tween(r,function(e,t,n){var r,i;function a(){var a=t.apply(this,arguments);return a!==i&&(r=(i=a)&&function(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}(e,a,n)),r}return a._value=t,a}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"===typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(st(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!==typeof e)throw new Error;return this.tween(t,function(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return r._value=e,r}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=Je(this.node(),n).tween,a=0,o=i.length;a<o;++a)if((r=i[a]).name===e)return r.value;return null}return this.each((null==t?at:ot)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?un:ln)(t,e)):Je(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?cn:hn)(t,e)):Je(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!==typeof t)throw new Error;return function(){Ye(this,e).ease=t}}(t,e)):Je(this.node(),t).ease},easeVarying:function(e){if("function"!==typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!==typeof n)throw new Error;Ye(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var s={value:o},u={value:function(){0===--i&&a()}};n.each(function(){var n=Ye(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),n.on=t}),0===i&&a()})},[Symbol.iterator]:vn[Symbol.iterator]};var Dn={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function yn(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error("transition ".concat(t," not found"));return n}Ee.prototype.interrupt=function(e){return this.each(function(){!function(e,t){var n,r,i,a=e.__transition,o=!0;if(a){for(i in t=null==t?null:t+"",a)(n=a[i]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete a[i]):o=!1;o&&delete e.__transition}}(this,e)})},Ee.prototype.transition=function(e){var t,n;e instanceof mn?(t=e._id,e=e._name):(t=gn(),(n=Dn).time=ke(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],u=s.length,l=0;l<u;++l)(o=s[l])&&Xe(o,e,t,l,s,n||yn(o,t));return new mn(r,this._parents,e,t)};const{abs:En,max:An,min:Cn}=Math;function _n(e){return[+e[0],+e[1]]}function bn(e){return[_n(e[0]),_n(e[1])]}["w","e"].map(xn),["n","s"].map(xn),["n","w","e","s","nw","ne","sw","se"].map(xn);function xn(e){return{type:e}}function Fn(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function wn(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=Tn)):void 0===t&&(t=Sn);for(var n,r,i,a,o,s=new Pn(e),u=[s];n=u.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)u.push(r=i[a]=new Pn(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(Bn)}function Sn(e){return e.children}function Tn(e){return Array.isArray(e)?e[1]:null}function Mn(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function Bn(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function Pn(e){this.data=e,this.depth=this.height=0,this.parent=null}function Nn(e,t){return e.parent===t.parent?1:2}function Rn(e){var t=e.children;return t?t[0]:e.t}function Ln(e){var t=e.children;return t?t[t.length-1]:e.t}function In(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function kn(e,t,n){return e.a.parent===t.parent?e.a:n}function On(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function Un(){var e=Nn,t=1,n=1,r=null;function i(i){var u=function(e){for(var t,n,r,i,a,o=new On(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new On(r[i],i)),n.parent=t;return(o.parent=new On(null,0)).children=[o],o}(i);if(u.eachAfter(a),u.parent.m=-u.z,u.eachBefore(o),r)i.eachBefore(s);else{var l=i,c=i,h=i;i.eachBefore(function(e){e.x<l.x&&(l=e),e.x>c.x&&(c=e),e.depth>h.depth&&(h=e)});var d=l===c?1:e(l,c)/2,p=d-l.x,f=t/(c.x+d+p),m=n/(h.depth||1);i.eachBefore(function(e){e.x=(e.x+p)*f,e.y=e.depth*m})}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,u=a.parent.children[0],l=a.m,c=o.m,h=s.m,d=u.m;s=Ln(s),a=Rn(a),s&&a;)u=Rn(u),(o=Ln(o)).a=t,(i=s.z+h-a.z-l+e(s._,a._))>0&&(In(kn(s,t,r),t,i),l+=i,c+=i),h+=s.m,l+=a.m,d+=u.m,c+=o.m;s&&!Ln(o)&&(o.t=s,o.m+=h-c),a&&!Rn(u)&&(u.t=a,u.m+=l-d,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}Pn.prototype=wn.prototype={constructor:Pn,count:function(){return this.eachAfter(Fn)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],u=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++u,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;e=n.pop(),t=r.pop();for(;e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return wn(this).eachBefore(Mn)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}},On.prototype=Object.create(Pn.prototype);const zn=Math.sqrt(50),Vn=Math.sqrt(10),Gn=Math.sqrt(2);function Hn(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=zn?10:a>=Vn?5:a>=Gn?2:1;let s,u,l;return i<0?(l=Math.pow(10,-i)/o,s=Math.round(e*l),u=Math.round(t*l),s/l<e&&++s,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,s=Math.round(e/l),u=Math.round(t/l),s*l<e&&++s,u*l>t&&--u),u<s&&.5<=n&&n<2?Hn(e,t,2*n):[s,u,l]}function jn(e,t,n){return Hn(e=+e,t=+t,n=+n)[2]}function Wn(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function qn(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Xn(e){let t,n,r;function i(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=Wn,n=(t,n)=>Wn(e(t),n),r=(t,n)=>e(t)-n):(t=e===Wn||e===qn?e:Kn,n=e,r=e),{left:i,center:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=i(e,t,n,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length)-1);return a>n&&r(e[a-1],t)>-r(e[a],t)?a-1:a},right:function(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<=0?i=t+1:a=t}while(i<a)}return i}}}function Kn(){return 0}const Yn=Xn(Wn),Jn=Yn.right,$n=(Yn.left,Xn(function(e){return null===e?NaN:+e}).center,Jn);function Qn(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=nr(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function Zn(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function er(e,t){var n,r={},i={};for(n in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)n in e?r[n]=nr(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}function tr(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function nr(e,t){var n,r=typeof t;return null==t||"boolean"===r?Ht(t):("number"===r?$e:"string"===r?(n=Ft(t))?(t=n,Xt):$t:t instanceof Ft?Xt:t instanceof Date?Zn:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?tr:Array.isArray(t)?Qn:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?er:$e)(e,t)}function rr(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function ir(e){return+e}var ar=[0,1];function or(e){return e}function sr(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function ur(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=sr(i,r),a=n(o,a)):(r=sr(r,i),a=n(a,o)),function(e){return a(r(e))}}function lr(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=sr(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=$n(e,t,1,r)-1;return a[n](i[n](t))}}function cr(){var e,t,n,r,i,a,o=ar,s=ar,u=nr,l=or;function c(){var e=Math.min(o.length,s.length);return l!==or&&(l=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?lr:ur,i=a=null,h}function h(t){return null==t||isNaN(t=+t)?n:(i||(i=r(o.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((a||(a=r(s,o.map(e),$e)))(n)))},h.domain=function(e){return arguments.length?(o=Array.from(e,ir),c()):o.slice()},h.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},h.rangeRound=function(e){return s=Array.from(e),u=rr,c()},h.clamp=function(e){return arguments.length?(l=!!e||or,c()):l!==or},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,c()}}function hr(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}var dr,pr=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function fr(e){if(!(t=pr.exec(e)))throw new Error("invalid format: "+e);var t;return new mr({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function mr(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function gr(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function vr(e){return(e=gr(Math.abs(e)))?e[1]:NaN}function Dr(e,t){var n=gr(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}fr.prototype=mr.prototype,mr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const yr={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Dr(100*e,t),r:Dr,s:function(e,t){var n=gr(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(dr=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+gr(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Er(e){return e}var Ar,Cr,_r,br=Array.prototype.map,xr=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Fr(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Er:(t=br.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Er:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(br.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"\u2212":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=fr(e)).fill,n=e.align,h=e.sign,d=e.symbol,p=e.zero,f=e.width,m=e.comma,g=e.precision,v=e.trim,D=e.type;"n"===D?(m=!0,D="g"):yr[D]||(void 0===g&&(g=12),v=!0,D="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var y="$"===d?i:"#"===d&&/[boxX]/.test(D)?"0"+D.toLowerCase():"",E="$"===d?a:/[%p]/.test(D)?u:"",A=yr[D],C=/[defgprs%]/.test(D);function _(e){var i,a,u,d=y,_=E;if("c"===D)_=A(e)+_,e="";else{var b=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:A(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),b&&0===+e&&"+"!==h&&(b=!1),d=(b?"("===h?h:l:"-"===h||"("===h?"":h)+d,_=("s"===D?xr[8+dr/3]:"")+_+(b&&"("===h?")":""),C)for(i=-1,a=e.length;++i<a;)if(48>(u=e.charCodeAt(i))||u>57){_=(46===u?o+e.slice(i+1):e.slice(i))+_,e=e.slice(0,i);break}}m&&!p&&(e=r(e,1/0));var x=d.length+e.length+_.length,F=x<f?new Array(f-x+1).join(t):"";switch(m&&p&&(e=r(F+e,F.length?f-_.length:1/0),F=""),n){case"<":e=d+e+_+F;break;case"=":e=d+F+e+_;break;case"^":e=F.slice(0,x=F.length>>1)+d+e+_+F.slice(x);break;default:e=F+d+e+_}return s(e)}return g=void 0===g?6:/[gprs]/.test(D)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),_.toString=function(){return e+""},_}return{format:h,formatPrefix:function(e,t){var n=h(((e=fr(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(vr(t)/3))),i=Math.pow(10,-r),a=xr[8+r/3];return function(e){return n(i*e)+a}}}}function wr(e,t,n,r){var i,a=function(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?jn(t,e,n):jn(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}(e,t,n);switch((r=fr(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(vr(t)/3)))-vr(Math.abs(e)))}(a,o))||(r.precision=i),_r(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,vr(t)-vr(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-vr(Math.abs(e)))}(a))||(r.precision=i-2*("%"===r.type))}return Cr(r)}function Sr(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){if(!((n=+n)>0))return[];if((e=+e)===(t=+t))return[e];const r=t<e,[i,a,o]=r?Hn(t,e,n):Hn(e,t,n);if(!(a>=i))return[];const s=a-i+1,u=new Array(s);if(r)if(o<0)for(let l=0;l<s;++l)u[l]=(a-l)/-o;else for(let l=0;l<s;++l)u[l]=(a-l)*o;else if(o<0)for(let l=0;l<s;++l)u[l]=(i+l)/-o;else for(let l=0;l<s;++l)u[l]=(i+l)*o;return u}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return wr(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,u=a[o],l=a[s],c=10;for(l<u&&(i=u,u=l,l=i,i=o,o=s,s=i);c-- >0;){if((i=jn(u,l,n))===r)return a[o]=u,a[s]=l,t(a);if(i>0)u=Math.floor(u/i)*i,l=Math.ceil(l/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,l=Math.floor(l*i)/i}r=i}return e},e}function Tr(){var e=cr()(or,or);return e.copy=function(){return t=e,Tr().domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown());var t},hr.apply(e,arguments),Sr(e)}function Mr(e){return"string"===typeof e?new De([[document.querySelector(e)]],[document.documentElement]):new De([[e]],ve)}function Br(e){this._context=e}function Pr(e){return new Br(e)}Ar=Fr({thousands:",",grouping:[3],currency:["$",""]}),Cr=Ar.format,_r=Ar.formatPrefix,Br.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Nr=Lr(Pr);function Rr(e){this._curve=e}function Lr(e){function t(t){return new Rr(e(t))}return t._curve=e,t}Rr.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(e,t){this._curve.point(t*Math.sin(e),t*-Math.cos(e))}};var Ir,kr,Or,Ur,zr,Vr,Gr,Hr,jr,Wr,qr,Xr,Kr,Yr,Jr=Array.prototype.slice;function $r(e){return function(){return e}}function Qr(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Zr=Math.PI,ei=2*Zr,ti=1e-6,ni=ei-ti;function ri(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class ii{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?ri:function(e){let t=Math.floor(e);if(!(t>=0))throw new Error("invalid digits: ".concat(e));if(t>15)return ri;const n=10**t;return function(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}(e)}moveTo(e,t){this._append(Ir||(Ir=Qr(["M",",",""])),this._x0=this._x1=+e,this._y0=this._y1=+t)}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append(kr||(kr=Qr(["Z"]))))}lineTo(e,t){this._append(Or||(Or=Qr(["L",",",""])),this._x1=+e,this._y1=+t)}quadraticCurveTo(e,t,n,r){this._append(Ur||(Ur=Qr(["Q",",",",",",",""])),+e,+t,this._x1=+n,this._y1=+r)}bezierCurveTo(e,t,n,r,i,a){this._append(zr||(zr=Qr(["C",",",",",",",",",",",""])),+e,+t,+n,+r,this._x1=+i,this._y1=+a)}arcTo(e,t,n,r,i){if(e=+e,t=+t,n=+n,r=+r,(i=+i)<0)throw new Error("negative radius: ".concat(i));let a=this._x1,o=this._y1,s=n-e,u=r-t,l=a-e,c=o-t,h=l*l+c*c;if(null===this._x1)this._append(Vr||(Vr=Qr(["M",",",""])),this._x1=e,this._y1=t);else if(h>ti)if(Math.abs(c*s-u*l)>ti&&i){let d=n-a,p=r-o,f=s*s+u*u,m=d*d+p*p,g=Math.sqrt(f),v=Math.sqrt(h),D=i*Math.tan((Zr-Math.acos((f+h-m)/(2*g*v)))/2),y=D/v,E=D/g;Math.abs(y-1)>ti&&this._append(Hr||(Hr=Qr(["L",",",""])),e+y*l,t+y*c),this._append(jr||(jr=Qr(["A",",",",0,0,",",",",",""])),i,i,+(c*d>l*p),this._x1=e+E*s,this._y1=t+E*u)}else this._append(Gr||(Gr=Qr(["L",",",""])),this._x1=e,this._y1=t);else;}arc(e,t,n,r,i,a){if(e=+e,t=+t,a=!!a,(n=+n)<0)throw new Error("negative radius: ".concat(n));let o=n*Math.cos(r),s=n*Math.sin(r),u=e+o,l=t+s,c=1^a,h=a?r-i:i-r;null===this._x1?this._append(Wr||(Wr=Qr(["M",",",""])),u,l):(Math.abs(this._x1-u)>ti||Math.abs(this._y1-l)>ti)&&this._append(qr||(qr=Qr(["L",",",""])),u,l),n&&(h<0&&(h=h%ei+ei),h>ni?this._append(Xr||(Xr=Qr(["A",",",",0,1,",",",",","A",",",",0,1,",",",",",""])),n,n,c,e-o,t-s,n,n,c,this._x1=u,this._y1=l):h>ti&&this._append(Kr||(Kr=Qr(["A",",",",0,",",",",",",",""])),n,n,+(h>=Zr),c,this._x1=e+n*Math.cos(i),this._y1=t+n*Math.sin(i)))}rect(e,t,n,r){this._append(Yr||(Yr=Qr(["M",",","h","v","h","Z"])),this._x0=this._x1=+e,this._y0=this._y1=+t,n=+n,+r,-n)}toString(){return this._}}function ai(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{const e=Math.floor(n);if(!(e>=0))throw new RangeError("invalid digits: ".concat(n));t=e}return e},()=>new ii(t)}function oi(e){return e[0]}function si(e){return e[1]}function ui(e,t){var n=$r(!0),r=null,i=Pr,a=null,o=ai(s);function s(s){var u,l,c,h=(s=function(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}(s)).length,d=!1;for(null==r&&(a=i(c=o())),u=0;u<=h;++u)!(u<h&&n(l=s[u],u,s))===d&&((d=!d)?a.lineStart():a.lineEnd()),d&&a.point(+e(l,u,s),+t(l,u,s));if(c)return a=null,c+""||null}return e="function"===typeof e?e:void 0===e?oi:$r(e),t="function"===typeof t?t:void 0===t?si:$r(t),s.x=function(t){return arguments.length?(e="function"===typeof t?t:$r(+t),s):e},s.y=function(e){return arguments.length?(t="function"===typeof e?e:$r(+e),s):t},s.defined=function(e){return arguments.length?(n="function"===typeof e?e:$r(!!e),s):n},s.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),s):i},s.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),s):r},s}function li(){return function(e){var t=e.curve;return e.angle=e.x,delete e.x,e.radius=e.y,delete e.y,e.curve=function(e){return arguments.length?t(Lr(e)):t()._curve},e}(ui().curve(Nr))}class ci{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function hi(e){return new ci(e,!0)}function di(e){return e.source}function pi(e){return e.target}function fi(e){let t=di,n=pi,r=oi,i=si,a=null,o=null,s=ai(u);function u(){let u;const l=Jr.call(arguments),c=t.apply(this,l),h=n.apply(this,l);if(null==a&&(o=e(u=s())),o.lineStart(),l[0]=c,o.point(+r.apply(this,l),+i.apply(this,l)),l[0]=h,o.point(+r.apply(this,l),+i.apply(this,l)),o.lineEnd(),u)return o=null,u+""||null}return u.source=function(e){return arguments.length?(t=e,u):t},u.target=function(e){return arguments.length?(n=e,u):n},u.x=function(e){return arguments.length?(r="function"===typeof e?e:$r(+e),u):r},u.y=function(e){return arguments.length?(i="function"===typeof e?e:$r(+e),u):i},u.context=function(t){return arguments.length?(null==t?a=o=null:o=e(a=t),u):a},u}function mi(){}function gi(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function vi(e,t){this._context=e,this._k=(1-t)/6}vi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:gi(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:gi(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function e(t){function n(e){return new vi(e,t)}return n.tension=function(t){return e(+t)},n})(0);function Di(e,t){this._context=e,this._k=(1-t)/6}Di.prototype={areaStart:mi,areaEnd:mi,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:gi(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const yi=function e(t){function n(e){return new Di(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Ei(e,t,n){this.k=e,this.x=t,this.y=n}Ei.prototype={constructor:Ei,scale:function(e){return 1===e?this:new Ei(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Ei(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new Ei(1,0,0);Ei.prototype;let Ai=function(e){return e.mRNA="mRNA transcripts",e.PROTEIN="proteins",e.METABOLITE="metabolites",e.LIPID="lipids",e}({}),Ci=function(e){return e.BASELINE="baseline",e.PERTURBED="perturbed",e.COMPARISON="comparison",e.ANIMATION="animation",e}({});const _i=["10 min","30 min","90 min","48 hours"],bi={"Energy Metabolism":["Glucose Metabolism","Lipid Metabolism","Mitochondrial Respiration","mTOR Signaling"],"Immune Response":["Innate Immunity","Adaptive Immunity","Inflammation","Cytokine Signaling"],"Oxidative Stress":["ROS Production","Antioxidant Defense","DNA Damage Response","Protein Folding Stress"],"Circadian Rhythm":["Circadian Clock","Sleep-Wake Cycle","Melatonin Signaling","Light-Dark Response"],"Blood Pressure":["Renin-Angiotensin System","Vascular Tone","Sodium Balance","Baroreceptor Response"],"Heart Rate":["Cardiac Conduction","Autonomic Control","Calcium Handling","Beta-Adrenergic Signaling"],"Temperature Regulation":["Thermogenesis","Heat Shock Response","Hypothalamic Control","Brown Fat Activation"]},xi=Object.values(bi).flat(),Fi=[{id:"ketamine",name:"Ketamine",mechanism:"NMDA Receptor Antagonist",targetPathways:["Antioxidant Defense","DNA Damage Response","Circadian Clock"],targetOmicsTypes:[Ai.mRNA,Ai.PROTEIN,Ai.METABOLITE],effects:{upregulatedGenes:["BDNF","ARC","CREB1","FOS"],downregulatedGenes:["GRIN1","GRIN2A","GRIN2B","GRIA1"],enhancedInteractions:["BDNF-TrkB","CREB-CBP"],disruptedInteractions:["NMDA-Glutamate","GABA-Inhibition"]}},{id:"etomidate",name:"Etomidate",mechanism:"GABAA Receptor Agonist",targetPathways:["Inflammation","Cytokine Signaling","Heat Shock Response"],targetOmicsTypes:[Ai.mRNA,Ai.PROTEIN],effects:{upregulatedGenes:["GABRA1","GABRB2","GABRG2","GAD1"],downregulatedGenes:["CYP11B1","CYP17A1","STAR","MC2R"],enhancedInteractions:["GABA-GABAA","Chloride-Influx"],disruptedInteractions:["ACTH-MC2R","Cholesterol-Cortisol"]}},{id:"propofol",name:"Propofol",mechanism:"GABAA Receptor Modulator",targetPathways:["Lipid Metabolism","Mitochondrial Respiration","Inflammation"],targetOmicsTypes:[Ai.PROTEIN,Ai.METABOLITE,Ai.LIPID],effects:{upregulatedGenes:["GABRA1","GABRB1","GABRG2","UCP1"],downregulatedGenes:["COX1","COX2","ATP5A1","NDUFA1"],enhancedInteractions:["GABA-Receptor","Propofol-Membrane"],disruptedInteractions:["ETC-Complex1","ATP-Synthesis"]}},{id:"novel1",name:"Novel 1",mechanism:"Multi-target Neuromodulator",targetPathways:["Circadian Clock","Sleep-Wake Cycle","Antioxidant Defense"],targetOmicsTypes:[Ai.mRNA,Ai.PROTEIN,Ai.METABOLITE],effects:{upregulatedGenes:["CLOCK","PER1","CRY1","BMAL1"],downregulatedGenes:["ROS","NOX4","MAOA","COMT"],enhancedInteractions:["Clock-Bmal1","Antioxidant-Defense"],disruptedInteractions:["ROS-Damage","Stress-Response"]}},{id:"novel2",name:"Novel 2",mechanism:"Selective Ion Channel Modulator",targetPathways:["Cardiac Conduction","Calcium Handling","Autonomic Control"],targetOmicsTypes:[Ai.PROTEIN,Ai.METABOLITE],effects:{upregulatedGenes:["CACNA1C","RYR2","SERCA2","PLN"],downregulatedGenes:["SCN5A","KCNH2","KCNQ1","HCN4"],enhancedInteractions:["Calcium-Release","SERCA-Uptake"],disruptedInteractions:["Sodium-Current","Potassium-Efflux"]}}],wi=(e,t,n,r)=>{let i=.3;switch(e){case Ai.PROTEIN:i+=.3;break;case Ai.mRNA:i+=.25;break;case Ai.METABOLITE:i+=.2;break;case Ai.LIPID:i+=.15}switch(["Glucose Metabolism","mTOR Signaling","Inflammation","DNA Damage Response","Antioxidant Defense"].includes(t)&&(i+=.2),n){case"10 min":i+=.15;break;case"30 min":i+=.1;break;case"90 min":i+=.05;break;case"48 hours":i-=.05}i+=.3*(Math.random()-.5);return(r<3||Math.random()<.15)&&(i+=.2),Math.max(.1,Math.min(.95,i))},Si=()=>{const e=[],t={"10 min":.15,"30 min":.35,"90 min":.55,"48 hours":.75},n={"Energy Metabolism":.2,"Immune Response":.5,"Oxidative Stress":.8};return _i.forEach((r,i)=>{const a=(e=>{switch(e){case"10 min":return{[Ai.mRNA]:.1,[Ai.PROTEIN]:.4,[Ai.METABOLITE]:.4,[Ai.LIPID]:.1};case"30 min":return{[Ai.mRNA]:.25,[Ai.PROTEIN]:.35,[Ai.METABOLITE]:.3,[Ai.LIPID]:.1};case"90 min":return{[Ai.mRNA]:.35,[Ai.PROTEIN]:.25,[Ai.METABOLITE]:.25,[Ai.LIPID]:.15};case"48 hours":return{[Ai.mRNA]:.3,[Ai.PROTEIN]:.2,[Ai.METABOLITE]:.15,[Ai.LIPID]:.35};default:return{[Ai.mRNA]:.25,[Ai.PROTEIN]:.25,[Ai.METABOLITE]:.25,[Ai.LIPID]:.25}}})(r);Object.entries(bi).forEach(i=>{let[o,s]=i;const u=Math.floor(120/Object.keys(bi).length),l={[Ai.mRNA]:Math.round(u*a[Ai.mRNA]),[Ai.PROTEIN]:Math.round(u*a[Ai.PROTEIN]),[Ai.METABOLITE]:Math.round(u*a[Ai.METABOLITE]),[Ai.LIPID]:Math.round(u*a[Ai.LIPID])};Object.entries(l).forEach(i=>{let[a,u]=i;s.forEach((i,l)=>{const c=Math.ceil(u/s.length);for(let s=0;s<c;s++){const u=10*Math.random()+1,l=Ti(i,a,s,r);if(l&&i&&a&&o){const c=.15*(Math.random()-.5),h=.08*(Math.random()-.5),d=wi(a,i,r,s);let p=o;"Inflammation"===i&&Math.random()<.4?p=[o,"Immune Response"]:"ROS Production"===i&&Math.random()<.3?p=[o,"Oxidative Stress"]:"Mitochondrial Respiration"===i&&Math.random()<.3?p=[o,"Energy Metabolism"]:"Circadian Clock"===i&&Math.random()<.2?p=[o,"Sleep-Wake Cycle"]:"Autonomic Control"===i&&Math.random()<.25&&(p=[o,"Blood Pressure"]),e.push({id:"".concat(r.replace(/\s+/g,""),"_").concat(o.replace(/\s+/g,""),"_").concat(i.replace(/\s+/g,""),"_").concat(a.replace(/\s+/g,""),"_").concat(s),name:l,type:a,pathway:i,broadCategory:p,timepoint:r,expression:u,baselineExpression:u,significance:.05*Math.random(),confidence:d,isPerturbationTarget:!1,initialX:n[o]+c,initialY:t[r]+h})}}})})})}),e.filter(e=>e&&e.id&&e.name&&e.type&&e.pathway)},Ti=(e,t,n,r)=>{if(!e||!t||n<0)return"Node_".concat(n);const i={"Glucose Metabolism":["GLUT4","HK2","PFKM","ALDOA","G6PC","PCK1","PDHB","CS","IDH1","GLUT1","HK1","PFKL","ALDOB","G6PD","PCK2","PDHA1","ACO1","IDH2","GLUT2","GLUT3","HK3","HK4","PFKP","ALDOC","GPI","TPI1","GAPDH","PGK1","PGAM1","ENO1","PKM","LDHA","LDHB","PDK1","PDK2","PDK3","PDK4","PDP1","PDP2","ACLY","ACC1","FASN","SCD1","ELOVL6","DGAT1","DGAT2","ATGL","HSL","MAGL","CPT1A","CPT1B","CPT2","ACADM","HADHA","HADHB"],"Lipid Metabolism":["FASN","ACACA","CPT1A","PPARA","SREBF1","ACOX1","DGAT1","LIPE","PLIN1","ACACB","CPT1B","PPARG","SREBF2","ACOX2","DGAT2","PNPLA2","PLIN2","ELOVL1","ELOVL2","ELOVL3","ELOVL4","ELOVL5","ELOVL6","ELOVL7","SCD1","SCD2","FADS1","FADS2","FADS3","ACSL1","ACSL3","ACSL4","ACSL5","ACSL6","HADHA","HADHB","ACADM","ACADL","ACADS","ACADVL","EHHADH","HSD17B4","PECR","MECR","TECR","SC5D","DHCR7","DHCR24","LSS","SQLE","HMGCR","HMGCS1"],"Mitochondrial Respiration":["COX4I1","NDUFA4","SDHA","UQCRB","ATP5A1","PGC1A","TFAM","NRF1","PPRC1","COX4I2","NDUFA1","SDHB","UQCRH","ATP5B","PGC1B","TFAM2","NRF2","PPRC2","NDUFS1","NDUFS2","NDUFS3","NDUFS4","NDUFS5","NDUFS6","NDUFS7","NDUFS8","NDUFV1","NDUFV2","NDUFV3","NDUFA2","NDUFA3","NDUFA5","NDUFA6","NDUFA7","NDUFA8","NDUFA9","SDHC","SDHD","SDHAF1","SDHAF2","UQCRC1","UQCRC2","CYC1","UQCRFS1","UQCRQ","COX5A","COX5B","COX6A1","COX6B1","COX6C","COX7A1","COX7B","COX7C","COX8A"],"mTOR Signaling":["MTOR","RPS6KB1","EIF4EBP1","ULK1","TFEB","TSC2","RHEB","AKT1","PTEN","RPTOR","RPS6KB2","EIF4EBP2","ULK2","TFE3","TSC1","RHOA","AKT2","PIK3CA","PIK3CB","PIK3CD","PIK3CG","PIK3R1","PIK3R2","PIK3R3","PDK1","RICTOR","MAPKAP1","MLST8","DEPTOR","PRAS40","RAPTOR","mLST8","FKBP12","FRAP1","RRAGA","RRAGB","RRAGC","RRAGD","LAMTOR1","LAMTOR2","LAMTOR3","LAMTOR4","LAMTOR5","SLC38A9","FLCN","FNIP1","FNIP2","SESN1","SESN2","SESN3","CASTOR1","CASTOR2","SAMTOR","WDR24","WDR59","MIOS"],"Innate Immunity":["TLR4","MYD88","IRF3","IFNB1","IL1B","CXCL10","IRF7","TBK1","MAVS","TLR2","TIRAP","IRF4","IFNA1","IL1A","CXCL8","IRF8","IKBKE","RIG1","TLR1","TLR3","TLR5","TLR6","TLR7","TLR8","TLR9","TLR10","IRAK1","IRAK2","IRAK4","TRAF3","TRAF6","TAK1","TAB1","TAB2","TAB3","IKK1","IKK2","NEMO","NFKB1","NFKB2","RELA","RELB","REL","IKBA","IKBB","IKBE","STAT1","STAT2","STAT3","STAT4","STAT5A","STAT5B","STAT6","JAK1","JAK2","JAK3","TYK2"],"Adaptive Immunity":["CD4","CD8A","TCR","BCR","IL2","IFNG","CD28","CTLA4","PD1","CD8B","TCRA","TCRB","TCRG","TCRD","IL4","IL5","IL13","CD80","CD86","PDCD1","CD3D","CD3E","CD3G","CD3Z","ZAP70","LCK","FYN","LAT","SLP76","GRAP2","VAV1","VAV2","VAV3","PLCG1","PLCG2","PRKCQ","PRKCA","NFATC1","NFATC2","NFATC3","ICOS","ICOSLG","CD40","CD40LG","OX40","OX40L","41BB","41BBL","GITR","GITRL","LAG3","TIM3","TIGIT","VISTA","CD27","CD70","HVEM","BTLA","CD160"],Inflammation:["NFKB1","TNF","IL6","PTGS2","NOS2","HMGB1","NLRP3","CASP1","IL18","RELA","TNFRSF1A","IL1R1","PTGS1","NOS1","S100A8","NLRP1","CASP4","IL1RN","IL1B","IL1A","IL6R","IL6ST","CXCL1","CXCL2","CXCL3","CXCL5","CCL2","CCL3","CCL4","CCL5","CCL20","CXCR1","CXCR2","CCR1","CCR2","CCR5","ICAM1","VCAM1","SELE","SELP","SELL","ITGAL","ITGAM","ITGAX","ITGB2","CD14","CD68","MPO","ELANE","CTSG","AZU1","PRTN3","CAMP","LTF","LCN2","S100A9","CALR"],"Cytokine Signaling":["JAK2","STAT3","SOCS3","IL10","TGFB1","SMAD3","JAK1","STAT1","IRF4","TYK2","STAT4","SOCS1","IL12","TGFB2","SMAD2","JAK3","STAT2","IRF1","STAT5A","STAT5B","STAT6","SOCS2","SOCS4","SOCS5","SOCS6","SOCS7","CIS","PIAS1","PIAS2","PIAS3","PIAS4","SUMO1","SUMO2","SUMO3","UBC9","SENP1","SENP2","SENP3","SMAD1","SMAD4","SMAD5","SMAD6","SMAD7","SMAD8","SMAD9","TGFBR1","TGFBR2","TGFBR3","BAMBI","SARA","SKI","SKIL","LTBP1","LTBP2","LTBP3","LTBP4","THBS1"],"ROS Production":["NOX4","XDH","CYP2E1","MPO","DUOX2","NOX1","NOX2","CYBA","NCF1","DUOX1","XO","CYP1A1","EPO","DUOX3","NOX3","NOX5","CYBB","NCF2","NCF4","RAC1","RAC2","NOXA1","NOXO1","DUOXA1","DUOXA2","TPO","LPO","CYP2A6","CYP2B6","CYP2C8","CYP2C9","CYP2C19","CYP2D6","CYP3A4","CYP3A5","CYP1A2","CYP2J2","ALDH1A1","ALDH2","ALDH3A1","ADH1A","ADH1B","ADH1C","ADH4","ADH5","ADH6","ADH7","MAOA","MAOB","AOC1","AOC2","AOC3","DAO","DDC","COMT"],"Antioxidant Defense":["SOD1","CAT","GPX1","GSR","NRF2","HMOX1","SOD2","PRDX1","TXN","SOD3","CATALASE","GPX2","GSSG","KEAP1","HMOX2","SOD4","PRDX2","TXNRD1","GPX3","GPX4","GPX5","GPX6","GPX7","GPX8","PRDX3","PRDX4","PRDX5","PRDX6","TXNRD2","TXNRD3","TXN2","TXNIP","SRXN1","GCLC","GCLM","GSS","GSTA1","GSTA2","GSTA3","GSTA4","GSTA5","GSTK1","GSTM1","GSTM2","GSTM3","GSTM4","GSTM5","GSTP1","GSTT1","GSTT2","GSTZ1","MGST1","MGST2","MGST3","EPHX1","EPHX2","NQO1"],"DNA Damage Response":["ATM","TP53","BRCA1","RAD51","PARP1","H2AFX","ATR","CHEK1","MDM2","ATF2","TP73","BRCA2","RAD52","PARP2","H2AX","ATRIP","CHEK2","MDM4","RAD50","MRE11","NBN","XRCC1","XRCC2","XRCC3","XRCC4","XRCC5","XRCC6","LIG1","LIG3","LIG4","PRKDC","NHEJ1","DCLRE1C","POLB","POLD1","POLE","PCNA","RPA1","RPA2","RPA3","RFC1","RFC2","RFC3","RFC4","RFC5","FEN1","WRN","BLM","RECQL","RECQL4","RECQL5","TOP1","TOP2A","TOP2B","TOP3A","TOP3B","TOPBP1"],"Protein Folding Stress":["HSPA1A","DNAJB1","CALR","PDIA3","XBP1","ATF4","HSPA5","HSPB1","CCT2","HSPA1B","DNAJB2","CANX","PDIA4","XBP1S","ATF6","HSPA8","HSPB2","CCT3","HSPA2","HSPA4","HSPA6","HSPA9","HSPA12A","HSPA12B","HSPA13","HSPA14","HSPB3","HSPB4","HSPB5","HSPB6","HSPB7","HSPB8","HSPB9","HSPB10","HSPB11","CCT1","CCT4","CCT5","CCT6A","CCT6B","CCT7","CCT8","DNAJA1","DNAJA2","DNAJA3","DNAJA4","DNAJB3","DNAJB4","DNAJB5","DNAJB6","DNAJB7","DNAJB8","DNAJB9","DNAJB11","DNAJB12","DNAJB13","DNAJB14"],"Circadian Clock":["CLOCK","BMAL1","PER1","PER2","PER3","CRY1","CRY2","REV-ERBA","ROR","NPAS2","ARNTL","CSNK1E","CSNK1D","FBXL3","FBXL21","CK1","GSK3B","SIRT1","TIMELESS","PERIOD","CYCLE","VRILLE","CLOCKWORK","DOUBLETIME","SHAGGY","JETLAG","TIMEOUT","SUPERNUMERARY","BRIDE","SLEEPLESS","WIDE","AWAKE","LARK","SLOWPOKE","HYPERKINETIC","PARALYTIC","CACOPHONY","KAI1","KAI2","KAI3","KAIA","KAIB","KAIC","CCA1","LHY","TOC1","PRR9","PRR7","PRR5","PRR3","ELF4","ELF3","LUX","PCL1","RVE8","RVE4"],"Sleep-Wake Cycle":["HCRT","MCH","GABA","ACHE","COMT","MAOA","HTR1A","HTR2A","DRD2","ADRA1A","CHRNA4","GABRA1","GABRB2","GABRG2","SLC6A4","SLC6A3","SLC6A2","TPH2","PENK","POMC","NPY","AGRP","CART","LEPR","GHSR","MC4R","AVPR1A","OXTR","CRHR1","CRHR2","UCN","CRH","AVP","OXT","VIP","PHI","PACAP","ADCYAP1R1","ADORA1","ADORA2A","ADORA2B","ADORA3","ENT1","ENT2","ADA","PDE4A","PDE4B","PDE4D","CREB1","ATF1","MAPK1","MAPK3","CAMK2A","CAMK2B","CAMK4","PRKACA","PRKAR1A"],"Melatonin Signaling":["MTNR1A","MTNR1B","AANAT","ASMT","TPH1","DDC","INMT","CYP1A2","CYP1A1","UGT1A6","SULT1A1","COMT2","MAO","ALDH","ADH","GNAS","GNAI","ADCY","PRKA","PLCB1","PLCB2","PLCB3","PLCB4","IP3R1","IP3R2","IP3R3","RYR1","RYR2","RYR3","CACNA1C","CACNA1D","CACNA1S","KCNJ3","KCNJ5","KCNJ9","KCNJ10","GIRK1","GIRK2","PINEAL","SCN","PVN","DMH","VMH","ARC","SON","PVT","IGL","vLGN","dLGN","SPZ","VLPO","TMN","LC","DR","MR","LDT","PPT"],"Light-Dark Response":["OPN4","RHO","OPN1SW","OPN1MW","OPN1LW","GNAT1","GNAT2","GNGT1","GNGT2","PDE6A","PDE6B","PDE6G","GRK1","ARR1","RCVRN","RGS9","R9AP","CNGB1","CNGA1","SLC24A1","SLC24A2","KCNV2","HCN1","HCN4","CABP4","CACNA1F","CACNA2D4","TRPM1","GRM6","GNAO1","GNB3","GNG13","LRIT3","ELFN1","GPR179","NYCTALOPIN","PIKACB","PRKCA","CREB1","ATF1","FOSB","JUNB","EGR1","EGR3","ARC","HOMER1","NPAS4","NR4A1","NR4A2","NR4A3","PER1","PER2","CRY1","CRY2","CLOCK","BMAL1","CIART"],"Renin-Angiotensin System":["REN","AGT","ACE","ACE2","AGTR1","AGTR2","ENPEP","MME","CTSG","CMA1","ANPEP","THOP1","PREP","DPP3","LNPEP","RNPEP","CTSA","CTSB","CTSD","CTSL","CYP11B2","NR3C2","SCNN1A","SCNN1B","SCNN1G","ATP1A1","ATP1B1","SLC12A3","SLC12A1","KCNJ1","CLCNKB","CLCNKA","BSND","ROMK","NKCC2","NCCT","ENaC","CFTR","AQP2","AVPR2","AVPR1A","AVPR1B","AVP","OXT","OXTR","ADH","GNAS","GNAQ","GNA11","PLCB1","IP3R1","CACNA1C","CAMK2A","PRKCA","MAPK1","MAPK3","AKT1","PIK3CA"],"Vascular Tone":["NOS3","NOS2","NOS1","ARG1","ARG2","DDAH1","DDAH2","ADMA","PRMT1","PRMT5","EDN1","EDN2","EDN3","EDNRA","EDNRB","ECE1","ECE2","GUCY1A1","GUCY1B1","PDE5A","PDE1A","PDE1C","PDE2A","PDE3A","PDE3B","ADCY1","ADCY2","ADCY3","ADCY5","ADCY6","GNAS","GNAI1","GNAI2","GNAQ","GNA11","GNA12","GNA13","RHOA","ROCK1","ROCK2","MYL9","MYLK","MYLK2","MYLK3","MYLK4","PPP1CB","PPP1CC","MYPT1","CPI17","ACTA2","MYH11","CNN1","TAGLN","CALR","CALM1","CALM2","CALM3","S100A4"],"Sodium Balance":["SLC12A1","SLC12A3","SCNN1A","SCNN1B","SCNN1G","KCNJ1","CLCNKB","CLCNKA","ATP1A1","ATP1B1","ATP1B3","SLC9A3","SLC9A1","SLC4A4","SLC4A5","CA2","CA4","CA12","WNK1","WNK2","WNK3","WNK4","STK39","OXSR1","SPAK","NEDD4L","SGK1","KLHL3","CUL3","UBQLN2","USP2","STUB1","CHIP","HSP70","HSP90","FKBP5","DNAJB1","NR3C2","NR3C1","HSD11B2","HSD11B1","CYP11B2","CYP11B1","STAR","CYP11A1","HSD3B2","CYP21A2","CYP17A1","FDXR","FDX1","POR","SULT2A1","UGT2B7","UGT2B15","UGT2B17","COMT"],"Baroreceptor Response":["ADRB1","ADRB2","ADRB3","ADRA1A","ADRA1B","ADRA1D","ADRA2A","ADRA2B","ADRA2C","GRK2","GRK5","ARRB1","ARRB2","GNAS","GNAI1","GNAI2","GNAQ","GNA11","ADCY1","ADCY2","ADCY5","ADCY6","PDE3A","PDE3B","PDE4A","PDE4B","PDE4D","PRKACA","PRKACB","PRKAR1A","PRKAR2A","AKAP1","AKAP5","AKAP6","AKAP7","AKAP9","AKAP10","PLCB1","PLCB2","PLCB3","IP3R1","IP3R2","RYR2","CACNA1C","CACNA1D","CACNA1S","CACNB1","CACNB2","KCNJ3","KCNJ5","KCNH2","KCNQ1","SCN5A","CAMK2A","CAMK2D","PRKCA"],"Cardiac Conduction":["SCN5A","SCN1B","SCN2B","SCN3B","SCN4B","KCNQ1","KCNE1","KCNH2","KCNE2","KCNJ2","KCNJ12","KCNA5","KCND3","CACNA1C","CACNB2","CACNA2D1","RYR2","CASQ2","HCN1","HCN2","HCN3","HCN4","KCNF1","KCNG2","KCNG3","KCNH1","KCNH6","KCNH7","KCNIP2","KCNAB1","KCNAB2","KCNMB1","KCNMB2","KCNN1","KCNN2","KCNN3","KCNN4","GJA1","GJA5","GJC1","NPPA","NPPB","NPR1","NPR2","NPR3","GUCY1A2","GUCY1B2","PDE2A","PDE5A","PRKG1","PRKG2","VASP","IRAG","IP3K","MRVI1","FXYD1"],"Autonomic Control":["CHAT","ACHE","CHRM1","CHRM2","CHRM3","CHRNA1","CHRNA3","CHRNA4","CHRNA7","CHRNB2","CHRNB4","TH","DBH","PNMT","COMT","MAOA","MAOB","SLC6A2","SLC6A3","ADRB1","ADRB2","ADRB3","ADRA1A","ADRA1B","ADRA2A","ADRA2B","ADRA2C","DRD1","DRD2","DRD3","DRD4","DRD5","HTR1A","HTR1B","HTR2A","HTR2C","HTR3A","HTR4","GABA","GABRA1","GABRA2","GABRB1","GABRB2","GABRG2","SLC6A1","GAD1","GAD2","VGAT","VGLUT1","VGLUT2","SLC17A6","SLC17A7","GLS","GLUL","SLC1A2","SLC1A3","EAAT1"],"Calcium Handling":["RYR2","CASQ2","TRDN","JUNC","SRL","FKBP12","FKBP12.6","CAMK2A","CAMK2D","PP1","PP2A","PLN","SERCA2","ATP2A2","SLN","DWORF","NCX1","SLC8A1","PMCA1","ATP2B1","ATP2B2","ATP2B3","ATP2B4","CACNA1C","CACNA1D","CACNA1S","CACNB1","CACNB2","CACNA2D1","CACNA2D2","CALM1","CALM2","CALM3","CALR","S100A1","TNNT2","TNNI3","TNNC1","TPM1","MYL2","MYL3","ACTC1","MYH6","MYH7","MYBPC3","ACTN2","TTN","TCAP","LDB3","MYOZ2","CSRP3","ANKRD1","XIRP1","XIRP2","OBSCN","NEBL"],"Beta-Adrenergic Signaling":["ADRB1","ADRB2","ADRB3","GNAS","GNAI1","ADCY1","ADCY2","ADCY5","ADCY6","PRKACA","PRKACB","PRKAR1A","PRKAR2A","PDE3A","PDE3B","PDE4A","PDE4B","PDE4D","AKAP1","AKAP5","AKAP6","AKAP7","AKAP9","AKAP10","AKAP12","AKAP13","GRK2","GRK5","ARRB1","ARRB2","CREB1","ATF1","CAMK2A","CAMK2D","PLN","RYR2","CACNA1C","TNNI3","MYL2","MYBPC3","TPM1","ACTC1","MYH6","MYH7","SERCA2","NCX1","PMCA1","CASQ2","CALM1","CALM2","CALM3","S100A1","FKBP12","PP1","PP2A","YWHAZ","YWHAB"],Thermogenesis:["UCP1","UCP2","UCP3","PPARA","PPARG","PPARGC1A","PPARGC1B","PRDM16","CIDEA","CIDEC","DIO2","ADRB3","ADCY3","PRKACA","CREB1","ATF2","CEBPB","CEBPA","KLF15","FABP4","FABP5","CD36","CPT1B","CPT2","ACADM","ACADL","HADHA","HADHB","ACOX1","EHHADH","SCD1","ELOVL3","DGAT1","DGAT2","PLIN1","PLIN5","ATGL","HSL","MAGL","THRB","THRA","THRSP","SPOT14","ME1","G6PD","ACLY","FASN","ACC1","ACC2","GPAM","AGPAT2","LPIN1","DGAT1","DGAT2","MOGAT1","MOGAT2","MGAT1","MGAT2"],"Heat Shock Response":["HSF1","HSF2","HSF4","HSPA1A","HSPA1B","HSPA1L","HSPA2","HSPA4","HSPA5","HSPA6","HSPA8","HSPA9","HSPA12A","HSPA13","HSPA14","HSPB1","HSPB2","HSPB3","HSPB4","HSPB5","HSPB6","HSPB7","HSPB8","HSPB9","HSPB10","HSPB11","HSPC1","HSPC2","HSPC3","HSPC4","HSPC5","DNAJA1","DNAJA2","DNAJA3","DNAJA4","DNAJB1","DNAJB2","DNAJB3","DNAJB4","DNAJB5","DNAJB6","DNAJB7","DNAJB8","DNAJB9","DNAJB11","DNAJB12","DNAJB13","DNAJB14","CCT1","CCT2","CCT3","CCT4","CCT5","CCT6A","CCT6B","CCT7","CCT8"],"Hypothalamic Control":["TRH","TRHR","TSH","TSHR","CRH","CRHR1","CRHR2","ACTH","MC2R","GnRH","GNRHR","LH","FSH","LHCGR","FSHR","GH","GHR","IGF1","IGF1R","PRL","PRLR","OXT","OXTR","AVP","AVPR1A","AVPR1B","AVPR2","POMC","AGRP","NPY","CART","MCH","HCRT","LEPR","GHSR","MC3R","MC4R","Y1R","Y2R","Y5R","MCHR1","HCRTR1","HCRTR2","GNAS","GNAQ","GNA11","GNAI1","GNAI2","ADCY1","ADCY2","ADCY5","ADCY6","PLCB1","PLCB2","PLCB3","IP3R1","IP3R2","IP3R3","CACNA1C","CACNA1D","KCNJ3","KCNJ5"],"Brown Fat Activation":["UCP1","PPARGC1A","PRDM16","CEBPB","PPARG","CIDEA","DIO2","ADRB3","TBX1","IRF4","MRTFA","MRTFB","EBF2","ZIC1","LHX8","SHOX2","EN1","MSX1","TBX15","HOXC9","HOXC8","HOXC10","EVX1","ZFP423","EBF1","EBF3","FOXC2","KLF11","KLF15","ZFPM2","TWIST1","TWIST2","TCF21","WT1","TBX18","OSR1","OSR2","PAX3","PAX7","MYF5","MYOD1","MYOG","MRF4","MEF2A","MEF2C","MEF2D","SIX1","SIX4","EYA1","EYA2","DACH1","DACH2","PITX2","PITX3","LBX1","MSX2","DLX5","DLX6","BARX1"]}[e]||[];let a="";if(i.length>n&&i[n])a=i[n];else{const r=e.split(" ").map(e=>e.charAt(0)).join(""),i=t===Ai.mRNA?"G":t===Ai.PROTEIN?"P":t===Ai.METABOLITE?"M":"L";a="".concat(r).concat(i).concat(n+1)}const o=r.replace(/\s+/g,"").replace("min","m").replace("hours","h");return"".concat(a,"_").concat(o)},Mi=()=>{const e=Si(),t=(e=>{const t=[],n={},r={},i={},a={[Ai.mRNA]:[],[Ai.PROTEIN]:[],[Ai.METABOLITE]:[],[Ai.LIPID]:[]};return e.forEach(e=>{n[e.pathway]||(n[e.pathway]=[]),n[e.pathway].push(e);const t=e.timepoint||"10 min";r[t]||(r[t]=[]),r[t].push(e),(Array.isArray(e.broadCategory)?e.broadCategory:[e.broadCategory||"Energy Metabolism"]).forEach(t=>{i[t]||(i[t]=[]),i[t].push(e)}),a[e.type].push(e)}),Object.entries(n).forEach(e=>{let[n,r]=e;console.log("Creating dense network for pathway: ".concat(n," with ").concat(r.length," nodes"));const i={};r.forEach(e=>{const t=e.timepoint||"10 min";i[t]||(i[t]=[]),i[t].push(e)}),Object.values(i).forEach(e=>{e.forEach(n=>{const r=Math.min(2+Math.floor(3*Math.random()),e.length-1),i=e.filter(e=>e.id!==n.id);i.sort(()=>Math.random()-.5).slice(0,r).forEach(e=>{if(!t.some(t=>t.source===n.id&&t.target===e.id||t.source===e.id&&t.target===n.id)){const r=.6+.3*Math.random();t.push({source:n.id,target:e.id,strength:r,baselineStrength:r,type:"regulation"})}})})}),_i.forEach((e,n)=>{if(n<_i.length-1){const r=i[e]||[],a=_i[n+1],o=i[a]||[];r.forEach(e=>{const n=1+Math.floor(3*Math.random());for(let r=0;r<n&&r<o.length;r++){const n=o[Math.floor(Math.random()*o.length)];if(!t.some(t=>t.source===e.id&&t.target===n.id||t.source===n.id&&t.target===e.id)){const r=.5+.4*Math.random();t.push({source:e.id,target:n.id,strength:r,baselineStrength:r,type:"regulation"})}}})}}),_i.forEach((e,n)=>{if(n>0){const r=i[e]||[],a=_i[n-1],o=i[a]||[];r.forEach(e=>{if(Math.random()>.7&&o.length>0){const n=o[Math.floor(Math.random()*o.length)];if(!t.some(t=>t.source===e.id&&t.target===n.id||t.source===n.id&&t.target===e.id)){const r=.3+.3*Math.random();t.push({source:e.id,target:n.id,strength:r,baselineStrength:r,type:"regulation"})}}})}})}),Object.entries(i).forEach(e=>{let[n,r]=e;const i={};r.forEach(e=>{i[e.pathway]||(i[e.pathway]=[]),i[e.pathway].push(e)});const a=Object.keys(i);a.forEach(e=>{a.forEach(n=>{if(e!==n){const r=i[e],a=i[n];r.forEach(e=>{if(Math.random()>.6){const n=a[Math.floor(Math.random()*a.length)],r=a.filter(t=>t.timepoint===e.timepoint),i=r.length>0?r[Math.floor(Math.random()*r.length)]:n;if(!t.some(t=>t.source===e.id&&t.target===i.id||t.source===i.id&&t.target===e.id)){const n=.3+.3*Math.random();t.push({source:e.id,target:i.id,strength:n,baselineStrength:n,type:"interaction"})}}})}})})}),Object.keys(i).forEach(e=>{Object.keys(i).forEach(n=>{if(e!==n){const r=i[e],a=i[n];r.forEach(e=>{if(Math.random()>.8){const n=a[Math.floor(Math.random()*a.length)];if(!t.some(t=>t.source===e.id&&t.target===n.id||t.source===n.id&&t.target===e.id)){const r=.2+.3*Math.random();t.push({source:e.id,target:n.id,strength:r,baselineStrength:r,type:"interaction"})}}})}})}),a[Ai.mRNA].forEach(e=>{const n=a[Ai.PROTEIN].filter(t=>t.pathway===e.pathway),r=Math.min(1+Math.floor(2*Math.random()),n.length);n.sort(()=>Math.random()-.5).slice(0,r).forEach(n=>{if(!t.some(t=>t.source===e.id&&t.target===n.id||t.source===n.id&&t.target===e.id)){const r=.7+.2*Math.random();t.push({source:e.id,target:n.id,strength:r,baselineStrength:r,type:"regulation"})}})}),a[Ai.PROTEIN].forEach(e=>{const n=a[Ai.METABOLITE].filter(t=>t.pathway===e.pathway),r=Math.min(1+Math.floor(3*Math.random()),n.length);n.sort(()=>Math.random()-.5).slice(0,r).forEach(n=>{if(!t.some(t=>t.source===e.id&&t.target===n.id||t.source===n.id&&t.target===e.id)){const r=.6+.3*Math.random();t.push({source:e.id,target:n.id,strength:r,baselineStrength:r,type:"conversion"})}})}),a[Ai.METABOLITE].forEach(e=>{if(e.pathway.toLowerCase().includes("lipid")||e.pathway.toLowerCase().includes("metabolism")){const n=a[Ai.LIPID].filter(t=>t.pathway===e.pathway),r=Math.min(1+Math.floor(2*Math.random()),n.length);n.sort(()=>Math.random()-.5).slice(0,r).forEach(n=>{if(!t.some(t=>t.source===e.id&&t.target===n.id||t.source===n.id&&t.target===e.id)){const r=.5+.3*Math.random();t.push({source:e.id,target:n.id,strength:r,baselineStrength:r,type:"conversion"})}})}}),console.log("Generated ".concat(t.length," total links with complex causal chains")),t})(e),n=e.filter(e=>e&&e.id&&e.name&&e.type&&e.pathway&&e.broadCategory&&"number"===typeof e.expression&&"number"===typeof e.baselineExpression),r=new Set(n.map(e=>e.id)),i=t.filter(e=>e&&e.source&&e.target&&"number"===typeof e.strength&&r.has("string"===typeof e.source?e.source:e.source.id)&&r.has("string"===typeof e.target?e.target:e.target.id));return console.log("Generated ".concat(n.length," valid nodes and ").concat(i.length," valid links")),{nodes:n,links:i,pathways:xi,broadCategories:Object.keys(bi)}};var Bi=n(414);const Pi=t=>{var n,r,i,a,o;let{baselineData:u,individualDrugData:l,width:c,height:h,selectedPathway:d,selectedOmicsType:p,selectedDrug:f,visualizationMode:m,visibleNodeTypes:g,selectedDrugs:v,isDarkMode:D=!1}=t;const y=(0,e.useRef)(null),[E,A]=(0,e.useState)(null),[C,_]=(0,e.useState)(!1),[b,x]=(0,e.useState)({x:0,y:0}),F=(0,e.useRef)({x:0,y:0}),w=(0,e.useRef)(null),S=(0,e.useMemo)(()=>["#78A8D4","#364FA1","#B8A6DE","#FFC9CC","#E86659","#788F4F","#004F36","#002B32","#EDEFA0"],[]),T=((0,e.useMemo)(()=>({"Energy Metabolism":S[0],"Immune Response":S[4],"Oxidative Stress":S[2],"Circadian Rhythm":S[7],"Blood Pressure":S[5],"Heart Rate":S[3],"Temperature Regulation":S[8]}),[S]),(0,e.useMemo)(()=>({ketamine:"#FFBF00",etomidate:"#40E0D0",propofol:"#DE3163",novel1:"#6495ED",novel2:"#77B254"}),[])),M=(0,e.useMemo)(()=>({proteins:"#CCCCFF",metabolites:"#FF7F50","mRNA transcripts":"#9FE2BF",lipids:"#DFFF00"}),[]),B=(0,e.useCallback)(()=>u,[u]),P=(0,e.useCallback)(e=>{const t=.6+2*(e.confidence||.5),n=e.significance||.05,r=3*t*(n<.01?1.3:n<.05?1.1:1);return Math.max(3,Math.min(12,r))},[]),N=(0,e.useCallback)(e=>M[e.type]||S[0],[S,M]),R=(0,e.useCallback)(e=>.8,[]),L=(0,e.useCallback)(e=>({color:"var(--edge-color)",width:1}),[]),I=(0,e.useCallback)(e=>({filter:"drop-shadow(0 0 3px rgba(255, 255, 255, 0.3))",animation:"none"}),[]),k=(0,e.useCallback)(e=>{if(!l||!v||0===v.size)return[];const t=[];return v.forEach(n=>{const r=l[n];if(r){const i=r.nodes.find(t=>t.id===e.id);if(i&&i.foldChange&&1!==i.foldChange){const e=Fi.find(e=>e.id===n),r={drugId:n,drugName:(null===e||void 0===e?void 0:e.name)||n,color:T[n]||"#FFFFFF",foldChange:i.foldChange||1,isTarget:i.isPerturbationTarget||!1};t.push(r)}}}),t},[l,v,T]),O=(0,e.useCallback)(e=>{C&&x({x:e.clientX-F.current.x,y:e.clientY-F.current.y})},[C]),U=(0,e.useCallback)(()=>{_(!1)},[]),z=(0,e.useCallback)(e=>{e.stopPropagation(),_(!0),F.current={x:e.clientX-b.x,y:e.clientY-b.y}},[b]);(0,e.useEffect)(()=>{E&&x({x:0,y:0})},[E]),(0,e.useEffect)(()=>(document.addEventListener("mousemove",O),document.addEventListener("mouseup",U),()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",U)}),[O,U]);const V=(0,e.useCallback)(e=>{if(!l||!v||0===v.size)return[];const t=[];return v.forEach(n=>{const r=l[n];if(r){const i="string"===typeof e.source?e.source:e.source.id,a="string"===typeof e.target?e.target:e.target.id,o=r.links.find(e=>{const t="string"===typeof e.source?e.source:e.source.id,n="string"===typeof e.target?e.target:e.target.id;return t===i&&n===a||t===a&&n===i});o&&o.strengthChange&&Math.abs(o.strengthChange-1)>.2&&t.push({drugId:n,color:T[n]||"#FFFFFF",strengthChange:o.strengthChange})}}),t},[l,v,T]),G=(0,e.useCallback)(()=>{const e=B();let t=e.nodes,n=e.links;return d&&(t=t.filter(e=>e.pathway===d),n=n.filter(t=>{const n=e.nodes.find(e=>e.id===("string"===typeof t.source?t.source:t.source.id)),r=e.nodes.find(e=>e.id===("string"===typeof t.target?t.target:t.target.id));return(null===n||void 0===n?void 0:n.pathway)===d&&(null===r||void 0===r?void 0:r.pathway)===d})),p&&(t=t.filter(e=>e.type===p),n=n.filter(e=>{const n=t.find(t=>t.id===("string"===typeof e.source?e.source:e.source.id)),r=t.find(t=>t.id===("string"===typeof e.target?e.target:e.target.id));return n&&r})),g&&g.size>0&&(t=t.filter(e=>g.has(e.type)),n=n.filter(e=>{const n=t.find(t=>t.id===("string"===typeof e.source?e.source:e.source.id)),r=t.find(t=>t.id===("string"===typeof e.target?e.target:e.target.id));return n&&r})),{nodes:t,links:n}},[B,d,p,g]);(0,e.useEffect)(()=>{if(!y.current)return;const e=Mr(y.current);e.selectAll("*").remove();const{nodes:t,links:n}=G();if(0===t.length)return;const r=n.map(e=>s({},e)),i=t.map(e=>s({},e)),a={"10 min":{x:.08,y:.2},"30 min":{x:.08,y:.4},"90 min":{x:.08,y:.6},"48 hours":{x:.08,y:.8}},o={"Energy Metabolism":{x:.18,y:.05},"Immune Response":{x:.3,y:.05},"Oxidative Stress":{x:.42,y:.05},"Circadian Rhythm":{x:.54,y:.05},"Blood Pressure":{x:.66,y:.05},"Heart Rate":{x:.78,y:.05},"Temperature Regulation":{x:.9,y:.05}};i.forEach((e,t)=>{var n,r;const i=e.timepoint||"10 min",s=Array.isArray(e.broadCategory)?e.broadCategory[0]:e.broadCategory||"Energy Metabolism",u=(null===(n=a[i])||void 0===n?void 0:n.y)*h||.5*h,l=(null===(r=o[s])||void 0===r?void 0:r.x)*c||.5*c,d=.32*(Math.random()-.5)*c,p=.25*(Math.random()-.5)*h,f=Math.random()*Math.PI*2,m=.08*Math.random()*Math.min(c,h),g=Math.cos(f)*m,v=Math.sin(f)*m;e.x=l+d+g,e.y=u+p+v,e.x=Math.max(120,Math.min(c-120,e.x)),e.y=Math.max(80,Math.min(h-80,e.y)),e.fx=e.x,e.fy=e.y}),e.on("click",()=>{A(null)});const u=e.append("g"),l=D?"#ffffff":"#002B32",d=(u.selectAll(".time-label").data(["10 min","30 min","90 min","48 hours"]).enter().append("text").attr("class","pathway-label time-label").attr("x",30).attr("y",(e,t)=>h*(.2+.2*t)).attr("text-anchor","start").attr("dominant-baseline","middle").style("font-size","18px").style("font-weight","bold").style("fill",l+" !important").text(e=>e),Object.keys(o));u.selectAll(".category-label").data(d).enter().append("text").attr("class","pathway-label category-label").attr("x",e=>o[e].x*c-140).attr("y",30).attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size","16px").style("font-weight","bold").style("fill",l+" !important").text(e=>e),u.append("g").selectAll("path").data(r).enter().append("path").attr("class","pathway-link").attr("stroke","var(--edge-color)").attr("stroke-width",e=>Math.max(1,2*e.strength)).attr("fill","none").attr("opacity",.6).attr("d",function(e){const t=i.find(t=>t.id===("string"===typeof e.source?e.source:e.source.id)),n=i.find(t=>t.id===("string"===typeof e.target?e.target:e.target.id));if(!t||!n)return"";const r=t.x||0,a=t.y||0,o=n.x||0,s=n.y||0,u=o-r,l=s-a,c=1.5*Math.sqrt(u*u+l*l);return"M".concat(r,",").concat(a,"A").concat(c,",").concat(c," 0 0,1 ").concat(o,",").concat(s)});m===Ci.PERTURBED&&v&&v.size>0&&r.forEach(e=>{const t=V(e);t.forEach((n,r)=>{const a=i.find(t=>t.id===("string"===typeof e.source?e.source:e.source.id)),o=i.find(t=>t.id===("string"===typeof e.target?e.target:e.target.id));if(!a||!o)return;const s=a.x||0,l=a.y||0,c=o.x||0,h=o.y||0,d=c-s,p=h-l,f=1.5*Math.sqrt(d*d+p*p)+1.5*(r-t.length/2);u.append("path").attr("class","drug-link-effect drug-".concat(n.drugId)).attr("stroke",n.color).attr("stroke-width",n.strengthChange>1.2?2.5:n.strengthChange<.8?2:1.5).attr("fill","none").attr("opacity",.7).attr("d","M".concat(s,",").concat(l,"A").concat(f,",").concat(f," 0 0,1 ").concat(c,",").concat(h)).style("filter","drop-shadow(0 0 3px ".concat(n.color,")"))})});u.append("g").selectAll("circle").data(i).enter().append("circle").attr("class","pathway-node").attr("r",e=>P(e)).attr("cx",e=>e.x||0).attr("cy",e=>e.y||0).style("fill",e=>N(e)).style("stroke","var(--edge-color)").style("stroke-width",1).style("opacity",.8).style("cursor","pointer").on("click",(e,t)=>{e.stopPropagation(),E===t.id?A(null):A(t.id)});return m===Ci.PERTURBED&&v&&v.size>0&&i.forEach((e,t)=>{k(e).forEach((t,n)=>{const r=P(e)+3+2*n;u.append("circle").attr("class","drug-node-effect drug-".concat(t.drugId)).attr("cx",e.x||0).attr("cy",e.y||0).attr("r",r).style("fill","none").style("stroke",t.color).style("stroke-width",3).style("opacity",.9).style("filter","drop-shadow(0 0 6px ".concat(t.color,")")).style("pointer-events","none");const i=t.foldChange>1.5?"\u25b2":t.foldChange<.5?"\u25bc":"\u25cf",a=r+8,o=72*n*Math.PI/180;u.append("text").attr("class","drug-symbol drug-".concat(t.drugId)).attr("x",(e.x||0)+a*Math.cos(o)).attr("y",(e.y||0)+a*Math.sin(o)).attr("text-anchor","middle").attr("dominant-baseline","middle").style("fill",t.color).style("font-size","12px").style("font-weight","bold").style("text-shadow","1px 1px 3px rgba(0,0,0,1)").style("pointer-events","none").text(i)})}),()=>{}},[u,l,d,p,f,m,c,h,D,G,P,N,R,L,I,k]),(0,e.useEffect)(()=>{if(!y.current)return;const e=Mr(y.current),t=e.selectAll(".pathway-node"),n=e.selectAll(".pathway-link");if(t.empty()||n.empty())return;const r=D?"#ffffff":"#002B32",i=e.selectAll(".time-label"),a=e.selectAll(".category-label");if(i.style("fill",r+" !important"),a.style("fill",r+" !important"),E){const{nodes:e,links:r}=G(),i=e.find(e=>e.id===E);if(!i)return;const o=e.filter(e=>e.pathway===i.pathway),s=new Set(o.map(e=>e.id));t.style("fill",e=>E===e.id?"#FFFBE6":s.has(e.id)?N(e):"#FFFBE6").style("opacity",e=>E===e.id?1:s.has(e.id)?R(e):.2),n.attr("stroke",e=>{const t="string"===typeof e.source?e.source:e.source.id,n="string"===typeof e.target?e.target:e.target.id;if(s.has(t)&&s.has(n)){if(m===Ci.PERTURBED&&e.strengthChange&&1!==e.strengthChange){if(e.strengthChange>1.5)return"#00FF00";if(e.strengthChange<.5)return"#FF0000"}return"#888888"}return"var(--edge-color)"}).attr("stroke-width",e=>{const t="string"===typeof e.source?e.source:e.source.id,n="string"===typeof e.target?e.target:e.target.id;if(s.has(t)&&s.has(n)){let t=Math.max(2,3*e.strength);return m===Ci.PERTURBED&&e.strengthChange&&1!==e.strengthChange&&(t*=Math.abs(e.strengthChange-1)+1),Math.min(t,8)}return Math.max(1,1.5*e.strength)}).attr("opacity",e=>{const t="string"===typeof e.source?e.source:e.source.id,n="string"===typeof e.target?e.target:e.target.id;return s.has(t)&&s.has(n)?m===Ci.PERTURBED&&e.strengthChange&&1!==e.strengthChange?.9:.7:.1});const u=new Set;o.forEach(e=>{e.broadCategory&&(Array.isArray(e.broadCategory)?e.broadCategory.forEach(e=>u.add(e)):u.add(e.broadCategory))}),a.style("opacity",e=>u.has(e)?1:.3)}else t.style("fill",e=>N(e)).style("opacity",e=>R(e)),n.attr("stroke",e=>{if(m===Ci.PERTURBED&&e.strengthChange&&1!==e.strengthChange){if(e.strengthChange>1.5)return"#00FF00";if(e.strengthChange<.5)return"#FF0000"}return"var(--edge-color)"}).attr("stroke-width",e=>{let t=Math.max(1,2*e.strength);return m===Ci.PERTURBED&&e.strengthChange&&1!==e.strengthChange&&(t*=Math.abs(e.strengthChange-1)+1),Math.min(t,8)}).attr("opacity",e=>m===Ci.PERTURBED&&e.strengthChange&&1!==e.strengthChange?.9:.6),a.style("opacity",1)},[E,u,l,m,D,G,N,R,L,I,k]);const H=E?B().nodes.find(e=>e.id===E):null,j=E&&m===Ci.COMPARISON?u.nodes.find(e=>e.id===E):null;return(0,Bi.jsxs)("div",{className:"pathway-visualization",children:[(0,Bi.jsx)("svg",{ref:y,width:c,height:h,className:"pathway-svg",style:{cursor:"default",width:"".concat(c,"px"),height:"".concat(h,"px")}}),m===Ci.PERTURBED&&v&&v.size>0&&(0,Bi.jsxs)("div",{style:{position:"absolute",top:"20px",left:"20px"},children:[(0,Bi.jsxs)("div",{className:"mode-indicator",style:{marginBottom:"12px"},children:["Individual Drug Effects: ",Array.from(v).length," drugs active"]}),(0,Bi.jsxs)("div",{style:{background:D?"rgba(0, 0, 0, 0.95)":"rgba(232, 227, 207, 0.95)",color:D?"#ffffff":"#002B32",padding:"16px",borderRadius:"12px",border:D?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(0, 43, 50, 0.3)",fontSize:"13px",maxWidth:"320px",marginBottom:"12px"},children:[(0,Bi.jsx)("div",{style:{color:D?"#FFD700":"#364FA1",fontWeight:"bold",marginBottom:"12px",fontSize:"14px"},children:"Drug-Specific Colors:"}),Array.from(v).map(e=>{const t=Fi.find(t=>t.id===e),n=T[e];return(0,Bi.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px",padding:"6px",background:D?"rgba(255,255,255,0.05)":"rgba(0,43,50,0.05)",borderRadius:"6px"},children:[(0,Bi.jsx)("div",{style:{width:"20px",height:"20px",borderRadius:"50%",border:"3px solid ".concat(n),marginRight:"10px",background:"transparent",boxShadow:"0 0 8px ".concat(n)}}),(0,Bi.jsxs)("div",{children:[(0,Bi.jsx)("div",{style:{color:D?"white":"#002B32",fontWeight:"bold",fontSize:"12px"},children:(null===t||void 0===t?void 0:t.name)||e}),(0,Bi.jsx)("div",{style:{color:D?"rgba(255,255,255,0.7)":"rgba(0,43,50,0.7)",fontSize:"10px"},children:(null===t||void 0===t?void 0:t.mechanism)||"Unknown mechanism"})]})]},e)}),(0,Bi.jsxs)("div",{style:{marginTop:"12px",padding:"8px",background:D?"rgba(255, 215, 0, 0.1)":"rgba(54, 79, 161, 0.1)",borderRadius:"6px"},children:[(0,Bi.jsx)("div",{style:{color:D?"#FFD700":"#364FA1",fontWeight:"bold",fontSize:"12px",marginBottom:"4px"},children:"How to Read:"}),(0,Bi.jsxs)("div",{style:{fontSize:"11px",color:D?"rgba(255,255,255,0.9)":"rgba(0,43,50,0.9)"},children:["\u2022 ",(0,Bi.jsx)("strong",{children:"Control network"})," = Always same base colors",(0,Bi.jsx)("br",{}),"\u2022 ",(0,Bi.jsx)("strong",{children:"Colored rings"})," = Each drug's effects",(0,Bi.jsx)("br",{}),"\u2022 ",(0,Bi.jsx)("strong",{children:"Up/Down/Minimal effects"})," = Triangle up/down, circle",(0,Bi.jsx)("br",{}),"\u2022 ",(0,Bi.jsx)("strong",{children:"Multiple rings"})," = Multiple drug effects",(0,Bi.jsx)("br",{}),"\u2022 ",(0,Bi.jsx)("strong",{children:"Colored links"})," = Drug-affected interactions"]})]})]}),(0,Bi.jsxs)("div",{style:{background:D?"rgba(0, 0, 0, 0.95)":"rgba(232, 227, 207, 0.95)",color:D?"#ffffff":"#002B32",padding:"16px",borderRadius:"12px",border:D?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(0, 43, 50, 0.3)",fontSize:"12px",maxWidth:"280px"},children:[(0,Bi.jsx)("div",{style:{color:D?"#FFD700":"#364FA1",fontWeight:"bold",marginBottom:"12px",fontSize:"14px"},children:"Drug Impact Summary:"}),(()=>{const e=B().nodes.filter(e=>e.isPerturbationTarget),t={};return e.forEach(e=>{(Array.isArray(e.broadCategory)?e.broadCategory:[e.broadCategory||"Unknown"]).forEach(n=>{t[n]||(t[n]={up:0,down:0,minimal:0,total:0}),t[n].total++;const r=e.foldChange||1;r>1.5?t[n].up++:r<.5?t[n].down++:t[n].minimal++})}),Object.entries(t).filter(e=>{let[,t]=e;return t.total>0}).sort((e,t)=>{let[,n]=e,[,r]=t;return r.up+r.down-(n.up+n.down)}).slice(0,5).map(e=>{let[t,n]=e;return(0,Bi.jsxs)("div",{style:{marginBottom:"10px",padding:"8px",background:D?"rgba(255,255,255,0.05)":"rgba(0,43,50,0.05)",borderRadius:"6px",border:D?"1px solid rgba(255,255,255,0.1)":"1px solid rgba(0,43,50,0.1)"},children:[(0,Bi.jsx)("div",{style:{color:D?"white":"#002B32",fontWeight:"600",marginBottom:"6px"},children:t}),(0,Bi.jsxs)("div",{style:{display:"flex",gap:"8px",fontSize:"11px",flexWrap:"wrap"},children:[n.up>0&&(0,Bi.jsxs)("span",{style:{color:"#00FF00",fontWeight:"bold"},children:["Up ",n.up]}),n.down>0&&(0,Bi.jsxs)("span",{style:{color:"#FF0000",fontWeight:"bold"},children:["Down ",n.down]}),n.minimal>0&&(0,Bi.jsxs)("span",{style:{color:"#FFD700"},children:["Minimal ",n.minimal]}),(0,Bi.jsxs)("span",{style:{color:D?"rgba(255,255,255,0.6)":"rgba(0,43,50,0.6)",marginLeft:"auto"},children:[n.total," nodes"]})]})]},t)})})(),(0,Bi.jsx)("div",{style:{marginTop:"12px",fontSize:"10px",color:D?"rgba(255,255,255,0.7)":"rgba(0,43,50,0.7)",textAlign:"center"},children:"Up = Upregulated \u2022 Down = Downregulated \u2022 Minimal = Minimal Change"})]})]}),H&&(0,Bi.jsxs)("div",{className:"node-info",ref:w,style:{position:"absolute",top:"20px",right:"20px",zIndex:1e3,maxHeight:"80vh",overflowY:"auto",transform:"translate(".concat(b.x,"px, ").concat(b.y,"px)"),cursor:C?"grabbing":"default",background:D?"var(--bg-secondary)":"rgba(232, 227, 207, 0.95)",borderRadius:"12px",boxShadow:"0 8px 32px var(--bg-primary)",border:"1px solid var(--border-primary)"},onClick:e=>e.stopPropagation(),onMouseDown:z,children:[(0,Bi.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",zIndex:1},children:(0,Bi.jsx)("button",{className:"popup-close",onClick:()=>A(null),style:{background:"none",border:"none",color:D?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",fontSize:"18px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:e=>e.target.style.color=D?"#ffffff":"#000000",onMouseLeave:e=>e.target.style.color=D?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",onMouseDown:e=>e.stopPropagation(),children:"\xd7"})}),(0,Bi.jsxs)("div",{style:{padding:"16px"},children:[(0,Bi.jsx)("h3",{children:H.name}),(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Type:"})," ",H.type]}),(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Pathway:"})," ",H.pathway]}),(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Category:"})," ",Array.isArray(H.broadCategory)?H.broadCategory.join(", "):H.broadCategory]}),m===Ci.COMPARISON&&j?(0,Bi.jsxs)(Bi.Fragment,{children:[(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Baseline Expression:"})," ",null===(n=j.expression)||void 0===n?void 0:n.toFixed(2)]}),(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Perturbed Expression:"})," ",null===(r=H.expression)||void 0===r?void 0:r.toFixed(2)]}),(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Fold Change:"}),(0,Bi.jsxs)("span",{className:"fold-change ".concat((H.foldChange||1)>1.2?"upregulated":(H.foldChange||1)<.8?"downregulated":"unchanged"),children:[null===(i=H.foldChange)||void 0===i?void 0:i.toFixed(2),"x"]})]})]}):(0,Bi.jsxs)(Bi.Fragment,{children:[(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Expression:"})," ",null===(a=H.expression)||void 0===a?void 0:a.toFixed(2)]}),H.foldChange&&1!==H.foldChange&&(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Fold Change:"}),(0,Bi.jsxs)("span",{className:"fold-change ".concat(H.foldChange>1.2?"upregulated":H.foldChange<.8?"downregulated":"unchanged"),children:[H.foldChange.toFixed(2),"x"]})]})]}),(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Significance:"})," ",null===(o=H.significance)||void 0===o?void 0:o.toFixed(4)]}),(0,Bi.jsxs)("p",{children:[(0,Bi.jsx)("strong",{children:"Confidence:"})," ",(100*(H.confidence||.5)).toFixed(1),"%"]}),H.isPerturbationTarget&&(0,Bi.jsx)("p",{className:"perturbation-target",children:"\ud83c\udfaf Drug Target"})]})]})]})};function Ni(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ri(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(c){l=!0,i=c}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||Ii(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Li(e){return function(e){if(Array.isArray(e))return ki(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ii(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ii(e,t){if(e){if("string"===typeof e)return ki(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ki(e,t):void 0}}function ki(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ui(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||Vi(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zi(e){return function(e){if(Array.isArray(e))return Oi(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Vi(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vi(e,t){if(e){if("string"==typeof e)return Oi(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Oi(e,t):void 0}}function Gi(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.useEffect,r=(0,e.useRef)(),i=(0,e.useRef)(!1),a=(0,e.useRef)(!1),o=Ui((0,e.useState)(0),2);o[0];var s=o[1];i.current&&(a.current=!0),n(function(){return i.current||(r.current=t(),i.current=!0),s(function(e){return e+1}),function(){a.current&&r.current&&r.current()}},[])}const Hi="177",ji=0,Wi=1,qi=2,Xi=0,Ki=1,Yi=2,Ji=3,$i=0,Qi=1,Zi=2,ea=100,ta=101,na=102,ra=200,ia=201,aa=202,oa=203,sa=204,ua=205,la=206,ca=207,ha=208,da=209,pa=210,fa=211,ma=212,ga=213,va=214,Da=0,ya=1,Ea=2,Aa=3,Ca=4,_a=5,ba=6,xa=7,Fa=300,wa=301,Sa=302,Ta=303,Ma=304,Ba=306,Pa=1e3,Na=1001,Ra=1002,La=1003,Ia=1004,ka=1005,Oa=1006,Ua=1007,za=1008,Va=1009,Ga=1010,Ha=1011,ja=1012,Wa=1013,qa=1014,Xa=1015,Ka=1016,Ya=1017,Ja=1018,$a=1020,Qa=35902,Za=1021,eo=1022,to=1023,no=1026,ro=1027,io=1028,ao=1029,oo=1030,so=1031,uo=1033,lo=33776,co=33777,ho=33778,po=33779,fo=35840,mo=35841,go=35842,vo=35843,Do=36196,yo=37492,Eo=37496,Ao=37808,Co=37809,_o=37810,bo=37811,xo=37812,Fo=37813,wo=37814,So=37815,To=37816,Mo=37817,Bo=37818,Po=37819,No=37820,Ro=37821,Lo=36492,Io=36494,ko=36495,Oo=36283,Uo=36284,zo=36285,Vo=36286,Go=2300,Ho=2301,jo=2302,Wo=2400,qo=2401,Xo=2402,Ko="",Yo="srgb",Jo="srgb-linear",$o="linear",Qo="srgb",Zo=7680,es=512,ts=513,ns=514,rs=515,is=516,as=517,os=518,ss=519,us=35044,ls=35048,cs="300 es",hs=2e3,ds=2001;class ps{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const r=n[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,r=t.length;n<r;n++)t[n].call(this,e);e.target=null}}}const fs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ms=1234567;const gs=Math.PI/180,vs=180/Math.PI;function Ds(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(fs[255&e]+fs[e>>8&255]+fs[e>>16&255]+fs[e>>24&255]+"-"+fs[255&t]+fs[t>>8&255]+"-"+fs[t>>16&15|64]+fs[t>>24&255]+"-"+fs[63&n|128]+fs[n>>8&255]+"-"+fs[n>>16&255]+fs[n>>24&255]+fs[255&r]+fs[r>>8&255]+fs[r>>16&255]+fs[r>>24&255]).toLowerCase()}function ys(e,t,n){return Math.max(t,Math.min(n,e))}function Es(e,t){return(e%t+t)%t}function As(e,t,n){return(1-n)*e+n*t}function Cs(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function _s(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const bs={DEG2RAD:gs,RAD2DEG:vs,generateUUID:Ds,clamp:ys,euclideanModulo:Es,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:As,damp:function(e,t,n,r){return As(e,t,1-Math.exp(-n*r))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Es(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(ms=e);let t=ms+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*gs},radToDeg:function(e){return e*vs},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const a=Math.cos,o=Math.sin,s=a(n/2),u=o(n/2),l=a((t+r)/2),c=o((t+r)/2),h=a((t-r)/2),d=o((t-r)/2),p=a((r-t)/2),f=o((r-t)/2);switch(i){case"XYX":e.set(s*c,u*h,u*d,s*l);break;case"YZY":e.set(u*d,s*c,u*h,s*l);break;case"ZXZ":e.set(u*h,u*d,s*c,s*l);break;case"XZX":e.set(s*c,u*f,u*p,s*l);break;case"YXY":e.set(u*p,s*c,u*f,s*l);break;case"ZYZ":e.set(u*f,u*p,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:_s,denormalize:Cs};class xs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;xs.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=ys(this.x,e.x,t.x),this.y=ys(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=ys(this.x,e,t),this.y=ys(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ys(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ys(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Fs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,o){let s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3];const h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=l,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(c!==f||s!==h||u!==d||l!==p){let e=1-o;const t=s*h+u*d+l*p+c*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,o=Math.sin(o*a)/i}const i=o*n;if(s=s*e+h*i,u=u*e+d*i,l=l*e+p*i,c=c*e+f*i,e===1-o){const e=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=e,u*=e,l*=e,c*=e}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,r,i,a){const o=n[r],s=n[r+1],u=n[r+2],l=n[r+3],c=i[a],h=i[a+1],d=i[a+2],p=i[a+3];return e[t]=o*p+l*c+s*d-u*h,e[t+1]=s*p+l*h+u*c-o*d,e[t+2]=u*p+l*d+o*h-s*c,e[t+3]=l*p-o*c-s*h-u*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(r/2),c=o(i/2),h=s(n/2),d=s(r/2),p=s(i/2);switch(a){case"XYZ":this._x=h*l*c+u*d*p,this._y=u*d*c-h*l*p,this._z=u*l*p+h*d*c,this._w=u*l*c-h*d*p;break;case"YXZ":this._x=h*l*c+u*d*p,this._y=u*d*c-h*l*p,this._z=u*l*p-h*d*c,this._w=u*l*c+h*d*p;break;case"ZXY":this._x=h*l*c-u*d*p,this._y=u*d*c+h*l*p,this._z=u*l*p+h*d*c,this._w=u*l*c-h*d*p;break;case"ZYX":this._x=h*l*c-u*d*p,this._y=u*d*c+h*l*p,this._z=u*l*p-h*d*c,this._w=u*l*c+h*d*p;break;case"YZX":this._x=h*l*c+u*d*p,this._y=u*d*c+h*l*p,this._z=u*l*p-h*d*c,this._w=u*l*c-h*d*p;break;case"XZY":this._x=h*l*c-u*d*p,this._y=u*d*c-h*l*p,this._z=u*l*p+h*d*c,this._w=u*l*c+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],u=t[2],l=t[6],c=t[10],h=n+o+c;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(l-s)*e,this._y=(i-u)*e,this._z=(a-r)*e}else if(n>o&&n>c){const e=2*Math.sqrt(1+n-o-c);this._w=(l-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+u)/e}else if(o>c){const e=2*Math.sqrt(1+o-n-c);this._w=(i-u)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+l)/e}else{const e=2*Math.sqrt(1+c-n-o);this._w=(a-r)/e,this._x=(i+u)/e,this._y=(s+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ys(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+a*o+r*u-i*s,this._y=r*l+a*s+i*o-n*u,this._z=i*l+a*u+n*s-r*o,this._w=a*l-n*o-r*s-i*u,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}const u=Math.sqrt(s),l=Math.atan2(u,o),c=Math.sin((1-t)*l)/u,h=Math.sin(t*l)/u;return this._w=a*c+this._w*h,this._x=n*c+this._x*h,this._y=r*c+this._y*h,this._z=i*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ws{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;ws.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ts.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ts.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,u=2*(a*r-o*n),l=2*(o*t-i*r),c=2*(i*n-a*t);return this.x=t+s*u+a*c-o*l,this.y=n+s*l+o*u-i*c,this.z=r+s*c+i*l-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=ys(this.x,e.x,t.x),this.y=ys(this.y,e.y,t.y),this.z=ys(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=ys(this.x,e,t),this.y=ys(this.y,e,t),this.z=ys(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ys(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ss.copy(this).projectOnVector(e),this.sub(Ss)}reflect(e){return this.sub(Ss.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ys(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ss=new ws,Ts=new Fs;class Ms{constructor(e,t,n,r,i,a,o,s,u){Ms.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,u)}set(e,t,n,r,i,a,o,s,u){const l=this.elements;return l[0]=e,l[1]=r,l[2]=o,l[3]=t,l[4]=i,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],D=r[4],y=r[7],E=r[2],A=r[5],C=r[8];return i[0]=a*f+o*v+s*E,i[3]=a*m+o*D+s*A,i[6]=a*g+o*y+s*C,i[1]=u*f+l*v+c*E,i[4]=u*m+l*D+c*A,i[7]=u*g+l*y+c*C,i[2]=h*f+d*v+p*E,i[5]=h*m+d*D+p*A,i[8]=h*g+d*y+p*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*a*l-t*o*u-n*i*l+n*o*s+r*i*u-r*a*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=l*a-o*u,h=o*s-l*i,d=u*i-a*s,p=t*c+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(r*u-l*n)*f,e[2]=(o*n-r*a)*f,e[3]=h*f,e[4]=(l*t-r*s)*f,e[5]=(r*i-o*t)*f,e[6]=d*f,e[7]=(n*s-u*t)*f,e[8]=(a*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,o){const s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-r*u,r*s,-r*(-u*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Bs.makeScale(e,t)),this}rotate(e){return this.premultiply(Bs.makeRotation(-e)),this}translate(e,t){return this.premultiply(Bs.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Bs=new Ms;function Ps(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Ns(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Rs(){const e=Ns("canvas");return e.style.display="block",e}const Ls={};function Is(e){e in Ls||(Ls[e]=!0,console.warn(e))}const ks=(new Ms).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Os=(new Ms).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Us(){const e={enabled:!0,workingColorSpace:Jo,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===Qo&&(e.r=Vs(e.r),e.g=Vs(e.g),e.b=Vs(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Qo&&(e.r=Gs(e.r),e.g=Gs(e.g),e.b=Gs(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Ko?$o:this.spaces[e].transfer},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return Is("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return Is("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[Jo]:{primaries:t,whitePoint:r,transfer:$o,toXYZ:ks,fromXYZ:Os,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Yo},outputColorSpaceConfig:{drawingBufferColorSpace:Yo}},[Yo]:{primaries:t,whitePoint:r,transfer:Qo,toXYZ:ks,fromXYZ:Os,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Yo}}}),e}const zs=Us();function Vs(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Gs(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Hs;class js{static getDataURL(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Hs&&(Hs=Ns("canvas")),Hs.width=e.width,Hs.height=e.height;const n=Hs.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Hs}return t.toDataURL(n)}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=Ns("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*Vs(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Vs(t[e]/255)):t[e]=Vs(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Ws=0;class qs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Ws++}),this.uuid=Ds(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Xs(r[t].image)):e.push(Xs(r[t]))}else e=Xs(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Xs(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?js.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Ks=0;const Ys=new ws;class Js extends ps{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Js.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Js.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Na,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Na,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Oa,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:za,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:to,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Va,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Js.DEFAULT_ANISOTROPY,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Ko;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ks++}),this.uuid=Ds(),this.name="",this.source=new qs(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=s,this.offset=new xs(0,0),this.repeat=new xs(1,1),this.center=new xs(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ms,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ys).x}get height(){return this.source.getSize(Ys).y}get depth(){return this.source.getSize(Ys).z}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Texture.setValues(): parameter '".concat(t,"' has value of undefined."));continue}const r=this[t];void 0!==r?r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n:console.warn("THREE.Texture.setValues(): property '".concat(t,"' does not exist."))}}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Fa)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Pa:e.x=e.x-Math.floor(e.x);break;case Na:e.x=e.x<0?0:1;break;case Ra:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Pa:e.y=e.y-Math.floor(e.y);break;case Na:e.y=e.y<0?0:1;break;case Ra:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Js.DEFAULT_IMAGE=null,Js.DEFAULT_MAPPING=Fa,Js.DEFAULT_ANISOTROPY=1;class $s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;$s.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(l-h)<a&&Math.abs(c-f)<a&&Math.abs(p-m)<a){if(Math.abs(l+h)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(u+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(u+1)/2,s=(d+1)/2,v=(g+1)/2,D=(l+h)/4,y=(c+f)/4,E=(p+m)/4;return e>s&&e>v?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=D/n,i=y/n):s>v?s<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=D/r,i=E/r):v<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=y/i,r=E/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-l)*(h-l));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(h-l)/v,this.w=Math.acos((u+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=ys(this.x,e.x,t.x),this.y=ys(this.y,e.y,t.y),this.z=ys(this.z,e.z,t.z),this.w=ys(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=ys(this.x,e,t),this.y=ys(this.y,e,t),this.z=ys(this.z,e,t),this.w=ys(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ys(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Qs extends ps{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Oa,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new $s(0,0,e,t),this.scissorTest=!1,this.viewport=new $s(0,0,e,t);const r={width:e,height:t,depth:n.depth},i=new Js(r);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=i.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={minFilter:Oa,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(t)}}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new qs(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Zs extends Qs{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class eu extends Js{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=La,this.minFilter=La,this.wrapR=Na,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class tu extends Js{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=La,this.minFilter=La,this.wrapR=Na,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class nu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ws(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ws(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(iu.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(iu.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=iu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,iu):iu.fromBufferAttribute(r,t),iu.applyMatrix4(e.matrixWorld),this.expandByPoint(iu);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),au.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),au.copy(n.boundingBox)),au.applyMatrix4(e.matrixWorld),this.union(au)}const r=e.children;for(let i=0,a=r.length;i<a;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,iu),iu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(du),pu.subVectors(this.max,du),ou.subVectors(e.a,du),su.subVectors(e.b,du),uu.subVectors(e.c,du),lu.subVectors(su,ou),cu.subVectors(uu,su),hu.subVectors(ou,uu);let t=[0,-lu.z,lu.y,0,-cu.z,cu.y,0,-hu.z,hu.y,lu.z,0,-lu.x,cu.z,0,-cu.x,hu.z,0,-hu.x,-lu.y,lu.x,0,-cu.y,cu.x,0,-hu.y,hu.x,0];return!!gu(t,ou,su,uu,pu)&&(t=[1,0,0,0,1,0,0,0,1],!!gu(t,ou,su,uu,pu)&&(fu.crossVectors(lu,cu),t=[fu.x,fu.y,fu.z],gu(t,ou,su,uu,pu)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,iu).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(iu).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ru[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ru[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ru[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ru[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ru[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ru[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ru[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ru[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ru)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const ru=[new ws,new ws,new ws,new ws,new ws,new ws,new ws,new ws],iu=new ws,au=new nu,ou=new ws,su=new ws,uu=new ws,lu=new ws,cu=new ws,hu=new ws,du=new ws,pu=new ws,fu=new ws,mu=new ws;function gu(e,t,n,r,i){for(let a=0,o=e.length-3;a<=o;a+=3){mu.fromArray(e,a);const o=i.x*Math.abs(mu.x)+i.y*Math.abs(mu.y)+i.z*Math.abs(mu.z),s=t.dot(mu),u=n.dot(mu),l=r.dot(mu);if(Math.max(-Math.max(s,u,l),Math.min(s,u,l))>o)return!1}return!0}const vu=new nu,Du=new ws,yu=new ws;class Eu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ws,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):vu.setFromPoints(e).getCenter(n);let r=0;for(let i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Du.subVectors(e,this.center);const t=Du.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Du,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(yu.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Du.copy(e.center).add(yu)),this.expandByPoint(Du.copy(e.center).sub(yu))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Au=new ws,Cu=new ws,_u=new ws,bu=new ws,xu=new ws,Fu=new ws,wu=new ws;class Su{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ws,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ws(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Au)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Au.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Au.copy(this.origin).addScaledVector(this.direction,t),Au.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Cu.copy(e).add(t).multiplyScalar(.5),_u.copy(t).sub(e).normalize(),bu.copy(this.origin).sub(Cu);const i=.5*e.distanceTo(t),a=-this.direction.dot(_u),o=bu.dot(this.direction),s=-bu.dot(_u),u=bu.lengthSq(),l=Math.abs(1-a*a);let c,h,d,p;if(l>0)if(c=a*s-o,h=a*o-s,p=i*l,c>=0)if(h>=-p)if(h<=p){const e=1/l;c*=e,h*=e,d=c*(c+a*h+2*o)+h*(a*c+h+2*s)+u}else h=i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+u;else h=-i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+u;else h<=-p?(c=Math.max(0,-(-a*i+o)),h=c>0?-i:Math.min(Math.max(-i,-s),i),d=-c*c+h*(h+2*s)+u):h<=p?(c=0,h=Math.min(Math.max(-i,-s),i),d=h*(h+2*s)+u):(c=Math.max(0,-(a*i+o)),h=c>0?i:Math.min(Math.max(-i,-s),i),d=-c*c+h*(h+2*s)+u);else h=a>0?-i:i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,c),r&&r.copy(Cu).addScaledVector(_u,h),d}intersectSphere(e,t){Au.subVectors(e.center,this.origin);const n=Au.dot(this.direction),r=Au.dot(Au)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,o,s;const u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),l>=0?(i=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Au)}intersectTriangle(e,t,n,r,i){xu.subVectors(t,e),Fu.subVectors(n,e),wu.crossVectors(xu,Fu);let a,o=this.direction.dot(wu);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}bu.subVectors(this.origin,e);const s=a*this.direction.dot(Fu.crossVectors(bu,Fu));if(s<0)return null;const u=a*this.direction.dot(xu.cross(bu));if(u<0)return null;if(s+u>o)return null;const l=-a*bu.dot(wu);return l<0?null:this.at(l/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Tu{constructor(e,t,n,r,i,a,o,s,u,l,c,h,d,p,f,m){Tu.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,u,l,c,h,d,p,f,m)}set(e,t,n,r,i,a,o,s,u,l,c,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=u,g[6]=l,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Tu).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Mu.setFromMatrixColumn(e,0).length(),i=1/Mu.setFromMatrixColumn(e,1).length(),a=1/Mu.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){const e=a*l,n=a*c,r=o*l,i=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=n+r*u,t[5]=e-i*u,t[9]=-o*s,t[2]=i-e*u,t[6]=r+n*u,t[10]=a*s}else if("YXZ"===e.order){const e=s*l,n=s*c,r=u*l,i=u*c;t[0]=e+i*o,t[4]=r*o-n,t[8]=a*u,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=n*o-r,t[6]=i+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*l,n=s*c,r=u*l,i=u*c;t[0]=e-i*o,t[4]=-a*c,t[8]=r+n*o,t[1]=n+r*o,t[5]=a*l,t[9]=i-e*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*l,n=a*c,r=o*l,i=o*c;t[0]=s*l,t[4]=r*u-n,t[8]=e*u+i,t[1]=s*c,t[5]=i*u+e,t[9]=n*u-r,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*u,r=o*s,i=o*u;t[0]=s*l,t[4]=i-e*c,t[8]=r*c+n,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-u*l,t[6]=n*c+r,t[10]=e-i*c}else if("XZY"===e.order){const e=a*s,n=a*u,r=o*s,i=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=e*c+i,t[5]=a*l,t[9]=n*c-r,t[2]=r*c-n,t[6]=o*l,t[10]=i*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Pu,e,Nu)}lookAt(e,t,n){const r=this.elements;return Iu.subVectors(e,t),0===Iu.lengthSq()&&(Iu.z=1),Iu.normalize(),Ru.crossVectors(n,Iu),0===Ru.lengthSq()&&(1===Math.abs(n.z)?Iu.x+=1e-4:Iu.z+=1e-4,Iu.normalize(),Ru.crossVectors(n,Iu)),Ru.normalize(),Lu.crossVectors(Iu,Ru),r[0]=Ru.x,r[4]=Lu.x,r[8]=Iu.x,r[1]=Ru.y,r[5]=Lu.y,r[9]=Iu.y,r[2]=Ru.z,r[6]=Lu.z,r[10]=Iu.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],D=n[7],y=n[11],E=n[15],A=r[0],C=r[4],_=r[8],b=r[12],x=r[1],F=r[5],w=r[9],S=r[13],T=r[2],M=r[6],B=r[10],P=r[14],N=r[3],R=r[7],L=r[11],I=r[15];return i[0]=a*A+o*x+s*T+u*N,i[4]=a*C+o*F+s*M+u*R,i[8]=a*_+o*w+s*B+u*L,i[12]=a*b+o*S+s*P+u*I,i[1]=l*A+c*x+h*T+d*N,i[5]=l*C+c*F+h*M+d*R,i[9]=l*_+c*w+h*B+d*L,i[13]=l*b+c*S+h*P+d*I,i[2]=p*A+f*x+m*T+g*N,i[6]=p*C+f*F+m*M+g*R,i[10]=p*_+f*w+m*B+g*L,i[14]=p*b+f*S+m*P+g*I,i[3]=v*A+D*x+y*T+E*N,i[7]=v*C+D*F+y*M+E*R,i[11]=v*_+D*w+y*B+E*L,i[15]=v*b+D*S+y*P+E*I,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*s*c-r*u*c-i*o*h+n*u*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*u*h+i*a*h-r*a*d+r*u*l-i*s*l)+e[11]*(+t*u*c-t*o*d-i*a*c+n*a*d+i*o*l-n*u*l)+e[15]*(-r*o*l-t*s*c+t*o*h+r*a*c-n*a*h+n*s*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*u-f*h*u+f*s*d-o*m*d-c*s*g+o*h*g,D=p*h*u-l*m*u-p*s*d+a*m*d+l*s*g-a*h*g,y=l*f*u-p*c*u+p*o*d-a*f*d-l*o*g+a*c*g,E=p*c*s-l*f*s-p*o*h+a*f*h+l*o*m-a*c*m,A=t*v+n*D+r*y+i*E;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/A;return e[0]=v*C,e[1]=(f*h*i-c*m*i-f*r*d+n*m*d+c*r*g-n*h*g)*C,e[2]=(o*m*i-f*s*i+f*r*u-n*m*u-o*r*g+n*s*g)*C,e[3]=(c*s*i-o*h*i-c*r*u+n*h*u+o*r*d-n*s*d)*C,e[4]=D*C,e[5]=(l*m*i-p*h*i+p*r*d-t*m*d-l*r*g+t*h*g)*C,e[6]=(p*s*i-a*m*i-p*r*u+t*m*u+a*r*g-t*s*g)*C,e[7]=(a*h*i-l*s*i+l*r*u-t*h*u-a*r*d+t*s*d)*C,e[8]=y*C,e[9]=(p*c*i-l*f*i-p*n*d+t*f*d+l*n*g-t*c*g)*C,e[10]=(a*f*i-p*o*i+p*n*u-t*f*u-a*n*g+t*o*g)*C,e[11]=(l*o*i-a*c*i-l*n*u+t*c*u+a*n*d-t*o*d)*C,e[12]=E*C,e[13]=(l*f*r-p*c*r+p*n*h-t*f*h-l*n*m+t*c*m)*C,e[14]=(p*o*r-a*f*r-p*n*s+t*f*s+a*n*m-t*o*m)*C,e[15]=(a*c*r-l*o*r+l*n*s-t*c*s-a*n*h+t*o*h)*C,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,u=i*a,l=i*o;return this.set(u*a+n,u*o-r*s,u*s+r*o,0,u*o+r*s,l*o+n,l*s-r*a,0,u*s-r*o,l*s+r*a,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,u=i+i,l=a+a,c=o+o,h=i*u,d=i*l,p=i*c,f=a*l,m=a*c,g=o*c,v=s*u,D=s*l,y=s*c,E=n.x,A=n.y,C=n.z;return r[0]=(1-(f+g))*E,r[1]=(d+y)*E,r[2]=(p-D)*E,r[3]=0,r[4]=(d-y)*A,r[5]=(1-(h+g))*A,r[6]=(m+v)*A,r[7]=0,r[8]=(p+D)*C,r[9]=(m-v)*C,r[10]=(1-(h+f))*C,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Mu.set(r[0],r[1],r[2]).length();const a=Mu.set(r[4],r[5],r[6]).length(),o=Mu.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Bu.copy(this);const s=1/i,u=1/a,l=1/o;return Bu.elements[0]*=s,Bu.elements[1]*=s,Bu.elements[2]*=s,Bu.elements[4]*=u,Bu.elements[5]*=u,Bu.elements[6]*=u,Bu.elements[8]*=l,Bu.elements[9]*=l,Bu.elements[10]*=l,t.setFromRotationMatrix(Bu),n.x=i,n.y=a,n.z=o,this}makePerspective(e,t,n,r,i,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:hs;const s=this.elements,u=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),h=(n+r)/(n-r);let d,p;if(o===hs)d=-(a+i)/(a-i),p=-2*a*i/(a-i);else{if(o!==ds)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-a/(a-i),p=-a*i/(a-i)}return s[0]=u,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=d,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,i,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:hs;const s=this.elements,u=1/(t-e),l=1/(n-r),c=1/(a-i),h=(t+e)*u,d=(n+r)*l;let p,f;if(o===hs)p=(a+i)*c,f=-2*c;else{if(o!==ds)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=i*c,f=-1*c}return s[0]=2*u,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-d,s[2]=0,s[6]=0,s[10]=f,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Mu=new ws,Bu=new Tu,Pu=new ws(0,0,0),Nu=new ws(1,1,1),Ru=new ws,Lu=new ws,Iu=new ws,ku=new Tu,Ou=new Fs;class Uu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Uu.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],u=r[5],l=r[9],c=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(ys(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ys(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(ys(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-ys(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(ys(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-ys(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ku.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ku,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Ou.setFromEuler(this),this.setFromQuaternion(Ou,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Uu.DEFAULT_ORDER="XYZ";class zu{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let Vu=0;const Gu=new ws,Hu=new Fs,ju=new Tu,Wu=new ws,qu=new ws,Xu=new ws,Ku=new Fs,Yu=new ws(1,0,0),Ju=new ws(0,1,0),$u=new ws(0,0,1),Qu={type:"added"},Zu={type:"removed"},el={type:"childadded",child:null},tl={type:"childremoved",child:null};class nl extends ps{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vu++}),this.uuid=Ds(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=nl.DEFAULT_UP.clone();const e=new ws,t=new Uu,n=new Fs,r=new ws(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Tu},normalMatrix:{value:new Ms}}),this.matrix=new Tu,this.matrixWorld=new Tu,this.matrixAutoUpdate=nl.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=nl.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new zu,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Hu.setFromAxisAngle(e,t),this.quaternion.multiply(Hu),this}rotateOnWorldAxis(e,t){return Hu.setFromAxisAngle(e,t),this.quaternion.premultiply(Hu),this}rotateX(e){return this.rotateOnAxis(Yu,e)}rotateY(e){return this.rotateOnAxis(Ju,e)}rotateZ(e){return this.rotateOnAxis($u,e)}translateOnAxis(e,t){return Gu.copy(e).applyQuaternion(this.quaternion),this.position.add(Gu.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Yu,e)}translateY(e){return this.translateOnAxis(Ju,e)}translateZ(e){return this.translateOnAxis($u,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ju.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Wu.copy(e):Wu.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),qu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ju.lookAt(qu,Wu,this.up):ju.lookAt(Wu,qu,this.up),this.quaternion.setFromRotationMatrix(ju),r&&(ju.extractRotation(r.matrixWorld),Hu.setFromRotationMatrix(ju),this.quaternion.premultiply(Hu.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Qu),el.child=e,this.dispatchEvent(el),el.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Zu),tl.child=e,this.dispatchEvent(tl),tl.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ju.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ju.multiply(e.parent.matrixWorld)),e.applyMatrix4(ju),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Qu),el.child=e,this.dispatchEvent(el),el.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const r=this.children;for(let i=0,a=r.length;i<a;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qu,e,Xu),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qu,Ku,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(e=>s(s({},e),{},{boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(e=>s({},e)),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(r.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),o=a(e.images),s=a(e.shapes),u=a(e.skeletons),l=a(e.animations),c=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),u.length>0&&(n.skeletons=u),l.length>0&&(n.animations=l),c.length>0&&(n.nodes=c)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}nl.DEFAULT_UP=new ws(0,1,0),nl.DEFAULT_MATRIX_AUTO_UPDATE=!0,nl.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const rl=new ws,il=new ws,al=new ws,ol=new ws,sl=new ws,ul=new ws,ll=new ws,cl=new ws,hl=new ws,dl=new ws,pl=new $s,fl=new $s,ml=new $s;class gl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ws,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ws,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ws;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),rl.subVectors(e,t),r.cross(rl);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){rl.subVectors(r,t),il.subVectors(n,t),al.subVectors(e,t);const a=rl.dot(rl),o=rl.dot(il),s=rl.dot(al),u=il.dot(il),l=il.dot(al),c=a*u-o*o;if(0===c)return i.set(0,0,0),null;const h=1/c,d=(u*s-o*l)*h,p=(a*l-o*s)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,ol)&&(ol.x>=0&&ol.y>=0&&ol.x+ol.y<=1)}static getInterpolation(e,t,n,r,i,a,o,s){return null===this.getBarycoord(e,t,n,r,ol)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(i,ol.x),s.addScaledVector(a,ol.y),s.addScaledVector(o,ol.z),s)}static getInterpolatedAttribute(e,t,n,r,i,a){return pl.setScalar(0),fl.setScalar(0),ml.setScalar(0),pl.fromBufferAttribute(e,t),fl.fromBufferAttribute(e,n),ml.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(pl,i.x),a.addScaledVector(fl,i.y),a.addScaledVector(ml,i.z),a}static isFrontFacing(e,t,n,r){return rl.subVectors(n,t),il.subVectors(e,t),rl.cross(il).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rl.subVectors(this.c,this.b),il.subVectors(this.a,this.b),.5*rl.cross(il).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return gl.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return gl.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return gl.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return gl.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return gl.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,o;sl.subVectors(r,n),ul.subVectors(i,n),cl.subVectors(e,n);const s=sl.dot(cl),u=ul.dot(cl);if(s<=0&&u<=0)return t.copy(n);hl.subVectors(e,r);const l=sl.dot(hl),c=ul.dot(hl);if(l>=0&&c<=l)return t.copy(r);const h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return a=s/(s-l),t.copy(n).addScaledVector(sl,a);dl.subVectors(e,i);const d=sl.dot(dl),p=ul.dot(dl);if(p>=0&&d<=p)return t.copy(i);const f=d*u-s*p;if(f<=0&&u>=0&&p<=0)return o=u/(u-p),t.copy(n).addScaledVector(ul,o);const m=l*p-d*c;if(m<=0&&c-l>=0&&d-p>=0)return ll.subVectors(i,r),o=(c-l)/(c-l+(d-p)),t.copy(r).addScaledVector(ll,o);const g=1/(m+f+h);return a=f*g,o=h*g,t.copy(n).addScaledVector(sl,a).addScaledVector(ul,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const vl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Dl={h:0,s:0,l:0},yl={h:0,s:0,l:0};function El(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Al{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yo;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,zs.colorSpaceToWorking(this,t),this}setRGB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:zs.workingColorSpace;return this.r=e,this.g=t,this.b=n,zs.colorSpaceToWorking(this,r),this}setHSL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:zs.workingColorSpace;if(e=Es(e,1),t=ys(t,0,1),n=ys(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=El(i,r,e+1/3),this.g=El(i,r,e),this.b=El(i,r,e-1/3)}return zs.colorSpaceToWorking(this,r),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yo;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=t[1],o=t[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,n);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=t[1],i=r.length;if(3===i)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===i)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yo;const n=vl[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Vs(e.r),this.g=Vs(e.g),this.b=Vs(e.b),this}copyLinearToSRGB(e){return this.r=Gs(e.r),this.g=Gs(e.g),this.b=Gs(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yo;return zs.workingToColorSpace(Cl.copy(this),e),65536*Math.round(ys(255*Cl.r,0,255))+256*Math.round(ys(255*Cl.g,0,255))+Math.round(ys(255*Cl.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yo;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zs.workingColorSpace;zs.workingToColorSpace(Cl.copy(this),t);const n=Cl.r,r=Cl.g,i=Cl.b,a=Math.max(n,r,i),o=Math.min(n,r,i);let s,u;const l=(o+a)/2;if(o===a)s=0,u=0;else{const e=a-o;switch(u=l<=.5?e/(a+o):e/(2-a-o),a){case n:s=(r-i)/e+(r<i?6:0);break;case r:s=(i-n)/e+2;break;case i:s=(n-r)/e+4}s/=6}return e.h=s,e.s=u,e.l=l,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zs.workingColorSpace;return zs.workingToColorSpace(Cl.copy(this),t),e.r=Cl.r,e.g=Cl.g,e.b=Cl.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yo;zs.workingToColorSpace(Cl.copy(this),e);const t=Cl.r,n=Cl.g,r=Cl.b;return e!==Yo?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*r),")")}offsetHSL(e,t,n){return this.getHSL(Dl),this.setHSL(Dl.h+e,Dl.s+t,Dl.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Dl),e.getHSL(yl);const n=As(Dl.h,yl.h,t),r=As(Dl.s,yl.s,t),i=As(Dl.l,yl.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Cl=new Al;Al.NAMES=vl;let _l=0;class bl extends ps{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_l++}),this.uuid=Ds(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=sa,this.blendDst=ua,this.blendEquation=ea,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Al(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Zo,this.stencilZFail=Zo,this.stencilZPass=Zo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."));continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==sa&&(n.blendSrc=this.blendSrc),this.blendDst!==ua&&(n.blendDst=this.blendDst),this.blendEquation!==ea&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Zo&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Zo&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Zo&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class xl extends bl{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Al(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Uu,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Fl=wl();function wl(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let u=0;u<256;++u){const e=u-127;e<-27?(r[u]=0,r[256|u]=32768,i[u]=24,i[256|u]=24):e<-14?(r[u]=1024>>-e-14,r[256|u]=1024>>-e-14|32768,i[u]=-e-1,i[256|u]=-e-1):e<=15?(r[u]=e+15<<10,r[256|u]=e+15<<10|32768,i[u]=13,i[256|u]=13):e<128?(r[u]=31744,r[256|u]=64512,i[u]=24,i[256|u]=24):(r[u]=31744,r[256|u]=64512,i[u]=13,i[256|u]=13)}const a=new Uint32Array(2048),o=new Uint32Array(64),s=new Uint32Array(64);for(let u=1;u<1024;++u){let e=u<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,a[u]=e|t}for(let u=1024;u<2048;++u)a[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)o[u]=u<<23;o[31]=1199570944,o[32]=2147483648;for(let u=33;u<63;++u)o[u]=2147483648+(u-32<<23);o[63]=3347054592;for(let u=1;u<64;++u)32!==u&&(s[u]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:o,offsetTable:s}}function Sl(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=ys(e,-65504,65504),Fl.floatView[0]=e;const t=Fl.uint32View[0],n=t>>23&511;return Fl.baseTable[n]+((8388607&t)>>Fl.shiftTable[n])}function Tl(e){const t=e>>10;return Fl.uint32View[0]=Fl.mantissaTable[Fl.offsetTable[t]+(1023&e)]+Fl.exponentTable[t],Fl.floatView[0]}const Ml=new ws,Bl=new xs;let Pl=0;class Nl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Pl++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=us,this.updateRanges=[],this.gpuType=Xa,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Bl.fromBufferAttribute(this,t),Bl.applyMatrix3(e),this.setXY(t,Bl.x,Bl.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ml.fromBufferAttribute(this,t),Ml.applyMatrix3(e),this.setXYZ(t,Ml.x,Ml.y,Ml.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ml.fromBufferAttribute(this,t),Ml.applyMatrix4(e),this.setXYZ(t,Ml.x,Ml.y,Ml.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ml.fromBufferAttribute(this,t),Ml.applyNormalMatrix(e),this.setXYZ(t,Ml.x,Ml.y,Ml.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ml.fromBufferAttribute(this,t),Ml.transformDirection(e),this.setXYZ(t,Ml.x,Ml.y,Ml.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Cs(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=_s(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Cs(t,this.array)),t}setX(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Cs(t,this.array)),t}setY(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Cs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Cs(t,this.array)),t}setW(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array),r=_s(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array),r=_s(r,this.array),i=_s(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==us&&(e.usage=this.usage),e}}class Rl extends Nl{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Ll extends Nl{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Il extends Nl{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Tl(this.array[e*this.itemSize]);return this.normalized&&(t=Cs(t,this.array)),t}setX(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize]=Sl(t),this}getY(e){let t=Tl(this.array[e*this.itemSize+1]);return this.normalized&&(t=Cs(t,this.array)),t}setY(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize+1]=Sl(t),this}getZ(e){let t=Tl(this.array[e*this.itemSize+2]);return this.normalized&&(t=Cs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize+2]=Sl(t),this}getW(e){let t=Tl(this.array[e*this.itemSize+3]);return this.normalized&&(t=Cs(t,this.array)),t}setW(e,t){return this.normalized&&(t=_s(t,this.array)),this.array[e*this.itemSize+3]=Sl(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array)),this.array[e+0]=Sl(t),this.array[e+1]=Sl(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array),r=_s(r,this.array)),this.array[e+0]=Sl(t),this.array[e+1]=Sl(n),this.array[e+2]=Sl(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array),r=_s(r,this.array),i=_s(i,this.array)),this.array[e+0]=Sl(t),this.array[e+1]=Sl(n),this.array[e+2]=Sl(r),this.array[e+3]=Sl(i),this}}class kl extends Nl{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Ol=0;const Ul=new Tu,zl=new nl,Vl=new ws,Gl=new nu,Hl=new nu,jl=new ws;class Wl extends ps{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ol++}),this.uuid=Ds(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ps(e)?Ll:Rl)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Ms).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ul.makeRotationFromQuaternion(e),this.applyMatrix4(Ul),this}rotateX(e){return Ul.makeRotationX(e),this.applyMatrix4(Ul),this}rotateY(e){return Ul.makeRotationY(e),this.applyMatrix4(Ul),this}rotateZ(e){return Ul.makeRotationZ(e),this.applyMatrix4(Ul),this}translate(e,t,n){return Ul.makeTranslation(e,t,n),this.applyMatrix4(Ul),this}scale(e,t,n){return Ul.makeScale(e,t,n),this.applyMatrix4(Ul),this}lookAt(e){return zl.lookAt(e),zl.updateMatrix(),this.applyMatrix4(zl.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vl).negate(),this.translate(Vl.x,Vl.y,Vl.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}this.setAttribute("position",new kl(t,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const n=e[r];t.setXYZ(r,n.x,n.y,n.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new ws(-1/0,-1/0,-1/0),new ws(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];Gl.setFromBufferAttribute(e),this.morphTargetsRelative?(jl.addVectors(this.boundingBox.min,Gl.min),this.boundingBox.expandByPoint(jl),jl.addVectors(this.boundingBox.max,Gl.max),this.boundingBox.expandByPoint(jl)):(this.boundingBox.expandByPoint(Gl.min),this.boundingBox.expandByPoint(Gl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Eu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new ws,1/0);if(e){const n=this.boundingSphere.center;if(Gl.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const n=t[e];Hl.setFromBufferAttribute(n),this.morphTargetsRelative?(jl.addVectors(Gl.min,Hl.min),Gl.expandByPoint(jl),jl.addVectors(Gl.max,Hl.max),Gl.expandByPoint(jl)):(Gl.expandByPoint(Hl.min),Gl.expandByPoint(Hl.max))}Gl.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)jl.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(jl));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],o=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)jl.fromBufferAttribute(a,t),o&&(Vl.fromBufferAttribute(e,t),jl.add(Vl)),r=Math.max(r,n.distanceToSquared(jl))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Nl(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],s=[];for(let _=0;_<n.count;_++)o[_]=new ws,s[_]=new ws;const u=new ws,l=new ws,c=new ws,h=new xs,d=new xs,p=new xs,f=new ws,m=new ws;function g(e,t,r){u.fromBufferAttribute(n,e),l.fromBufferAttribute(n,t),c.fromBufferAttribute(n,r),h.fromBufferAttribute(i,e),d.fromBufferAttribute(i,t),p.fromBufferAttribute(i,r),l.sub(u),c.sub(u),d.sub(h),p.sub(h);const a=1/(d.x*p.y-p.x*d.y);isFinite(a)&&(f.copy(l).multiplyScalar(p.y).addScaledVector(c,-d.y).multiplyScalar(a),m.copy(c).multiplyScalar(d.x).addScaledVector(l,-p.x).multiplyScalar(a),o[e].add(f),o[t].add(f),o[r].add(f),s[e].add(m),s[t].add(m),s[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let _=0,b=v.length;_<b;++_){const t=v[_],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)g(e.getX(r+0),e.getX(r+1),e.getX(r+2))}const D=new ws,y=new ws,E=new ws,A=new ws;function C(e){E.fromBufferAttribute(r,e),A.copy(E);const t=o[e];D.copy(t),D.sub(E.multiplyScalar(E.dot(t))).normalize(),y.crossVectors(A,t);const n=y.dot(s[e])<0?-1:1;a.setXYZW(e,D.x,D.y,D.z,n)}for(let _=0,b=v.length;_<b;++_){const t=v[_],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)C(e.getX(r+0)),C(e.getX(r+1)),C(e.getX(r+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Nl(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new ws,i=new ws,a=new ws,o=new ws,s=new ws,u=new ws,l=new ws,c=new ws;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),l.subVectors(a,i),c.subVectors(r,i),l.cross(c),o.fromBufferAttribute(n,d),s.fromBufferAttribute(n,p),u.fromBufferAttribute(n,f),o.add(l),s.add(l),u.add(l),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(f,u.x,u.y,u.z)}else for(let e=0,h=t.count;e<h;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),l.subVectors(a,i),c.subVectors(r,i),l.cross(c),n.setXYZ(e+0,l.x,l.y,l.z),n.setXYZ(e+1,l.x,l.y,l.z),n.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)jl.fromBufferAttribute(e,t),jl.normalize(),e.setXYZ(t,jl.x,jl.y,jl.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let o=0,s=0;for(let u=0,l=t.length;u<l;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(let e=0;e<r;e++)a[s++]=n[o++]}return new Nl(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Wl,n=this.index.array,r=this.attributes;for(const o in r){const i=e(r[o],n);t.setAttribute(o,i)}const i=this.morphAttributes;for(const o in i){const r=[],a=i[o];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);r.push(i)}t.morphAttributes[o]=r}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const e=a[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const r={};let i=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];n.push(i.toJSON(e.data))}n.length>0&&(r[s]=n,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere=o.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const r=e.attributes;for(const u in r){const e=r[u];this.setAttribute(u,e.clone(t))}const i=e.morphAttributes;for(const u in i){const e=[],n=i[u];for(let r=0,i=n.length;r<i;r++)e.push(n[r].clone(t));this.morphAttributes[u]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,l=a.length;u<l;u++){const e=a[u];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ql=new Tu,Xl=new Su,Kl=new Eu,Yl=new ws,Jl=new ws,$l=new ws,Ql=new ws,Zl=new ws,ec=new ws,tc=new ws,nc=new ws;class rc extends nl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xl;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(i&&o){ec.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],s=i[n];0!==r&&(Zl.fromBufferAttribute(s,e),a?ec.addScaledVector(Zl,r):ec.addScaledVector(Zl.sub(t),r))}t.add(ec)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Kl.copy(n.boundingSphere),Kl.applyMatrix4(i),Xl.copy(e.ray).recast(e.near),!1===Kl.containsPoint(Xl.origin)){if(null===Xl.intersectSphere(Kl,Yl))return;if(Xl.origin.distanceToSquared(Yl)>(e.far-e.near)**2)return}ql.copy(i).invert(),Xl.copy(e.ray).applyMatrix4(ql),null!==n.boundingBox&&!1===Xl.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Xl)}}_computeIntersections(e,t,n){let r;const i=this.geometry,a=this.material,o=i.index,s=i.attributes.position,u=i.attributes.uv,l=i.attributes.uv1,c=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const i=h[p],s=a[i.materialIndex];for(let a=Math.max(i.start,d.start),h=Math.min(o.count,Math.min(i.start+i.count,d.start+d.count));a<h;a+=3){r=ic(this,s,e,n,u,l,c,o.getX(a),o.getX(a+1),o.getX(a+2)),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);i<s;i+=3){r=ic(this,a,e,n,u,l,c,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==s)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const i=h[p],o=a[i.materialIndex];for(let a=Math.max(i.start,d.start),h=Math.min(s.count,Math.min(i.start+i.count,d.start+d.count));a<h;a+=3){r=ic(this,o,e,n,u,l,c,a,a+1,a+2),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);i<o;i+=3){r=ic(this,a,e,n,u,l,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}}function ic(e,t,n,r,i,a,o,s,u,l){e.getVertexPosition(s,Jl),e.getVertexPosition(u,$l),e.getVertexPosition(l,Ql);const c=function(e,t,n,r,i,a,o,s){let u;if(u=1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,0===t.side,s),null===u)return null;nc.copy(s),nc.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(nc);return l<n.near||l>n.far?null:{distance:l,point:nc.clone(),object:e}}(e,t,n,r,Jl,$l,Ql,tc);if(c){const e=new ws;gl.getBarycoord(tc,Jl,$l,Ql,e),i&&(c.uv=gl.getInterpolatedAttribute(i,s,u,l,e,new xs)),a&&(c.uv1=gl.getInterpolatedAttribute(a,s,u,l,e,new xs)),o&&(c.normal=gl.getInterpolatedAttribute(o,s,u,l,e,new ws),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const t={a:s,b:u,c:l,normal:new ws,materialIndex:0};gl.getNormal(Jl,$l,Ql,t.normal),c.face=t,c.barycoord=e}return c}class ac extends Wl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const o=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const s=[],u=[],l=[],c=[];let h=0,d=0;function p(e,t,n,r,i,a,p,f,m,g,v){const D=a/m,y=p/g,E=a/2,A=p/2,C=f/2,_=m+1,b=g+1;let x=0,F=0;const w=new ws;for(let o=0;o<b;o++){const a=o*y-A;for(let s=0;s<_;s++){const h=s*D-E;w[e]=h*r,w[t]=a*i,w[n]=C,u.push(w.x,w.y,w.z),w[e]=0,w[t]=0,w[n]=f>0?1:-1,l.push(w.x,w.y,w.z),c.push(s/m),c.push(1-o/g),x+=1}}for(let o=0;o<g;o++)for(let e=0;e<m;e++){const t=h+e+_*o,n=h+e+_*(o+1),r=h+(e+1)+_*(o+1),i=h+(e+1)+_*o;s.push(t,n,i),s.push(n,r,i),F+=6}o.addGroup(d,F,v),d+=F,h+=x}p("z","y","x",-1,-1,n,t,e,a,i,0),p("z","y","x",1,-1,n,t,-e,a,i,1),p("x","z","y",1,1,e,n,t,r,a,2),p("x","z","y",1,-1,e,n,-t,r,a,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new kl(u,3)),this.setAttribute("normal",new kl(l,3)),this.setAttribute("uv",new kl(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ac(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function oc(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function sc(e){const t={};for(let n=0;n<e.length;n++){const r=oc(e[n]);for(const e in r)t[e]=r[e]}return t}function uc(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:zs.workingColorSpace}const lc={clone:oc,merge:sc};class cc extends bl{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=oc(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class hc extends nl{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Tu,this.projectionMatrix=new Tu,this.projectionMatrixInverse=new Tu,this.coordinateSystem=hs}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const dc=new ws,pc=new xs,fc=new xs;class mc extends hc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*vs*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*gs*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*vs*Math.atan(Math.tan(.5*gs*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){dc.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(dc.x,dc.y).multiplyScalar(-e/dc.z),dc.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(dc.x,dc.y).multiplyScalar(-e/dc.z)}getViewSize(e,t){return this.getViewBounds(e,pc,fc),t.subVectors(fc,pc)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*gs*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const gc=-90;class vc extends nl{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new mc(gc,1,e,t);r.layers=this.layers,this.add(r);const i=new mc(gc,1,e,t);i.layers=this.layers,this.add(i);const a=new mc(gc,1,e,t);a.layers=this.layers,this.add(a);const o=new mc(gc,1,e,t);o.layers=this.layers,this.add(o);const s=new mc(gc,1,e,t);s.layers=this.layers,this.add(s);const u=new mc(gc,1,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,o,s]=t;for(const u of t)this.remove(u);if(e===hs)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==ds)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,a,o,s,u,l]=this.children,c=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,o),e.setRenderTarget(n,3,r),e.render(t,s),e.setRenderTarget(n,4,r),e.render(t,u),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,r),e.render(t,l),e.setRenderTarget(c,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Dc extends Js{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:wa,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0,arguments.length>9?arguments[9]:void 0),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class yc extends Zs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new Dc(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new ac(5,5,5),o=new cc({name:"CubemapFromEquirect",uniforms:oc(n),vertexShader:r,fragmentShader:i,side:1,blending:0});o.uniforms.tEquirect.value=t;const s=new rc(a,o),u=t.minFilter;t.minFilter===za&&(t.minFilter=Oa);return new vc(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}clear(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}class Ec extends nl{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ac={type:"move"};class Cc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ec,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ec,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ws,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ws),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ec,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ws,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ws),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),r=this._getHandJoint(u,a);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const r=u.joints["index-finger-tip"],i=u.joints["thumb-tip"],o=r.position.distanceTo(i.position),s=.02,l=.005;u.inputState.pinching&&o>s+l?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&o<=s-l&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ac)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==u&&(u.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Ec;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class _c extends nl{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Uu,this.environmentIntensity=1,this.environmentRotation=new Uu,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class bc{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=us,this.updateRanges=[],this.version=0,this.uuid=Ds()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ds()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ds()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const xc=new ws;class Fc{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)xc.fromBufferAttribute(this,t),xc.applyMatrix4(e),this.setXYZ(t,xc.x,xc.y,xc.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)xc.fromBufferAttribute(this,t),xc.applyNormalMatrix(e),this.setXYZ(t,xc.x,xc.y,xc.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)xc.fromBufferAttribute(this,t),xc.transformDirection(e),this.setXYZ(t,xc.x,xc.y,xc.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Cs(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=_s(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=_s(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=_s(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=_s(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=_s(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Cs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Cs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Cs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Cs(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array),r=_s(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=_s(t,this.array),n=_s(n,this.array),r=_s(r,this.array),i=_s(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Nl(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Fc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class wc extends bl{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Al(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class Sc extends Js{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:La,arguments.length>9&&void 0!==arguments[9]?arguments[9]:La,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Tc extends Nl{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Mc=new ws,Bc=new ws,Pc=new Ms;class Nc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ws(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Mc.subVectors(n,t).cross(Bc.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Mc),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Pc.getNormalMatrix(e),r=this.coplanarPoint(Mc).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Rc=new Eu,Lc=new ws;class Ic{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Nc,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Nc,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Nc,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Nc,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Nc,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Nc;this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hs;const n=this.planes,r=e.elements,i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],D=r[14],y=r[15];if(n[0].setComponents(s-i,h-u,m-d,y-g).normalize(),n[1].setComponents(s+i,h+u,m+d,y+g).normalize(),n[2].setComponents(s+a,h+l,m+p,y+v).normalize(),n[3].setComponents(s-a,h-l,m-p,y-v).normalize(),n[4].setComponents(s-o,h-c,m-f,y-D).normalize(),t===hs)n[5].setComponents(s+o,h+c,m+f,y+D).normalize();else{if(t!==ds)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(o,c,f,D).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Rc.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Rc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Rc)}intersectsSprite(e){return Rc.center.set(0,0,0),Rc.radius=.7071067811865476,Rc.applyMatrix4(e.matrixWorld),this.intersectsSphere(Rc)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Lc.x=r.normal.x>0?e.max.x:e.min.x,Lc.y=r.normal.y>0?e.max.y:e.min.y,Lc.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Lc)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const kc=new Tu,Oc=new Ic;class Uc{constructor(){this.coordinateSystem=hs}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(kc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Oc.setFromProjectionMatrix(kc,this.coordinateSystem),Oc.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(kc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Oc.setFromProjectionMatrix(kc,this.coordinateSystem),Oc.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(kc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Oc.setFromProjectionMatrix(kc,this.coordinateSystem),Oc.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(kc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Oc.setFromProjectionMatrix(kc,this.coordinateSystem),Oc.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(kc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Oc.setFromProjectionMatrix(kc,this.coordinateSystem),Oc.containsPoint(e))return!0}return!1}clone(){return new Uc}}class zc extends bl{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Al(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class Vc extends bl{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Al(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class Gc extends Js{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=La,this.minFilter=La,this.generateMipmaps=!1,this.needsUpdate=!0}}class Hc extends Js{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qa,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:La,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:La,u=arguments.length>8?arguments[8]:void 0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:no,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;if(l!==no&&l!==ro)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:c},r,i,a,o,s,l,n,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new qs(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class jc extends Wl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};const u=this;r=Math.floor(r),i=Math.floor(i);const l=[],c=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,a=new xs,f=new ws;let v=0;const D=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=r;e++)c.push(0,m*y,0),h.push(0,y,0),d.push(.5,.5),p++;const E=p;for(let e=0;e<=r;e++){const t=e/r*s+o,n=Math.cos(t),i=Math.sin(t);f.x=D*i,f.y=m*y,f.z=D*n,c.push(f.x,f.y,f.z),h.push(0,y,0),a.x=.5*n+.5,a.y=.5*i*y+.5,d.push(a.x,a.y),p++}for(let e=0;e<r;e++){const t=i+e,r=E+e;!0===n?l.push(r,r+1,t):l.push(r+1,r,t),v+=3}u.addGroup(g,v,!0===n?1:2),g+=v}!function(){const a=new ws,v=new ws;let D=0;const y=(t-e)/n;for(let u=0;u<=i;u++){const l=[],g=u/i,D=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*s+o,u=Math.sin(i),f=Math.cos(i);v.x=D*u,v.y=-g*n+m,v.z=D*f,c.push(v.x,v.y,v.z),a.set(u,y,f).normalize(),h.push(a.x,a.y,a.z),d.push(t,1-g),l.push(p++)}f.push(l)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const a=f[r][n],o=f[r+1][n],s=f[r+1][n+1],u=f[r][n+1];(e>0||0!==r)&&(l.push(a,o,u),D+=3),(t>0||r!==i-1)&&(l.push(o,s,u),D+=3)}u.addGroup(g,D,0),g+=D}(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new kl(c,3)),this.setAttribute("normal",new kl(h,3)),this.setAttribute("uv",new kl(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Wc extends Wl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,o=Math.floor(n),s=Math.floor(r),u=o+1,l=s+1,c=e/o,h=t/s,d=[],p=[],f=[],m=[];for(let g=0;g<l;g++){const e=g*h-a;for(let t=0;t<u;t++){const n=t*c-i;p.push(n,-e,0),f.push(0,0,1),m.push(t/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let e=0;e<o;e++){const t=e+u*g,n=e+u*(g+1),r=e+1+u*(g+1),i=e+1+u*g;d.push(t,n,i),d.push(n,r,i)}this.setIndex(d),this.setAttribute("position",new kl(p,3)),this.setAttribute("normal",new kl(f,3)),this.setAttribute("uv",new kl(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wc(e.width,e.height,e.widthSegments,e.heightSegments)}}class qc extends Wl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let u=0;const l=[],c=new ws,h=new ws,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let D=0;0===g&&0===a?D=.5/t:g===n&&s===Math.PI&&(D=-.5/t);for(let n=0;n<=t;n++){const s=n/t;c.x=-e*Math.cos(r+s*i)*Math.sin(a+v*o),c.y=e*Math.cos(a+v*o),c.z=e*Math.sin(r+s*i)*Math.sin(a+v*o),p.push(c.x,c.y,c.z),h.copy(c).normalize(),f.push(h.x,h.y,h.z),m.push(s+D,1-v),d.push(u++)}l.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=l[g][e+1],r=l[g][e],i=l[g+1][e],o=l[g+1][e+1];(0!==g||a>0)&&d.push(t,r,o),(g!==n-1||s<Math.PI)&&d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new kl(p,3)),this.setAttribute("normal",new kl(f,3)),this.setAttribute("uv",new kl(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Xc extends bl{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Al(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Kc extends bl{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Al(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Al(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Uu,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Yc extends Kc{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xs(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ys(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Al(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Al(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Al(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Jc extends bl{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Al(16777215),this.specular=new Al(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Al(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Uu,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $c extends bl{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Al(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Al(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Qc extends bl{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Zc extends bl{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Al(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Al(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Uu,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eh extends bl{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class th extends bl{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class nh extends bl{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Al(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rh extends zc{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ih(e,t){return e&&e.constructor!==t?"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function ah(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}class oh{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(e>=i)break e;{const o=t[1];e<o&&(n=2,i=o);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0}}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let a=0;a!==r;++a)t[a]=n[i+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class sh extends oh{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Wo,endingEnd:Wo}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case qo:i=e,o=2*t-n;break;case Xo:i=r.length-2,o=t+r[i]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case qo:a=e,s=2*n-t;break;case Xo:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}const u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=i*l,this._offsetNext=a*l}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,D=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let E=0;E!==o;++E)i[E]=g*a[l+E]+v*a[u+E]+D*a[s+E]+y*a[c+E];return i}}class uh extends oh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(r-t),c=1-l;for(let h=0;h!==o;++h)i[h]=a[u+h]*c+a[s+h]*l;return i}}class lh extends oh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class ch{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ih(t,this.TimeBufferType),this.values=ih(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:ih(e.times,Array),values:ih(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new lh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new sh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Go:t=this.InterpolantFactoryMethodDiscrete;break;case Ho:t=this.InterpolantFactoryMethodLinear;break;case jo:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Go;case this.InterpolantFactoryMethodLinear:return Ho;case this.InterpolantFactoryMethodSmooth:return jo}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=n.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==i;o++){const t=n[o];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==a&&a>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,t,a),e=!1;break}a=t}if(void 0!==r&&ah(r))for(let o=0,s=r.length;o!==s;++o){const t=r[o];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===jo,i=e.length-1;let a=1;for(let o=1;o<i;++o){let i=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(r)i=!0;else{const e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[r+o]||n!==t[a+o]){i=!0;break}}}if(i){if(o!==a){e[a]=e[o];const r=o*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,o=0;o!==n;++o)t[r+o]=t[e+o];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}ch.prototype.ValueTypeName="",ch.prototype.TimeBufferType=Float32Array,ch.prototype.ValueBufferType=Float32Array,ch.prototype.DefaultInterpolation=Ho;class hh extends ch{constructor(e,t,n){super(e,t,n)}}hh.prototype.ValueTypeName="bool",hh.prototype.ValueBufferType=Array,hh.prototype.DefaultInterpolation=Go,hh.prototype.InterpolantFactoryMethodLinear=void 0,hh.prototype.InterpolantFactoryMethodSmooth=void 0;class dh extends ch{constructor(e,t,n,r){super(e,t,n,r)}}dh.prototype.ValueTypeName="color";class ph extends ch{constructor(e,t,n,r){super(e,t,n,r)}}ph.prototype.ValueTypeName="number";class fh extends oh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t);let u=e*o;for(let l=u+o;u!==l;u+=4)Fs.slerpFlat(i,0,a,u-o,a,u,s);return i}}class mh extends ch{constructor(e,t,n,r){super(e,t,n,r)}InterpolantFactoryMethodLinear(e){return new fh(this.times,this.values,this.getValueSize(),e)}}mh.prototype.ValueTypeName="quaternion",mh.prototype.InterpolantFactoryMethodSmooth=void 0;class gh extends ch{constructor(e,t,n){super(e,t,n)}}gh.prototype.ValueTypeName="string",gh.prototype.ValueBufferType=Array,gh.prototype.DefaultInterpolation=Go,gh.prototype.InterpolantFactoryMethodLinear=void 0,gh.prototype.InterpolantFactoryMethodSmooth=void 0;class vh extends ch{constructor(e,t,n,r){super(e,t,n,r)}}vh.prototype.ValueTypeName="vector";const Dh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class yh{constructor(e,t,n){const r=this;let i,a=!1,o=0,s=0;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return u.push(e,t),this},this.removeHandler=function(e){const t=u.indexOf(e);return-1!==t&&u.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=u.length;t<n;t+=2){const n=u[t],r=u[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const Eh=new yh;class Ah{constructor(e){this.manager=void 0!==e?e:Eh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ah.DEFAULT_MATERIAL_NAME="__DEFAULT";Error;class Ch extends Ah{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Dh.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;const o=Ns("img");function s(){l(),Dh.add(e,this),t&&t(this),i.manager.itemEnd(e)}function u(t){l(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function l(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}class _h extends nl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Al(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class bh extends _h{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(nl.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Al(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const xh=new Tu,Fh=new ws,wh=new ws;class Sh{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new xs(512,512),this.mapType=Va,this.map=null,this.mapPass=null,this.matrix=new Tu,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ic,this._frameExtents=new xs(1,1),this._viewportCount=1,this._viewports=[new $s(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Fh.setFromMatrixPosition(e.matrixWorld),t.position.copy(Fh),wh.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(wh),t.updateMatrixWorld(),xh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(xh)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Th extends Sh{constructor(){super(new mc(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*vs*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Mh extends _h{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(nl.DEFAULT_UP),this.updateMatrix(),this.target=new nl,this.distance=n,this.angle=r,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new Th}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Bh=new Tu,Ph=new ws,Nh=new ws;class Rh extends Sh{constructor(){super(new mc(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new xs(4,2),this._viewportCount=6,this._viewports=[new $s(2,1,1,1),new $s(0,1,1,1),new $s(3,1,1,1),new $s(1,1,1,1),new $s(3,0,1,1),new $s(1,0,1,1)],this._cubeDirections=[new ws(1,0,0),new ws(-1,0,0),new ws(0,0,1),new ws(0,0,-1),new ws(0,1,0),new ws(0,-1,0)],this._cubeUps=[new ws(0,1,0),new ws(0,1,0),new ws(0,1,0),new ws(0,1,0),new ws(0,0,1),new ws(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Ph.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ph),Nh.copy(n.position),Nh.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Nh),n.updateMatrixWorld(),r.makeTranslation(-Ph.x,-Ph.y,-Ph.z),Bh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bh)}}class Lh extends _h{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Rh}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Ih extends hc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class kh extends Sh{constructor(){super(new Ih(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Oh extends _h{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(nl.DEFAULT_UP),this.updateMatrix(),this.target=new nl,this.shadow=new kh}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Uh extends _h{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class zh extends _h{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Vh{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ws)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class Gh extends _h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vh;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}new WeakMap;class Hh extends mc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class jh{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Wh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Wh();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Wh(){return performance.now()}const qh="\\[\\]\\.:\\/",Xh=new RegExp("["+qh+"]","g"),Kh="[^"+qh+"]",Yh="[^"+qh.replace("\\.","")+"]",Jh=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Kh)+/(WCOD+)?/.source.replace("WCOD",Yh)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Kh)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Kh)+"$"),$h=["material","materials","bones","map"];class Qh{constructor(e,t,n){this.path=t,this.parsedPath=n||Qh.parseTrackName(t),this.node=Qh.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Qh.Composite(e,t,n):new Qh(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Xh,"")}static parseTrackName(e){const t=Jh.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==$h.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=Qh.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?o=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Qh.Composite=class{constructor(e,t,n){const r=n||Qh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Qh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Qh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Qh.prototype.GetterByBindingType=[Qh.prototype._getValue_direct,Qh.prototype._getValue_array,Qh.prototype._getValue_arrayElement,Qh.prototype._getValue_toArray],Qh.prototype.SetterByBindingTypeAndVersioning=[[Qh.prototype._setValue_direct,Qh.prototype._setValue_direct_setNeedsUpdate,Qh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Qh.prototype._setValue_array,Qh.prototype._setValue_array_setNeedsUpdate,Qh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Qh.prototype._setValue_arrayElement,Qh.prototype._setValue_arrayElement_setNeedsUpdate,Qh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Qh.prototype._setValue_fromArray,Qh.prototype._setValue_fromArray_setNeedsUpdate,Qh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);class Zh extends bc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const ed=new Tu;class td{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new Su(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new zu,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return ed.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(ed),this}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return rd(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(nd),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let r=0,i=e.length;r<i;r++)rd(e[r],this,n,t);return n.sort(nd),n}}function nd(e,t){return e.distance-t.distance}function rd(e,t,n,r){let i=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(i=!1)}if(!0===i&&!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)rd(r[e],t,n,!0)}}class id{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=ys(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ys(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class ad{constructor(e,t,n,r){ad.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}}class od extends ps{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e?(null!==this.domElement&&this.disconnect(),this.domElement=e):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function sd(e,t,n,r){const i=function(e){switch(e){case Va:case Ga:return{byteLength:1,components:1};case ja:case Ha:case Ka:return{byteLength:2,components:1};case Ya:case Ja:return{byteLength:2,components:4};case qa:case Wa:case Xa:return{byteLength:4,components:1};case Qa:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(e,"."))}(r);switch(n){case Za:return e*t;case io:case ao:return e*t/i.components*i.byteLength;case oo:case so:return e*t*2/i.components*i.byteLength;case eo:return e*t*3/i.components*i.byteLength;case to:case uo:return e*t*4/i.components*i.byteLength;case lo:case co:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case ho:case po:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case mo:case vo:return Math.max(e,16)*Math.max(t,8)/4;case fo:case go:return Math.max(e,8)*Math.max(t,8)/2;case Do:case yo:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Eo:case Ao:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case Co:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case _o:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case bo:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case xo:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case Fo:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case wo:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case So:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case To:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case Mo:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case Bo:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case Po:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case No:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case Ro:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case Lo:case Io:case ko:return Math.ceil(e/4)*Math.ceil(t/4)*16;case Oo:case Uo:return Math.ceil(e/4)*Math.ceil(t/4)*8;case zo:case Vo:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error("Unable to determine texture byte length for ".concat(n," format."))}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Hi}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Hi);const ud=new Nc,ld=new xs,cd=new ws,hd=new xs,dd=new xs,pd=new ws,fd=new ws,md=new Tu,gd=new ws,vd=new ws;let Dd=null,yd=null;const Ed=[],Ad=-1,Cd=0,_d=1;class bd extends od{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new td,this.mouseButtons={LEFT:qi,MIDDLE:qi,RIGHT:ji},this.touches={ONE:Ki},this._onPointerMove=xd.bind(this),this._onPointerDown=Fd.bind(this),this._onPointerCancel=wd.bind(this),this._onContextMenu=Sd.bind(this),null!==n&&this.connect(n)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();ld.x=(e.clientX-t.left)/t.width*2-1,ld.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if("touch"===e.pointerType)t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case qi:case Ki:this.state=Cd;break;case ji:case Xi:this.state=_d;break;default:this.state=Ad}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function xd(e){const t=this.object,n=this.domElement,r=this.raycaster;if(!1!==this.enabled){if(this._updatePointer(e),r.setFromCamera(ld,t),Dd)this.state===Cd?r.ray.intersectPlane(ud,pd)&&Dd.position.copy(pd.sub(cd).applyMatrix4(md)):this.state===_d&&(hd.subVectors(ld,dd).multiplyScalar(this.rotateSpeed),Dd.rotateOnWorldAxis(gd,hd.x),Dd.rotateOnWorldAxis(vd.normalize(),-hd.y)),this.dispatchEvent({type:"drag",object:Dd}),dd.copy(ld);else if("mouse"===e.pointerType||"pen"===e.pointerType)if(Ed.length=0,r.setFromCamera(ld,t),r.intersectObjects(this.objects,this.recursive,Ed),Ed.length>0){const e=Ed[0].object;ud.setFromNormalAndCoplanarPoint(t.getWorldDirection(ud.normal),fd.setFromMatrixPosition(e.matrixWorld)),yd!==e&&null!==yd&&(this.dispatchEvent({type:"hoveroff",object:yd}),n.style.cursor="auto",yd=null),yd!==e&&(this.dispatchEvent({type:"hoveron",object:e}),n.style.cursor="pointer",yd=e)}else null!==yd&&(this.dispatchEvent({type:"hoveroff",object:yd}),n.style.cursor="auto",yd=null);dd.copy(ld)}}function Fd(e){const t=this.object,n=this.domElement,r=this.raycaster;!1!==this.enabled&&(this._updatePointer(e),this._updateState(e),Ed.length=0,r.setFromCamera(ld,t),r.intersectObjects(this.objects,this.recursive,Ed),Ed.length>0&&(Dd=!0===this.transformGroup?Td(Ed[0].object):Ed[0].object,ud.setFromNormalAndCoplanarPoint(t.getWorldDirection(ud.normal),fd.setFromMatrixPosition(Dd.matrixWorld)),r.ray.intersectPlane(ud,pd)&&(this.state===Cd?(md.copy(Dd.parent.matrixWorld).invert(),cd.copy(pd).sub(fd.setFromMatrixPosition(Dd.matrixWorld))):this.state===_d&&(gd.set(0,1,0).applyQuaternion(t.quaternion).normalize(),vd.set(1,0,0).applyQuaternion(t.quaternion).normalize())),n.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Dd})),dd.copy(ld))}function wd(){!1!==this.enabled&&(Dd&&(this.dispatchEvent({type:"dragend",object:Dd}),Dd=null),this.domElement.style.cursor=yd?"pointer":"auto",this.state=Ad)}function Sd(e){!1!==this.enabled&&e.preventDefault()}function Td(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.isGroup&&(t=e),null===e.parent?t:Td(e.parent,t)}const Md="150",Bd=0,Pd=1,Nd=2,Rd=100,Ld=101,Id=102,kd=200,Od=201,Ud=202,zd=203,Vd=204,Gd=205,Hd=206,jd=207,Wd=208,qd=209,Xd=210,Kd=301,Yd=302,Jd=303,$d=304,Qd=306,Zd=1e3,ep=1001,tp=1002,np=1003,rp=1004,ip=1005,ap=1006,op=1007,sp=1008,up=1009,lp=1014,cp=1015,hp=1016,dp=1020,pp=1023,fp=1026,mp=1027,gp=33776,vp=33777,Dp=33778,yp=33779,Ep=36492,Ap=2300,Cp=2301,_p=2302,bp=2400,xp=2401,Fp=2402,wp=3e3,Sp=3001,Tp="srgb",Mp="srgb-linear",Bp="display-p3",Pp=7680,Np=35044,Rp="300 es",Lp=1035;class Ip{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const kp=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const Op=Math.PI/180,Up=180/Math.PI;function zp(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(kp[255&e]+kp[e>>8&255]+kp[e>>16&255]+kp[e>>24&255]+"-"+kp[255&t]+kp[t>>8&255]+"-"+kp[t>>16&15|64]+kp[t>>24&255]+"-"+kp[63&n|128]+kp[n>>8&255]+"-"+kp[n>>16&255]+kp[n>>24&255]+kp[255&r]+kp[r>>8&255]+kp[r>>16&255]+kp[r>>24&255]).toLowerCase()}function Vp(e,t,n){return Math.max(t,Math.min(n,e))}function Gp(e,t){return(e%t+t)%t}function Hp(e,t,n){return(1-n)*e+n*t}function jp(e){return 0===(e&e-1)&&0!==e}function Wp(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function qp(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Xp(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class Kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Kp.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Yp{constructor(){Yp.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,r,i,a,o,s,u){const l=this.elements;return l[0]=e,l[1]=r,l[2]=o,l[3]=t,l[4]=i,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],D=r[4],y=r[7],E=r[2],A=r[5],C=r[8];return i[0]=a*f+o*v+s*E,i[3]=a*m+o*D+s*A,i[6]=a*g+o*y+s*C,i[1]=u*f+l*v+c*E,i[4]=u*m+l*D+c*A,i[7]=u*g+l*y+c*C,i[2]=h*f+d*v+p*E,i[5]=h*m+d*D+p*A,i[8]=h*g+d*y+p*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*a*l-t*o*u-n*i*l+n*o*s+r*i*u-r*a*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=l*a-o*u,h=o*s-l*i,d=u*i-a*s,p=t*c+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(r*u-l*n)*f,e[2]=(o*n-r*a)*f,e[3]=h*f,e[4]=(l*t-r*s)*f,e[5]=(r*i-o*t)*f,e[6]=d*f,e[7]=(n*s-u*t)*f,e[8]=(a*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,o){const s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-r*u,r*s,-r*(-u*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Jp.makeScale(e,t)),this}rotate(e){return this.premultiply(Jp.makeRotation(-e)),this}translate(e,t){return this.premultiply(Jp.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Jp=new Yp;function $p(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Qp(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}class Zp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,o){let s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3];const h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=l,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(c!==f||s!==h||u!==d||l!==p){let e=1-o;const t=s*h+u*d+l*p+c*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,o=Math.sin(o*a)/i}const i=o*n;if(s=s*e+h*i,u=u*e+d*i,l=l*e+p*i,c=c*e+f*i,e===1-o){const e=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=e,u*=e,l*=e,c*=e}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,r,i,a){const o=n[r],s=n[r+1],u=n[r+2],l=n[r+3],c=i[a],h=i[a+1],d=i[a+2],p=i[a+3];return e[t]=o*p+l*c+s*d-u*h,e[t+1]=s*p+l*h+u*c-o*d,e[t+2]=u*p+l*d+o*h-s*c,e[t+3]=l*p-o*c-s*h-u*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(r/2),c=o(i/2),h=s(n/2),d=s(r/2),p=s(i/2);switch(a){case"XYZ":this._x=h*l*c+u*d*p,this._y=u*d*c-h*l*p,this._z=u*l*p+h*d*c,this._w=u*l*c-h*d*p;break;case"YXZ":this._x=h*l*c+u*d*p,this._y=u*d*c-h*l*p,this._z=u*l*p-h*d*c,this._w=u*l*c+h*d*p;break;case"ZXY":this._x=h*l*c-u*d*p,this._y=u*d*c+h*l*p,this._z=u*l*p+h*d*c,this._w=u*l*c-h*d*p;break;case"ZYX":this._x=h*l*c-u*d*p,this._y=u*d*c+h*l*p,this._z=u*l*p-h*d*c,this._w=u*l*c+h*d*p;break;case"YZX":this._x=h*l*c+u*d*p,this._y=u*d*c+h*l*p,this._z=u*l*p-h*d*c,this._w=u*l*c-h*d*p;break;case"XZY":this._x=h*l*c-u*d*p,this._y=u*d*c-h*l*p,this._z=u*l*p+h*d*c,this._w=u*l*c+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],u=t[2],l=t[6],c=t[10],h=n+o+c;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(l-s)*e,this._y=(i-u)*e,this._z=(a-r)*e}else if(n>o&&n>c){const e=2*Math.sqrt(1+n-o-c);this._w=(l-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+u)/e}else if(o>c){const e=2*Math.sqrt(1+o-n-c);this._w=(i-u)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+l)/e}else{const e=2*Math.sqrt(1+c-n-o);this._w=(a-r)/e,this._x=(i+u)/e,this._y=(s+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+a*o+r*u-i*s,this._y=r*l+a*s+i*o-n*u,this._z=i*l+a*u+n*s-r*o,this._w=a*l-n*o-r*s-i*u,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(s),l=Math.atan2(u,o),c=Math.sin((1-t)*l)/u,h=Math.sin(t*l)/u;return this._w=a*c+this._w*h,this._x=n*c+this._x*h,this._y=r*c+this._y*h,this._z=i*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ef{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;ef.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(nf.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(nf.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*r-o*n,l=s*n+o*t-i*r,c=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return tf.copy(this).projectOnVector(e),this.sub(tf)}reflect(e){return this.sub(tf.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const tf=new ef,nf=new Zp;function rf(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function af(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const of=(new Yp).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),sf=(new Yp).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),uf=new ef;const lf={[Mp]:e=>e,[Tp]:e=>e.convertSRGBToLinear(),[Bp]:function(e){return e.convertSRGBToLinear(),uf.set(e.r,e.g,e.b).applyMatrix3(sf),e.setRGB(uf.x,uf.y,uf.z)}},cf={[Mp]:e=>e,[Tp]:e=>e.convertLinearToSRGB(),[Bp]:function(e){return uf.set(e.r,e.g,e.b).applyMatrix3(of),e.setRGB(uf.x,uf.y,uf.z).convertLinearToSRGB()}},hf={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return Mp},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=lf[t],i=cf[n];if(void 0===r||void 0===i)throw new Error('Unsupported color space conversion, "'.concat(t,'" to "').concat(n,'".'));return i(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let df;class pf{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===df&&(df=Qp("canvas")),df.width=e.width,df.height=e.height;const n=df.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=df}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=Qp("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*rf(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*rf(t[e]/255)):t[e]=rf(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,this.uuid=zp(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(mf(r[t].image)):e.push(mf(r[t]))}else e=mf(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function mf(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?pf.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let gf=0;class vf extends Ip{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vf.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vf.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ep,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ep,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ap,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:sp,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:pp,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:up,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:vf.DEFAULT_ANISOTROPY,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:wp;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gf++}),this.uuid=zp(),this.name="",this.source=new ff(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Kp(0,0),this.repeat=new Kp(1,1),this.center=new Kp(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Yp,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Zd:e.x=e.x-Math.floor(e.x);break;case ep:e.x=e.x<0?0:1;break;case tp:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Zd:e.y=e.y-Math.floor(e.y);break;case ep:e.y=e.y<0?0:1;break;case tp:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}vf.DEFAULT_IMAGE=null,vf.DEFAULT_MAPPING=300,vf.DEFAULT_ANISOTROPY=1;class Df{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Df.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(l-h)<a&&Math.abs(c-f)<a&&Math.abs(p-m)<a){if(Math.abs(l+h)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(u+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(u+1)/2,s=(d+1)/2,v=(g+1)/2,D=(l+h)/4,y=(c+f)/4,E=(p+m)/4;return e>s&&e>v?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=D/n,i=y/n):s>v?s<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=D/r,i=E/r):v<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=y/i,r=E/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-l)*(h-l));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(h-l)/v,this.w=Math.acos((u+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class yf extends Ip{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Df(0,0,e,t),this.scissorTest=!1,this.viewport=new Df(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new vf(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:ap,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ff(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ef extends vf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=np,this.minFilter=np,this.wrapR=ep,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Af extends vf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=np,this.minFilter=np,this.wrapR=ep,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Cf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0;for(let s=0,u=e.length;s<u;s+=3){const u=e[s],l=e[s+1],c=e[s+2];u<t&&(t=u),l<n&&(n=l),c<r&&(r=c),u>i&&(i=u),l>a&&(a=l),c>o&&(o=c)}return this.min.set(t,n,r),this.max.set(i,a,o),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0;for(let s=0,u=e.count;s<u;s++){const u=e.getX(s),l=e.getY(s),c=e.getZ(s);u<t&&(t=u),l<n&&(n=l),c<r&&(r=c),u>i&&(i=u),l>a&&(a=l),c>o&&(o=c)}return this.min.set(t,n,r),this.max.set(i,a,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=bf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&void 0!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,r=t.count;n<r;n++)bf.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(bf)}else null===n.boundingBox&&n.computeBoundingBox(),xf.copy(n.boundingBox),xf.applyMatrix4(e.matrixWorld),this.union(xf);const r=e.children;for(let i=0,a=r.length;i<a;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,bf),bf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Pf),Nf.subVectors(this.max,Pf),Ff.subVectors(e.a,Pf),wf.subVectors(e.b,Pf),Sf.subVectors(e.c,Pf),Tf.subVectors(wf,Ff),Mf.subVectors(Sf,wf),Bf.subVectors(Ff,Sf);let t=[0,-Tf.z,Tf.y,0,-Mf.z,Mf.y,0,-Bf.z,Bf.y,Tf.z,0,-Tf.x,Mf.z,0,-Mf.x,Bf.z,0,-Bf.x,-Tf.y,Tf.x,0,-Mf.y,Mf.x,0,-Bf.y,Bf.x,0];return!!If(t,Ff,wf,Sf,Nf)&&(t=[1,0,0,0,1,0,0,0,1],!!If(t,Ff,wf,Sf,Nf)&&(Rf.crossVectors(Tf,Mf),t=[Rf.x,Rf.y,Rf.z],If(t,Ff,wf,Sf,Nf)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,bf).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(bf).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(_f[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_f[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_f[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_f[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_f[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_f[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_f[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_f[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_f)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _f=[new ef,new ef,new ef,new ef,new ef,new ef,new ef,new ef],bf=new ef,xf=new Cf,Ff=new ef,wf=new ef,Sf=new ef,Tf=new ef,Mf=new ef,Bf=new ef,Pf=new ef,Nf=new ef,Rf=new ef,Lf=new ef;function If(e,t,n,r,i){for(let a=0,o=e.length-3;a<=o;a+=3){Lf.fromArray(e,a);const o=i.x*Math.abs(Lf.x)+i.y*Math.abs(Lf.y)+i.z*Math.abs(Lf.z),s=t.dot(Lf),u=n.dot(Lf),l=r.dot(Lf);if(Math.max(-Math.max(s,u,l),Math.min(s,u,l))>o)return!1}return!0}const kf=new Cf,Of=new ef,Uf=new ef;class zf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):kf.setFromPoints(e).getCenter(n);let r=0;for(let i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Of.subVectors(e,this.center);const t=Of.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Of,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Uf.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Of.copy(e.center).add(Uf)),this.expandByPoint(Of.copy(e.center).sub(Uf))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Vf=new ef,Gf=new ef,Hf=new ef,jf=new ef,Wf=new ef,qf=new ef,Xf=new ef;class Kf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Vf)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Vf.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Vf.copy(this.origin).addScaledVector(this.direction,t),Vf.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Gf.copy(e).add(t).multiplyScalar(.5),Hf.copy(t).sub(e).normalize(),jf.copy(this.origin).sub(Gf);const i=.5*e.distanceTo(t),a=-this.direction.dot(Hf),o=jf.dot(this.direction),s=-jf.dot(Hf),u=jf.lengthSq(),l=Math.abs(1-a*a);let c,h,d,p;if(l>0)if(c=a*s-o,h=a*o-s,p=i*l,c>=0)if(h>=-p)if(h<=p){const e=1/l;c*=e,h*=e,d=c*(c+a*h+2*o)+h*(a*c+h+2*s)+u}else h=i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+u;else h=-i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+u;else h<=-p?(c=Math.max(0,-(-a*i+o)),h=c>0?-i:Math.min(Math.max(-i,-s),i),d=-c*c+h*(h+2*s)+u):h<=p?(c=0,h=Math.min(Math.max(-i,-s),i),d=h*(h+2*s)+u):(c=Math.max(0,-(a*i+o)),h=c>0?i:Math.min(Math.max(-i,-s),i),d=-c*c+h*(h+2*s)+u);else h=a>0?-i:i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,c),r&&r.copy(Gf).addScaledVector(Hf,h),d}intersectSphere(e,t){Vf.subVectors(e.center,this.origin);const n=Vf.dot(this.direction),r=Vf.dot(Vf)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,o,s;const u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),l>=0?(i=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Vf)}intersectTriangle(e,t,n,r,i){Wf.subVectors(t,e),qf.subVectors(n,e),Xf.crossVectors(Wf,qf);let a,o=this.direction.dot(Xf);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}jf.subVectors(this.origin,e);const s=a*this.direction.dot(qf.crossVectors(jf,qf));if(s<0)return null;const u=a*this.direction.dot(Wf.cross(jf));if(u<0)return null;if(s+u>o)return null;const l=-a*jf.dot(Xf);return l<0?null:this.at(l/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Yf{constructor(){Yf.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,r,i,a,o,s,u,l,c,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=u,g[6]=l,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Yf).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Jf.setFromMatrixColumn(e,0).length(),i=1/Jf.setFromMatrixColumn(e,1).length(),a=1/Jf.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){const e=a*l,n=a*c,r=o*l,i=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=n+r*u,t[5]=e-i*u,t[9]=-o*s,t[2]=i-e*u,t[6]=r+n*u,t[10]=a*s}else if("YXZ"===e.order){const e=s*l,n=s*c,r=u*l,i=u*c;t[0]=e+i*o,t[4]=r*o-n,t[8]=a*u,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=n*o-r,t[6]=i+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*l,n=s*c,r=u*l,i=u*c;t[0]=e-i*o,t[4]=-a*c,t[8]=r+n*o,t[1]=n+r*o,t[5]=a*l,t[9]=i-e*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*l,n=a*c,r=o*l,i=o*c;t[0]=s*l,t[4]=r*u-n,t[8]=e*u+i,t[1]=s*c,t[5]=i*u+e,t[9]=n*u-r,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*u,r=o*s,i=o*u;t[0]=s*l,t[4]=i-e*c,t[8]=r*c+n,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-u*l,t[6]=n*c+r,t[10]=e-i*c}else if("XZY"===e.order){const e=a*s,n=a*u,r=o*s,i=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=e*c+i,t[5]=a*l,t[9]=n*c-r,t[2]=r*c-n,t[6]=o*l,t[10]=i*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Qf,e,Zf)}lookAt(e,t,n){const r=this.elements;return nm.subVectors(e,t),0===nm.lengthSq()&&(nm.z=1),nm.normalize(),em.crossVectors(n,nm),0===em.lengthSq()&&(1===Math.abs(n.z)?nm.x+=1e-4:nm.z+=1e-4,nm.normalize(),em.crossVectors(n,nm)),em.normalize(),tm.crossVectors(nm,em),r[0]=em.x,r[4]=tm.x,r[8]=nm.x,r[1]=em.y,r[5]=tm.y,r[9]=nm.y,r[2]=em.z,r[6]=tm.z,r[10]=nm.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],D=n[7],y=n[11],E=n[15],A=r[0],C=r[4],_=r[8],b=r[12],x=r[1],F=r[5],w=r[9],S=r[13],T=r[2],M=r[6],B=r[10],P=r[14],N=r[3],R=r[7],L=r[11],I=r[15];return i[0]=a*A+o*x+s*T+u*N,i[4]=a*C+o*F+s*M+u*R,i[8]=a*_+o*w+s*B+u*L,i[12]=a*b+o*S+s*P+u*I,i[1]=l*A+c*x+h*T+d*N,i[5]=l*C+c*F+h*M+d*R,i[9]=l*_+c*w+h*B+d*L,i[13]=l*b+c*S+h*P+d*I,i[2]=p*A+f*x+m*T+g*N,i[6]=p*C+f*F+m*M+g*R,i[10]=p*_+f*w+m*B+g*L,i[14]=p*b+f*S+m*P+g*I,i[3]=v*A+D*x+y*T+E*N,i[7]=v*C+D*F+y*M+E*R,i[11]=v*_+D*w+y*B+E*L,i[15]=v*b+D*S+y*P+E*I,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*s*c-r*u*c-i*o*h+n*u*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*u*h+i*a*h-r*a*d+r*u*l-i*s*l)+e[11]*(+t*u*c-t*o*d-i*a*c+n*a*d+i*o*l-n*u*l)+e[15]*(-r*o*l-t*s*c+t*o*h+r*a*c-n*a*h+n*s*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*u-f*h*u+f*s*d-o*m*d-c*s*g+o*h*g,D=p*h*u-l*m*u-p*s*d+a*m*d+l*s*g-a*h*g,y=l*f*u-p*c*u+p*o*d-a*f*d-l*o*g+a*c*g,E=p*c*s-l*f*s-p*o*h+a*f*h+l*o*m-a*c*m,A=t*v+n*D+r*y+i*E;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/A;return e[0]=v*C,e[1]=(f*h*i-c*m*i-f*r*d+n*m*d+c*r*g-n*h*g)*C,e[2]=(o*m*i-f*s*i+f*r*u-n*m*u-o*r*g+n*s*g)*C,e[3]=(c*s*i-o*h*i-c*r*u+n*h*u+o*r*d-n*s*d)*C,e[4]=D*C,e[5]=(l*m*i-p*h*i+p*r*d-t*m*d-l*r*g+t*h*g)*C,e[6]=(p*s*i-a*m*i-p*r*u+t*m*u+a*r*g-t*s*g)*C,e[7]=(a*h*i-l*s*i+l*r*u-t*h*u-a*r*d+t*s*d)*C,e[8]=y*C,e[9]=(p*c*i-l*f*i-p*n*d+t*f*d+l*n*g-t*c*g)*C,e[10]=(a*f*i-p*o*i+p*n*u-t*f*u-a*n*g+t*o*g)*C,e[11]=(l*o*i-a*c*i-l*n*u+t*c*u+a*n*d-t*o*d)*C,e[12]=E*C,e[13]=(l*f*r-p*c*r+p*n*h-t*f*h-l*n*m+t*c*m)*C,e[14]=(p*o*r-a*f*r-p*n*s+t*f*s+a*n*m-t*o*m)*C,e[15]=(a*c*r-l*o*r+l*n*s-t*c*s-a*n*h+t*o*h)*C,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,u=i*a,l=i*o;return this.set(u*a+n,u*o-r*s,u*s+r*o,0,u*o+r*s,l*o+n,l*s-r*a,0,u*s-r*o,l*s+r*a,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,u=i+i,l=a+a,c=o+o,h=i*u,d=i*l,p=i*c,f=a*l,m=a*c,g=o*c,v=s*u,D=s*l,y=s*c,E=n.x,A=n.y,C=n.z;return r[0]=(1-(f+g))*E,r[1]=(d+y)*E,r[2]=(p-D)*E,r[3]=0,r[4]=(d-y)*A,r[5]=(1-(h+g))*A,r[6]=(m+v)*A,r[7]=0,r[8]=(p+D)*C,r[9]=(m-v)*C,r[10]=(1-(h+f))*C,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Jf.set(r[0],r[1],r[2]).length();const a=Jf.set(r[4],r[5],r[6]).length(),o=Jf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],$f.copy(this);const s=1/i,u=1/a,l=1/o;return $f.elements[0]*=s,$f.elements[1]*=s,$f.elements[2]*=s,$f.elements[4]*=u,$f.elements[5]*=u,$f.elements[6]*=u,$f.elements[8]*=l,$f.elements[9]*=l,$f.elements[10]*=l,t.setFromRotationMatrix($f),n.x=i,n.y=a,n.z=o,this}makePerspective(e,t,n,r,i,a){const o=this.elements,s=2*i/(t-e),u=2*i/(n-r),l=(t+e)/(t-e),c=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,a){const o=this.elements,s=1/(t-e),u=1/(n-r),l=1/(a-i),c=(t+e)*s,h=(n+r)*u,d=(a+i)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Jf=new ef,$f=new Yf,Qf=new ef(0,0,0),Zf=new ef(1,1,1),em=new ef,tm=new ef,nm=new ef,rm=new Yf,im=new Zp;class am{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:am.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],u=r[5],l=r[9],c=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(Vp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Vp(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(Vp(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-Vp(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Vp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Vp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return rm.makeRotationFromQuaternion(e),this.setFromRotationMatrix(rm,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return im.setFromEuler(this),this.setFromQuaternion(im,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}am.DEFAULT_ORDER="XYZ";class om{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let sm=0;const um=new ef,lm=new Zp,cm=new Yf,hm=new ef,dm=new ef,pm=new ef,fm=new Zp,mm=new ef(1,0,0),gm=new ef(0,1,0),vm=new ef(0,0,1),Dm={type:"added"},ym={type:"removed"};class Em extends Ip{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:sm++}),this.uuid=zp(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Em.DEFAULT_UP.clone();const e=new ef,t=new am,n=new Zp,r=new ef(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Yf},normalMatrix:{value:new Yp}}),this.matrix=new Yf,this.matrixWorld=new Yf,this.matrixAutoUpdate=Em.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Em.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new om,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return lm.setFromAxisAngle(e,t),this.quaternion.multiply(lm),this}rotateOnWorldAxis(e,t){return lm.setFromAxisAngle(e,t),this.quaternion.premultiply(lm),this}rotateX(e){return this.rotateOnAxis(mm,e)}rotateY(e){return this.rotateOnAxis(gm,e)}rotateZ(e){return this.rotateOnAxis(vm,e)}translateOnAxis(e,t){return um.copy(e).applyQuaternion(this.quaternion),this.position.add(um.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(mm,e)}translateY(e){return this.translateOnAxis(gm,e)}translateZ(e){return this.translateOnAxis(vm,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(cm.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?hm.copy(e):hm.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),dm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?cm.lookAt(dm,hm,this.up):cm.lookAt(hm,dm,this.up),this.quaternion.setFromRotationMatrix(cm),r&&(cm.extractRotation(r.matrixWorld),lm.setFromRotationMatrix(cm),this.quaternion.premultiply(lm.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Dm)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(ym)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(ym)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),cm.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),cm.multiply(e.parent.matrixWorld)),e.applyMatrix4(cm),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectsByProperty(e,t);i.length>0&&(n=n.concat(i))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dm,e,pm),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dm,fm,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),o=a(e.images),s=a(e.shapes),u=a(e.skeletons),l=a(e.animations),c=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),u.length>0&&(n.skeletons=u),l.length>0&&(n.animations=l),c.length>0&&(n.nodes=c)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Em.DEFAULT_UP=new ef(0,1,0),Em.DEFAULT_MATRIX_AUTO_UPDATE=!0,Em.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Am=new ef,Cm=new ef,_m=new ef,bm=new ef,xm=new ef,Fm=new ef,wm=new ef,Sm=new ef,Tm=new ef,Mm=new ef;class Bm{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ef;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Am.subVectors(e,t),r.cross(Am);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Am.subVectors(r,t),Cm.subVectors(n,t),_m.subVectors(e,t);const a=Am.dot(Am),o=Am.dot(Cm),s=Am.dot(_m),u=Cm.dot(Cm),l=Cm.dot(_m),c=a*u-o*o;if(0===c)return i.set(-2,-1,-1);const h=1/c,d=(u*s-o*l)*h,p=(a*l-o*s)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,bm),bm.x>=0&&bm.y>=0&&bm.x+bm.y<=1}static getUV(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,bm),s.set(0,0),s.addScaledVector(i,bm.x),s.addScaledVector(a,bm.y),s.addScaledVector(o,bm.z),s}static isFrontFacing(e,t,n,r){return Am.subVectors(n,t),Cm.subVectors(e,t),Am.cross(Cm).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Am.subVectors(this.c,this.b),Cm.subVectors(this.a,this.b),.5*Am.cross(Cm).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Bm.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Bm.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return Bm.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Bm.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Bm.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,o;xm.subVectors(r,n),Fm.subVectors(i,n),Sm.subVectors(e,n);const s=xm.dot(Sm),u=Fm.dot(Sm);if(s<=0&&u<=0)return t.copy(n);Tm.subVectors(e,r);const l=xm.dot(Tm),c=Fm.dot(Tm);if(l>=0&&c<=l)return t.copy(r);const h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return a=s/(s-l),t.copy(n).addScaledVector(xm,a);Mm.subVectors(e,i);const d=xm.dot(Mm),p=Fm.dot(Mm);if(p>=0&&d<=p)return t.copy(i);const f=d*u-s*p;if(f<=0&&u>=0&&p<=0)return o=u/(u-p),t.copy(n).addScaledVector(Fm,o);const m=l*p-d*c;if(m<=0&&c-l>=0&&d-p>=0)return wm.subVectors(i,r),o=(c-l)/(c-l+(d-p)),t.copy(r).addScaledVector(wm,o);const g=1/(m+f+h);return a=f*g,o=h*g,t.copy(n).addScaledVector(xm,a).addScaledVector(Fm,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Pm=0;class Nm extends Ip{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Pm++}),this.uuid=zp(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=Rd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Pp,this.stencilZFail=Pp,this.stencilZPass=Pp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const Rm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Lm={h:0,s:0,l:0},Im={h:0,s:0,l:0};function km(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Om{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tp;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,hf.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:hf.workingColorSpace;return this.r=e,this.g=t,this.b=n,hf.toWorkingColorSpace(this,r),this}setHSL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:hf.workingColorSpace;if(e=Gp(e,1),t=Vp(t,0,1),n=Vp(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=km(i,r,e+1/3),this.g=km(i,r,e),this.b=km(i,r,e-1/3)}return hf.toWorkingColorSpace(this,r),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tp;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=t[1],o=t[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,hf.toWorkingColorSpace(this,n),r(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,hf.toWorkingColorSpace(this,n),r(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const e=parseFloat(i[1])/360,t=parseFloat(i[2])/100,a=parseFloat(i[3])/100;return r(i[4]),this.setHSL(e,t,a,n)}break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=t[1],i=r.length;if(3===i)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,hf.toWorkingColorSpace(this,n),this;if(6===i)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,hf.toWorkingColorSpace(this,n),this;console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tp;const n=Rm[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=rf(e.r),this.g=rf(e.g),this.b=rf(e.b),this}copyLinearToSRGB(e){return this.r=af(e.r),this.g=af(e.g),this.b=af(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tp;return hf.fromWorkingColorSpace(Um.copy(this),e),Vp(255*Um.r,0,255)<<16^Vp(255*Um.g,0,255)<<8^Vp(255*Um.b,0,255)}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tp;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hf.workingColorSpace;hf.fromWorkingColorSpace(Um.copy(this),t);const n=Um.r,r=Um.g,i=Um.b,a=Math.max(n,r,i),o=Math.min(n,r,i);let s,u;const l=(o+a)/2;if(o===a)s=0,u=0;else{const e=a-o;switch(u=l<=.5?e/(a+o):e/(2-a-o),a){case n:s=(r-i)/e+(r<i?6:0);break;case r:s=(i-n)/e+2;break;case i:s=(n-r)/e+4}s/=6}return e.h=s,e.s=u,e.l=l,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hf.workingColorSpace;return hf.fromWorkingColorSpace(Um.copy(this),t),e.r=Um.r,e.g=Um.g,e.b=Um.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tp;hf.fromWorkingColorSpace(Um.copy(this),e);const t=Um.r,n=Um.g,r=Um.b;return e!==Tp?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(255*t|0,",").concat(255*n|0,",").concat(255*r|0,")")}offsetHSL(e,t,n){return this.getHSL(Lm),Lm.h+=e,Lm.s+=t,Lm.l+=n,this.setHSL(Lm.h,Lm.s,Lm.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Lm),e.getHSL(Im);const n=Hp(Lm.h,Im.h,t),r=Hp(Lm.s,Im.s,t),i=Hp(Lm.l,Im.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Um=new Om;Om.NAMES=Rm;class zm extends Nm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Om(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Vm=new ef,Gm=new Kp;class Hm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Np,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Gm.fromBufferAttribute(this,t),Gm.applyMatrix3(e),this.setXY(t,Gm.x,Gm.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Vm.fromBufferAttribute(this,t),Vm.applyMatrix3(e),this.setXYZ(t,Vm.x,Vm.y,Vm.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Vm.fromBufferAttribute(this,t),Vm.applyMatrix4(e),this.setXYZ(t,Vm.x,Vm.y,Vm.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Vm.fromBufferAttribute(this,t),Vm.applyNormalMatrix(e),this.setXYZ(t,Vm.x,Vm.y,Vm.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Vm.fromBufferAttribute(this,t),Vm.transformDirection(e),this.setXYZ(t,Vm.x,Vm.y,Vm.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=qp(t,this.array)),t}setX(e,t){return this.normalized&&(t=Xp(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=qp(t,this.array)),t}setY(e,t){return this.normalized&&(t=Xp(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=qp(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Xp(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=qp(t,this.array)),t}setW(e,t){return this.normalized&&(t=Xp(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Xp(t,this.array),n=Xp(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Xp(t,this.array),n=Xp(n,this.array),r=Xp(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=Xp(t,this.array),n=Xp(n,this.array),r=Xp(r,this.array),i=Xp(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Np&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class jm extends Hm{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Wm extends Hm{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class qm extends Hm{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Xm=0;const Km=new Yf,Ym=new Em,Jm=new ef,$m=new Cf,Qm=new Cf,Zm=new ef;class eg extends Ip{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Xm++}),this.uuid=zp(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($p(e)?Wm:jm)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Yp).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Km.makeRotationFromQuaternion(e),this.applyMatrix4(Km),this}rotateX(e){return Km.makeRotationX(e),this.applyMatrix4(Km),this}rotateY(e){return Km.makeRotationY(e),this.applyMatrix4(Km),this}rotateZ(e){return Km.makeRotationZ(e),this.applyMatrix4(Km),this}translate(e,t,n){return Km.makeTranslation(e,t,n),this.applyMatrix4(Km),this}scale(e,t,n){return Km.makeScale(e,t,n),this.applyMatrix4(Km),this}lookAt(e){return Ym.lookAt(e),Ym.updateMatrix(),this.applyMatrix4(Ym.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Jm).negate(),this.translate(Jm.x,Jm.y,Jm.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new qm(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Cf);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ef(-1/0,-1/0,-1/0),new ef(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];$m.setFromBufferAttribute(e),this.morphTargetsRelative?(Zm.addVectors(this.boundingBox.min,$m.min),this.boundingBox.expandByPoint(Zm),Zm.addVectors(this.boundingBox.max,$m.max),this.boundingBox.expandByPoint(Zm)):(this.boundingBox.expandByPoint($m.min),this.boundingBox.expandByPoint($m.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new zf);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ef,1/0);if(e){const n=this.boundingSphere.center;if($m.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const n=t[e];Qm.setFromBufferAttribute(n),this.morphTargetsRelative?(Zm.addVectors($m.min,Qm.min),$m.expandByPoint(Zm),Zm.addVectors($m.max,Qm.max),$m.expandByPoint(Zm)):($m.expandByPoint(Qm.min),$m.expandByPoint(Qm.max))}$m.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)Zm.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Zm));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],o=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)Zm.fromBufferAttribute(a,t),o&&(Jm.fromBufferAttribute(e,t),Zm.add(Jm)),r=Math.max(r,n.distanceToSquared(Zm))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,a=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Hm(new Float32Array(4*o),4));const s=this.getAttribute("tangent").array,u=[],l=[];for(let x=0;x<o;x++)u[x]=new ef,l[x]=new ef;const c=new ef,h=new ef,d=new ef,p=new Kp,f=new Kp,m=new Kp,g=new ef,v=new ef;function D(e,t,n){c.fromArray(r,3*e),h.fromArray(r,3*t),d.fromArray(r,3*n),p.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*n),h.sub(c),d.sub(c),f.sub(p),m.sub(p);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),u[e].add(g),u[t].add(g),u[n].add(g),l[e].add(v),l[t].add(v),l[n].add(v))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let x=0,F=y.length;x<F;++x){const e=y[x],t=e.start;for(let r=t,i=t+e.count;r<i;r+=3)D(n[r+0],n[r+1],n[r+2])}const E=new ef,A=new ef,C=new ef,_=new ef;function b(e){C.fromArray(i,3*e),_.copy(C);const t=u[e];E.copy(t),E.sub(C.multiplyScalar(C.dot(t))).normalize(),A.crossVectors(_,t);const n=A.dot(l[e])<0?-1:1;s[4*e]=E.x,s[4*e+1]=E.y,s[4*e+2]=E.z,s[4*e+3]=n}for(let x=0,F=y.length;x<F;++x){const e=y[x],t=e.start;for(let r=t,i=t+e.count;r<i;r+=3)b(n[r+0]),b(n[r+1]),b(n[r+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Hm(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new ef,i=new ef,a=new ef,o=new ef,s=new ef,u=new ef,l=new ef,c=new ef;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),l.subVectors(a,i),c.subVectors(r,i),l.cross(c),o.fromBufferAttribute(n,d),s.fromBufferAttribute(n,p),u.fromBufferAttribute(n,f),o.add(l),s.add(l),u.add(l),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(f,u.x,u.y,u.z)}else for(let e=0,h=t.count;e<h;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),l.subVectors(a,i),c.subVectors(r,i),l.cross(c),n.setXYZ(e+0,l.x,l.y,l.z),n.setXYZ(e+1,l.x,l.y,l.z),n.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Zm.fromBufferAttribute(e,t),Zm.normalize(),e.setXYZ(t,Zm.x,Zm.y,Zm.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let o=0,s=0;for(let u=0,l=t.length;u<l;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(let e=0;e<r;e++)a[s++]=n[o++]}return new Hm(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new eg,n=this.index.array,r=this.attributes;for(const o in r){const i=e(r[o],n);t.setAttribute(o,i)}const i=this.morphAttributes;for(const o in i){const r=[],a=i[o];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);r.push(i)}t.morphAttributes[o]=r}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const e=a[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const r={};let i=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];n.push(i.toJSON(e.data))}n.length>0&&(r[s]=n,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const u in r){const e=r[u];this.setAttribute(u,e.clone(t))}const i=e.morphAttributes;for(const u in i){const e=[],n=i[u];for(let r=0,i=n.length;r<i;r++)e.push(n[r].clone(t));this.morphAttributes[u]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,l=a.length;u<l;u++){const e=a[u];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const tg=new Yf,ng=new Kf,rg=new zf,ig=new ef,ag=new ef,og=new ef,sg=new ef,ug=new ef,lg=new ef,cg=new Kp,hg=new Kp,dg=new Kp,pg=new ef,fg=new ef;class mg extends Em{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eg,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new zm;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(i&&o){lg.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],s=i[n];0!==r&&(ug.fromBufferAttribute(s,e),a?lg.addScaledVector(ug,r):lg.addScaledVector(ug.sub(t),r))}t.add(lg)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),rg.copy(n.boundingSphere),rg.applyMatrix4(i),ng.copy(e.ray).recast(e.near),!1===rg.containsPoint(ng.origin)){if(null===ng.intersectSphere(rg,ig))return;if(ng.origin.distanceToSquared(ig)>(e.far-e.near)**2)return}if(tg.copy(i).invert(),ng.copy(e.ray).applyMatrix4(tg),null!==n.boundingBox&&!1===ng.intersectsBox(n.boundingBox))return;let a;const o=n.index,s=n.attributes.position,u=n.attributes.uv,l=n.attributes.uv2,c=n.groups,h=n.drawRange;if(null!==o)if(Array.isArray(r))for(let d=0,p=c.length;d<p;d++){const n=c[d],i=r[n.materialIndex];for(let r=Math.max(n.start,h.start),s=Math.min(o.count,Math.min(n.start+n.count,h.start+h.count));r<s;r+=3){const s=o.getX(r),c=o.getX(r+1),h=o.getX(r+2);a=gg(this,i,e,ng,u,l,s,c,h),a&&(a.faceIndex=Math.floor(r/3),a.face.materialIndex=n.materialIndex,t.push(a))}}else{for(let n=Math.max(0,h.start),i=Math.min(o.count,h.start+h.count);n<i;n+=3){const i=o.getX(n),s=o.getX(n+1),c=o.getX(n+2);a=gg(this,r,e,ng,u,l,i,s,c),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}}else if(void 0!==s)if(Array.isArray(r))for(let d=0,p=c.length;d<p;d++){const n=c[d],i=r[n.materialIndex];for(let r=Math.max(n.start,h.start),o=Math.min(s.count,Math.min(n.start+n.count,h.start+h.count));r<o;r+=3){a=gg(this,i,e,ng,u,l,r,r+1,r+2),a&&(a.faceIndex=Math.floor(r/3),a.face.materialIndex=n.materialIndex,t.push(a))}}else{for(let n=Math.max(0,h.start),i=Math.min(s.count,h.start+h.count);n<i;n+=3){a=gg(this,r,e,ng,u,l,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}}}}function gg(e,t,n,r,i,a,o,s,u){e.getVertexPosition(o,ag),e.getVertexPosition(s,og),e.getVertexPosition(u,sg);const l=function(e,t,n,r,i,a,o,s){let u;if(u=1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,0===t.side,s),null===u)return null;fg.copy(s),fg.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(fg);return l<n.near||l>n.far?null:{distance:l,point:fg.clone(),object:e}}(e,t,n,r,ag,og,sg,pg);if(l){i&&(cg.fromBufferAttribute(i,o),hg.fromBufferAttribute(i,s),dg.fromBufferAttribute(i,u),l.uv=Bm.getUV(pg,ag,og,sg,cg,hg,dg,new Kp)),a&&(cg.fromBufferAttribute(a,o),hg.fromBufferAttribute(a,s),dg.fromBufferAttribute(a,u),l.uv2=Bm.getUV(pg,ag,og,sg,cg,hg,dg,new Kp));const e={a:o,b:s,c:u,normal:new ef,materialIndex:0};Bm.getNormal(ag,og,sg,e.normal),l.face=e}return l}class vg extends eg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const o=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const s=[],u=[],l=[],c=[];let h=0,d=0;function p(e,t,n,r,i,a,p,f,m,g,v){const D=a/m,y=p/g,E=a/2,A=p/2,C=f/2,_=m+1,b=g+1;let x=0,F=0;const w=new ef;for(let o=0;o<b;o++){const a=o*y-A;for(let s=0;s<_;s++){const h=s*D-E;w[e]=h*r,w[t]=a*i,w[n]=C,u.push(w.x,w.y,w.z),w[e]=0,w[t]=0,w[n]=f>0?1:-1,l.push(w.x,w.y,w.z),c.push(s/m),c.push(1-o/g),x+=1}}for(let o=0;o<g;o++)for(let e=0;e<m;e++){const t=h+e+_*o,n=h+e+_*(o+1),r=h+(e+1)+_*(o+1),i=h+(e+1)+_*o;s.push(t,n,i),s.push(n,r,i),F+=6}o.addGroup(d,F,v),d+=F,h+=x}p("z","y","x",-1,-1,n,t,e,a,i,0),p("z","y","x",1,-1,n,t,-e,a,i,1),p("x","z","y",1,1,e,n,t,r,a,2),p("x","z","y",1,-1,e,n,-t,r,a,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new qm(u,3)),this.setAttribute("normal",new qm(l,3)),this.setAttribute("uv",new qm(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vg(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Dg(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function yg(e){const t={};for(let n=0;n<e.length;n++){const r=Dg(e[n]);for(const e in r)t[e]=r[e]}return t}function Eg(e){return null===e.getRenderTarget()&&e.outputEncoding===Sp?Tp:Mp}const Ag={clone:Dg,merge:yg};class Cg extends Nm{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Dg(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class _g extends Em{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Yf,this.projectionMatrix=new Yf,this.projectionMatrixInverse=new Yf}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class bg extends _g{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Up*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Op*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Up*Math.atan(Math.tan(.5*Op*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Op*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const xg=-90;class Fg extends Em{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const r=new bg(xg,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const i=new bg(xg,1,e,t);i.layers=this.layers,i.up.set(0,1,0),i.lookAt(-1,0,0),this.add(i);const a=new bg(xg,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);const o=new bg(xg,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const s=new bg(xg,1,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(0,0,1),this.add(s);const u=new bg(xg,1,e,t);u.layers=this.layers,u.up.set(0,1,0),u.lookAt(0,0,-1),this.add(u)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,a,o,s,u]=this.children,l=e.getRenderTarget(),c=e.toneMapping,h=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(l),e.toneMapping=c,e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class wg extends vf{constructor(e,t,n,r,i,a,o,s,u,l){super(e=void 0!==e?e:[],t=void 0!==t?t:Kd,n,r,i,a,o,s,u,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Sg extends yf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new wg(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ap}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new vg(5,5,5),o=new Cg({name:"CubemapFromEquirect",uniforms:Dg(n),vertexShader:r,fragmentShader:i,side:1,blending:0});o.uniforms.tEquirect.value=t;const s=new mg(a,o),u=t.minFilter;t.minFilter===sp&&(t.minFilter=ap);return new Fg(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}const Tg=new ef,Mg=new ef,Bg=new Yp;class Pg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Tg.subVectors(n,t).cross(Mg.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Tg),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Bg.getNormalMatrix(e),r=this.coplanarPoint(Tg).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Ng=new zf,Rg=new ef;class Lg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pg,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pg,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Pg,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Pg,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Pg,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Pg;this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],D=n[15];return t[0].setComponents(o-r,c-s,f-h,D-m).normalize(),t[1].setComponents(o+r,c+s,f+h,D+m).normalize(),t[2].setComponents(o+i,c+u,f+d,D+g).normalize(),t[3].setComponents(o-i,c-u,f-d,D-g).normalize(),t[4].setComponents(o-a,c-l,f-p,D-v).normalize(),t[5].setComponents(o+a,c+l,f+p,D+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Ng.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ng)}intersectsSprite(e){return Ng.center.set(0,0,0),Ng.radius=.7071067811865476,Ng.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ng)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Rg.x=r.normal.x>0?e.max.x:e.min.x,Rg.y=r.normal.y>0?e.max.y:e.min.y,Rg.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Rg)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ig(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function kg(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=r.get(t);void 0===a?r.set(t,function(t,r){const i=t.array,a=t.usage,o=e.createBuffer();let s;if(e.bindBuffer(r,o),e.bufferData(r,i,a),t.onUploadCallback(),i instanceof Float32Array)s=5126;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");s=5131}else s=5123;else if(i instanceof Int16Array)s=5122;else if(i instanceof Uint32Array)s=5125;else if(i instanceof Int32Array)s=5124;else if(i instanceof Int8Array)s=5120;else if(i instanceof Uint8Array)s=5121;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);s=5121}return{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):a.version<t.version&&(!function(t,r,i){const a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),r.onUploadCallback()}(a.buffer,t,i),a.version=t.version)}}}class Og extends eg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,o=Math.floor(n),s=Math.floor(r),u=o+1,l=s+1,c=e/o,h=t/s,d=[],p=[],f=[],m=[];for(let g=0;g<l;g++){const e=g*h-a;for(let t=0;t<u;t++){const n=t*c-i;p.push(n,-e,0),f.push(0,0,1),m.push(t/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let e=0;e<o;e++){const t=e+u*g,n=e+u*(g+1),r=e+1+u*(g+1),i=e+1+u*g;d.push(t,n,i),d.push(n,r,i)}this.setIndex(d),this.setAttribute("position",new qm(p,3)),this.setAttribute("normal",new qm(f,3)),this.setAttribute("uv",new qm(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Og(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ug={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\t\n\t\tvec2 lodFudge = pow( 1.95, lod ) / fullSize;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec2 fullSize = vec2( textureSize( sampler, 0 ) );\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},zg={common:{diffuse:{value:new Om(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Yp},uv2Transform:{value:new Yp},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Kp(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Om(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Om(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Yp}},sprite:{diffuse:{value:new Om(16777215)},opacity:{value:1},center:{value:new Kp(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Yp}}},Vg={basic:{uniforms:yg([zg.common,zg.specularmap,zg.envmap,zg.aomap,zg.lightmap,zg.fog]),vertexShader:Ug.meshbasic_vert,fragmentShader:Ug.meshbasic_frag},lambert:{uniforms:yg([zg.common,zg.specularmap,zg.envmap,zg.aomap,zg.lightmap,zg.emissivemap,zg.bumpmap,zg.normalmap,zg.displacementmap,zg.fog,zg.lights,{emissive:{value:new Om(0)}}]),vertexShader:Ug.meshlambert_vert,fragmentShader:Ug.meshlambert_frag},phong:{uniforms:yg([zg.common,zg.specularmap,zg.envmap,zg.aomap,zg.lightmap,zg.emissivemap,zg.bumpmap,zg.normalmap,zg.displacementmap,zg.fog,zg.lights,{emissive:{value:new Om(0)},specular:{value:new Om(1118481)},shininess:{value:30}}]),vertexShader:Ug.meshphong_vert,fragmentShader:Ug.meshphong_frag},standard:{uniforms:yg([zg.common,zg.envmap,zg.aomap,zg.lightmap,zg.emissivemap,zg.bumpmap,zg.normalmap,zg.displacementmap,zg.roughnessmap,zg.metalnessmap,zg.fog,zg.lights,{emissive:{value:new Om(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ug.meshphysical_vert,fragmentShader:Ug.meshphysical_frag},toon:{uniforms:yg([zg.common,zg.aomap,zg.lightmap,zg.emissivemap,zg.bumpmap,zg.normalmap,zg.displacementmap,zg.gradientmap,zg.fog,zg.lights,{emissive:{value:new Om(0)}}]),vertexShader:Ug.meshtoon_vert,fragmentShader:Ug.meshtoon_frag},matcap:{uniforms:yg([zg.common,zg.bumpmap,zg.normalmap,zg.displacementmap,zg.fog,{matcap:{value:null}}]),vertexShader:Ug.meshmatcap_vert,fragmentShader:Ug.meshmatcap_frag},points:{uniforms:yg([zg.points,zg.fog]),vertexShader:Ug.points_vert,fragmentShader:Ug.points_frag},dashed:{uniforms:yg([zg.common,zg.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ug.linedashed_vert,fragmentShader:Ug.linedashed_frag},depth:{uniforms:yg([zg.common,zg.displacementmap]),vertexShader:Ug.depth_vert,fragmentShader:Ug.depth_frag},normal:{uniforms:yg([zg.common,zg.bumpmap,zg.normalmap,zg.displacementmap,{opacity:{value:1}}]),vertexShader:Ug.meshnormal_vert,fragmentShader:Ug.meshnormal_frag},sprite:{uniforms:yg([zg.sprite,zg.fog]),vertexShader:Ug.sprite_vert,fragmentShader:Ug.sprite_frag},background:{uniforms:{uvTransform:{value:new Yp},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ug.background_vert,fragmentShader:Ug.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ug.backgroundCube_vert,fragmentShader:Ug.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ug.cube_vert,fragmentShader:Ug.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ug.equirect_vert,fragmentShader:Ug.equirect_frag},distanceRGBA:{uniforms:yg([zg.common,zg.displacementmap,{referencePosition:{value:new ef},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ug.distanceRGBA_vert,fragmentShader:Ug.distanceRGBA_frag},shadow:{uniforms:yg([zg.lights,zg.fog,{color:{value:new Om(0)},opacity:{value:1}}]),vertexShader:Ug.shadow_vert,fragmentShader:Ug.shadow_frag}};Vg.physical={uniforms:yg([Vg.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Kp(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Om(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Kp},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Om(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Om(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ug.meshphysical_vert,fragmentShader:Ug.meshphysical_frag};const Gg={r:0,b:0,g:0};function Hg(e,t,n,r,i,a,o){const s=new Om(0);let u,l,c=!0===a?0:1,h=null,d=0,p=null;function f(t,n){t.getRGB(Gg,Eg(e)),r.buffers.color.setClear(Gg.r,Gg.g,Gg.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),c=t,f(s,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,f(s,c)},render:function(r,a){let o=!1,m=!0===a.isScene?a.background:null;if(m&&m.isTexture){m=(a.backgroundBlurriness>0?n:t).get(m)}const g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?f(s,c):m&&m.isColor&&(f(m,1),o=!0),(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===Qd)?(void 0===l&&(l=new mg(new vg(1,1,1),new Cg({name:"BackgroundCubeMaterial",uniforms:Dg(Vg.backgroundCube.uniforms),vertexShader:Vg.backgroundCube.vertexShader,fragmentShader:Vg.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=a.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,l.material.toneMapped=m.encoding!==Sp,h===m&&d===m.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=m,d=m.version,p=e.toneMapping),l.layers.enableAll(),r.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===u&&(u=new mg(new Og(2,2),new Cg({name:"BackgroundMaterial",uniforms:Dg(Vg.background.uniforms),vertexShader:Vg.background.vertexShader,fragmentShader:Vg.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=m,u.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,u.material.toneMapped=m.encoding!==Sp,!0===m.matrixAutoUpdate&&m.updateMatrix(),u.material.uniforms.uvTransform.value.copy(m.matrix),h===m&&d===m.version&&p===e.toneMapping||(u.material.needsUpdate=!0,h=m,d=m.version,p=e.toneMapping),u.layers.enableAll(),r.unshift(u,u.geometry,u.material,0,0,null))}}}function jg(e,t,n,r){const i=e.getParameter(34921),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},u=p(null);let l=u,c=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],r=[];for(let a=0;a<i;a++)t[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){const e=l.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,i){const a=l.newAttributes,o=l.enabledAttributes,s=l.attributeDivisors;if(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i}}function v(){const t=l.newAttributes,n=l.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function D(t,n,i,a,o,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,a,o,s):e.vertexAttribIPointer(t,n,i,o,s)}function y(){E(),c=!0,l!==u&&(l=u,h(l.object))}function E(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(i,u,d,y,E){let A=!1;if(o){const t=function(t,n,i){const o=!0===i.wireframe;let u=s[t.id];void 0===u&&(u={},s[t.id]=u);let l=u[n.id];void 0===l&&(l={},u[n.id]=l);let c=l[o];void 0===c&&(c=p(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),l[o]=c);return c}(y,d,u);l!==t&&(l=t,h(l.object)),A=function(e,t,n,r){const i=l.attributes,a=t.attributes;let o=0;const s=n.getAttributes();for(const u in s){if(s[u].location>=0){const t=i[u];let n=a[u];if(void 0===n&&("instanceMatrix"===u&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return l.attributesNum!==o||l.index!==r}(i,y,d,E),A&&function(e,t,n,r){const i={},a=t.attributes;let o=0;const s=n.getAttributes();for(const u in s){if(s[u].location>=0){let t=a[u];void 0===t&&("instanceMatrix"===u&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),i[u]=n,o++}}l.attributes=i,l.attributesNum=o,l.index=r}(i,y,d,E)}else{const e=!0===u.wireframe;l.geometry===y.id&&l.program===d.id&&l.wireframe===e||(l.geometry=y.id,l.program=d.id,l.wireframe=e,A=!0)}null!==E&&n.update(E,34963),(A||c)&&(c=!1,function(i,a,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const u=s.attributes,l=o.getAttributes(),c=a.defaultAttributeValues;for(const t in l){const r=l[t];if(r.location>=0){let a=u[t];if(void 0===a&&("instanceMatrix"===t&&i.instanceMatrix&&(a=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(a=i.instanceColor)),void 0!==a){const t=a.normalized,o=a.itemSize,u=n.get(a);if(void 0===u)continue;const l=u.buffer,c=u.type,h=u.bytesPerElement;if(a.isInterleavedBufferAttribute){const n=a.data,u=n.stride,d=a.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)g(r.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<r.locationSize;e++)m(r.location+e);e.bindBuffer(34962,l);for(let e=0;e<r.locationSize;e++)D(r.location+e,o/r.locationSize,c,t,u*h,(d+o/r.locationSize*e)*h)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)g(r.location+e,a.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<r.locationSize;e++)m(r.location+e);e.bindBuffer(34962,l);for(let e=0;e<r.locationSize;e++)D(r.location+e,o/r.locationSize,c,t,o*h,o/r.locationSize*e*h)}}else if(void 0!==c){const n=c[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r.location,n);break;case 3:e.vertexAttrib3fv(r.location,n);break;case 4:e.vertexAttrib4fv(r.location,n);break;default:e.vertexAttrib1fv(r.location,n)}}}}v()}(i,u,d,y),null!==E&&e.bindBuffer(34963,n.get(E).buffer))},reset:y,resetDefaultState:E,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const n in t){const e=t[n];for(const t in e)d(e[t].object),delete e[t];delete t[n]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)d(r[e].object),delete r[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function Wg(e,t,n,r){const i=r.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,o,s){if(0===s)return;let u,l;if(i)u=e,l="drawArraysInstanced";else if(u=t.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===u)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](a,r,o,s),n.update(o,a,s)}}function qg(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext;let o=void 0!==n.precision?n.precision:"highp";const s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const u=a||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),D=h>0,y=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:D,floatFragmentTextures:y,floatVertexTextures:D&&y,maxSamples:a?e.getParameter(36183):0}}function Xg(e){const t=this;let n=null,r=0,i=!1,a=!1;const o=new Pg,s=new Yp,u={value:null,needsUpdate:!1};function l(e,n,r,i){const a=null!==e?e.length:0;let l=null;if(0!==a){if(l=u.value,!0!==i||null===l){const t=r+4*a,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===l||l.length<t)&&(l=new Float32Array(t));for(let n=0,u=r;n!==a;++n,u+=4)o.copy(e[n]).applyMatrix4(i,s),o.normal.toArray(l,u),l[u+3]=o.constant}u.value=l,u.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,l(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=l(e,t,0)},this.setState=function(o,s,c){const h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=e.get(o);if(!i||null===h||0===h.length||a&&!p)a?l(null):function(){u.value!==n&&(u.value=n,u.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=a?0:r,t=4*e;let i=f.clippingState||null;u.value=i,i=l(h,s,t,c);for(let r=0;r!==t;++r)i[r]=n[r];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Kg(e){let t=new WeakMap;function n(e,t){return t===Jd?e.mapping=Kd:t===$d&&(e.mapping=Yd),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const a=i.mapping;if(a===Jd||a===$d){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const a=i.image;if(a&&a.height>0){const o=new Sg(a.height/2);return o.fromEquirectangularTexture(e,i),t.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class Yg extends _g{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const Jg=[.125,.215,.35,.446,.526,.582],$g=20,Qg=new Yg,Zg=new Om;let ev=null;const tv=(1+Math.sqrt(5))/2,nv=1/tv,rv=[new ef(1,1,1),new ef(-1,1,1),new ef(1,1,-1),new ef(-1,1,-1),new ef(0,tv,nv),new ef(0,tv,-nv),new ef(nv,0,tv),new ef(-nv,0,tv),new ef(tv,nv,0),new ef(-tv,nv,0)];class iv{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;ev=this._renderer.getRenderTarget(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=uv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=sv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ev),e.scissorTest=!1,ov(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Kd||e.mapping===Yd?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ev=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ap,minFilter:ap,generateMipmaps:!1,type:hp,format:pp,encoding:wp,depthBuffer:!1},r=av(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=av(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+Jg.length;for(let o=0;o<a;o++){const a=Math.pow(2,i);n.push(a);let s=1/a;o>e-4?s=Jg[o-e+4-1]:0===o&&(s=0),r.push(s);const u=1/(a-2),l=-u,c=1+u,h=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),D=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,f*p*e),D.set(h,m*p*e);const i=[e,e,e,e,e,e];y.set(i,g*p*e)}const E=new eg;E.setAttribute("position",new Hm(v,f)),E.setAttribute("uv",new Hm(D,m)),E.setAttribute("faceIndex",new Hm(y,g)),t.push(E),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array($g),i=new ef(0,1,0),a=new Cg({name:"SphericalGaussianBlur",defines:{n:$g,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return a}(r,e,t)}return r}_compileMaterial(e){const t=new mg(this._lodPlanes[0],e);this._renderer.compile(t,Qg)}_sceneToCubeUV(e,t,n,r){const i=new bg(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,l=s.toneMapping;s.getClearColor(Zg),s.toneMapping=0,s.autoClear=!1;const c=new zm({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new mg(new vg,c);let d=!1;const p=e.background;p?p.isColor&&(c.color.copy(p),e.background=null,d=!0):(c.color.copy(Zg),d=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(i.up.set(0,a[f],0),i.lookAt(o[f],0,0)):1===t?(i.up.set(0,0,a[f]),i.lookAt(0,o[f],0)):(i.up.set(0,a[f],0),i.lookAt(0,0,o[f]));const n=this._cubeSize;ov(r,t*n,f>2?n:0,n,n),s.setRenderTarget(r),d&&s.render(h,i),s.render(e,i)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=l,s.autoClear=u,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Kd||e.mapping===Yd;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=uv()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=sv());const i=r?this._cubemapMaterial:this._equirectMaterial,a=new mg(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const o=this._cubeSize;ov(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,Qg)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=rv[(r-1)%rv.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new mg(this._lodPlanes[r],u),c=u.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):$g;f>$g&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat($g));const m=[];let g=0;for(let y=0;y<$g;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const D=this._sizeLods[r];ov(t,3*D*(r>v-4?r-v+4:0),4*(this._cubeSize-D),3*D,2*D),s.setRenderTarget(t),s.render(l,Qg)}}function av(e,t,n){const r=new yf(e,t,n);return r.texture.mapping=Qd,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function ov(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function sv(){return new Cg({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function uv(){return new Cg({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function lv(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,o=a===Jd||a===$d,s=a===Kd||a===Yd;if(o||s){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=t.get(i);return null===n&&(n=new iv(e)),r=o?n.fromEquirectangular(i,r):n.fromCubemap(i,r),t.set(i,r),r.texture}if(t.has(i))return t.get(i).texture;{const a=i.image;if(o&&a&&a.height>0||s&&a&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(a)){null===n&&(n=new iv(e));const a=o?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,a),i.addEventListener("dispose",r),a.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function cv(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function hv(e,t,n,r){const i={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);s.removeEventListener("dispose",o),delete i[s.id];const u=a.get(s);u&&(t.remove(u),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{const e=i.array;o=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const s=new($p(n)?Wm:jm)(n,1);s.version=o;const u=a.get(e);u&&t.remove(u),a.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const i in n)t.update(n[i],34962);const r=e.morphAttributes;for(const i in r){const e=r[i];for(let n=0,r=e.length;n<r;n++)t.update(e[n],34962)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function dv(e,t,n,r){const i=r.isWebGL2;let a,o,s;this.setMode=function(e){a=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,o,t*s),n.update(r,a,1)},this.renderInstances=function(r,u,l){if(0===l)return;let c,h;if(i)c=e,h="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](a,u,o,r*s,l),n.update(u,a,l)}}function pv(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function fv(e,t){return e[0]-t[0]}function mv(e,t){return Math.abs(t[1])-Math.abs(e[1])}function gv(e,t,n){const r={},i=new Float32Array(8),a=new WeakMap,o=new Df,s=[];for(let u=0;u<8;u++)s[u]=[u,0];return{update:function(u,l,c){const h=u.morphTargetInfluences;if(!0===t.isWebGL2){const d=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,p=void 0!==d?d.length:0;let f=a.get(l);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const v=void 0!==l.morphAttributes.position,D=void 0!==l.morphAttributes.normal,y=void 0!==l.morphAttributes.color,E=l.morphAttributes.position||[],A=l.morphAttributes.normal||[],C=l.morphAttributes.color||[];let _=0;!0===v&&(_=1),!0===D&&(_=2),!0===y&&(_=3);let b=l.attributes.position.count*_,x=1;b>t.maxTextureSize&&(x=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);const F=new Float32Array(b*x*4*p),w=new Ef(F,b,x,p);w.type=cp,w.needsUpdate=!0;const S=4*_;for(let M=0;M<p;M++){const B=E[M],P=A[M],N=C[M],R=b*x*4*M;for(let L=0;L<B.count;L++){const I=L*S;!0===v&&(o.fromBufferAttribute(B,L),F[R+I+0]=o.x,F[R+I+1]=o.y,F[R+I+2]=o.z,F[R+I+3]=0),!0===D&&(o.fromBufferAttribute(P,L),F[R+I+4]=o.x,F[R+I+5]=o.y,F[R+I+6]=o.z,F[R+I+7]=0),!0===y&&(o.fromBufferAttribute(N,L),F[R+I+8]=o.x,F[R+I+9]=o.y,F[R+I+10]=o.z,F[R+I+11]=4===N.itemSize?o.w:1)}}function T(){w.dispose(),a.delete(l),l.removeEventListener("dispose",T)}f={count:p,texture:w,size:new Kp(b,x)},a.set(l,f),l.addEventListener("dispose",T)}let m=0;for(let k=0;k<h.length;k++)m+=h[k];const g=l.morphTargetsRelative?1:1-m;c.getUniforms().setValue(e,"morphTargetBaseInfluence",g),c.getUniforms().setValue(e,"morphTargetInfluences",h),c.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),c.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const O=void 0===h?0:h.length;let U=r[l.id];if(void 0===U||U.length!==O){U=[];for(let j=0;j<O;j++)U[j]=[j,0];r[l.id]=U}for(let W=0;W<O;W++){const q=U[W];q[0]=W,q[1]=h[W]}U.sort(mv);for(let X=0;X<8;X++)X<O&&U[X][1]?(s[X][0]=U[X][0],s[X][1]=U[X][1]):(s[X][0]=Number.MAX_SAFE_INTEGER,s[X][1]=0);s.sort(fv);const z=l.morphAttributes.position,V=l.morphAttributes.normal;let G=0;for(let K=0;K<8;K++){const Y=s[K],J=Y[0],$=Y[1];J!==Number.MAX_SAFE_INTEGER&&$?(z&&l.getAttribute("morphTarget"+K)!==z[J]&&l.setAttribute("morphTarget"+K,z[J]),V&&l.getAttribute("morphNormal"+K)!==V[J]&&l.setAttribute("morphNormal"+K,V[J]),i[K]=$,G+=$):(z&&!0===l.hasAttribute("morphTarget"+K)&&l.deleteAttribute("morphTarget"+K),V&&!0===l.hasAttribute("morphNormal"+K)&&l.deleteAttribute("morphNormal"+K),i[K]=0)}const H=l.morphTargetsRelative?1:1-G;c.getUniforms().setValue(e,"morphTargetBaseInfluence",H),c.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function vv(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const o=r.render.frame,s=e.geometry,u=t.get(e,s);return i.get(u)!==o&&(t.update(u),i.set(u,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),u},dispose:function(){i=new WeakMap}}}const Dv=new vf,yv=new Ef,Ev=new Af,Av=new wg,Cv=[],_v=[],bv=new Float32Array(16),xv=new Float32Array(9),Fv=new Float32Array(4);function wv(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=Cv[i];if(void 0===a&&(a=new Float32Array(i),Cv[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function Sv(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Tv(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Mv(e,t){let n=_v[t];void 0===n&&(n=new Int32Array(t),_v[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Bv(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Pv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Sv(n,t))return;e.uniform2fv(this.addr,t),Tv(n,t)}}function Nv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Sv(n,t))return;e.uniform3fv(this.addr,t),Tv(n,t)}}function Rv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Sv(n,t))return;e.uniform4fv(this.addr,t),Tv(n,t)}}function Lv(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Sv(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Tv(n,t)}else{if(Sv(n,r))return;Fv.set(r),e.uniformMatrix2fv(this.addr,!1,Fv),Tv(n,r)}}function Iv(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Sv(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Tv(n,t)}else{if(Sv(n,r))return;xv.set(r),e.uniformMatrix3fv(this.addr,!1,xv),Tv(n,r)}}function kv(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Sv(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Tv(n,t)}else{if(Sv(n,r))return;bv.set(r),e.uniformMatrix4fv(this.addr,!1,bv),Tv(n,r)}}function Ov(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Uv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Sv(n,t))return;e.uniform2iv(this.addr,t),Tv(n,t)}}function zv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Sv(n,t))return;e.uniform3iv(this.addr,t),Tv(n,t)}}function Vv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Sv(n,t))return;e.uniform4iv(this.addr,t),Tv(n,t)}}function Gv(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Hv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Sv(n,t))return;e.uniform2uiv(this.addr,t),Tv(n,t)}}function jv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Sv(n,t))return;e.uniform3uiv(this.addr,t),Tv(n,t)}}function Wv(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Sv(n,t))return;e.uniform4uiv(this.addr,t),Tv(n,t)}}function qv(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||Dv,i)}function Xv(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Ev,i)}function Kv(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Av,i)}function Yv(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||yv,i)}function Jv(e,t){e.uniform1fv(this.addr,t)}function $v(e,t){const n=wv(t,this.size,2);e.uniform2fv(this.addr,n)}function Qv(e,t){const n=wv(t,this.size,3);e.uniform3fv(this.addr,n)}function Zv(e,t){const n=wv(t,this.size,4);e.uniform4fv(this.addr,n)}function eD(e,t){const n=wv(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function tD(e,t){const n=wv(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function nD(e,t){const n=wv(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function rD(e,t){e.uniform1iv(this.addr,t)}function iD(e,t){e.uniform2iv(this.addr,t)}function aD(e,t){e.uniform3iv(this.addr,t)}function oD(e,t){e.uniform4iv(this.addr,t)}function sD(e,t){e.uniform1uiv(this.addr,t)}function uD(e,t){e.uniform2uiv(this.addr,t)}function lD(e,t){e.uniform3uiv(this.addr,t)}function cD(e,t){e.uniform4uiv(this.addr,t)}function hD(e,t,n){const r=this.cache,i=t.length,a=Mv(n,i);Sv(r,a)||(e.uniform1iv(this.addr,a),Tv(r,a));for(let o=0;o!==i;++o)n.setTexture2D(t[o]||Dv,a[o])}function dD(e,t,n){const r=this.cache,i=t.length,a=Mv(n,i);Sv(r,a)||(e.uniform1iv(this.addr,a),Tv(r,a));for(let o=0;o!==i;++o)n.setTexture3D(t[o]||Ev,a[o])}function pD(e,t,n){const r=this.cache,i=t.length,a=Mv(n,i);Sv(r,a)||(e.uniform1iv(this.addr,a),Tv(r,a));for(let o=0;o!==i;++o)n.setTextureCube(t[o]||Av,a[o])}function fD(e,t,n){const r=this.cache,i=t.length,a=Mv(n,i);Sv(r,a)||(e.uniform1iv(this.addr,a),Tv(r,a));for(let o=0;o!==i;++o)n.setTexture2DArray(t[o]||yv,a[o])}class mD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Bv;case 35664:return Pv;case 35665:return Nv;case 35666:return Rv;case 35674:return Lv;case 35675:return Iv;case 35676:return kv;case 5124:case 35670:return Ov;case 35667:case 35671:return Uv;case 35668:case 35672:return zv;case 35669:case 35673:return Vv;case 5125:return Gv;case 36294:return Hv;case 36295:return jv;case 36296:return Wv;case 35678:case 36198:case 36298:case 36306:case 35682:return qv;case 35679:case 36299:case 36307:return Xv;case 35680:case 36300:case 36308:case 36293:return Kv;case 36289:case 36303:case 36311:case 36292:return Yv}}(t.type)}}class gD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Jv;case 35664:return $v;case 35665:return Qv;case 35666:return Zv;case 35674:return eD;case 35675:return tD;case 35676:return nD;case 5124:case 35670:return rD;case 35667:case 35671:return iD;case 35668:case 35672:return aD;case 35669:case 35673:return oD;case 5125:return sD;case 36294:return uD;case 36295:return lD;case 36296:return cD;case 35678:case 36198:case 36298:case 36306:case 35682:return hD;case 35679:case 36299:case 36307:return dD;case 35680:case 36300:case 36308:case 36293:return pD;case 36289:case 36303:case 36311:case 36292:return fD}}(t.type)}}class vD{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}const DD=/(\w+)(\])?(\[|\.)?/g;function yD(e,t){e.seq.push(t),e.map[t.id]=t}function ED(e,t,n){const r=e.name,i=r.length;for(DD.lastIndex=0;;){const a=DD.exec(r),o=DD.lastIndex;let s=a[1];const u="]"===a[2],l=a[3];if(u&&(s|=0),void 0===l||"["===l&&o+2===i){yD(n,void 0===l?new mD(s,e,t):new gD(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new vD(s),yD(n,e)),n=e}}}class AD{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);ED(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function CD(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let _D=0;function bD(e,t,n){const r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=i;o<a;o++){const e=o+1;r.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),r)}return i}function xD(e,t){const n=function(e){switch(e){case wp:return["Linear","( value )"];case Sp:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function FD(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function wD(e){return""!==e}function SD(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function TD(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const MD=/^[ \t]*#include +<([\w\d./]+)>/gm;function BD(e){return e.replace(MD,PD)}function PD(e,t){const n=Ug[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return BD(n)}const ND=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function RD(e){return e.replace(ND,LD)}function LD(e,t,n,r){let i="";for(let a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function ID(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function kD(e,t,n,r){const i=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const u=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Kd:case Yd:t="ENVMAP_TYPE_CUBE";break;case Qd:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),c=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Yd&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(wD).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),m=i.createProgram();let g,v,D=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(wD).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(wD).join("\n"),v.length>0&&(v+="\n")):(g=[ID(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(wD).join("\n"),v=[p,ID(n),"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Ug.tonemapping_pars_fragment:"",0!==n.toneMapping?FD("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ug.encodings_pars_fragment,xD("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(wD).join("\n")),o=BD(o),o=SD(o,n),o=TD(o,n),s=BD(s),s=SD(s,n),s=TD(s,n),o=RD(o),s=RD(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(D="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===Rp?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Rp?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=D+v+s,E=CD(i,35633,D+g+o),A=CD(i,35632,y);if(i.attachShader(m,E),i.attachShader(m,A),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),e.debug.checkShaderErrors){const e=i.getProgramInfoLog(m).trim(),t=i.getShaderInfoLog(E).trim(),n=i.getShaderInfoLog(A).trim();let r=!0,a=!0;if(!1===i.getProgramParameter(m,35714)){r=!1;const t=bD(i,E,"vertex"),n=bD(i,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(a=!1);a&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let C,_;return i.deleteShader(E),i.deleteShader(A),this.getUniforms=function(){return void 0===C&&(C=new AD(i,m)),C},this.getAttributes=function(){return void 0===_&&(_=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let o=1;35674===r.type&&(o=2),35675===r.type&&(o=3),35676===r.type&&(o=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:o}}return n}(i,m)),_},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=_D++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=E,this.fragmentShader=A,this}let OD=0;class UD{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new zD(e),t.set(e,n)),n}}class zD{constructor(e){this.id=OD++,this.code=e,this.usedTimes=0}}function VD(e,t,n,r,i,a,o){const s=new om,u=new UD,l=[],c=i.isWebGL2,h=i.logarithmicDepthBuffer,d=i.vertexTextures;let p=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(a,s,l,m,g){const v=m.fog,D=g.geometry,y=a.isMeshStandardMaterial?m.environment:null,E=(a.isMeshStandardMaterial?n:t).get(a.envMap||y),A=E&&E.mapping===Qd?E.image.height:null,C=f[a.type];null!==a.precision&&(p=i.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));const _=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,b=void 0!==_?_.length:0;let x,F,w,S,T=0;if(void 0!==D.morphAttributes.position&&(T=1),void 0!==D.morphAttributes.normal&&(T=2),void 0!==D.morphAttributes.color&&(T=3),C){const e=Vg[C];x=e.vertexShader,F=e.fragmentShader}else x=a.vertexShader,F=a.fragmentShader,u.update(a),w=u.getVertexShaderID(a),S=u.getFragmentShaderID(a);const M=e.getRenderTarget(),B=a.alphaTest>0,P=a.clearcoat>0,N=a.iridescence>0;return{isWebGL2:c,shaderID:C,shaderName:a.type,vertexShader:x,fragmentShader:F,defines:a.defines,customVertexShaderID:w,customFragmentShaderID:S,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:d,outputEncoding:null===M?e.outputEncoding:!0===M.isXRRenderTarget?M.texture.encoding:wp,map:!!a.map,matcap:!!a.matcap,envMap:!!E,envMapMode:E&&E.mapping,envMapCubeUVHeight:A,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:1===a.normalMapType,tangentSpaceNormalMap:0===a.normalMapType,decodeVideoTexture:!!a.map&&!0===a.map.isVideoTexture&&a.map.encoding===Sp,clearcoat:P,clearcoatMap:P&&!!a.clearcoatMap,clearcoatRoughnessMap:P&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!a.clearcoatNormalMap,iridescence:N,iridescenceMap:N&&!!a.iridescenceMap,iridescenceThicknessMap:N&&!!a.iridescenceThicknessMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,opaque:!1===a.transparent&&1===a.blending,alphaMap:!!a.alphaMap,alphaTest:B,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!D.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!D.attributes.color&&4===D.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.iridescenceMap||!!a.iridescenceThicknessMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||!!a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!v,useFog:!0===a.fog,fogExp2:v&&v.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==D.morphAttributes.position,morphNormals:void 0!==D.morphAttributes.normal,morphColors:void 0!==D.morphAttributes.color,morphTargetsCount:b,morphTextureStride:T,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:0,useLegacyLights:e.useLegacyLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:!!a.depthPacking,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.iridescence&&s.enable(18);t.iridescenceMap&&s.enable(19);t.iridescenceThicknessMap&&s.enable(20);t.displacementMap&&s.enable(21);t.specularMap&&s.enable(22);t.roughnessMap&&s.enable(23);t.metalnessMap&&s.enable(24);t.gradientMap&&s.enable(25);t.alphaMap&&s.enable(26);t.alphaTest&&s.enable(27);t.vertexColors&&s.enable(28);t.vertexAlphas&&s.enable(29);t.vertexUvs&&s.enable(30);t.vertexTangents&&s.enable(31);t.uvsVertexOnly&&s.enable(32);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.useLegacyLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.specularIntensityMap&&s.enable(15);t.specularColorMap&&s.enable(16);t.transmission&&s.enable(17);t.transmissionMap&&s.enable(18);t.thicknessMap&&s.enable(19);t.sheen&&s.enable(20);t.sheenColorMap&&s.enable(21);t.sheenRoughnessMap&&s.enable(22);t.decodeVideoTexture&&s.enable(23);t.opaque&&s.enable(24);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=Vg[t];n=Ag.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,i=l.length;e<i;e++){const t=l[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new kD(e,n,t,a),l.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},releaseShaderCache:function(e){u.remove(e)},programs:l,dispose:function(){u.dispose()}}}function GD(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function HD(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function jD(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WD(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,o,s){let u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=i,u.groupOrder=a,u.renderOrder=n.renderOrder,u.z=o,u.group=s),t++,u}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,s,u,l){const c=a(e,t,o,s,u,l);o.transmission>0?r.push(c):!0===o.transparent?i.push(c):n.push(c)},unshift:function(e,t,o,s,u,l){const c=a(e,t,o,s,u,l);o.transmission>0?r.unshift(c):!0===o.transparent?i.unshift(c):n.unshift(c)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||HD),r.length>1&&r.sort(t||jD),i.length>1&&i.sort(t||jD)}}}function qD(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new WD,e.set(t,[i])):n>=r.length?(i=new WD,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function XD(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new ef,color:new Om};break;case"SpotLight":n={position:new ef,direction:new ef,color:new Om,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ef,color:new Om,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ef,skyColor:new Om,groundColor:new Om};break;case"RectAreaLight":n={color:new Om,position:new ef,halfWidth:new ef,halfHeight:new ef}}return e[t.id]=n,n}}}let KD=0;function YD(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function JD(e,t){const n=new XD,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Kp};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Kp,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)i.probe.push(new ef);const a=new ef,o=new Yf,s=new Yf;return{setup:function(a,o){let s=0,u=0,l=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let c=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,D=0,y=0;a.sort(YD);const E=!0===o?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],o=t.color,A=t.intensity,C=t.distance,_=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=o.r*A*E,u+=o.g*A*E,l+=o.b*A*E;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],A);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*E),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=_,i.directionalShadowMatrix[c]=t.shadow.matrix,m++}i.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(A*E),e.distance=C,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,i.spot[d]=e;const a=t.shadow;if(t.map&&(i.spotLightMap[D]=t.map,D++,a.updateMatrices(t),t.castShadow&&y++),i.spotLightMatrix[d]=a.matrix,t.castShadow){const e=r.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,i.spotShadow[d]=e,i.spotShadowMap[d]=_,v++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(A),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*E),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=_,i.pointShadowMatrix[h]=t.shadow.matrix,g++}i.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(A*E),e.groundColor.copy(t.groundColor).multiplyScalar(A*E),i.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=zg.LTC_FLOAT_1,i.rectAreaLTC2=zg.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=zg.LTC_HALF_1,i.rectAreaLTC2=zg.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=u,i.ambient[2]=l;const A=i.hash;A.directionalLength===c&&A.pointLength===h&&A.spotLength===d&&A.rectAreaLength===p&&A.hemiLength===f&&A.numDirectionalShadows===m&&A.numPointShadows===g&&A.numSpotShadows===v&&A.numSpotMaps===D||(i.directional.length=c,i.spot.length=d,i.rectArea.length=p,i.point.length=h,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=v+D-y,i.spotLightMap.length=D,i.numSpotLightShadowsWithMaps=y,A.directionalLength=c,A.pointLength=h,A.spotLength=d,A.rectAreaLength=p,A.hemiLength=f,A.numDirectionalShadows=m,A.numPointShadows=g,A.numSpotShadows=v,A.numSpotMaps=D,i.version=KD++)},setupView:function(e,t){let n=0,r=0,u=0,l=0,c=0;const h=t.matrixWorldInverse;for(let d=0,p=e.length;d<p;d++){const t=e[d];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=i.spot[u];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),u++}else if(t.isRectAreaLight){const e=i.rectArea[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s.identity(),o.copy(t.matrixWorld),o.premultiply(h),s.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),l++}else if(t.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),r++}else if(t.isHemisphereLight){const e=i.hemi[c];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),c++}}},state:i}}function $D(e,t){const n=new JD(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function QD(e,t){let n=new WeakMap;return{get:function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=n.get(r);let o;return void 0===a?(o=new $D(e,t),n.set(r,[o])):i>=a.length?(o=new $D(e,t),a.push(o)):o=a[i],o},dispose:function(){n=new WeakMap}}}class ZD extends Nm{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ey extends Nm{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new ef,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function ty(e,t,n){let r=new Lg;const i=new Kp,a=new Kp,o=new Df,s=new ZD({depthPacking:3201}),u=new ey,l={},c=n.maxTextureSize,h={[Bd]:1,[Pd]:0,[Nd]:2},d=new Cg({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Kp},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new eg;f.setAttribute("position",new Hm(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new mg(f,d),g=this;function v(n,r){const a=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new yf(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,p,m,null)}function D(t,n,r,i,a,o){let c=null;const d=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==d)c=d;else if(c=!0===r.isPointLight?u:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=c.uuid,t=n.uuid;let r=l[e];void 0===r&&(r={},l[e]=r);let i=r[t];void 0===i&&(i=c.clone(),r[t]=i),c=i}return c.visible=n.visible,c.wireframe=n.wireframe,c.side=3===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],c.alphaMap=n.alphaMap,c.alphaTest=n.alphaTest,c.map=n.map,c.clipShadows=n.clipShadows,c.clippingPlanes=n.clippingPlanes,c.clipIntersection=n.clipIntersection,c.displacementMap=n.displacementMap,c.displacementScale=n.displacementScale,c.displacementBias=n.displacementBias,c.wireframeLinewidth=n.wireframeLinewidth,c.linewidth=n.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=i,c.farDistance=a),c}function y(n,i,a,o,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let u=0,l=t.length;u<l;u++){const l=t[u],c=i[l.materialIndex];if(c&&c.visible){const t=D(n,c,o,a.near,a.far,s);e.renderBufferDirect(a,null,r,t,n,l)}}}else if(i.visible){const t=D(n,i,o,a.near,a.far,s);e.renderBufferDirect(a,null,r,t,n,null)}}const u=n.children;for(let e=0,t=u.length;e<t;e++)y(u[e],i,a,o,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const u=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=t.length;p<f;p++){const u=t[p],l=u.shadow;if(void 0===l){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===l.autoUpdate&&!1===l.needsUpdate)continue;i.copy(l.mapSize);const h=l.getFrameExtents();if(i.multiply(h),a.copy(l.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/h.x),i.x=a.x*h.x,l.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/h.y),i.y=a.y*h.y,l.mapSize.y=a.y)),null===l.map){const e=3!==this.type?{minFilter:np,magFilter:np}:{};l.map=new yf(i.x,i.y,e),l.map.texture.name=u.name+".shadowMap",l.camera.updateProjectionMatrix()}e.setRenderTarget(l.map),e.clear();const f=l.getViewportCount();for(let e=0;e<f;e++){const t=l.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(o),l.updateMatrices(u,e),r=l.getFrustum(),y(n,s,l.camera,u,this.type)}!0!==l.isPointLightShadow&&3===this.type&&v(l,s),l.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(u,l,h)}}function ny(e,t,n){const r=n.isWebGL2;const i=new function(){let t=!1;const n=new Df;let r=null;const i=new Df(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){e?z(2929):V(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},o=new function(){let t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(e){t||(e?z(2960):V(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&u===r||(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null}}},s=new WeakMap,u=new WeakMap;let l={},c={},h=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,D=null,y=null,E=null,A=null,C=!1,_=null,b=null,x=null,F=null,w=null;const S=e.getParameter(35661);let T=!1,M=0;const B=e.getParameter(7938);-1!==B.indexOf("WebGL")?(M=parseFloat(/^WebGL (\d)/.exec(B)[1]),T=M>=1):-1!==B.indexOf("OpenGL ES")&&(M=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),T=M>=2);let P=null,N={};const R=e.getParameter(3088),L=e.getParameter(2978),I=(new Df).fromArray(R),k=(new Df).fromArray(L);function O(t,n,r){const i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return a}const U={};function z(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function V(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}U[3553]=O(3553,3553,1),U[34067]=O(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),z(2929),a.setFunc(3),W(!1),q(1),z(2884),j(0);const G={[Rd]:32774,[Ld]:32778,[Id]:32779};if(r)G[103]=32775,G[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(G[103]=e.MIN_EXT,G[104]=e.MAX_EXT)}const H={[kd]:0,[Od]:1,[Ud]:768,[Vd]:770,[Xd]:776,[Wd]:774,[Hd]:772,[zd]:769,[Gd]:771,[qd]:775,[jd]:773};function j(t,n,r,i,a,o,s,u){if(0!==t){if(!1===f&&(z(3042),f=!0),5===t)a=a||n,o=o||r,s=s||i,n===g&&a===y||(e.blendEquationSeparate(G[n],G[a]),g=n,y=a),r===v&&i===D&&o===E&&s===A||(e.blendFuncSeparate(H[r],H[i],H[o],H[s]),v=r,D=i,E=o,A=s),m=t,C=!1;else if(t!==m||u!==C){if(g===Rd&&y===Rd||(e.blendEquation(32774),g=Rd,y=Rd),u)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,D=null,E=null,A=null,m=t,C=u}}else!0===f&&(V(3042),f=!1)}function W(t){_!==t&&(t?e.frontFace(2304):e.frontFace(2305),_=t)}function q(t){0!==t?(z(2884),t!==b&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):V(2884),b=t}function X(t,n,r){t?(z(32823),F===n&&w===r||(e.polygonOffset(n,r),F=n,w=r)):V(32823)}return{buffers:{color:i,depth:a,stencil:o},enable:z,disable:V,bindFramebuffer:function(t,n){return c[t]!==n&&(e.bindFramebuffer(t,n),c[t]=n,r&&(36009===t&&(c[36160]=n),36160===t&&(c[36009]=n)),!0)},drawBuffers:function(r,i){let a=d,o=!1;if(r)if(a=h.get(i),void 0===a&&(a=[],h.set(i,a)),r.isWebGLMultipleRenderTargets){const e=r.texture;if(a.length!==e.length||36064!==a[0]){for(let t=0,n=e.length;t<n;t++)a[t]=36064+t;a.length=e.length,o=!0}}else 36064!==a[0]&&(a[0]=36064,o=!0);else 1029!==a[0]&&(a[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:j,setMaterial:function(e,t){2===e.side?V(2884):z(2884);let n=1===e.side;t&&(n=!n),W(n),1===e.blending&&!1===e.transparent?j(0):j(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),i.setMask(e.colorWrite);const r=e.stencilWrite;o.setTest(r),r&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),X(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?z(32926):V(32926)},setFlipSided:W,setCullFace:q,setLineWidth:function(t){t!==x&&(T&&e.lineWidth(t),x=t)},setPolygonOffset:X,setScissorTest:function(e){e?z(3089):V(3089)},activeTexture:function(t){void 0===t&&(t=33984+S-1),P!==t&&(e.activeTexture(t),P=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===P?33984+S-1:P);let i=N[r];void 0===i&&(i={type:void 0,texture:void 0},N[r]=i),i.type===t&&i.texture===n||(P!==r&&(e.activeTexture(r),P=r),e.bindTexture(t,n||U[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=N[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let r=u.get(n);void 0===r&&(r=new WeakMap,u.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=u.get(n).get(t);s.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),s.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===I.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),I.copy(t))},viewport:function(t){!1===k.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),k.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===r&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),l={},P=null,N={},c={},h=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,D=null,y=null,E=null,A=null,C=!1,_=null,b=null,x=null,F=null,w=null,I.set(0,0,e.canvas.width,e.canvas.height),k.set(0,0,e.canvas.width,e.canvas.height),i.reset(),a.reset(),o.reset()}}}function ry(e,t,n,r,i,a,o){const s=i.isWebGL2,u=i.maxTextures,l=i.maxCubemapSize,c=i.maxTextureSize,h=i.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let v=!1;try{v="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(G){}function D(e,t){return v?new OffscreenCanvas(e,t):Qp("canvas")}function y(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Wp:Math.floor,a=r(i*e.width),o=r(i*e.height);void 0===m&&(m=D(a,o));const s=n?D(a,o):m;s.width=a,s.height=o;return s.getContext("2d").drawImage(e,0,0,a,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function E(e){return jp(e.width)&&jp(e.height)}function A(e,t){return e.generateMipmaps&&t&&e.minFilter!==np&&e.minFilter!==ap}function C(t){e.generateMipmap(t)}function _(n,r,i,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===s)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let u=r;return 6403===r&&(5126===i&&(u=33326),5131===i&&(u=33325),5121===i&&(u=33321)),33319===r&&(5126===i&&(u=33328),5131===i&&(u=33327),5121===i&&(u=33323)),6408===r&&(5126===i&&(u=34836),5131===i&&(u=34842),5121===i&&(u=a===Sp&&!1===o?35907:32856),32819===i&&(u=32854),32820===i&&(u=32855)),33325!==u&&33326!==u&&33327!==u&&33328!==u&&34842!==u&&34836!==u||t.get("EXT_color_buffer_float"),u}function b(e,t,n){return!0===A(e,n)||e.isFramebufferTexture&&e.minFilter!==np&&e.minFilter!==ap?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function x(e){return e===np||e===rp||e===ip?9728:9729}function F(e){const t=e.target;t.removeEventListener("dispose",F),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=g.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&S(e),0===Object.keys(i).length&&g.delete(n)}r.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=t.texture,i=r.get(t),a=r.get(n);void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++)e.deleteFramebuffer(i.__webglFramebuffer[r]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[r]);else{if(e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let s=0,u=n.length;s<u;s++){const t=r.get(n[s]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),r.remove(n[s])}r.remove(n),r.remove(t)}(n)}function S(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete g.get(i)[n.__cacheKey],o.memory.textures--}let T=0;function M(e,t){const i=r.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&i.__version!==e.version){const n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void L(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(3553,i.__webglTexture,33984+t)}const B={[Zd]:10497,[ep]:33071,[tp]:33648},P={[np]:9728,[rp]:9984,[ip]:9986,[ap]:9729,[op]:9985,[sp]:9987};function N(n,a,o){if(o?(e.texParameteri(n,10242,B[a.wrapS]),e.texParameteri(n,10243,B[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,B[a.wrapR]),e.texParameteri(n,10240,P[a.magFilter]),e.texParameteri(n,10241,P[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===ep&&a.wrapT===ep||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,x(a.magFilter)),e.texParameteri(n,10241,x(a.minFilter)),a.minFilter!==np&&a.minFilter!==ap&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===np)return;if(a.minFilter!==ip&&a.minFilter!==sp)return;if(a.type===cp&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&a.type===hp&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function R(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",F));const i=n.source;let a=g.get(i);void 0===a&&(a={},g.set(i,a));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[s].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&S(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return r}function L(t,i,o){let u=3553;(i.isDataArrayTexture||i.isCompressedArrayTexture)&&(u=35866),i.isData3DTexture&&(u=32879);const l=R(t,i),h=i.source;n.bindTexture(u,t.__webglTexture,33984+o);const d=r.get(h);if(h.version!==d.__version||!0===l){n.activeTexture(33984+o),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!s&&(e.wrapS!==ep||e.wrapT!==ep||e.minFilter!==np&&e.minFilter!==ap)}(i)&&!1===E(i.image);let r=y(i.image,t,!1,c);r=V(i,r);const p=E(r)||s,f=a.convert(i.format,i.encoding);let m,g=a.convert(i.type),v=_(i.internalFormat,f,g,i.encoding,i.isVideoTexture);N(u,i,p);const D=i.mipmaps,x=s&&!0!==i.isVideoTexture,F=void 0===d.__version||!0===l,w=b(i,r,p);if(i.isDepthTexture)v=6402,s?v=i.type===cp?36012:i.type===lp?33190:i.type===dp?35056:33189:i.type===cp&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===fp&&6402===v&&1012!==i.type&&i.type!==lp&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=lp,g=a.convert(i.type)),i.format===mp&&6402===v&&(v=34041,i.type!==dp&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=dp,g=a.convert(i.type))),F&&(x?n.texStorage2D(3553,1,v,r.width,r.height):n.texImage2D(3553,0,v,r.width,r.height,0,f,g,null));else if(i.isDataTexture)if(D.length>0&&p){x&&F&&n.texStorage2D(3553,w,v,D[0].width,D[0].height);for(let e=0,t=D.length;e<t;e++)m=D[e],x?n.texSubImage2D(3553,e,0,0,m.width,m.height,f,g,m.data):n.texImage2D(3553,e,v,m.width,m.height,0,f,g,m.data);i.generateMipmaps=!1}else x?(F&&n.texStorage2D(3553,w,v,r.width,r.height),n.texSubImage2D(3553,0,0,0,r.width,r.height,f,g,r.data)):n.texImage2D(3553,0,v,r.width,r.height,0,f,g,r.data);else if(i.isCompressedTexture)if(i.isCompressedArrayTexture){x&&F&&n.texStorage3D(35866,w,v,D[0].width,D[0].height,r.depth);for(let e=0,t=D.length;e<t;e++)m=D[e],i.format!==pp?null!==f?x?n.compressedTexSubImage3D(35866,e,0,0,0,m.width,m.height,r.depth,f,m.data,0,0):n.compressedTexImage3D(35866,e,v,m.width,m.height,r.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):x?n.texSubImage3D(35866,e,0,0,0,m.width,m.height,r.depth,f,g,m.data):n.texImage3D(35866,e,v,m.width,m.height,r.depth,0,f,g,m.data)}else{x&&F&&n.texStorage2D(3553,w,v,D[0].width,D[0].height);for(let e=0,t=D.length;e<t;e++)m=D[e],i.format!==pp?null!==f?x?n.compressedTexSubImage2D(3553,e,0,0,m.width,m.height,f,m.data):n.compressedTexImage2D(3553,e,v,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):x?n.texSubImage2D(3553,e,0,0,m.width,m.height,f,g,m.data):n.texImage2D(3553,e,v,m.width,m.height,0,f,g,m.data)}else if(i.isDataArrayTexture)x?(F&&n.texStorage3D(35866,w,v,r.width,r.height,r.depth),n.texSubImage3D(35866,0,0,0,0,r.width,r.height,r.depth,f,g,r.data)):n.texImage3D(35866,0,v,r.width,r.height,r.depth,0,f,g,r.data);else if(i.isData3DTexture)x?(F&&n.texStorage3D(32879,w,v,r.width,r.height,r.depth),n.texSubImage3D(32879,0,0,0,0,r.width,r.height,r.depth,f,g,r.data)):n.texImage3D(32879,0,v,r.width,r.height,r.depth,0,f,g,r.data);else if(i.isFramebufferTexture){if(F)if(x)n.texStorage2D(3553,w,v,r.width,r.height);else{let e=r.width,t=r.height;for(let r=0;r<w;r++)n.texImage2D(3553,r,v,e,t,0,f,g,null),e>>=1,t>>=1}}else if(D.length>0&&p){x&&F&&n.texStorage2D(3553,w,v,D[0].width,D[0].height);for(let e=0,t=D.length;e<t;e++)m=D[e],x?n.texSubImage2D(3553,e,0,0,f,g,m):n.texImage2D(3553,e,v,f,g,m);i.generateMipmaps=!1}else x?(F&&n.texStorage2D(3553,w,v,r.width,r.height),n.texSubImage2D(3553,0,0,0,f,g,r)):n.texImage2D(3553,0,v,f,g,r);A(i,p)&&C(u),d.__version=h.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function I(t,i,o,s,u){const l=a.convert(o.format,o.encoding),c=a.convert(o.type),h=_(o.internalFormat,l,c,o.encoding);r.get(i).__hasExternalTextures||(32879===u||35866===u?n.texImage3D(u,0,h,i.width,i.height,i.depth,0,l,c,null):n.texImage2D(u,0,h,i.width,i.height,0,l,c,null)),n.bindFramebuffer(36160,t),z(i)?d.framebufferTexture2DMultisampleEXT(36160,s,u,r.get(o).__webglTexture,0,U(i)):(3553===u||u>=34069&&u<=34074)&&e.framebufferTexture2D(36160,s,u,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function k(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r||z(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===cp?i=36012:t.type===lp&&(i=33190));const r=U(n);z(n)?d.renderbufferStorageMultisampleEXT(36161,r,i,n.width,n.height):e.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=U(n);r&&!1===z(n)?e.renderbufferStorageMultisample(36161,i,35056,n.width,n.height):z(n)?d.renderbufferStorageMultisampleEXT(36161,i,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let i=0;i<t.length;i++){const o=t[i],s=a.convert(o.format,o.encoding),u=a.convert(o.type),l=_(o.internalFormat,s,u,o.encoding),c=U(n);r&&!1===z(n)?e.renderbufferStorageMultisample(36161,c,l,n.width,n.height):z(n)?d.renderbufferStorageMultisampleEXT(36161,c,l,n.width,n.height):e.renderbufferStorage(36161,l,n.width,n.height)}}e.bindRenderbuffer(36161,null)}function O(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),M(i.depthTexture,0);const a=r.get(i.depthTexture).__webglTexture,o=U(i);if(i.depthTexture.format===fp)z(i)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,o):e.framebufferTexture2D(36160,36096,3553,a,0);else{if(i.depthTexture.format!==mp)throw new Error("Unknown depthTexture format");z(i)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,o):e.framebufferTexture2D(36160,33306,3553,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),k(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),k(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function U(e){return Math.min(h,e.samples)}function z(e){const n=r.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(e,n){const r=e.encoding,i=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Lp||r!==wp&&(r===Sp?!1===s?!0===t.has("EXT_sRGB")&&i===pp?(e.format=Lp,e.minFilter=ap,e.generateMipmaps=!1):n=pf.sRGBToLinear(n):i===pp&&a===up||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){const e=T;return e>=u&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+u),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=M,this.setTexture2DArray=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?L(i,e,t):n.bindTexture(35866,i.__webglTexture,33984+t)},this.setTexture3D=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?L(i,e,t):n.bindTexture(32879,i.__webglTexture,33984+t)},this.setTextureCube=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?function(t,i,o){if(6!==i.image.length)return;const u=R(t,i),c=i.source;n.bindTexture(34067,t.__webglTexture,33984+o);const h=r.get(c);if(c.version!==h.__version||!0===u){n.activeTexture(33984+o),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=i.isCompressedTexture||i.image[0].isCompressedTexture,r=i.image[0]&&i.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=t||r?r?i.image[e].image:i.image[e]:y(i.image[e],!1,!0,l),d[e]=V(i,d[e]);const p=d[0],f=E(p)||s,m=a.convert(i.format,i.encoding),g=a.convert(i.type),v=_(i.internalFormat,m,g,i.encoding),D=s&&!0!==i.isVideoTexture,x=void 0===h.__version||!0===u;let F,w=b(i,p,f);if(N(34067,i,f),t){D&&x&&n.texStorage2D(34067,w,v,p.width,p.height);for(let e=0;e<6;e++){F=d[e].mipmaps;for(let t=0;t<F.length;t++){const r=F[t];i.format!==pp?null!==m?D?n.compressedTexSubImage2D(34069+e,t,0,0,r.width,r.height,m,r.data):n.compressedTexImage2D(34069+e,t,v,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):D?n.texSubImage2D(34069+e,t,0,0,r.width,r.height,m,g,r.data):n.texImage2D(34069+e,t,v,r.width,r.height,0,m,g,r.data)}}}else{F=i.mipmaps,D&&x&&(F.length>0&&w++,n.texStorage2D(34067,w,v,d[0].width,d[0].height));for(let e=0;e<6;e++)if(r){D?n.texSubImage2D(34069+e,0,0,0,d[e].width,d[e].height,m,g,d[e].data):n.texImage2D(34069+e,0,v,d[e].width,d[e].height,0,m,g,d[e].data);for(let t=0;t<F.length;t++){const r=F[t].image[e].image;D?n.texSubImage2D(34069+e,t+1,0,0,r.width,r.height,m,g,r.data):n.texImage2D(34069+e,t+1,v,r.width,r.height,0,m,g,r.data)}}else{D?n.texSubImage2D(34069+e,0,0,0,m,g,d[e]):n.texImage2D(34069+e,0,v,m,g,d[e]);for(let t=0;t<F.length;t++){const r=F[t];D?n.texSubImage2D(34069+e,t+1,0,0,m,g,r.image[e]):n.texImage2D(34069+e,t+1,v,m,g,r.image[e])}}}A(i,f)&&C(34067),h.__version=c.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(o,t,i):n.bindTexture(34067,o.__webglTexture,33984+i)},this.rebindTextures=function(e,t,n){const i=r.get(e);void 0!==t&&I(i.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&O(e)},this.setupRenderTarget=function(t){const u=t.texture,l=r.get(t),c=r.get(u);t.addEventListener("dispose",w),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=u.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=E(t)||s;if(h){l.__webglFramebuffer=[];for(let t=0;t<6;t++)l.__webglFramebuffer[t]=e.createFramebuffer()}else{if(l.__webglFramebuffer=e.createFramebuffer(),d)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===z(t)){const r=d?u:[u];l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer);for(let n=0;n<r.length;n++){const i=r[n];l.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer[n]);const o=a.convert(i.format,i.encoding),s=a.convert(i.type),u=_(i.internalFormat,o,s,i.encoding,!0===t.isXRRenderTarget),c=U(t);e.renderbufferStorageMultisample(36161,c,u,t.width,t.height),e.framebufferRenderbuffer(36160,36064+n,36161,l.__webglColorRenderbuffer[n])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),k(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,c.__webglTexture),N(34067,u,p);for(let e=0;e<6;e++)I(l.__webglFramebuffer[e],t,u,36064,34069+e);A(u,p)&&C(34067),n.unbindTexture()}else if(d){const e=t.texture;for(let i=0,a=e.length;i<a;i++){const a=e[i],o=r.get(a);n.bindTexture(3553,o.__webglTexture),N(3553,a,p),I(l.__webglFramebuffer,t,a,36064+i,3553),A(a,p)&&C(3553)}n.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(e,c.__webglTexture),N(e,u,p),I(l.__webglFramebuffer,t,u,36064,e),A(u,p)&&C(e),n.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(e){const t=E(e)||s,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,o=i.length;a<o;a++){const o=i[a];if(A(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,i=r.get(o).__webglTexture;n.bindTexture(t,i),C(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===z(t)){const i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,o=t.height;let s=16384;const u=[],l=t.stencilBuffer?33306:36096,c=r.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),n.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);n.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,c.__webglFramebuffer);for(let n=0;n<i.length;n++){u.push(36064+n),t.depthBuffer&&u.push(l);const d=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),h&&e.framebufferRenderbuffer(36008,36064,36161,c.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(36008,[l]),e.invalidateFramebuffer(36009,[l])),h){const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728),p&&e.invalidateFramebuffer(36008,u)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,c.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,a,0)}n.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=I,this.useMultisampledRTT=z}function iy(e,t,n){const r=n.isWebGL2;return{convert:function(n){let i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===up)return 5121;if(1017===n)return 32819;if(1018===n)return 32820;if(1010===n)return 5120;if(1011===n)return 5122;if(1012===n)return 5123;if(1013===n)return 5124;if(n===lp)return 5125;if(n===cp)return 5126;if(n===hp)return r?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(1021===n)return 6406;if(n===pp)return 6408;if(1024===n)return 6409;if(1025===n)return 6410;if(n===fp)return 6402;if(n===mp)return 34041;if(n===Lp)return i=t.get("EXT_sRGB"),null!==i?i.SRGB_ALPHA_EXT:null;if(1028===n)return 6403;if(1029===n)return 36244;if(1030===n)return 33319;if(1031===n)return 33320;if(1033===n)return 36249;if(n===gp||n===vp||n===Dp||n===yp)if(a===Sp){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===gp)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===vp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Dp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===yp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===gp)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===vp)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Dp)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===yp)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(35840===n)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(37492===n)return a===Sp?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(37496===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(37808===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return a===Sp?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Ep){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===Ep)return a===Sp?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===n||36284===n||36285===n||36286===n){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===Ep)return i.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===dp?r?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class ay extends bg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}}class oy extends Em{constructor(){super(),this.isGroup=!0,this.type="Group"}}const sy={type:"move"};class uy{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new oy,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new oy,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ef,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ef),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new oy,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ef,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ef),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),r=this._getHandJoint(u,a);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const r=u.joints["index-finger-tip"],i=u.joints["thumb-tip"],o=r.position.distanceTo(i.position),s=.02,l=.005;u.inputState.pinching&&o>s+l?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&o<=s-l&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(sy)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==u&&(u.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new oy;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class ly extends vf{constructor(e,t,n,r,i,a,o,s,u,l){if((l=void 0!==l?l:fp)!==fp&&l!==mp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===fp&&(n=lp),void 0===n&&l===mp&&(n=dp),super(null,r,i,a,o,s,l,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:np,this.minFilter=void 0!==s?s:np,this.flipY=!1,this.generateMipmaps=!1}}class cy extends Ip{constructor(e,t){super();const n=this;let r=null,i=1,a=null,o="local-floor",s=1,u=null,l=null,c=null,h=null,d=null,p=null;const f=t.getContextAttributes();let m=null,g=null;const v=[],D=[],y=new Set,E=new Map,A=new bg;A.layers.enable(1),A.viewport=new Df;const C=new bg;C.layers.enable(2),C.viewport=new Df;const _=[A,C],b=new ay;b.layers.enable(1),b.layers.enable(2);let x=null,F=null;function w(e){const t=D.indexOf(e.inputSource);if(-1===t)return;const n=v[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}function S(){r.removeEventListener("select",w),r.removeEventListener("selectstart",w),r.removeEventListener("selectend",w),r.removeEventListener("squeeze",w),r.removeEventListener("squeezestart",w),r.removeEventListener("squeezeend",w),r.removeEventListener("end",S),r.removeEventListener("inputsourceschange",T);for(let e=0;e<v.length;e++){const t=D[e];null!==t&&(D[e]=null,v[e].disconnect(t))}x=null,F=null,e.setRenderTarget(m),d=null,h=null,c=null,r=null,g=null,R.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function T(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=D.indexOf(n);r>=0&&(D[r]=null,v[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=D.indexOf(n);if(-1===r){for(let e=0;e<v.length;e++){if(e>=D.length){D.push(n),r=e;break}if(null===D[e]){D[e]=n,r=e;break}}if(-1===r)break}const i=v[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new uy,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new uy,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new uy,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(e){u=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(l){if(r=l,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",w),r.addEventListener("selectstart",w),r.addEventListener("selectend",w),r.addEventListener("squeeze",w),r.addEventListener("squeezestart",w),r.addEventListener("squeezeend",w),r.addEventListener("end",S),r.addEventListener("inputsourceschange",T),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),g=new yf(d.framebufferWidth,d.framebufferHeight,{format:pp,type:up,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let n=null,a=null,o=null;f.depth&&(o=f.stencil?35056:33190,n=f.stencil?mp:fp,a=f.stencil?dp:lp);const s={colorFormat:32856,depthFormat:o,scaleFactor:i};c=new XRWebGLBinding(r,t),h=c.createProjectionLayer(s),r.updateRenderState({layers:[h]}),g=new yf(h.textureWidth,h.textureHeight,{format:pp,type:up,depthTexture:new ly(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(s),u=null,a=await r.requestReferenceSpace(o),R.setContext(r),R.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const M=new ef,B=new ef;function P(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;b.near=C.near=A.near=e.near,b.far=C.far=A.far=e.far,x===b.near&&F===b.far||(r.updateRenderState({depthNear:b.near,depthFar:b.far}),x=b.near,F=b.far);const t=e.parent,n=b.cameras;P(b,t);for(let r=0;r<n.length;r++)P(n[r],t);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),e.matrix.copy(b.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const i=e.children;for(let r=0,a=i.length;r<a;r++)i[r].updateMatrixWorld(!0);2===n.length?function(e,t,n){M.setFromMatrixPosition(t.matrixWorld),B.setFromMatrixPosition(n.matrixWorld);const r=M.distanceTo(B),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,p=o*h,f=r/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,v=s+f,D=d-m,y=p+(r-m),E=u*s/v*g,A=l*s/v*g;e.projectionMatrix.makePerspective(D,y,E,A,g,v)}(b,A,C):b.projectionMatrix.copy(A.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){if(null!==h||null!==d)return s},this.setFoveation=function(e){s=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.getPlanes=function(){return y};let N=null;const R=new Ig;R.setAnimationLoop(function(t,r){if(l=r.getViewerPose(u||a),p=r,null!==l){const t=l.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==b.cameras.length&&(b.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let a=null;if(null!==d)a=d.getViewport(i);else{const t=c.getViewSubImage(h,i);a=t.viewport,0===r&&(e.setRenderTargetTextures(g,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let o=_[r];void 0===o&&(o=new bg,o.layers.enable(r),o.viewport=new Df,_[r]=o),o.matrix.fromArray(i.transform.matrix),o.projectionMatrix.fromArray(i.projectionMatrix),o.viewport.set(a.x,a.y,a.width,a.height),0===r&&b.matrix.copy(o.matrix),!0===n&&b.cameras.push(o)}}for(let e=0;e<v.length;e++){const t=D[e],n=v[e];null!==t&&void 0!==n&&n.update(t,r,u||a)}if(N&&N(t,r),r.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:r.detectedPlanes});let e=null;for(const t of y)r.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(const t of e)y.delete(t),E.delete(t),n.dispatchEvent({type:"planeremoved",data:t});for(const t of r.detectedPlanes)if(y.has(t)){const e=E.get(t);t.lastChangedTime>e&&(E.set(t,t.lastChangedTime),n.dispatchEvent({type:"planechanged",data:t}))}else y.add(t),E.set(t,r.lastChangedTime),n.dispatchEvent({type:"planeadded",data:t})}p=null}),this.setAnimationLoop=function(e){N=e},this.dispose=function(){}}}function hy(e,t){function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,1===r.side&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),1===r.side&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);const i=t.get(r).envMap;if(i&&(n.envMap.value=i,n.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;const t=!0===e.useLegacyLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*t}let a,o;r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?a=r.map:r.specularMap?a=r.specularMap:r.displacementMap?a=r.displacementMap:r.normalMap?a=r.normalMap:r.bumpMap?a=r.bumpMap:r.roughnessMap?a=r.roughnessMap:r.metalnessMap?a=r.metalnessMap:r.alphaMap?a=r.alphaMap:r.emissiveMap?a=r.emissiveMap:r.clearcoatMap?a=r.clearcoatMap:r.clearcoatNormalMap?a=r.clearcoatNormalMap:r.clearcoatRoughnessMap?a=r.clearcoatRoughnessMap:r.iridescenceMap?a=r.iridescenceMap:r.iridescenceThicknessMap?a=r.iridescenceThicknessMap:r.specularIntensityMap?a=r.specularIntensityMap:r.specularColorMap?a=r.specularColorMap:r.transmissionMap?a=r.transmissionMap:r.thicknessMap?a=r.thicknessMap:r.sheenColorMap?a=r.sheenColorMap:r.sheenRoughnessMap&&(a=r.sheenRoughnessMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uvTransform.value.copy(a.matrix)),r.aoMap?o=r.aoMap:r.lightMap&&(o=r.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),n.uv2Transform.value.copy(o.matrix))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Eg(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,i,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(n(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(n(e,r),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);const r=t.get(n).envMap;r&&(e.envMapIntensity.value=n.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,o)):r.isMeshMatcapMaterial?(n(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function dy(e,t,n,r){let i={},a={},o=[];const s=n.isWebGL2?e.getParameter(35375):0;function u(e,t,n){const r=e.value;if(void 0===n[t]){if("number"===typeof r)n[t]=r;else{const e=Array.isArray(r)?r:[r],i=[];for(let t=0;t<e.length;t++)i.push(e[t].clone());n[t]=i}return!0}if("number"===typeof r){if(n[t]!==r)return n[t]=r,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],i=Array.isArray(r)?r:[r];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(i[t]))return n.copy(i[t]),!0}}return!1}function l(e){const t={boundary:0,storage:0};return"number"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){const n=t.target;n.removeEventListener("dispose",c);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let d=i[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const r=16;let i=0;for(let a=0,o=t.length;a<o;a++){const e=t[a],o={boundary:0,storage:0},s=Array.isArray(e.value)?e.value:[e.value];for(let t=0,n=s.length;t<n;t++){const e=l(s[t]);o.boundary+=e.boundary,o.storage+=e.storage}if(e.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,a>0){i=n%r;0!==i&&r-i-o.boundary<0&&(n+=r-i,e.__offset=n)}n+=o.storage}i=n%r,i>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(35345,r),e.bufferData(35345,i,a),e.bindBuffer(35345,null),e.bindBufferBase(35345,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",c));const p=h.program;r.updateUBOMapping(n,p);const f=t.render.frame;a[n.id]!==f&&(!function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(35345,n);for(let i=0,o=r.length;i<o;i++){const t=r[i];if(!0===u(t,i,a)){const n=t.__offset,r=Array.isArray(t.value)?t.value:[t.value];let i=0;for(let a=0;a<r.length;a++){const o=r[a],s=l(o);"number"===typeof o?(t.__data[0]=o,e.bufferSubData(35345,n+i,t.__data)):o.isMatrix3?(t.__data[0]=o.elements[0],t.__data[1]=o.elements[1],t.__data[2]=o.elements[2],t.__data[3]=o.elements[0],t.__data[4]=o.elements[3],t.__data[5]=o.elements[4],t.__data[6]=o.elements[5],t.__data[7]=o.elements[0],t.__data[8]=o.elements[6],t.__data[9]=o.elements[7],t.__data[10]=o.elements[8],t.__data[11]=o.elements[0]):(o.toArray(t.__data,i),i+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,n,t.__data)}}e.bindBuffer(35345,null)}(n),a[n.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);o=[],i={},a={}}}}function py(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;const t=void 0!==e.canvas?e.canvas:function(){const e=Qp("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,i=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,s=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",l=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let c;c=null!==n?n.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let h=null,d=null;const p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=wp,this.useLegacyLights=!0,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,v=0,D=0,y=null,E=-1,A=null;const C=new Df,_=new Df;let b=null,x=t.width,F=t.height,w=1,S=null,T=null;const M=new Df(0,0,x,F),B=new Df(0,0,x,F);let P=!1;const N=new Lg;let R=!1,L=!1,I=null;const k=new Yf,O=new ef,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===y?w:1}let V,G,H,j,W,q,X,K,Y,J,$,Q,Z,ee,te,ne,re,ie,ae,oe,se,ue,le,ce,he=n;function de(e,n){for(let r=0;r<e.length;r++){const i=e[r],a=t.getContext(i,n);if(null!==a)return a}return null}try{const e={alpha:!0,depth:r,stencil:i,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:s,powerPreference:u,failIfMajorPerformanceCaveat:l};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(Md)),t.addEventListener("webglcontextlost",me,!1),t.addEventListener("webglcontextrestored",ge,!1),t.addEventListener("webglcontextcreationerror",ve,!1),null===he){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),he=de(t,e),null===he)throw de(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Te){throw console.error("THREE.WebGLRenderer: "+Te.message),Te}function pe(){V=new cv(he),G=new qg(he,V,e),V.init(G),ue=new iy(he,V,G),H=new ny(he,V,G),j=new pv,W=new GD,q=new ry(he,V,H,W,G,ue,j),X=new Kg(m),K=new lv(m),Y=new kg(he,G),le=new jg(he,V,Y,G),J=new hv(he,Y,j,le),$=new vv(he,J,Y,j),ae=new gv(he,G,q),ne=new Xg(W),Q=new VD(m,X,K,V,G,le,ne),Z=new hy(m,W),ee=new qD,te=new QD(V,G),ie=new Hg(m,X,K,H,$,c,o),re=new ty(m,$,G),ce=new dy(he,j,G,H),oe=new Wg(he,V,j,G),se=new dv(he,V,j,G),j.programs=Q.programs,m.capabilities=G,m.extensions=V,m.properties=W,m.renderLists=ee,m.shadowMap=re,m.state=H,m.info=j}pe();const fe=new cy(m,he);function me(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ge(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=j.autoReset,t=re.enabled,n=re.autoUpdate,r=re.needsUpdate,i=re.type;pe(),j.autoReset=e,re.enabled=t,re.autoUpdate=n,re.needsUpdate=r,re.type=i}function ve(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function De(e){const t=e.target;t.removeEventListener("dispose",De),function(e){(function(e){const t=W.get(e).programs;void 0!==t&&(t.forEach(function(e){Q.releaseProgram(e)}),e.isShaderMaterial&&Q.releaseShaderCache(e))})(e),W.remove(e)}(t)}this.xr=fe,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){const e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return w},this.setPixelRatio=function(e){void 0!==e&&(w=e,this.setSize(x,F,!1))},this.getSize=function(e){return e.set(x,F)},this.setSize=function(e,n){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];fe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(x=e,F=n,t.width=Math.floor(e*w),t.height=Math.floor(n*w),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(x*w,F*w).floor()},this.setDrawingBufferSize=function(e,n,r){x=e,F=n,w=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(M)},this.setViewport=function(e,t,n,r){e.isVector4?M.set(e.x,e.y,e.z,e.w):M.set(e,t,n,r),H.viewport(C.copy(M).multiplyScalar(w).floor())},this.getScissor=function(e){return e.copy(B)},this.setScissor=function(e,t,n,r){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,r),H.scissor(_.copy(B).multiplyScalar(w).floor())},this.getScissorTest=function(){return P},this.setScissorTest=function(e){H.setScissorTest(P=e)},this.setOpaqueSort=function(e){S=e},this.setTransparentSort=function(e){T=e},this.getClearColor=function(e){return e.copy(ie.getClearColor())},this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)},this.clear=function(){let e=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(e|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e|=1024),he.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",me,!1),t.removeEventListener("webglcontextrestored",ge,!1),t.removeEventListener("webglcontextcreationerror",ve,!1),ee.dispose(),te.dispose(),W.dispose(),X.dispose(),K.dispose(),$.dispose(),le.dispose(),ce.dispose(),Q.dispose(),fe.dispose(),fe.removeEventListener("sessionstart",Ee),fe.removeEventListener("sessionend",Ae),I&&(I.dispose(),I=null),Ce.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=U);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,n,r,i){!0!==t.isScene&&(t=U);q.resetTextureUnits();const a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===y?m.outputEncoding:!0===y.isXRRenderTarget?y.texture.encoding:wp,u=(r.isMeshStandardMaterial?K:X).get(r.envMap||o),l=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,f=!!n.morphAttributes.color,g=r.toneMapped?m.toneMapping:0,v=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,D=void 0!==v?v.length:0,C=W.get(r),_=d.state.lights;if(!0===R&&(!0===L||e!==A)){const t=e===A&&r.id===E;ne.setState(r,e,t)}let b=!1;r.version===C.__version?C.needsLights&&C.lightsStateVersion!==_.state.version||C.outputEncoding!==s||i.isInstancedMesh&&!1===C.instancing?b=!0:i.isInstancedMesh||!0!==C.instancing?i.isSkinnedMesh&&!1===C.skinning?b=!0:i.isSkinnedMesh||!0!==C.skinning?C.envMap!==u||!0===r.fog&&C.fog!==a?b=!0:void 0===C.numClippingPlanes||C.numClippingPlanes===ne.numPlanes&&C.numIntersection===ne.numIntersection?(C.vertexAlphas!==l||C.vertexTangents!==c||C.morphTargets!==h||C.morphNormals!==p||C.morphColors!==f||C.toneMapping!==g||!0===G.isWebGL2&&C.morphTargetsCount!==D)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,C.__version=r.version);let x=C.currentProgram;!0===b&&(x=we(r,t,i));let S=!1,T=!1,M=!1;const B=x.getUniforms(),P=C.uniforms;H.useProgram(x.program)&&(S=!0,T=!0,M=!0);r.id!==E&&(E=r.id,T=!0);if(S||A!==e){if(B.setValue(he,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&B.setValue(he,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),A!==e&&(A=e,T=!0,M=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const t=B.map.cameraPosition;void 0!==t&&t.setValue(he,O.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&B.setValue(he,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&B.setValue(he,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){B.setOptional(he,i,"bindMatrix"),B.setOptional(he,i,"bindMatrixInverse");const e=i.skeleton;e&&(G.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),B.setValue(he,"boneTexture",e.boneTexture,q),B.setValue(he,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const N=n.morphAttributes;(void 0!==N.position||void 0!==N.normal||void 0!==N.color&&!0===G.isWebGL2)&&ae.update(i,n,x);(T||C.receiveShadow!==i.receiveShadow)&&(C.receiveShadow=i.receiveShadow,B.setValue(he,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(P.envMap.value=u,P.flipEnvMap.value=u.isCubeTexture&&!1===u.isRenderTargetTexture?-1:1);T&&(B.setValue(he,"toneMappingExposure",m.toneMappingExposure),C.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(P,M),a&&!0===r.fog&&Z.refreshFogUniforms(P,a),Z.refreshMaterialUniforms(P,r,w,F,I),AD.upload(he,C.uniformsList,P,q));r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(AD.upload(he,C.uniformsList,P,q),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&B.setValue(he,"center",i.center);if(B.setValue(he,"modelViewMatrix",i.modelViewMatrix),B.setValue(he,"normalMatrix",i.normalMatrix),B.setValue(he,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(G.isWebGL2){const n=e[t];ce.update(n,x),ce.bind(n,x)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return x}(e,t,n,r,i);H.setMaterial(r,o);let u=n.index,l=1;!0===r.wireframe&&(u=J.getWireframeAttribute(n),l=2);const c=n.drawRange,h=n.attributes.position;let p=c.start*l,f=(c.start+c.count)*l;null!==a&&(p=Math.max(p,a.start*l),f=Math.min(f,(a.start+a.count)*l)),null!==u?(p=Math.max(p,0),f=Math.min(f,u.count)):void 0!==h&&null!==h&&(p=Math.max(p,0),f=Math.min(f,h.count));const g=f-p;if(g<0||g===1/0)return;let v;le.setup(i,r,s,n,u);let D=oe;if(null!==u&&(v=Y.get(u),D=se,D.setIndex(v)),i.isMesh)!0===r.wireframe?(H.setLineWidth(r.wireframeLinewidth*z()),D.setMode(1)):D.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),H.setLineWidth(e*z()),i.isLineSegments?D.setMode(1):i.isLineLoop?D.setMode(2):D.setMode(3)}else i.isPoints?D.setMode(0):i.isSprite&&D.setMode(4);if(i.isInstancedMesh)D.renderInstances(p,g,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);D.renderInstances(p,g,t)}else D.render(p,g)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,we(e,t,n),e.side=0,e.needsUpdate=!0,we(e,t,n),e.side=2):we(e,t,n)}d=te.get(e),d.init(),f.push(d),e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))}),d.setupLights(m.useLegacyLights),e.traverse(function(t){const r=t.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){n(r[i],e,t)}else n(r,e,t)}),f.pop(),d=null};let ye=null;function Ee(){Ce.stop()}function Ae(){Ce.start()}const Ce=new Ig;function _e(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||N.intersectsSprite(e)){r&&O.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k);const t=$.update(e),i=e.material;i.visible&&h.push(e,t,i,n,O.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==j.render.frame&&(e.skeleton.update(),e.skeleton.frame=j.render.frame),!e.frustumCulled||N.intersectsObject(e))){r&&O.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k);const t=$.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let a=0,o=r.length;a<o;a++){const o=r[a],s=i[o.materialIndex];s&&s.visible&&h.push(e,t,s,n,O.z,o)}}else i.visible&&h.push(e,t,i,n,O.z,null)}const i=e.children;for(let a=0,o=i.length;a<o;a++)_e(i[a],t,n,r)}function be(e,t,n,r){const i=e.opaque,o=e.transmissive,s=e.transparent;d.setupLightsView(n),!0===R&&ne.setGlobalState(m.clippingPlanes,n),o.length>0&&function(e,t,n){const r=G.isWebGL2;null===I&&(I=new yf(1024,1024,{generateMipmaps:!0,type:V.has("EXT_color_buffer_half_float")?hp:up,minFilter:sp,samples:r&&!0===a?4:0}));const i=m.getRenderTarget();m.setRenderTarget(I),m.clear();const o=m.toneMapping;m.toneMapping=0,xe(e,t,n),m.toneMapping=o,q.updateMultisampleRenderTarget(I),q.updateRenderTargetMipmap(I),m.setRenderTarget(i)}(i,t,n),r&&H.viewport(C.copy(r)),i.length>0&&xe(i,t,n),o.length>0&&xe(o,t,n),s.length>0&&xe(s,t,n),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1)}function xe(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],o=a.object,s=a.geometry,u=null===r?a.material:r,l=a.group;o.layers.test(n.layers)&&Fe(o,t,n,s,u,l)}}function Fe(e,t,n,r,i,a){e.onBeforeRender(m,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(m,t,n,r,e,a),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,m.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,m.renderBufferDirect(n,t,r,i,e,a),i.side=2):m.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(m,t,n,r,i,a)}function we(e,t,n){!0!==t.isScene&&(t=U);const r=W.get(e),i=d.state.lights,a=d.state.shadowsArray,o=i.state.version,s=Q.getParameters(e,i.state,a,t,n),u=Q.getProgramCacheKey(s);let l=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?K:X).get(e.envMap||r.environment),void 0===l&&(e.addEventListener("dispose",De),l=new Map,r.programs=l);let c=l.get(u);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===o)return Se(e,s),c}else s.uniforms=Q.getUniforms(e),e.onBuild(n,s,m),e.onBeforeCompile(s,m),c=Q.acquireProgram(s,u),l.set(u,c),r.uniforms=s.uniforms;const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ne.uniform),Se(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=c.getUniforms(),f=AD.seqWithValue(p.seq,h);return r.currentProgram=c,r.uniformsList=f,c}function Se(e,t){const n=W.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ce.setAnimationLoop(function(e){ye&&ye(e)}),"undefined"!==typeof self&&Ce.setContext(self),this.setAnimationLoop=function(e){ye=e,fe.setAnimationLoop(e),null===e?Ce.stop():Ce.start()},fe.addEventListener("sessionstart",Ee),fe.addEventListener("sessionend",Ae),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===fe.enabled&&!0===fe.isPresenting&&(!0===fe.cameraAutoUpdate&&fe.updateCamera(t),t=fe.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,y),d=te.get(e,f.length),d.init(),f.push(d),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(k),L=this.localClippingEnabled,R=ne.init(this.clippingPlanes,L),h=ee.get(e,p.length),h.init(),p.push(h),_e(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(S,T),!0===R&&ne.beginShadows();const n=d.state.shadowsArray;if(re.render(n,e,t),!0===R&&ne.endShadows(),!0===this.info.autoReset&&this.info.reset(),ie.render(h,e),d.setupLights(m.useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];be(h,e,r,r.viewport)}}else be(h,e,t);null!==y&&(q.updateMultisampleRenderTarget(y),q.updateRenderTargetMipmap(y)),!0===e.isScene&&e.onAfterRender(m,e,t),le.resetDefaultState(),E=-1,A=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(e,t,n){W.get(e.texture).__webglTexture=t,W.get(e.depthTexture).__webglTexture=n;const r=W.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===V.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=W.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y=e,v=t,D=n;let r=!0,i=null,a=!1,o=!1;if(e){const n=W.get(e);void 0!==n.__useDefaultFramebuffer?(H.bindFramebuffer(36160,null),r=!1):void 0===n.__webglFramebuffer?q.setupRenderTarget(e):n.__hasExternalTextures&&q.rebindTextures(e,W.get(e.texture).__webglTexture,W.get(e.depthTexture).__webglTexture);const s=e.texture;(s.isData3DTexture||s.isDataArrayTexture||s.isCompressedArrayTexture)&&(o=!0);const u=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=u[t],a=!0):i=G.isWebGL2&&e.samples>0&&!1===q.useMultisampledRTT(e)?W.get(e).__webglMultisampledFramebuffer:u,C.copy(e.viewport),_.copy(e.scissor),b=e.scissorTest}else C.copy(M).multiplyScalar(w).floor(),_.copy(B).multiplyScalar(w).floor(),b=P;if(H.bindFramebuffer(36160,i)&&G.drawBuffers&&r&&H.drawBuffers(e,i),H.viewport(C),H.scissor(_),H.setScissorTest(b),a){const r=W.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,n)}else if(o){const r=W.get(e.texture),i=t||0;he.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}E=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){H.bindFramebuffer(36160,s);try{const o=e.texture,s=o.format,u=o.type;if(s!==pp&&ue.convert(s)!==he.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=u===hp&&(V.has("EXT_color_buffer_half_float")||G.isWebGL2&&V.has("EXT_color_buffer_float"));if(u!==up&&ue.convert(u)!==he.getParameter(35738)&&(u!==cp||!(G.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float")))&&!l)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&he.readPixels(t,n,r,i,ue.convert(s),ue.convert(u),a)}finally{const e=null!==y?W.get(y).__webglFramebuffer:null;H.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);q.setTexture2D(t,0),he.copyTexSubImage2D(3553,n,0,0,e.x,e.y,i,a),H.unbindTexture()},this.copyTextureToTexture=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=t.image.width,a=t.image.height,o=ue.convert(n.format),s=ue.convert(n.type);q.setTexture2D(n,0),he.pixelStorei(37440,n.flipY),he.pixelStorei(37441,n.premultiplyAlpha),he.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):he.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&he.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,u=ue.convert(r.format),l=ue.convert(r.type);let c;if(r.isData3DTexture)q.setTexture3D(r,0),c=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");q.setTexture2DArray(r,0),c=35866}he.pixelStorei(37440,r.flipY),he.pixelStorei(37441,r.premultiplyAlpha),he.pixelStorei(3317,r.unpackAlignment);const h=he.getParameter(3314),d=he.getParameter(32878),p=he.getParameter(3316),f=he.getParameter(3315),g=he.getParameter(32877),v=n.isCompressedTexture?n.mipmaps[0]:n.image;he.pixelStorei(3314,v.width),he.pixelStorei(32878,v.height),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?he.texSubImage3D(c,i,t.x,t.y,t.z,a,o,s,u,l,v.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),he.compressedTexSubImage3D(c,i,t.x,t.y,t.z,a,o,s,u,v.data)):he.texSubImage3D(c,i,t.x,t.y,t.z,a,o,s,u,l,v),he.pixelStorei(3314,h),he.pixelStorei(32878,d),he.pixelStorei(3316,p),he.pixelStorei(3315,f),he.pixelStorei(32877,g),0===i&&r.generateMipmaps&&he.generateMipmap(c),H.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?q.setTextureCube(e,0):e.isData3DTexture?q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?q.setTexture2DArray(e,0):q.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){v=0,D=0,y=null,H.reset(),le.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.defineProperties(py.prototype,{physicallyCorrectLights:{get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}}});(class extends py{}).prototype.isWebGL1Renderer=!0;class fy{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Np,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=zp()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zp()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zp()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const my=new ef;class gy{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)my.fromBufferAttribute(this,t),my.applyMatrix4(e),this.setXYZ(t,my.x,my.y,my.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)my.fromBufferAttribute(this,t),my.applyNormalMatrix(e),this.setXYZ(t,my.x,my.y,my.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)my.fromBufferAttribute(this,t),my.transformDirection(e),this.setXYZ(t,my.x,my.y,my.z);return this}setX(e,t){return this.normalized&&(t=Xp(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Xp(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Xp(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Xp(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=qp(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=qp(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=qp(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=qp(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Xp(t,this.array),n=Xp(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Xp(t,this.array),n=Xp(n,this.array),r=Xp(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Xp(t,this.array),n=Xp(n,this.array),r=Xp(r,this.array),i=Xp(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Hm(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new gy(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class vy extends Nm{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Om(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Dy;const yy=new ef,Ey=new ef,Ay=new ef,Cy=new Kp,_y=new Kp,by=new Yf,xy=new ef,Fy=new ef,wy=new ef,Sy=new Kp,Ty=new Kp,My=new Kp;class By extends Em{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Dy){Dy=new eg;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new fy(e,5);Dy.setIndex([0,1,2,0,2,3]),Dy.setAttribute("position",new gy(t,3,0,!1)),Dy.setAttribute("uv",new gy(t,2,3,!1))}this.geometry=Dy,this.material=void 0!==e?e:new vy,this.center=new Kp(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ey.setFromMatrixScale(this.matrixWorld),by.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ay.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ey.multiplyScalar(-Ay.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const a=this.center;Py(xy.set(-.5,-.5,0),Ay,a,Ey,r,i),Py(Fy.set(.5,-.5,0),Ay,a,Ey,r,i),Py(wy.set(.5,.5,0),Ay,a,Ey,r,i),Sy.set(0,0),Ty.set(1,0),My.set(1,1);let o=e.ray.intersectTriangle(xy,Fy,wy,!1,yy);if(null===o&&(Py(Fy.set(-.5,.5,0),Ay,a,Ey,r,i),Ty.set(0,1),o=e.ray.intersectTriangle(xy,wy,Fy,!1,yy),null===o))return;const s=e.ray.origin.distanceTo(yy);s<e.near||s>e.far||t.push({distance:s,point:yy.clone(),uv:Bm.getUV(yy,xy,Fy,wy,Sy,Ty,My,new Kp),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Py(e,t,n,r,i,a){Cy.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(_y.x=a*Cy.x-i*Cy.y,_y.y=i*Cy.x+a*Cy.y):_y.copy(Cy),e.copy(t),e.x+=_y.x,e.y+=_y.y,e.applyMatrix4(by)}class Ny extends Nm{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Om(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Ry=new ef,Ly=new ef,Iy=new Yf,ky=new Kf,Oy=new zf;class Uy extends Em{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eg,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ny;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Ry.fromBufferAttribute(t,e-1),Ly.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Ry.distanceTo(Ly);e.setAttribute("lineDistance",new qm(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Oy.copy(n.boundingSphere),Oy.applyMatrix4(r),Oy.radius+=i,!1===e.ray.intersectsSphere(Oy))return;Iy.copy(r).invert(),ky.copy(e.ray).applyMatrix4(Iy);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new ef,l=new ef,c=new ef,h=new ef,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p){for(let n=Math.max(0,a.start),r=Math.min(p.count,a.start+a.count)-1;n<r;n+=d){const r=p.getX(n),i=p.getX(n+1);u.fromBufferAttribute(f,r),l.fromBufferAttribute(f,i);if(ky.distanceSqToSegment(u,l,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const a=e.ray.origin.distanceTo(h);a<e.near||a>e.far||t.push({distance:a,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,a.start),r=Math.min(f.count,a.start+a.count)-1;n<r;n+=d){u.fromBufferAttribute(f,n),l.fromBufferAttribute(f,n+1);if(ky.distanceSqToSegment(u,l,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}class zy extends vf{constructor(e,t,n,r,i,a,o,s,u){super(e,t,n,r,i,a,o,s,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Vy{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let a;a=t||e*n[i-1];let o,s=0,u=i-1;for(;s<=u;)if(r=Math.floor(s+(u-s)/2),o=n[r]-a,o<0)s=r+1;else{if(!(o>0)){u=r;break}u=r-1}if(r=u,n[r]===a)return r/(i-1);const l=n[r];return(r+(a-l)/(n[r+1]-l))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new Kp:new ef);return s.copy(o).sub(a).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new ef,r=[],i=[],a=[],o=new ef,s=new Yf;for(let d=0;d<=e;d++){const t=d/e;r[d]=this.getTangentAt(t,new ef)}i[0]=new ef,a[0]=new ef;let u=Number.MAX_VALUE;const l=Math.abs(r[0].x),c=Math.abs(r[0].y),h=Math.abs(r[0].z);l<=u&&(u=l,n.set(1,0,0)),c<=u&&(u=c,n.set(0,1,0)),h<=u&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(let d=1;d<=e;d++){if(i[d]=i[d-1].clone(),a[d]=a[d-1].clone(),o.crossVectors(r[d-1],r[d]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(Vp(r[d-1].dot(r[d]),-1,1));i[d].applyMatrix4(s.makeRotationAxis(o,e))}a[d].crossVectors(r[d],i[d])}if(!0===t){let t=Math.acos(Vp(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],t*n)),a[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Gy extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t){const n=t||new Kp,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);const o=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=u-this.aY;s=n*e-r*t+this.aX,u=n*t+r*e+this.aY}return n.set(s,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function Hy(){let e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){let u=(t-e)/a-(n-e)/(a+o)+(n-t)/o,l=(n-t)/o-(r-t)/(o+s)+(r-n)/s;u*=o,l*=o,i(t,n,u,l)},calc:function(i){const a=i*i;return e+t*i+n*a+r*(a*i)}}}const jy=new ef,Wy=new Hy,qy=new Hy,Xy=new Hy;function Ky(e,t,n,r,i){const a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Yy(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Jy(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class $y extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Kp,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Kp;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(Jy(e,n.x,r.x,i.x,a.x),Jy(e,n.y,r.y,i.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Qy extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ef,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ef;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(Jy(e,n.x,r.x,i.x,a.x),Jy(e,n.y,r.y,i.y,a.y),Jy(e,n.z,r.z,i.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Zy extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class eE extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Kp;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp,n=this.v0,r=this.v1,i=this.v2;return t.set(Yy(e,n.x,r.x,i.x),Yy(e,n.y,r.y,i.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class tE extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ef;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef,n=this.v0,r=this.v1,i=this.v2;return t.set(Yy(e,n.x,r.x,i.x),Yy(e,n.y,r.y,i.y),Yy(e,n.z,r.z,i.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class nE extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kp,n=this.points,r=(n.length-1)*e,i=Math.floor(r),a=r-i,o=n[0===i?i:i-1],s=n[i],u=n[i>n.length-2?n.length-1:i+1],l=n[i>n.length-3?n.length-1:i+2];return t.set(Ky(a,o.x,s.x,u.x,l.x),Ky(a,o.y,s.y,u.y,l.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Kp).fromArray(n))}return this}}var rE=Object.freeze({__proto__:null,ArcCurve:class extends Gy{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef,n=this.points,r=n.length,i=(r-(this.closed?0:1))*e;let a,o,s=Math.floor(i),u=i-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/r)+1)*r:0===u&&s===r-1&&(s=r-2,u=1),this.closed||s>0?a=n[(s-1)%r]:(jy.subVectors(n[0],n[1]).add(n[0]),a=jy);const l=n[s%r],c=n[(s+1)%r];if(this.closed||s+2<r?o=n[(s+2)%r]:(jy.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=jy),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(l),e),n=Math.pow(l.distanceToSquared(c),e),r=Math.pow(c.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Wy.initNonuniformCatmullRom(a.x,l.x,c.x,o.x,t,n,r),qy.initNonuniformCatmullRom(a.y,l.y,c.y,o.y,t,n,r),Xy.initNonuniformCatmullRom(a.z,l.z,c.z,o.z,t,n,r)}else"catmullrom"===this.curveType&&(Wy.initCatmullRom(a.x,l.x,c.x,o.x,this.tension),qy.initCatmullRom(a.y,l.y,c.y,o.y,this.tension),Xy.initCatmullRom(a.z,l.z,c.z,o.z,this.tension));return t.set(Wy.calc(u),qy.calc(u),Xy.calc(u)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ef).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:$y,CubicBezierCurve3:Qy,EllipseCurve:Gy,LineCurve:Zy,LineCurve3:class extends Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ef,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:eE,QuadraticBezierCurve3:tE,SplineCurve:nE});class iE extends eg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};const u=this;r=Math.floor(r),i=Math.floor(i);const l=[],c=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,a=new Kp,f=new ef;let v=0;const D=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=r;e++)c.push(0,m*y,0),h.push(0,y,0),d.push(.5,.5),p++;const E=p;for(let e=0;e<=r;e++){const t=e/r*s+o,n=Math.cos(t),i=Math.sin(t);f.x=D*i,f.y=m*y,f.z=D*n,c.push(f.x,f.y,f.z),h.push(0,y,0),a.x=.5*n+.5,a.y=.5*i*y+.5,d.push(a.x,a.y),p++}for(let e=0;e<r;e++){const t=i+e,r=E+e;!0===n?l.push(r,r+1,t):l.push(r+1,r,t),v+=3}u.addGroup(g,v,!0===n?1:2),g+=v}!function(){const a=new ef,v=new ef;let D=0;const y=(t-e)/n;for(let u=0;u<=i;u++){const l=[],g=u/i,D=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*s+o,u=Math.sin(i),f=Math.cos(i);v.x=D*u,v.y=-g*n+m,v.z=D*f,c.push(v.x,v.y,v.z),a.set(u,y,f).normalize(),h.push(a.x,a.y,a.z),d.push(t,1-g),l.push(p++)}f.push(l)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=f[t][e],r=f[t+1][e],i=f[t+1][e+1],a=f[t][e+1];l.push(n,r,a),l.push(r,i,a),D+=6}u.addGroup(g,D,0),g+=D}(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new qm(c,3)),this.setAttribute("normal",new qm(h,3)),this.setAttribute("uv",new qm(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iE(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class aE extends iE{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,r,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}static fromJSON(e){return new aE(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class oE extends eg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let u=0;const l=[],c=new ef,h=new ef,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let D=0;0==g&&0==a?D=.5/t:g==n&&s==Math.PI&&(D=-.5/t);for(let n=0;n<=t;n++){const s=n/t;c.x=-e*Math.cos(r+s*i)*Math.sin(a+v*o),c.y=e*Math.cos(a+v*o),c.z=e*Math.sin(r+s*i)*Math.sin(a+v*o),p.push(c.x,c.y,c.z),h.copy(c).normalize(),f.push(h.x,h.y,h.z),m.push(s+D,1-v),d.push(u++)}l.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=l[g][e+1],r=l[g][e],i=l[g+1][e],o=l[g+1][e+1];(0!==g||a>0)&&d.push(t,r,o),(g!==n-1||s<Math.PI)&&d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new qm(p,3)),this.setAttribute("normal",new qm(f,3)),this.setAttribute("uv",new qm(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oE(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class sE extends eg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tE(new ef(-1,-1,0),new ef(-1,1,0),new ef(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new ef,s=new ef,u=new Kp;let l=new ef;const c=[],h=[],d=[],p=[];function f(i){l=e.getPointAt(i/t,l);const u=a.normals[i],d=a.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),a=-Math.cos(t);s.x=a*u.x+i*d.x,s.y=a*u.y+i*d.y,s.z=a*u.z+i*d.z,s.normalize(),h.push(s.x,s.y,s.z),o.x=l.x+n*s.x,o.y=l.y+n*s.y,o.z=l.z+n*s.z,c.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)u.x=e/t,u.y=n/r,d.push(u.x,u.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,o=(r+1)*(e-1)+t;p.push(n,i,o),p.push(i,a,o)}}()}(),this.setIndex(p),this.setAttribute("position",new qm(c,3)),this.setAttribute("normal",new qm(h,3)),this.setAttribute("uv",new qm(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new sE((new rE[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class uE extends Nm{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Om(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Om(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Kp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function lE(e,t,n){return hE(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function cE(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function hE(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}class dE{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(e>=i)break e;{const o=t[1];e<o&&(n=2,i=o);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0}}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let a=0;a!==r;++a)t[a]=n[i+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class pE extends dE{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:bp,endingEnd:bp}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case xp:i=e,o=2*t-n;break;case Fp:i=r.length-2,o=t+r[i]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case xp:a=e,s=2*n-t;break;case Fp:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}const u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=i*l,this._offsetNext=a*l}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,D=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let E=0;E!==o;++E)i[E]=g*a[l+E]+v*a[u+E]+D*a[s+E]+y*a[c+E];return i}}class fE extends dE{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(r-t),c=1-l;for(let h=0;h!==o;++h)i[h]=a[u+h]*c+a[s+h]*l;return i}}class mE extends dE{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class gE{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=cE(t,this.TimeBufferType),this.values=cE(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:cE(e.times,Array),values:cE(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new mE(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new fE(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new pE(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ap:t=this.InterpolantFactoryMethodDiscrete;break;case Cp:t=this.InterpolantFactoryMethodLinear;break;case _p:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ap;case this.InterpolantFactoryMethodLinear:return Cp;case this.InterpolantFactoryMethodSmooth:return _p}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=lE(n,i,a),this.values=lE(this.values,i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==i;o++){const t=n[o];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==a&&a>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,t,a),e=!1;break}a=t}if(void 0!==r&&hE(r))for(let o=0,s=r.length;o!==s;++o){const t=r[o];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=lE(this.times),t=lE(this.values),n=this.getValueSize(),r=this.getInterpolation()===_p,i=e.length-1;let a=1;for(let o=1;o<i;++o){let i=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(r)i=!0;else{const e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[r+o]||n!==t[a+o]){i=!0;break}}}if(i){if(o!==a){e[a]=e[o];const r=o*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,o=0;o!==n;++o)t[r+o]=t[e+o];++a}return a!==e.length?(this.times=lE(e,0,a),this.values=lE(t,0,a*n)):(this.times=e,this.values=t),this}clone(){const e=lE(this.times,0),t=lE(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}gE.prototype.TimeBufferType=Float32Array,gE.prototype.ValueBufferType=Float32Array,gE.prototype.DefaultInterpolation=Cp;class vE extends gE{}vE.prototype.ValueTypeName="bool",vE.prototype.ValueBufferType=Array,vE.prototype.DefaultInterpolation=Ap,vE.prototype.InterpolantFactoryMethodLinear=void 0,vE.prototype.InterpolantFactoryMethodSmooth=void 0;class DE extends gE{}DE.prototype.ValueTypeName="color";class yE extends gE{}yE.prototype.ValueTypeName="number";class EE extends dE{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t);let u=e*o;for(let l=u+o;u!==l;u+=4)Zp.slerpFlat(i,0,a,u-o,a,u,s);return i}}class AE extends gE{InterpolantFactoryMethodLinear(e){return new EE(this.times,this.values,this.getValueSize(),e)}}AE.prototype.ValueTypeName="quaternion",AE.prototype.DefaultInterpolation=Cp,AE.prototype.InterpolantFactoryMethodSmooth=void 0;class CE extends gE{}CE.prototype.ValueTypeName="string",CE.prototype.ValueBufferType=Array,CE.prototype.DefaultInterpolation=Ap,CE.prototype.InterpolantFactoryMethodLinear=void 0,CE.prototype.InterpolantFactoryMethodSmooth=void 0;class _E extends gE{}_E.prototype.ValueTypeName="vector";Error;const bE="\\[\\]\\.:\\/",xE=new RegExp("["+bE+"]","g"),FE="[^"+bE+"]",wE="[^"+bE.replace("\\.","")+"]",SE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",FE)+/(WCOD+)?/.source.replace("WCOD",wE)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",FE)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",FE)+"$"),TE=["material","materials","bones","map"];class ME{constructor(e,t,n){this.path=t,this.parsedPath=n||ME.parseTrackName(t),this.node=ME.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new ME.Composite(e,t,n):new ME(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(xE,"")}static parseTrackName(e){const t=SE.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==TE.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=ME.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ME.Composite=class{constructor(e,t,n){const r=n||ME.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},ME.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ME.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ME.prototype.GetterByBindingType=[ME.prototype._getValue_direct,ME.prototype._getValue_array,ME.prototype._getValue_arrayElement,ME.prototype._getValue_toArray],ME.prototype.SetterByBindingTypeAndVersioning=[[ME.prototype._setValue_direct,ME.prototype._setValue_direct_setNeedsUpdate,ME.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ME.prototype._setValue_array,ME.prototype._setValue_array_setNeedsUpdate,ME.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ME.prototype._setValue_arrayElement,ME.prototype._setValue_arrayElement_setNeedsUpdate,ME.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ME.prototype._setValue_fromArray,ME.prototype._setValue_fromArray_setNeedsUpdate,ME.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Md}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Md);const BE=4294967296;function PE(e){return e.x}function NE(e){return e.y}function RE(e){return e.z}var LE=Math.PI*(3-Math.sqrt(5)),IE=20*Math.PI/(9+Math.sqrt(221));function kE(e,t){t=t||2;var n,r=Math.min(3,Math.max(1,Math.round(t))),i=1,a=.001,o=1-Math.pow(a,1/300),s=0,u=.6,l=new Map,c=ze(p),h=Fe("tick","end"),d=function(){let e=1;return()=>(e=(1664525*e+1013904223)%BE)/BE}();function p(){f(),h.call("tick",n),i<a&&(c.stop(),h.call("end",n))}function f(t){var a,c,h=e.length;void 0===t&&(t=1);for(var d=0;d<t;++d)for(i+=(s-i)*o,l.forEach(function(e){e(i)}),a=0;a<h;++a)null==(c=e[a]).fx?c.x+=c.vx*=u:(c.x=c.fx,c.vx=0),r>1&&(null==c.fy?c.y+=c.vy*=u:(c.y=c.fy,c.vy=0)),r>2&&(null==c.fz?c.z+=c.vz*=u:(c.z=c.fz,c.vz=0));return n}function m(){for(var t,n=0,i=e.length;n<i;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),null!=t.fz&&(t.z=t.fz),isNaN(t.x)||r>1&&isNaN(t.y)||r>2&&isNaN(t.z)){var a=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),o=n*LE,s=n*IE;1===r?t.x=a:2===r?(t.x=a*Math.cos(o),t.y=a*Math.sin(o)):(t.x=a*Math.sin(o)*Math.cos(s),t.y=a*Math.cos(o),t.z=a*Math.sin(o)*Math.sin(s))}(isNaN(t.vx)||r>1&&isNaN(t.vy)||r>2&&isNaN(t.vz))&&(t.vx=0,r>1&&(t.vy=0),r>2&&(t.vz=0))}}function g(t){return t.initialize&&t.initialize(e,d,r),t}return null==e&&(e=[]),m(),n={tick:f,restart:function(){return c.restart(p),n},stop:function(){return c.stop(),n},numDimensions:function(e){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(e))),l.forEach(g),n):r},nodes:function(t){return arguments.length?(e=t,m(),l.forEach(g),n):e},alpha:function(e){return arguments.length?(i=+e,n):i},alphaMin:function(e){return arguments.length?(a=+e,n):a},alphaDecay:function(e){return arguments.length?(o=+e,n):+o},alphaTarget:function(e){return arguments.length?(s=+e,n):s},velocityDecay:function(e){return arguments.length?(u=1-e,n):1-u},randomSource:function(e){return arguments.length?(d=e,l.forEach(g),n):d},force:function(e,t){return arguments.length>1?(null==t?l.delete(e):l.set(e,g(t)),n):l.get(e)},find:function(){var t,n,i,a,o,s,u=Array.prototype.slice.call(arguments),l=u.shift()||0,c=(r>1?u.shift():null)||0,h=(r>2?u.shift():null)||0,d=u.shift()||1/0,p=0,f=e.length;for(d*=d,p=0;p<f;++p)(a=(t=l-(o=e[p]).x)*t+(n=c-(o.y||0))*n+(i=h-(o.z||0))*i)<d&&(s=o,d=a);return s},on:function(e,t){return arguments.length>1?(h.on(e,t),n):h.on(e)}}}function OE(e){return function(){return e}}function UE(e){return 1e-6*(e()-.5)}function zE(e){return e.index}function VE(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function GE(e){var t,n,r,i,a,o,s,u=zE,l=function(e){return 1/Math.min(a[e.source.index],a[e.target.index])},c=OE(30),h=1;function d(r){for(var a=0,u=e.length;a<h;++a)for(var l,c,d,p,f,m=0,g=0,v=0,D=0;m<u;++m)c=(l=e[m]).source,g=(d=l.target).x+d.vx-c.x-c.vx||UE(s),i>1&&(v=d.y+d.vy-c.y-c.vy||UE(s)),i>2&&(D=d.z+d.vz-c.z-c.vz||UE(s)),g*=p=((p=Math.sqrt(g*g+v*v+D*D))-n[m])/p*r*t[m],v*=p,D*=p,d.vx-=g*(f=o[m]),i>1&&(d.vy-=v*f),i>2&&(d.vz-=D*f),c.vx+=g*(f=1-f),i>1&&(c.vy+=v*f),i>2&&(c.vz+=D*f)}function p(){if(r){var i,s,l=r.length,c=e.length,h=new Map(r.map((e,t)=>[u(e,t,r),e]));for(i=0,a=new Array(l);i<c;++i)(s=e[i]).index=i,"object"!==typeof s.source&&(s.source=VE(h,s.source)),"object"!==typeof s.target&&(s.target=VE(h,s.target)),a[s.source.index]=(a[s.source.index]||0)+1,a[s.target.index]=(a[s.target.index]||0)+1;for(i=0,o=new Array(c);i<c;++i)s=e[i],o[i]=a[s.source.index]/(a[s.source.index]+a[s.target.index]);t=new Array(c),f(),n=new Array(c),m()}}function f(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function m(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+c(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e){r=e;for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];s=n.find(e=>"function"===typeof e)||Math.random,i=n.find(e=>[1,2,3].includes(e))||2,p()},d.links=function(t){return arguments.length?(e=t,p(),d):e},d.id=function(e){return arguments.length?(u=e,d):u},d.iterations=function(e){return arguments.length?(h=+e,d):h},d.strength=function(e){return arguments.length?(l="function"===typeof e?e:OE(+e),f(),d):l},d.distance=function(e){return arguments.length?(c="function"===typeof e?e:OE(+e),m(),d):c},d}function HE(e,t,n){if(isNaN(t))return e;var r,i,a,o,s,u,l=e._root,c={data:n},h=e._x0,d=e._x1;if(!l)return e._root=c,e;for(;l.length;)if((o=t>=(i=(h+d)/2))?h=i:d=i,r=l,!(l=l[s=+o]))return r[s]=c,e;if(t===(a=+e._x.call(null,l.data)))return c.next=l,r?r[s]=c:e._root=c,e;do{r=r?r[s]=new Array(2):e._root=new Array(2),(o=t>=(i=(h+d)/2))?h=i:d=i}while((s=+o)===(u=+(a>=i)));return r[u]=l,r[s]=c,e}function jE(e,t,n){this.node=e,this.x0=t,this.x1=n}function WE(e){return e[0]}function qE(e,t){var n=new XE(null==t?WE:t,NaN,NaN);return null==e?n:n.addAll(e)}function XE(e,t,n){this._x=e,this._x0=t,this._x1=n,this._root=void 0}function KE(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var YE=qE.prototype=XE.prototype;function JE(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,u,l,c,h,d,p=e._root,f={data:r},m=e._x0,g=e._y0,v=e._x1,D=e._y1;if(!p)return e._root=f,e;for(;p.length;)if((l=t>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+D)/2))?g=o:D=o,i=p,!(p=p[h=c<<1|l]))return i[h]=f,e;if(s=+e._x.call(null,p.data),u=+e._y.call(null,p.data),t===s&&n===u)return f.next=p,i?i[h]=f:e._root=f,e;do{i=i?i[h]=new Array(4):e._root=new Array(4),(l=t>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+D)/2))?g=o:D=o}while((h=c<<1|l)===(d=(u>=o)<<1|s>=a));return i[d]=p,i[h]=f,e}function $E(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function QE(e){return e[0]}function ZE(e){return e[1]}function eA(e,t,n){var r=new tA(null==t?QE:t,null==n?ZE:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function tA(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function nA(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}YE.copy=function(){var e,t,n=new XE(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=KE(r),n;for(e=[{source:r,target:n._root=new Array(2)}];r=e.pop();)for(var i=0;i<2;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(2)}):r.target[i]=KE(t));return n},YE.add=function(e){const t=+this._x.call(null,e);return HE(this.cover(t),t,e)},YE.addAll=function(e){Array.isArray(e)||(e=Array.from(e));const t=e.length,n=new Float64Array(t);let r=1/0,i=-1/0;for(let a,o=0;o<t;++o)isNaN(a=+this._x.call(null,e[o]))||(n[o]=a,a<r&&(r=a),a>i&&(i=a));if(r>i)return this;this.cover(r).cover(i);for(let a=0;a<t;++a)HE(this,n[a],e[a]);return this},YE.cover=function(e){if(isNaN(e=+e))return this;var t=this._x0,n=this._x1;if(isNaN(t))n=(t=Math.floor(e))+1;else{for(var r,i,a=n-t||1,o=this._root;t>e||e>=n;)switch(i=+(e<t),(r=new Array(2))[i]=o,o=r,a*=2,i){case 0:n=t+a;break;case 1:t=n-a}this._root&&this._root.length&&(this._root=o)}return this._x0=t,this._x1=n,this},YE.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},YE.extent=function(e){return arguments.length?this.cover(+e[0][0]).cover(+e[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},YE.find=function(e,t){var n,r,i,a,o,s=this._x0,u=this._x1,l=[],c=this._root;for(c&&l.push(new jE(c,s,u)),null==t?t=1/0:(s=e-t,u=e+t);a=l.pop();)if(!(!(c=a.node)||(r=a.x0)>u||(i=a.x1)<s))if(c.length){var h=(r+i)/2;l.push(new jE(c[1],h,i),new jE(c[0],r,h)),(o=+(e>=h))&&(a=l[l.length-1],l[l.length-1]=l[l.length-1-o],l[l.length-1-o]=a)}else{var d=Math.abs(e-+this._x.call(null,c.data));d<t&&(t=d,s=e-d,u=e+d,n=c.data)}return n},YE.remove=function(e){if(isNaN(a=+this._x.call(null,e)))return this;var t,n,r,i,a,o,s,u,l,c=this._root,h=this._x0,d=this._x1;if(!c)return this;if(c.length)for(;;){if((s=a>=(o=(h+d)/2))?h=o:d=o,t=c,!(c=c[u=+s]))return this;if(!c.length)break;t[u+1&1]&&(n=t,l=u)}for(;c.data!==e;)if(r=c,!(c=c.next))return this;return(i=c.next)&&delete c.next,r?(i?r.next=i:delete r.next,this):t?(i?t[u]=i:delete t[u],(c=t[0]||t[1])&&c===(t[1]||t[0])&&!c.length&&(n?n[l]=c:this._root=c),this):(this._root=i,this)},YE.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},YE.root=function(){return this._root},YE.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},YE.visit=function(e){var t,n,r,i,a=[],o=this._root;for(o&&a.push(new jE(o,this._x0,this._x1));t=a.pop();)if(!e(o=t.node,r=t.x0,i=t.x1)&&o.length){var s=(r+i)/2;(n=o[1])&&a.push(new jE(n,s,i)),(n=o[0])&&a.push(new jE(n,r,s))}return this},YE.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new jE(this._root,this._x0,this._x1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.x1,u=(o+s)/2;(a=i[0])&&n.push(new jE(a,o,u)),(a=i[1])&&n.push(new jE(a,u,s))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.x1);return this},YE.x=function(e){return arguments.length?(this._x=e,this):this._x};var rA=eA.prototype=tA.prototype;function iA(e,t,n,r,i){if(isNaN(t)||isNaN(n)||isNaN(r))return e;var a,o,s,u,l,c,h,d,p,f,m,g,v=e._root,D={data:i},y=e._x0,E=e._y0,A=e._z0,C=e._x1,_=e._y1,b=e._z1;if(!v)return e._root=D,e;for(;v.length;)if((d=t>=(o=(y+C)/2))?y=o:C=o,(p=n>=(s=(E+_)/2))?E=s:_=s,(f=r>=(u=(A+b)/2))?A=u:b=u,a=v,!(v=v[m=f<<2|p<<1|d]))return a[m]=D,e;if(l=+e._x.call(null,v.data),c=+e._y.call(null,v.data),h=+e._z.call(null,v.data),t===l&&n===c&&r===h)return D.next=v,a?a[m]=D:e._root=D,e;do{a=a?a[m]=new Array(8):e._root=new Array(8),(d=t>=(o=(y+C)/2))?y=o:C=o,(p=n>=(s=(E+_)/2))?E=s:_=s,(f=r>=(u=(A+b)/2))?A=u:b=u}while((m=f<<2|p<<1|d)===(g=(h>=u)<<2|(c>=s)<<1|l>=o));return a[g]=v,a[m]=D,e}function aA(e,t,n,r,i,a,o){this.node=e,this.x0=t,this.y0=n,this.z0=r,this.x1=i,this.y1=a,this.z1=o}rA.copy=function(){var e,t,n=new tA(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=nA(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=nA(t));return n},rA.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return JE(this.cover(t,n),t,n,e)},rA.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),u=1/0,l=1/0,c=-1/0,h=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<u&&(u=r),r>c&&(c=r),i<l&&(l=i),i>h&&(h=i));if(u>c||l>h)return this;for(this.cover(u,l).cover(c,h),n=0;n<a;++n)JE(this,o[n],s[n],e[n]);return this},rA.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,u=i-n||1,l=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=l,l=o,u*=2,s){case 0:i=n+u,a=r+u;break;case 1:n=i-u,a=r+u;break;case 2:i=n+u,r=a-u;break;case 3:n=i-u,r=a-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},rA.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},rA.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},rA.find=function(e,t,n){var r,i,a,o,s,u,l,c=this._x0,h=this._y0,d=this._x1,p=this._y1,f=[],m=this._root;for(m&&f.push(new $E(m,c,h,d,p)),null==n?n=1/0:(c=e-n,h=t-n,d=e+n,p=t+n,n*=n);u=f.pop();)if(!(!(m=u.node)||(i=u.x0)>d||(a=u.y0)>p||(o=u.x1)<c||(s=u.y1)<h))if(m.length){var g=(i+o)/2,v=(a+s)/2;f.push(new $E(m[3],g,v,o,s),new $E(m[2],i,v,g,s),new $E(m[1],g,a,o,v),new $E(m[0],i,a,g,v)),(l=(t>=v)<<1|e>=g)&&(u=f[f.length-1],f[f.length-1]=f[f.length-1-l],f[f.length-1-l]=u)}else{var D=e-+this._x.call(null,m.data),y=t-+this._y.call(null,m.data),E=D*D+y*y;if(E<n){var A=Math.sqrt(n=E);c=e-A,h=t-A,d=e+A,p=t+A,r=m.data}}return r},rA.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,u,l,c,h,d,p=this._root,f=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!p)return this;if(p.length)for(;;){if((l=a>=(s=(f+g)/2))?f=s:g=s,(c=o>=(u=(m+v)/2))?m=u:v=u,t=p,!(p=p[h=c<<1|l]))return this;if(!p.length)break;(t[h+1&3]||t[h+2&3]||t[h+3&3])&&(n=t,d=h)}for(;p.data!==e;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):t?(i?t[h]=i:delete t[h],(p=t[0]||t[1]||t[2]||t[3])&&p===(t[3]||t[2]||t[1]||t[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=i,this)},rA.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},rA.root=function(){return this._root},rA.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},rA.visit=function(e){var t,n,r,i,a,o,s=[],u=this._root;for(u&&s.push(new $E(u,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&u.length){var l=(r+a)/2,c=(i+o)/2;(n=u[3])&&s.push(new $E(n,l,c,a,o)),(n=u[2])&&s.push(new $E(n,r,c,l,o)),(n=u[1])&&s.push(new $E(n,l,i,a,c)),(n=u[0])&&s.push(new $E(n,r,i,l,c))}return this},rA.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new $E(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,u=t.x1,l=t.y1,c=(o+u)/2,h=(s+l)/2;(a=i[0])&&n.push(new $E(a,o,s,c,h)),(a=i[1])&&n.push(new $E(a,c,s,u,h)),(a=i[2])&&n.push(new $E(a,o,h,c,l)),(a=i[3])&&n.push(new $E(a,c,h,u,l))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},rA.x=function(e){return arguments.length?(this._x=e,this):this._x},rA.y=function(e){return arguments.length?(this._y=e,this):this._y};const oA=(e,t,n,r,i,a)=>Math.sqrt((e-r)**2+(t-i)**2+(n-a)**2);function sA(e){return e[0]}function uA(e){return e[1]}function lA(e){return e[2]}function cA(e,t,n,r){var i=new hA(null==t?sA:t,null==n?uA:n,null==r?lA:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function hA(e,t,n,r,i,a,o,s,u){this._x=e,this._y=t,this._z=n,this._x0=r,this._y0=i,this._z0=a,this._x1=o,this._y1=s,this._z1=u,this._root=void 0}function dA(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var pA=cA.prototype=hA.prototype;function fA(){var e,t,n,r,i,a,o=OE(-30),s=1,u=1/0,l=.81;function c(r){var a,o=e.length,s=(1===t?qE(e,PE):2===t?eA(e,PE,NE):3===t?cA(e,PE,NE,RE):null).visitAfter(d);for(i=r,a=0;a<o;++a)n=e[a],s.visit(p)}function h(){if(e){var t,n,r=e.length;for(a=new Array(r),t=0;t<r;++t)n=e[t],a[n.index]=+o(n,t,e)}}function d(e){var n,r,i,o,s,u,l=0,c=0,h=e.length;if(h){for(i=o=s=u=0;u<h;++u)(n=e[u])&&(r=Math.abs(n.value))&&(l+=n.value,c+=r,i+=r*(n.x||0),o+=r*(n.y||0),s+=r*(n.z||0));l*=Math.sqrt(4/h),e.x=i/c,t>1&&(e.y=o/c),t>2&&(e.z=s/c)}else{(n=e).x=n.data.x,t>1&&(n.y=n.data.y),t>2&&(n.z=n.data.z);do{l+=a[n.data.index]}while(n=n.next)}e.value=l}function p(e,o,c,h,d){if(!e.value)return!0;var p=[c,h,d][t-1],f=e.x-n.x,m=t>1?e.y-n.y:0,g=t>2?e.z-n.z:0,v=p-o,D=f*f+m*m+g*g;if(v*v/l<D)return D<u&&(0===f&&(D+=(f=UE(r))*f),t>1&&0===m&&(D+=(m=UE(r))*m),t>2&&0===g&&(D+=(g=UE(r))*g),D<s&&(D=Math.sqrt(s*D)),n.vx+=f*e.value*i/D,t>1&&(n.vy+=m*e.value*i/D),t>2&&(n.vz+=g*e.value*i/D)),!0;if(!(e.length||D>=u)){(e.data!==n||e.next)&&(0===f&&(D+=(f=UE(r))*f),t>1&&0===m&&(D+=(m=UE(r))*m),t>2&&0===g&&(D+=(g=UE(r))*g),D<s&&(D=Math.sqrt(s*D)));do{e.data!==n&&(v=a[e.data.index]*i/D,n.vx+=f*v,t>1&&(n.vy+=m*v),t>2&&(n.vz+=g*v))}while(e=e.next)}}return c.initialize=function(n){e=n;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];r=a.find(e=>"function"===typeof e)||Math.random,t=a.find(e=>[1,2,3].includes(e))||2,h()},c.strength=function(e){return arguments.length?(o="function"===typeof e?e:OE(+e),h(),c):o},c.distanceMin=function(e){return arguments.length?(s=e*e,c):Math.sqrt(s)},c.distanceMax=function(e){return arguments.length?(u=e*e,c):Math.sqrt(u)},c.theta=function(e){return arguments.length?(l=e*e,c):Math.sqrt(l)},c}function mA(e,t,n){var r,i=1;function a(){var a,o,s=r.length,u=0,l=0,c=0;for(a=0;a<s;++a)u+=(o=r[a]).x||0,l+=o.y||0,c+=o.z||0;for(u=(u/s-e)*i,l=(l/s-t)*i,c=(c/s-n)*i,a=0;a<s;++a)o=r[a],u&&(o.x-=u),l&&(o.y-=l),c&&(o.z-=c)}return null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),a.initialize=function(e){r=e},a.x=function(t){return arguments.length?(e=+t,a):e},a.y=function(e){return arguments.length?(t=+e,a):t},a.z=function(e){return arguments.length?(n=+e,a):n},a.strength=function(e){return arguments.length?(i=+e,a):i},a}pA.copy=function(){var e,t,n=new hA(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=dA(r),n;for(e=[{source:r,target:n._root=new Array(8)}];r=e.pop();)for(var i=0;i<8;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(8)}):r.target[i]=dA(t));return n},pA.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e),r=+this._z.call(null,e);return iA(this.cover(t,n,r),t,n,r,e)},pA.addAll=function(e){Array.isArray(e)||(e=Array.from(e));const t=e.length,n=new Float64Array(t),r=new Float64Array(t),i=new Float64Array(t);let a=1/0,o=1/0,s=1/0,u=-1/0,l=-1/0,c=-1/0;for(let h,d,p,f,m=0;m<t;++m)isNaN(d=+this._x.call(null,h=e[m]))||isNaN(p=+this._y.call(null,h))||isNaN(f=+this._z.call(null,h))||(n[m]=d,r[m]=p,i[m]=f,d<a&&(a=d),d>u&&(u=d),p<o&&(o=p),p>l&&(l=p),f<s&&(s=f),f>c&&(c=f));if(a>u||o>l||s>c)return this;this.cover(a,o,s).cover(u,l,c);for(let h=0;h<t;++h)iA(this,n[h],r[h],i[h],e[h]);return this},pA.cover=function(e,t,n){if(isNaN(e=+e)||isNaN(t=+t)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,a=this._z0,o=this._x1,s=this._y1,u=this._z1;if(isNaN(r))o=(r=Math.floor(e))+1,s=(i=Math.floor(t))+1,u=(a=Math.floor(n))+1;else{for(var l,c,h=o-r||1,d=this._root;r>e||e>=o||i>t||t>=s||a>n||n>=u;)switch(c=(n<a)<<2|(t<i)<<1|e<r,(l=new Array(8))[c]=d,d=l,h*=2,c){case 0:o=r+h,s=i+h,u=a+h;break;case 1:r=o-h,s=i+h,u=a+h;break;case 2:o=r+h,i=s-h,u=a+h;break;case 3:r=o-h,i=s-h,u=a+h;break;case 4:o=r+h,s=i+h,a=u-h;break;case 5:r=o-h,s=i+h,a=u-h;break;case 6:o=r+h,i=s-h,a=u-h;break;case 7:r=o-h,i=s-h,a=u-h}this._root&&this._root.length&&(this._root=d)}return this._x0=r,this._y0=i,this._z0=a,this._x1=o,this._y1=s,this._z1=u,this},pA.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},pA.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1],+e[0][2]).cover(+e[1][0],+e[1][1],+e[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},pA.find=function(e,t,n,r){var i,a,o,s,u,l,c,h,d,p=this._x0,f=this._y0,m=this._z0,g=this._x1,v=this._y1,D=this._z1,y=[],E=this._root;for(E&&y.push(new aA(E,p,f,m,g,v,D)),null==r?r=1/0:(p=e-r,f=t-r,m=n-r,g=e+r,v=t+r,D=n+r,r*=r);h=y.pop();)if(!(!(E=h.node)||(a=h.x0)>g||(o=h.y0)>v||(s=h.z0)>D||(u=h.x1)<p||(l=h.y1)<f||(c=h.z1)<m))if(E.length){var A=(a+u)/2,C=(o+l)/2,_=(s+c)/2;y.push(new aA(E[7],A,C,_,u,l,c),new aA(E[6],a,C,_,A,l,c),new aA(E[5],A,o,_,u,C,c),new aA(E[4],a,o,_,A,C,c),new aA(E[3],A,C,s,u,l,_),new aA(E[2],a,C,s,A,l,_),new aA(E[1],A,o,s,u,C,_),new aA(E[0],a,o,s,A,C,_)),(d=(n>=_)<<2|(t>=C)<<1|e>=A)&&(h=y[y.length-1],y[y.length-1]=y[y.length-1-d],y[y.length-1-d]=h)}else{var b=e-+this._x.call(null,E.data),x=t-+this._y.call(null,E.data),F=n-+this._z.call(null,E.data),w=b*b+x*x+F*F;if(w<r){var S=Math.sqrt(r=w);p=e-S,f=t-S,m=n-S,g=e+S,v=t+S,D=n+S,i=E.data}}return i},pA.findAllWithinRadius=function(e,t,n,r){const i=[],a=e-r,o=t-r,s=n-r,u=e+r,l=t+r,c=n+r;return this.visit((h,d,p,f,m,g,v)=>{if(!h.length)do{const a=h.data;oA(e,t,n,this._x(a),this._y(a),this._z(a))<=r&&i.push(a)}while(h=h.next);return d>u||p>l||f>c||m<a||g<o||v<s}),i},pA.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e))||isNaN(s=+this._z.call(null,e)))return this;var t,n,r,i,a,o,s,u,l,c,h,d,p,f,m,g=this._root,v=this._x0,D=this._y0,y=this._z0,E=this._x1,A=this._y1,C=this._z1;if(!g)return this;if(g.length)for(;;){if((h=a>=(u=(v+E)/2))?v=u:E=u,(d=o>=(l=(D+A)/2))?D=l:A=l,(p=s>=(c=(y+C)/2))?y=c:C=c,t=g,!(g=g[f=p<<2|d<<1|h]))return this;if(!g.length)break;(t[f+1&7]||t[f+2&7]||t[f+3&7]||t[f+4&7]||t[f+5&7]||t[f+6&7]||t[f+7&7])&&(n=t,m=f)}for(;g.data!==e;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(g=t[0]||t[1]||t[2]||t[3]||t[4]||t[5]||t[6]||t[7])&&g===(t[7]||t[6]||t[5]||t[4]||t[3]||t[2]||t[1]||t[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},pA.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},pA.root=function(){return this._root},pA.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},pA.visit=function(e){var t,n,r,i,a,o,s,u,l=[],c=this._root;for(c&&l.push(new aA(c,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=l.pop();)if(!e(c=t.node,r=t.x0,i=t.y0,a=t.z0,o=t.x1,s=t.y1,u=t.z1)&&c.length){var h=(r+o)/2,d=(i+s)/2,p=(a+u)/2;(n=c[7])&&l.push(new aA(n,h,d,p,o,s,u)),(n=c[6])&&l.push(new aA(n,r,d,p,h,s,u)),(n=c[5])&&l.push(new aA(n,h,i,p,o,d,u)),(n=c[4])&&l.push(new aA(n,r,i,p,h,d,u)),(n=c[3])&&l.push(new aA(n,h,d,a,o,s,p)),(n=c[2])&&l.push(new aA(n,r,d,a,h,s,p)),(n=c[1])&&l.push(new aA(n,h,i,a,o,d,p)),(n=c[0])&&l.push(new aA(n,r,i,a,h,d,p))}return this},pA.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new aA(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,u=t.z0,l=t.x1,c=t.y1,h=t.z1,d=(o+l)/2,p=(s+c)/2,f=(u+h)/2;(a=i[0])&&n.push(new aA(a,o,s,u,d,p,f)),(a=i[1])&&n.push(new aA(a,d,s,u,l,p,f)),(a=i[2])&&n.push(new aA(a,o,p,u,d,c,f)),(a=i[3])&&n.push(new aA(a,d,p,u,l,c,f)),(a=i[4])&&n.push(new aA(a,o,s,f,d,p,h)),(a=i[5])&&n.push(new aA(a,d,s,f,l,p,h)),(a=i[6])&&n.push(new aA(a,o,p,f,d,c,h)),(a=i[7])&&n.push(new aA(a,d,p,f,l,c,h))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.z0,t.x1,t.y1,t.z1);return this},pA.x=function(e){return arguments.length?(this._x=e,this):this._x},pA.y=function(e){return arguments.length?(this._y=e,this):this._y},pA.z=function(e){return arguments.length?(this._z=e,this):this._z};var gA=n(907),vA=n(78);const DA=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const yA="object"==typeof global&&global&&global.Object===Object&&global;var EA="object"==typeof self&&self&&self.Object===Object&&self;const AA=yA||EA||Function("return this")();const CA=function(){return AA.Date.now()};var _A=/\s/;const bA=function(e){for(var t=e.length;t--&&_A.test(e.charAt(t)););return t};var xA=/^\s+/;const FA=function(e){return e?e.slice(0,bA(e)+1).replace(xA,""):e};const wA=AA.Symbol;var SA=Object.prototype,TA=SA.hasOwnProperty,MA=SA.toString,BA=wA?wA.toStringTag:void 0;const PA=function(e){var t=TA.call(e,BA),n=e[BA];try{e[BA]=void 0;var r=!0}catch(nY){}var i=MA.call(e);return r&&(t?e[BA]=n:delete e[BA]),i};var NA=Object.prototype.toString;const RA=function(e){return NA.call(e)};var LA=wA?wA.toStringTag:void 0;const IA=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":LA&&LA in Object(e)?PA(e):RA(e)};const kA=function(e){return null!=e&&"object"==typeof e};const OA=function(e){return"symbol"==typeof e||kA(e)&&"[object Symbol]"==IA(e)};var UA=/^[-+]0x[0-9a-f]+$/i,zA=/^0b[01]+$/i,VA=/^0o[0-7]+$/i,GA=parseInt;const HA=function(e){if("number"==typeof e)return e;if(OA(e))return NaN;if(DA(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=DA(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=FA(e);var n=zA.test(e);return n||VA.test(e)?GA(e.slice(2),n?2:8):UA.test(e)?NaN:+e};var jA=Math.max,WA=Math.min;const qA=function(e,t,n){var r,i,a,o,s,u,l=0,c=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n)}function f(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-l>=a}function m(){var e=CA();if(f(e))return g(e);s=setTimeout(m,function(e){var n=t-(e-u);return h?WA(n,a-(e-l)):n}(e))}function g(e){return s=void 0,d&&r?p(e):(r=i=void 0,o)}function v(){var e=CA(),n=f(e);if(r=arguments,i=this,u=e,n){if(void 0===s)return function(e){return l=e,s=setTimeout(m,t),c?p(e):o}(u);if(h)return clearTimeout(s),s=setTimeout(m,t),p(u)}return void 0===s&&(s=setTimeout(m,t)),o}return t=HA(t)||0,DA(n)&&(c=!!n.leading,a=(h="maxWait"in n)?jA(HA(n.maxWait)||0,t):a,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=u=i=s=void 0},v.flush=function(){return void 0===s?o:g(CA())},v};function XA(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function KA(e,t,n){return Object.defineProperty(e,"prototype",{writable:!1}),e}function YA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return XA(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?XA(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var JA=KA(function e(t,n){var r=n.default,i=void 0===r?null:r,a=n.triggerUpdate,o=void 0===a||a,s=n.onChange,u=void 0===s?function(e,t){}:s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.defaultVal=i,this.triggerUpdate=o,this.onChange=u});function $A(e){var t=e.stateInit,n=void 0===t?function(){return{}}:t,r=e.props,i=void 0===r?{}:r,a=e.methods,o=void 0===a?{}:a,s=e.aliases,u=void 0===s?{}:s,l=e.init,c=void 0===l?function(){}:l,h=e.update,d=void 0===h?function(){}:h,p=Object.keys(i).map(function(e){return new JA(e,i[e])});return function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var a=!!(this instanceof e?this.constructor:void 0),s=a?r.shift():void 0,l=r[0],h=void 0===l?{}:l,f=Object.assign({},n instanceof Function?n(h):n,{initialised:!1}),m={};function g(e){return v(e,h),D(),g}var v=function(e,t){c.call(g,e,f,t),f.initialised=!0},D=qA(function(){f.initialised&&(d.call(g,f,m),m={})},1);return p.forEach(function(e){g[e.name]=function(e){var t=e.name,n=e.triggerUpdate,r=void 0!==n&&n,i=e.onChange,a=void 0===i?function(e,t){}:i,o=e.defaultVal,s=void 0===o?null:o;return function(e){var n=f[t];if(!arguments.length)return n;var i=void 0===e?s:e;return f[t]=i,a.call(g,i,f,n),!m.hasOwnProperty(t)&&(m[t]=n),r&&D(),g}}(e)}),Object.keys(o).forEach(function(e){g[e]=function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=o[e]).call.apply(t,[g,f].concat(r))}}),Object.entries(u).forEach(function(e){var t=YA(e,2),n=t[0],r=t[1];return g[n]=g[r]}),g.resetProps=function(){return p.forEach(function(e){g[e.name](e.defaultVal)}),g},g.resetProps(),f._rerender=D,a&&s&&g(s),g}}var QA=function(e){return"function"===typeof e?e:"string"===typeof e?function(t){return t[e]}:function(t){return e}};function ZA(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function eC(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function tC(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function nC(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function rC(e,t){return e.get(nC(e,t))}function iC(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function aC(e,t,n){return e.set(nC(e,t),n),n}function oC(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,lC(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function sC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||cC(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uC(e){return function(e){if(Array.isArray(e))return tC(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||cC(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lC(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function cC(e,t){if(e){if("string"==typeof e)return tC(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tC(e,t):void 0}}var hC=new WeakMap,dC=new WeakMap,pC=new WeakMap,fC=new WeakMap,mC=new WeakMap,gC=new WeakMap,vC=function(){return oC(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),iC(this,hC,new Map),iC(this,dC,new Map),iC(this,pC,function(e){return e}),iC(this,fC,function(){return{}}),iC(this,mC,function(){}),iC(this,gC,function(){})},[{key:"getObj",value:function(e){return rC(hC,this).get(rC(pC,this).call(this,e))}},{key:"getData",value:function(e){return rC(dC,this).get(e)}},{key:"entries",value:function(){return uC(rC(dC,this).entries()).map(function(e){var t=sC(e,2),n=t[0];return[t[1],n]})}},{key:"id",value:function(e){return aC(pC,this,QA(e)),this}},{key:"onCreateObj",value:function(e){return aC(fC,this,e),this}},{key:"onUpdateObj",value:function(e){return aC(mC,this,e),this}},{key:"onRemoveObj",value:function(e){return aC(gC,this,e),this}},{key:"digest",value:function(e){var t=this;e.filter(function(e){return!rC(hC,t).has(rC(pC,t).call(t,e))}).forEach(function(e){var n=rC(fC,t).call(t,e);rC(hC,t).set(rC(pC,t).call(t,e),n),rC(dC,t).set(n,e)});var n=new Map(e.map(function(e){return[rC(pC,t).call(t,e),e]}));return rC(hC,this).forEach(function(e,r){n.has(r)?rC(mC,t).call(t,e,n.get(r)):(rC(gC,t).call(t,e,r),rC(hC,t).delete(r),rC(dC,t).delete(e))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();class DC extends Map{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CC;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[n,r]of e)this.set(n,r)}get(e){return super.get(yC(this,e))}has(e){return super.has(yC(this,e))}set(e,t){return super.set(EC(this,e),t)}delete(e){return super.delete(AC(this,e))}}Set;function yC(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):t}function EC(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):(n.set(i,t),t)}function AC(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)&&(t=n.get(i),n.delete(i)),t}function CC(e){return null!==e&&"object"===typeof e?e.valueOf():e}const _C=Symbol("implicit");const bC=function(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function xC(e){return xC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xC(e)}var FC=/^\s+/,wC=/\s+$/;function SC(e,t){if(t=t||{},(e=e||"")instanceof SC)return e;if(!(this instanceof SC))return new SC(e,t);var n=function(e){var t={r:0,g:0,b:0},n=1,r=null,i=null,a=null,o=!1,s=!1;"string"==typeof e&&(e=function(e){e=e.replace(FC,"").replace(wC,"").toLowerCase();var t,n=!1;if(WC[e])e=WC[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=t_.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=t_.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=t_.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=t_.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=t_.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=t_.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=t_.hex8.exec(e))return{r:JC(t[1]),g:JC(t[2]),b:JC(t[3]),a:e_(t[4]),format:n?"name":"hex8"};if(t=t_.hex6.exec(e))return{r:JC(t[1]),g:JC(t[2]),b:JC(t[3]),format:n?"name":"hex"};if(t=t_.hex4.exec(e))return{r:JC(t[1]+""+t[1]),g:JC(t[2]+""+t[2]),b:JC(t[3]+""+t[3]),a:e_(t[4]+""+t[4]),format:n?"name":"hex8"};if(t=t_.hex3.exec(e))return{r:JC(t[1]+""+t[1]),g:JC(t[2]+""+t[2]),b:JC(t[3]+""+t[3]),format:n?"name":"hex"};return!1}(e));"object"==xC(e)&&(n_(e.r)&&n_(e.g)&&n_(e.b)?(t=function(e,t,n){return{r:255*KC(e,255),g:255*KC(t,255),b:255*KC(n,255)}}(e.r,e.g,e.b),o=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):n_(e.h)&&n_(e.s)&&n_(e.v)?(r=QC(e.s),i=QC(e.v),t=function(e,t,n){e=6*KC(e,360),t=KC(t,100),n=KC(n,100);var r=Math.floor(e),i=e-r,a=n*(1-t),o=n*(1-i*t),s=n*(1-(1-i)*t),u=r%6,l=[n,o,a,a,s,n][u],c=[s,n,n,o,a,a][u],h=[a,a,s,n,n,o][u];return{r:255*l,g:255*c,b:255*h}}(e.h,r,i),o=!0,s="hsv"):n_(e.h)&&n_(e.s)&&n_(e.l)&&(r=QC(e.s),a=QC(e.l),t=function(e,t,n){var r,i,a;function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=KC(e,360),t=KC(t,100),n=KC(n,100),0===t)r=i=a=n;else{var s=n<.5?n*(1+t):n+t-n*t,u=2*n-s;r=o(u,s,e+1/3),i=o(u,s,e),a=o(u,s,e-1/3)}return{r:255*r,g:255*i,b:255*a}}(e.h,r,a),o=!0,s="hsl"),e.hasOwnProperty("a")&&(n=e.a));return n=XC(n),{ok:o,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function TC(e,t,n){e=KC(e,255),t=KC(t,255),n=KC(n,255);var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),s=(a+o)/2;if(a==o)r=i=0;else{var u=a-o;switch(i=s>.5?u/(2-a-o):u/(a+o),a){case e:r=(t-n)/u+(t<n?6:0);break;case t:r=(n-e)/u+2;break;case n:r=(e-t)/u+4}r/=6}return{h:r,s:i,l:s}}function MC(e,t,n){e=KC(e,255),t=KC(t,255),n=KC(n,255);var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),s=a,u=a-o;if(i=0===a?0:u/a,a==o)r=0;else{switch(a){case e:r=(t-n)/u+(t<n?6:0);break;case t:r=(n-e)/u+2;break;case n:r=(e-t)/u+4}r/=6}return{h:r,s:i,v:s}}function BC(e,t,n,r){var i=[$C(Math.round(e).toString(16)),$C(Math.round(t).toString(16)),$C(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function PC(e,t,n,r){return[$C(ZC(r)),$C(Math.round(e).toString(16)),$C(Math.round(t).toString(16)),$C(Math.round(n).toString(16))].join("")}function NC(e,t){t=0===t?0:t||10;var n=SC(e).toHsl();return n.s-=t/100,n.s=YC(n.s),SC(n)}function RC(e,t){t=0===t?0:t||10;var n=SC(e).toHsl();return n.s+=t/100,n.s=YC(n.s),SC(n)}function LC(e){return SC(e).desaturate(100)}function IC(e,t){t=0===t?0:t||10;var n=SC(e).toHsl();return n.l+=t/100,n.l=YC(n.l),SC(n)}function kC(e,t){t=0===t?0:t||10;var n=SC(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),SC(n)}function OC(e,t){t=0===t?0:t||10;var n=SC(e).toHsl();return n.l-=t/100,n.l=YC(n.l),SC(n)}function UC(e,t){var n=SC(e).toHsl(),r=(n.h+t)%360;return n.h=r<0?360+r:r,SC(n)}function zC(e){var t=SC(e).toHsl();return t.h=(t.h+180)%360,SC(t)}function VC(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=SC(e).toHsl(),r=[SC(e)],i=360/t,a=1;a<t;a++)r.push(SC({h:(n.h+a*i)%360,s:n.s,l:n.l}));return r}function GC(e){var t=SC(e).toHsl(),n=t.h;return[SC(e),SC({h:(n+72)%360,s:t.s,l:t.l}),SC({h:(n+216)%360,s:t.s,l:t.l})]}function HC(e,t,n){t=t||6,n=n||30;var r=SC(e).toHsl(),i=360/n,a=[SC(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,a.push(SC(r));return a}function jC(e,t){t=t||6;for(var n=SC(e).toHsv(),r=n.h,i=n.s,a=n.v,o=[],s=1/t;t--;)o.push(SC({h:r,s:i,v:a})),a=(a+s)%1;return o}SC.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,r=this.toRgb();return e=r.r/255,t=r.g/255,n=r.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=XC(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=MC(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=MC(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=TC(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=TC(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return BC(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,n,r,i){var a=[$C(Math.round(e).toString(16)),$C(Math.round(t).toString(16)),$C(Math.round(n).toString(16)),$C(ZC(r))];if(i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1))return a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0);return a.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*KC(this._r,255))+"%",g:Math.round(100*KC(this._g,255))+"%",b:Math.round(100*KC(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*KC(this._r,255))+"%, "+Math.round(100*KC(this._g,255))+"%, "+Math.round(100*KC(this._b,255))+"%)":"rgba("+Math.round(100*KC(this._r,255))+"%, "+Math.round(100*KC(this._g,255))+"%, "+Math.round(100*KC(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(qC[BC(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+PC(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var i=SC(e);n="#"+PC(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0;return t||!r||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return SC(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(IC,arguments)},brighten:function(){return this._applyModification(kC,arguments)},darken:function(){return this._applyModification(OC,arguments)},desaturate:function(){return this._applyModification(NC,arguments)},saturate:function(){return this._applyModification(RC,arguments)},greyscale:function(){return this._applyModification(LC,arguments)},spin:function(){return this._applyModification(UC,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(HC,arguments)},complement:function(){return this._applyCombination(zC,arguments)},monochromatic:function(){return this._applyCombination(jC,arguments)},splitcomplement:function(){return this._applyCombination(GC,arguments)},triad:function(){return this._applyCombination(VC,[3])},tetrad:function(){return this._applyCombination(VC,[4])}},SC.fromRatio=function(e,t){if("object"==xC(e)){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]="a"===r?e[r]:QC(e[r]));e=n}return SC(e,t)},SC.equals=function(e,t){return!(!e||!t)&&SC(e).toRgbString()==SC(t).toRgbString()},SC.random=function(){return SC.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},SC.mix=function(e,t,n){n=0===n?0:n||50;var r=SC(e).toRgb(),i=SC(t).toRgb(),a=n/100;return SC({r:(i.r-r.r)*a+r.r,g:(i.g-r.g)*a+r.g,b:(i.b-r.b)*a+r.b,a:(i.a-r.a)*a+r.a})},SC.readability=function(e,t){var n=SC(e),r=SC(t);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},SC.isReadable=function(e,t,n){var r,i,a=SC.readability(e,t);switch(i=!1,r=function(e){var t,n;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==n&&"large"!==n&&(n="small");return{level:t,size:n}}(n),r.level+r.size){case"AAsmall":case"AAAlarge":i=a>=4.5;break;case"AAlarge":i=a>=3;break;case"AAAsmall":i=a>=7}return i},SC.mostReadable=function(e,t,n){var r,i,a,o,s=null,u=0;i=(n=n||{}).includeFallbackColors,a=n.level,o=n.size;for(var l=0;l<t.length;l++)(r=SC.readability(e,t[l]))>u&&(u=r,s=SC(t[l]));return SC.isReadable(e,s,{level:a,size:o})||!i?s:(n.includeFallbackColors=!1,SC.mostReadable(e,["#fff","#000"],n))};var WC=SC.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},qC=SC.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(WC);function XC(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function KC(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"===typeof e&&-1!=e.indexOf("%")}(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function YC(e){return Math.min(1,Math.max(0,e))}function JC(e){return parseInt(e,16)}function $C(e){return 1==e.length?"0"+e:""+e}function QC(e){return e<=1&&(e=100*e+"%"),e}function ZC(e){return Math.round(255*parseFloat(e)).toString(16)}function e_(e){return JC(e)/255}var t_=function(){var e="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{CSS_UNIT:new RegExp(e),rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+t),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function n_(e){return!!t_.CSS_UNIT.exec(e)}function r_(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i_(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function a_(e,t,n){return t=f_(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,g_()?Reflect.construct(t,n||[],f_(e).constructor):t.apply(e,n))}function o_(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s_(e,t){return e.get(i_(e,t))}function u_(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function l_(e,t,n){return e.set(i_(e,t),n),n}function c_(e,t,n){if(g_())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,t),new(e.bind.apply(e,r))}function h_(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,C_(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function d_(e,t,n){return(t=C_(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p_(){return p_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=f_(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},p_.apply(null,arguments)}function f_(e){return f_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f_(e)}function m_(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D_(e,t)}function g_(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g_=function(){return!!e})()}function v_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function D_(e,t){return D_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},D_(e,t)}function y_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||b_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E_(e,t,n,r){var i=p_(f_(e.prototype),t,n);return"function"==typeof i?function(e){return i.apply(n,e)}:i}function A_(e){return function(e){if(Array.isArray(e))return r_(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C_(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function __(e){return __="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},__(e)}function b_(e,t){if(e){if("string"==typeof e)return r_(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r_(e,t):void 0}}var x_=function(e){e instanceof Array?e.forEach(x_):(e.map&&e.map.dispose(),e.dispose())},F_=function(e){e.geometry&&e.geometry.dispose(),e.material&&x_(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(F_)},w_=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),F_(t)}},S_=new WeakMap,T_=new WeakMap,M_=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.dataBindAttr,a=void 0===i?"__data":i,o=r.objBindAttr,s=void 0===o?"__threeObj":o;return o_(this,t),d_(n=a_(this,t),"scene",void 0),u_(n,S_,void 0),u_(n,T_,void 0),n.scene=e,l_(S_,n,a),l_(T_,n,s),n.onRemoveObj(function(){}),n}return m_(t,e),h_(t,[{key:"onCreateObj",value:function(e){var n=this;return E_(t,"onCreateObj",this)([function(t){var r=e(t);return t[s_(T_,n)]=r,r[s_(S_,n)]=t,n.scene.add(r),r}]),this}},{key:"onRemoveObj",value:function(e){var n=this;return E_(t,"onRemoveObj",this)([function(r,i){var a=E_(t,"getData",n)([r]);e(r,i),n.scene.remove(r),w_(r),delete a[s_(T_,n)]}]),this}}])}(vC),B_=function(e){return isNaN(e)?parseInt(SC(e).toHex(),16):e},P_=function(e){return isNaN(e)?SC(e).getAlpha():1},N_=function e(){var t=new DC,n=[],r=[],i=_C;function a(e){let a=t.get(e);if(void 0===a){if(i!==_C)return i;t.set(e,a=n.push(e)-1)}return r[a%r.length]}return a.domain=function(e){if(!arguments.length)return n.slice();n=[],t=new DC;for(const r of e)t.has(r)||t.set(r,n.push(r)-1);return a},a.range=function(e){return arguments.length?(r=Array.from(e),a):r.slice()},a.unknown=function(e){return arguments.length?(i=e,a):i},a.copy=function(){return e(n,r).unknown(i)},hr.apply(a,arguments),a}(bC);function R_(e,t,n){t&&"string"===typeof n&&e.filter(function(e){return!e[n]}).forEach(function(e){e[n]=N_(t(e))})}var L_=window.THREE?window.THREE:{Group:oy,Mesh:mg,MeshLambertMaterial:uE,Color:Om,BufferGeometry:eg,BufferAttribute:Hm,Matrix4:Yf,Vector3:ef,SphereGeometry:oE,CylinderGeometry:iE,TubeGeometry:sE,ConeGeometry:aE,Line:Uy,LineBasicMaterial:Ny,QuadraticBezierCurve3:tE,CubicBezierCurve3:Qy,Box3:Cf},I_={graph:gA,forcelayout:vA},k_=(new L_.BufferGeometry).setAttribute?"setAttribute":"addAttribute",O_=(new L_.BufferGeometry).applyMatrix4?"applyMatrix4":"applyMatrix",U_=$A({props:{jsonUrl:{onChange:function(e,t){var n=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(e){return e.json()}).then(function(e){t.fetchingJson=!1,t.onFinishLoading(e),n.graphData(e)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var n=t.d3ForceLayout.force("charge");function r(e,t){e.forEach(function(e){delete e[t],delete e["v".concat(t)]})}n&&n.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y")}},dagMode:{onChange:function(e,t){!e&&"d3"===t.forceEngine&&(t.graphData.nodes||[]).forEach(function(e){return e.fx=e.fy=e.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,n){return void 0===n?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,n),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t="ngraph"!==e.forceEngine;return e.engineRunning&&function(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var n=QA(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(r){var i=y_(r,2),a=i[0],o=i[1];if(o){var s=t?a:e.layout.getNodePosition(a[e.nodeId]),u=n(a);e.nodePositionUpdate&&e.nodePositionUpdate(u?o.children[0]:o,{x:s.x,y:s.y,z:s.z},a)&&!u||(o.position.x=s.x,o.position.y=s.y||0,o.position.z=s.z||0)}});var r=QA(e.linkWidth),i=QA(e.linkCurvature),a=QA(e.linkCurveRotation),o=QA(e.linkThreeObjectExtend);function s(n){var r=t?n:e.layout.getLinkPosition(e.layout.graph.getLink(n.source,n.target).id),o=r[t?"source":"from"],s=r[t?"target":"to"];if(o&&s&&o.hasOwnProperty("x")&&s.hasOwnProperty("x")){var u=i(n);if(u){var l,c=new L_.Vector3(o.x,o.y||0,o.z||0),h=new L_.Vector3(s.x,s.y||0,s.z||0),d=c.distanceTo(h),p=a(n);if(d>0){var f=s.x-o.x,m=s.y-o.y||0,g=(new L_.Vector3).subVectors(h,c),v=g.clone().multiplyScalar(u).cross(0!==f||0!==m?new L_.Vector3(0,0,1):new L_.Vector3(0,1,0)).applyAxisAngle(g.normalize(),p).add((new L_.Vector3).addVectors(c,h).divideScalar(2));l=new L_.QuadraticBezierCurve3(c,v,h)}else{var D=70*u,y=-p,E=y+Math.PI/2;l=new L_.CubicBezierCurve3(c,new L_.Vector3(D*Math.cos(E),D*Math.sin(E),0).add(c),new L_.Vector3(D*Math.cos(y),D*Math.sin(y),0).add(c),h)}n.__curve=l}else n.__curve=null}}e.linkDataMapper.entries().forEach(function(n){var i=y_(n,2),a=i[0],u=i[1];if(u){var l=t?a:e.layout.getLinkPosition(e.layout.graph.getLink(a.source,a.target).id),c=l[t?"source":"from"],h=l[t?"target":"to"];if(c&&h&&c.hasOwnProperty("x")&&h.hasOwnProperty("x")){s(a);var d=o(a);if(!e.linkPositionUpdate||!e.linkPositionUpdate(d?u.children[1]:u,{start:{x:c.x,y:c.y,z:c.z},end:{x:h.x,y:h.y,z:h.z}},a)||d){var p=30,f=a.__curve,m=u.children.length?u.children[0]:u;if("Line"===m.type){if(f){var g=f.getPoints(p);m.geometry.getAttribute("position").array.length!==3*g.length&&m.geometry[k_]("position",new L_.BufferAttribute(new Float32Array(3*g.length),3)),m.geometry.setFromPoints(g)}else{var v=m.geometry.getAttribute("position");v&&v.array&&6===v.array.length||m.geometry[k_]("position",v=new L_.BufferAttribute(new Float32Array(6),3)),v.array[0]=c.x,v.array[1]=c.y||0,v.array[2]=c.z||0,v.array[3]=h.x,v.array[4]=h.y||0,v.array[5]=h.z||0,v.needsUpdate=!0}m.geometry.computeBoundingSphere()}else if("Mesh"===m.type)if(f){m.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(m.position.set(0,0,0),m.rotation.set(0,0,0),m.scale.set(1,1,1));var D=Math.ceil(10*r(a))/10/2,y=new L_.TubeGeometry(f,p,D,e.linkResolution,!1);m.geometry.dispose(),m.geometry=y}else{if(!m.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var E=Math.ceil(10*r(a))/10/2,A=new L_.CylinderGeometry(E,E,1,e.linkResolution,1,!1);A[O_]((new L_.Matrix4).makeTranslation(0,.5,0)),A[O_]((new L_.Matrix4).makeRotationX(Math.PI/2)),m.geometry.dispose(),m.geometry=A}var C=new L_.Vector3(c.x,c.y||0,c.z||0),_=new L_.Vector3(h.x,h.y||0,h.z||0),b=C.distanceTo(_);m.position.x=C.x,m.position.y=C.y,m.position.z=C.z,m.scale.z=b,m.parent.localToWorld(_),m.lookAt(_)}}}}})}(),function(){var n=QA(e.linkDirectionalArrowRelPos),r=QA(e.linkDirectionalArrowLength),i=QA(e.nodeVal);e.arrowDataMapper.entries().forEach(function(a){var o=y_(a,2),s=o[0],u=o[1];if(u){var l=t?s:e.layout.getLinkPosition(e.layout.graph.getLink(s.source,s.target).id),c=l[t?"source":"from"],h=l[t?"target":"to"];if(c&&h&&c.hasOwnProperty("x")&&h.hasOwnProperty("x")){var d=Math.cbrt(Math.max(0,i(c)||1))*e.nodeRelSize,p=Math.cbrt(Math.max(0,i(h)||1))*e.nodeRelSize,f=r(s),m=n(s),g=s.__curve?function(e){return s.__curve.getPoint(e)}:function(e){var t=function(e,t,n,r){return t[e]+(n[e]-t[e])*r||0};return{x:t("x",c,h,e),y:t("y",c,h,e),z:t("z",c,h,e)}},v=s.__curve?s.__curve.getLength():Math.sqrt(["x","y","z"].map(function(e){return Math.pow((h[e]||0)-(c[e]||0),2)}).reduce(function(e,t){return e+t},0)),D=d+f+(v-d-p-f)*m,y=g(D/v),E=g((D-f)/v);["x","y","z"].forEach(function(e){return u.position[e]=E[e]});var A=c_(L_.Vector3,A_(["x","y","z"].map(function(e){return y[e]})));u.parent.localToWorld(A),u.lookAt(A)}}})}(),function(){var n=QA(e.linkDirectionalParticleSpeed);e.graphData.links.forEach(function(r){var i=e.particlesDataMapper.getObj(r),a=i&&i.children,o=r.__singleHopPhotonsObj&&r.__singleHopPhotonsObj.children;if(o&&o.length||a&&a.length){var s=t?r:e.layout.getLinkPosition(e.layout.graph.getLink(r.source,r.target).id),u=s[t?"source":"from"],l=s[t?"target":"to"];if(u&&l&&u.hasOwnProperty("x")&&l.hasOwnProperty("x")){var c=n(r),h=r.__curve?function(e){return r.__curve.getPoint(e)}:function(e){var t=function(e,t,n,r){return t[e]+(n[e]-t[e])*r||0};return{x:t("x",u,l,e),y:t("y",u,l,e),z:t("z",u,l,e)}};[].concat(A_(a||[]),A_(o||[])).forEach(function(e,t){var n="singleHopPhotons"===e.parent.__linkThreeObjType;if(e.hasOwnProperty("__progressRatio")||(e.__progressRatio=n?0:t/a.length),e.__progressRatio+=c,e.__progressRatio>=1){if(n)return e.parent.remove(e),void w_(e);e.__progressRatio=e.__progressRatio%1}var r=e.__progressRatio,i=h(r);["x","y","z"].forEach(function(t){return e.position[t]=i[t]})})}}})}(),this},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var n=new L_.Group;n.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=n,e.graphScene.add(n)}var r=QA(e.linkDirectionalParticleWidth),i=Math.ceil(10*r(t))/10/2,a=e.linkDirectionalParticleResolution,o=new L_.SphereGeometry(i,a,a),s=QA(e.linkColor),u=QA(e.linkDirectionalParticleColor)(t)||s(t)||"#f0f0f0",l=new L_.Color(B_(u)),c=3*e.linkOpacity,h=new L_.MeshLambertMaterial({color:l,transparent:!0,opacity:c});t.__singleHopPhotonsObj.add(new L_.Mesh(o,h))}return this},getGraphBbox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!e.initialised)return null;var n=function e(n){var r=[];if(n.geometry){n.geometry.computeBoundingBox();var i=new L_.Box3;i.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),r.push(i)}return r.concat.apply(r,A_((n.children||[]).filter(function(e){return!e.hasOwnProperty("__graphObjType")||"node"===e.__graphObjType&&t(e.__data)}).map(e)))}(e.graphScene);return n.length?Object.assign.apply(Object,A_(["x","y","z"].map(function(e){return d_({},e,[ZA(n,function(t){return t.min[e]}),eC(n,function(t){return t.max[e]})])}))):null}},stateInit:function(){return{d3ForceLayout:kE().force("link",GE()).force("charge",fA()).force("center",mA()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new M_(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new M_(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new M_(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new M_(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var n=function(e){return e.some(function(e){return t.hasOwnProperty(e)})};if(e.engineRunning=!1,"function"===typeof e.onUpdate&&e.onUpdate(),null!==e.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&R_(e.graphData.nodes,QA(e.nodeAutoColorBy),e.nodeColor),null!==e.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&R_(e.graphData.links,QA(e.linkAutoColorBy),e.linkColor),e._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=QA(e.nodeThreeObject),i=QA(e.nodeThreeObjectExtend),a=QA(e.nodeVal),o=QA(e.nodeColor),s=QA(e.nodeVisibility),u={},l={};(e._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(t){var n,a=r(t),o=i(t);return a&&e.nodeThreeObject===a&&(a=a.clone()),a&&!o?n=a:((n=new L_.Mesh).__graphDefaultObj=!0,a&&o&&n.add(a)),n.__graphObjType="node",n}).onUpdateObj(function(t,n){if(t.__graphDefaultObj){var r=a(n)||1,i=Math.cbrt(r)*e.nodeRelSize,s=e.nodeResolution;t.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&t.geometry.parameters.radius===i&&t.geometry.parameters.widthSegments===s||(u.hasOwnProperty(r)||(u[r]=new L_.SphereGeometry(i,s,s)),t.geometry.dispose(),t.geometry=u[r]);var c=o(n),h=new L_.Color(B_(c||"#ffffaa")),d=e.nodeOpacity*P_(c);"MeshLambertMaterial"===t.material.type&&t.material.color.equals(h)&&t.material.opacity===d||(l.hasOwnProperty(c)||(l[c]=new L_.MeshLambertMaterial({color:h,transparent:!0,opacity:d})),t.material.dispose(),t.material=l[c])}}).digest(e.graphData.nodes.filter(s))}if(e._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var c=QA(e.linkThreeObject),h=QA(e.linkThreeObjectExtend),d=QA(e.linkMaterial),p=QA(e.linkVisibility),f=QA(e.linkColor),m=QA(e.linkWidth),g={},v={},D={},y=e.graphData.links.filter(p);if((e._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(e){var t=e.__data&&e.__data.__singleHopPhotonsObj;t&&(t.parent.remove(t),w_(t),delete e.__data.__singleHopPhotonsObj)}).onCreateObj(function(t){var n,r,i=c(t),a=h(t);if(i&&e.linkThreeObject===i&&(i=i.clone()),!i||a)if(!!m(t))n=new L_.Mesh;else{var o=new L_.BufferGeometry;o[k_]("position",new L_.BufferAttribute(new Float32Array(6),3)),n=new L_.Line(o)}return i?a?((r=new L_.Group).__graphDefaultObj=!0,r.add(n),r.add(i)):r=i:(r=n).__graphDefaultObj=!0,r.renderOrder=10,r.__graphObjType="link",r}).onUpdateObj(function(t,n){if(t.__graphDefaultObj){var r=t.children.length?t.children[0]:t,i=Math.ceil(10*m(n))/10,a=!!i;if(a){var o=i/2,s=e.linkResolution;if(!r.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||r.geometry.parameters.radiusTop!==o||r.geometry.parameters.radialSegments!==s){if(!g.hasOwnProperty(i)){var u=new L_.CylinderGeometry(o,o,1,s,1,!1);u[O_]((new L_.Matrix4).makeTranslation(0,.5,0)),u[O_]((new L_.Matrix4).makeRotationX(Math.PI/2)),g[i]=u}r.geometry.dispose(),r.geometry=g[i]}}var l=d(n);if(l)r.material=l;else{var c=f(n),h=new L_.Color(B_(c||"#f0f0f0")),p=e.linkOpacity*P_(c),y=a?"MeshLambertMaterial":"LineBasicMaterial";if(r.material.type!==y||!r.material.color.equals(h)||r.material.opacity!==p){var E=a?v:D;E.hasOwnProperty(c)||(E[c]=new L_[y]({color:h,transparent:p<1,opacity:p,depthWrite:p>=1})),r.material.dispose(),r.material=E[c]}}}}).digest(y),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var E=QA(e.linkDirectionalArrowLength),A=QA(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var e=new L_.Mesh(void 0,new L_.MeshLambertMaterial({transparent:!0}));return e.__linkThreeObjType="arrow",e}).onUpdateObj(function(t,n){var r=E(n),i=e.linkDirectionalArrowResolution;if(!t.geometry.type.match(/^Cone(Buffer)?Geometry$/)||t.geometry.parameters.height!==r||t.geometry.parameters.radialSegments!==i){var a=new L_.ConeGeometry(.25*r,r,i);a.translate(0,r/2,0),a.rotateX(Math.PI/2),t.geometry.dispose(),t.geometry=a}var o=A(n)||f(n)||"#f0f0f0";t.material.color=new L_.Color(B_(o)),t.material.opacity=3*e.linkOpacity*P_(o)}).digest(y.filter(E))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var C=QA(e.linkDirectionalParticles),_=QA(e.linkDirectionalParticleWidth),b=QA(e.linkDirectionalParticleColor),x={},F={};e.particlesDataMapper.onCreateObj(function(){var e=new L_.Group;return e.__linkThreeObjType="photons",e.__photonDataMapper=new M_(e),e}).onUpdateObj(function(t,n){var r,i=Math.round(Math.abs(C(n))),a=!!t.children.length&&t.children[0],o=Math.ceil(10*_(n))/10/2,s=e.linkDirectionalParticleResolution;a&&a.geometry.parameters.radius===o&&a.geometry.parameters.widthSegments===s?r=a.geometry:(F.hasOwnProperty(o)||(F[o]=new L_.SphereGeometry(o,s,s)),r=F[o],a&&a.geometry.dispose());var u,l=b(n)||f(n)||"#f0f0f0",c=new L_.Color(B_(l)),h=3*e.linkOpacity;a&&a.material.color.equals(c)&&a.material.opacity===h?u=a.material:(x.hasOwnProperty(l)||(x[l]=new L_.MeshLambertMaterial({color:c,transparent:!0,opacity:h})),u=x[l],a&&a.material.dispose()),t.__photonDataMapper.id(function(e){return e.idx}).onCreateObj(function(){return new L_.Mesh(r,u)}).onUpdateObj(function(e){e.geometry=r,e.material=u}).digest(A_(new Array(i)).map(function(e,t){return{idx:t}}))}).digest(y.filter(C))}}if(e._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(t){t.source=t[e.linkSource],t.target=t[e.linkTarget]});var w,S="ngraph"!==e.forceEngine;if(S){(w=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var T=e.d3ForceLayout.force("link");T&&T.id(function(t){return t[e.nodeId]}).links(e.graphData.links);var M=e.dagMode&&function(e,t){var n=e.nodes,r=e.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.nodeFilter,o=void 0===a?function(){return!0}:a,s=i.onLoopError,u=void 0===s?function(e){throw"Invalid DAG structure! Found cycle in node path: ".concat(e.join(" -> "),".")}:s,l={};n.forEach(function(e){return l[t(e)]={data:e,out:[],depth:-1,skip:!o(e)}}),r.forEach(function(e){var n=e.source,r=e.target,i=u(n),a=u(r);if(!l.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!l.hasOwnProperty(a))throw"Missing target node with id: ".concat(a);var o=l[i],s=l[a];function u(e){return"object"===__(e)?t(e):e}o.out.push(s)});var c=[];return function e(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=function(){var a=n[o];if(-1!==r.indexOf(a)){var s=[].concat(A_(r.slice(r.indexOf(a))),[a]).map(function(e){return t(e.data)});return c.some(function(e){return e.length===s.length&&e.every(function(e,t){return e===s[t]})})||(c.push(s),u(s)),1}i>a.depth&&(a.depth=i,e(a.out,[].concat(A_(r),[a]),i+(a.skip?0:1)))},o=0,s=n.length;o<s;o++)a()}(Object.values(l)),Object.assign.apply(Object,[{}].concat(A_(Object.entries(l).filter(function(e){return!y_(e,2)[1].skip}).map(function(e){var t=y_(e,2);return d_({},t[0],t[1].depth)}))))}(e.graphData,function(t){return t[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),B=Math.max.apply(Math,A_(Object.values(M||[]))),P=e.dagLevelDistance||e.graphData.nodes.length/(B||1)*2*(-1!==["radialin","radialout"].indexOf(e.dagMode)?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var N=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(e){return delete e[N]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var R=["rl","td","zout"].includes(e.dagMode),L=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(t){return t[L]=function(t){return(M[t[e.nodeId]]-B/2)*P*(R?-1:1)}(t)})}e.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(e.dagMode)?function(e,t,n,r){var i,a,o,s,u=OE(.1);function l(e){for(var u=0,l=i.length;u<l;++u){var c=i[u],h=c.x-t||1e-6,d=(c.y||0)-n||1e-6,p=(c.z||0)-r||1e-6,f=Math.sqrt(h*h+d*d+p*p),m=(s[u]-f)*o[u]*e/f;c.vx+=h*m,a>1&&(c.vy+=d*m),a>2&&(c.vz+=p*m)}}function c(){if(i){var t,n=i.length;for(o=new Array(n),s=new Array(n),t=0;t<n;++t)s[t]=+e(i[t],t,i),o[t]=isNaN(s[t])?0:+u(i[t],t,i)}}return"function"!==typeof e&&(e=OE(+e)),null==t&&(t=0),null==n&&(n=0),null==r&&(r=0),l.initialize=function(e){i=e;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a=n.find(e=>[1,2,3].includes(e))||2,c()},l.strength=function(e){return arguments.length?(u="function"===typeof e?e:OE(+e),c(),l):u},l.radius=function(t){return arguments.length?(e="function"===typeof t?t:OE(+t),c(),l):e},l.x=function(e){return arguments.length?(t=+e,l):t},l.y=function(e){return arguments.length?(n=+e,l):n},l.z=function(e){return arguments.length?(r=+e,l):r},l}(function(t){var n=M[t[e.nodeId]]||-1;return("radialin"===e.dagMode?B-n:n)*P}).strength(function(t){return e.dagNodeFilter(t)?1:0}):null)}else{var I=I_.graph();e.graphData.nodes.forEach(function(t){I.addNode(t[e.nodeId])}),e.graphData.links.forEach(function(e){I.addLink(e.source,e.target)}),w=I_.forcelayout(I,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v_(Object(n),!0).forEach(function(t){d_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({dimensions:e.numDimensions},e.ngraphPhysics)),w.graph=I}for(var k=0;k<e.warmupTicks&&!(S&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);k++)w[S?"tick":"step"]();e.layout=w,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});var z_=function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(n){function r(){var n;o_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(n=a_(this,r,[].concat(a))).__kapsuleInstance=c_(e,[].concat(A_(t?[n]:[]),a)),n}return m_(r,n),h_(r)}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object);return Object.keys(e()).forEach(function(e){return n.prototype[e]=function(){var t,n=(t=this.__kapsuleInstance)[e].apply(t,arguments);return n===this.__kapsuleInstance?this:n}}),n}(U_,(window.THREE?window.THREE:{Group:oy}).Group,!0);function V_(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function G_(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=t.get(n);if(void 0===i)t.set(n,function(t,n){const r=t.array,i=t.usage,a=r.byteLength,o=e.createBuffer();let s;if(e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback(),r instanceof Float32Array)s=e.FLOAT;else if(r instanceof Uint16Array)s=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)s=e.SHORT;else if(r instanceof Uint32Array)s=e.UNSIGNED_INT;else if(r instanceof Int32Array)s=e.INT;else if(r instanceof Int8Array)s=e.BYTE;else if(r instanceof Uint8Array)s=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);s=e.UNSIGNED_BYTE}return{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:a}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const i=n.array,a=n.updateRanges;if(e.bindBuffer(r,t),0===a.length)e.bufferSubData(r,0,i);else{a.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<a.length;e++){const n=a[t],r=a[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++t,a[t]=r)}a.length=t+1;for(let n=0,o=a.length;n<o;n++){const t=a[n];e.bufferSubData(r,t.start*i.BYTES_PER_ELEMENT,i,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}const H_={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},j_={common:{diffuse:{value:new Al(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ms},alphaMap:{value:null},alphaMapTransform:{value:new Ms},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ms}},envmap:{envMap:{value:null},envMapRotation:{value:new Ms},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ms}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ms}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ms},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ms},normalScale:{value:new xs(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ms},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ms}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ms}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ms}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Al(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Al(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ms},alphaTest:{value:0},uvTransform:{value:new Ms}},sprite:{diffuse:{value:new Al(16777215)},opacity:{value:1},center:{value:new xs(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ms},alphaMap:{value:null},alphaMapTransform:{value:new Ms},alphaTest:{value:0}}},W_={basic:{uniforms:sc([j_.common,j_.specularmap,j_.envmap,j_.aomap,j_.lightmap,j_.fog]),vertexShader:H_.meshbasic_vert,fragmentShader:H_.meshbasic_frag},lambert:{uniforms:sc([j_.common,j_.specularmap,j_.envmap,j_.aomap,j_.lightmap,j_.emissivemap,j_.bumpmap,j_.normalmap,j_.displacementmap,j_.fog,j_.lights,{emissive:{value:new Al(0)}}]),vertexShader:H_.meshlambert_vert,fragmentShader:H_.meshlambert_frag},phong:{uniforms:sc([j_.common,j_.specularmap,j_.envmap,j_.aomap,j_.lightmap,j_.emissivemap,j_.bumpmap,j_.normalmap,j_.displacementmap,j_.fog,j_.lights,{emissive:{value:new Al(0)},specular:{value:new Al(1118481)},shininess:{value:30}}]),vertexShader:H_.meshphong_vert,fragmentShader:H_.meshphong_frag},standard:{uniforms:sc([j_.common,j_.envmap,j_.aomap,j_.lightmap,j_.emissivemap,j_.bumpmap,j_.normalmap,j_.displacementmap,j_.roughnessmap,j_.metalnessmap,j_.fog,j_.lights,{emissive:{value:new Al(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:H_.meshphysical_vert,fragmentShader:H_.meshphysical_frag},toon:{uniforms:sc([j_.common,j_.aomap,j_.lightmap,j_.emissivemap,j_.bumpmap,j_.normalmap,j_.displacementmap,j_.gradientmap,j_.fog,j_.lights,{emissive:{value:new Al(0)}}]),vertexShader:H_.meshtoon_vert,fragmentShader:H_.meshtoon_frag},matcap:{uniforms:sc([j_.common,j_.bumpmap,j_.normalmap,j_.displacementmap,j_.fog,{matcap:{value:null}}]),vertexShader:H_.meshmatcap_vert,fragmentShader:H_.meshmatcap_frag},points:{uniforms:sc([j_.points,j_.fog]),vertexShader:H_.points_vert,fragmentShader:H_.points_frag},dashed:{uniforms:sc([j_.common,j_.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:H_.linedashed_vert,fragmentShader:H_.linedashed_frag},depth:{uniforms:sc([j_.common,j_.displacementmap]),vertexShader:H_.depth_vert,fragmentShader:H_.depth_frag},normal:{uniforms:sc([j_.common,j_.bumpmap,j_.normalmap,j_.displacementmap,{opacity:{value:1}}]),vertexShader:H_.meshnormal_vert,fragmentShader:H_.meshnormal_frag},sprite:{uniforms:sc([j_.sprite,j_.fog]),vertexShader:H_.sprite_vert,fragmentShader:H_.sprite_frag},background:{uniforms:{uvTransform:{value:new Ms},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:H_.background_vert,fragmentShader:H_.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ms}},vertexShader:H_.backgroundCube_vert,fragmentShader:H_.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:H_.cube_vert,fragmentShader:H_.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:H_.equirect_vert,fragmentShader:H_.equirect_frag},distanceRGBA:{uniforms:sc([j_.common,j_.displacementmap,{referencePosition:{value:new ws},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:H_.distanceRGBA_vert,fragmentShader:H_.distanceRGBA_frag},shadow:{uniforms:sc([j_.lights,j_.fog,{color:{value:new Al(0)},opacity:{value:1}}]),vertexShader:H_.shadow_vert,fragmentShader:H_.shadow_frag}};W_.physical={uniforms:sc([W_.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ms},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ms},clearcoatNormalScale:{value:new xs(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ms},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ms},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ms},sheen:{value:0},sheenColor:{value:new Al(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ms},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ms},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ms},transmissionSamplerSize:{value:new xs},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ms},attenuationDistance:{value:0},attenuationColor:{value:new Al(0)},specularColor:{value:new Al(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ms},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ms},anisotropyVector:{value:new xs},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ms}}]),vertexShader:H_.meshphysical_vert,fragmentShader:H_.meshphysical_frag};const q_={r:0,b:0,g:0},X_=new Uu,K_=new Tu;function Y_(e,t,n,r,i,a,o){const s=new Al(0);let u,l,c=!0===a?0:1,h=null,d=0,p=null;function f(e){let r=!0===e.isScene?e.background:null;if(r&&r.isTexture){r=(e.backgroundBlurriness>0?n:t).get(r)}return r}function m(t,n){t.getRGB(q_,uc(e)),r.buffers.color.setClear(q_.r,q_.g,q_.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),c=t,m(s,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,m(s,c)},render:function(t){let n=!1;const i=f(t);null===i?m(s,c):i&&i.isColor&&(m(i,1),n=!0);const a=e.xr.getEnvironmentBlendMode();"additive"===a?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&r.buffers.color.setClear(0,0,0,0,o),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=f(n);r&&(r.isCubeTexture||r.mapping===Ba)?(void 0===l&&(l=new rc(new ac(1,1,1),new cc({name:"BackgroundCubeMaterial",uniforms:oc(W_.backgroundCube.uniforms),vertexShader:W_.backgroundCube.vertexShader,fragmentShader:W_.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),X_.copy(n.backgroundRotation),X_.x*=-1,X_.y*=-1,X_.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(X_.y*=-1,X_.z*=-1),l.material.uniforms.envMap.value=r,l.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4(K_.makeRotationFromEuler(X_)),l.material.toneMapped=zs.getTransfer(r.colorSpace)!==Qo,h===r&&d===r.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=r,d=r.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null)):r&&r.isTexture&&(void 0===u&&(u=new rc(new Wc(2,2),new cc({name:"BackgroundMaterial",uniforms:oc(W_.background.uniforms),vertexShader:W_.background.vertexShader,fragmentShader:W_.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=r,u.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,u.material.toneMapped=zs.getTransfer(r.colorSpace)!==Qo,!0===r.matrixAutoUpdate&&r.updateMatrix(),u.material.uniforms.uvTransform.value.copy(r.matrix),h===r&&d===r.version&&p===e.toneMapping||(u.material.needsUpdate=!0,h=r,d=r.version,p=e.toneMapping),u.layers.enableAll(),t.unshift(u,u.geometry,u.material,0,0,null))},dispose:function(){void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0),void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}}}function J_(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},i=l(null);let a=i,o=!1;function s(t){return e.bindVertexArray(t)}function u(t){return e.deleteVertexArray(t)}function l(e){const t=[],r=[],i=[];for(let a=0;a<n;a++)t[a]=0,r[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function c(){const e=a.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const r=a.newAttributes,i=a.enabledAttributes,o=a.attributeDivisors;r[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),o[t]!==n&&(e.vertexAttribDivisor(t,n),o[t]=n)}function p(){const t=a.newAttributes,n=a.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function f(t,n,r,i,a,o,s){!0===s?e.vertexAttribIPointer(t,n,r,a,o):e.vertexAttribPointer(t,n,r,i,a,o)}function m(){g(),o=!0,a!==i&&(a=i,s(a.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,u,m,g){let v=!1;const D=function(t,n,i){const a=!0===i.wireframe;let o=r[t.id];void 0===o&&(o={},r[t.id]=o);let s=o[n.id];void 0===s&&(s={},o[n.id]=s);let u=s[a];void 0===u&&(u=l(e.createVertexArray()),s[a]=u);return u}(m,u,i);a!==D&&(a=D,s(a.object)),v=function(e,t,n,r){const i=a.attributes,o=t.attributes;let s=0;const u=n.getAttributes();for(const a in u){if(u[a].location>=0){const t=i[a];let n=o[a];if(void 0===n&&("instanceMatrix"===a&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;s++}}return a.attributesNum!==s||a.index!==r}(n,m,u,g),v&&function(e,t,n,r){const i={},o=t.attributes;let s=0;const u=n.getAttributes();for(const a in u){if(u[a].location>=0){let t=o[a];void 0===t&&("instanceMatrix"===a&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),i[a]=n,s++}}a.attributes=i,a.attributesNum=s,a.index=r}(n,m,u,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(n,r,i,a){c();const o=a.attributes,s=i.getAttributes(),u=r.defaultAttributeValues;for(const l in s){const r=s[l];if(r.location>=0){let i=o[l];if(void 0===i&&("instanceMatrix"===l&&n.instanceMatrix&&(i=n.instanceMatrix),"instanceColor"===l&&n.instanceColor&&(i=n.instanceColor)),void 0!==i){const o=i.normalized,s=i.itemSize,u=t.get(i);if(void 0===u)continue;const l=u.buffer,c=u.type,p=u.bytesPerElement,m=c===e.INT||c===e.UNSIGNED_INT||i.gpuType===Wa;if(i.isInterleavedBufferAttribute){const t=i.data,u=t.stride,g=i.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)d(r.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,l);for(let e=0;e<r.locationSize;e++)f(r.location+e,s/r.locationSize,c,o,u*p,(g+s/r.locationSize*e)*p,m)}else{if(i.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)d(r.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,l);for(let e=0;e<r.locationSize;e++)f(r.location+e,s/r.locationSize,c,o,s*p,s/r.locationSize*e*p,m)}}else if(void 0!==u){const t=u[l];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(r.location,t);break;case 3:e.vertexAttrib3fv(r.location,t);break;case 4:e.vertexAttrib4fv(r.location,t);break;default:e.vertexAttrib1fv(r.location,t)}}}}p()}(n,i,u,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)u(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const n in t){const e=t[n];for(const t in e)u(e[t].object),delete e[t];delete t[n]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)u(i[e].object),delete i[e];delete n[e.id]}},initAttributes:c,enableAttribute:h,disableUnusedAttributes:p}}function $_(e,t,n){let r;function i(t,i,a){0!==a&&(e.drawArraysInstanced(r,t,i,a),n.update(i,r,a))}this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,i,0,a);let o=0;for(let t=0;t<a;t++)o+=i[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,a,o,s){if(0===o)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)i(e[t],a[t],s[t]);else{u.multiDrawArraysInstancedWEBGL(r,e,0,a,0,s,0,o);let t=0;for(let e=0;e<o;e++)t+=a[e]*s[e];n.update(t,r,1)}}}function Q_(e,t,n,r){let i;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const u=!0===n.logarithmicDepthBuffer,l=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control"),c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:a,textureFormatReadable:function(t){return t===to||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===Ka&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==Va&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==Xa&&!i)},precision:o,logarithmicDepthBuffer:u,reverseDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function Z_(e){const t=this;let n=null,r=0,i=!1,a=!1;const o=new Nc,s=new Ms,u={value:null,needsUpdate:!1};function l(e,n,r,i){const a=null!==e?e.length:0;let l=null;if(0!==a){if(l=u.value,!0!==i||null===l){const t=r+4*a,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===l||l.length<t)&&(l=new Float32Array(t));for(let n=0,u=r;n!==a;++n,u+=4)o.copy(e[n]).applyMatrix4(i,s),o.normal.toArray(l,u),l[u+3]=o.constant}u.value=l,u.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,l(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=l(e,t,0)},this.setState=function(o,s,c){const h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=e.get(o);if(!i||null===h||0===h.length||a&&!p)a?l(null):function(){u.value!==n&&(u.value=n,u.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=a?0:r,t=4*e;let i=f.clippingState||null;u.value=i,i=l(h,s,t,c);for(let r=0;r!==t;++r)i[r]=n[r];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function eb(e){let t=new WeakMap;function n(e,t){return t===Ta?e.mapping=wa:t===Ma&&(e.mapping=Sa),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping;if(a===Ta||a===Ma){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const a=i.image;if(a&&a.height>0){const o=new yc(a.height);return o.fromEquirectangularTexture(e,i),t.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}const tb=[.125,.215,.35,.446,.526,.582],nb=20,rb=new Ih,ib=new Al;let ab=null,ob=0,sb=0,ub=!1;const lb=(1+Math.sqrt(5))/2,cb=1/lb,hb=[new ws(-lb,cb,0),new ws(lb,cb,0),new ws(-cb,0,lb),new ws(cb,0,lb),new ws(0,lb,-cb),new ws(0,lb,cb),new ws(-1,1,-1),new ws(1,1,-1),new ws(-1,1,1),new ws(1,1,1)],db=new ws;class pb{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:a=256,position:o=db}=i;ab=this._renderer.getRenderTarget(),ob=this._renderer.getActiveCubeFace(),sb=this._renderer.getActiveMipmapLevel(),ub=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s,o),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=vb(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=gb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ab,ob,sb),this._renderer.xr.enabled=ub,e.scissorTest=!1,mb(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===wa||e.mapping===Sa?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ab=this._renderer.getRenderTarget(),ob=this._renderer.getActiveCubeFace(),sb=this._renderer.getActiveMipmapLevel(),ub=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Oa,minFilter:Oa,generateMipmaps:!1,type:Ka,format:to,colorSpace:Jo,depthBuffer:!1},r=fb(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=fb(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+tb.length;for(let o=0;o<a;o++){const a=Math.pow(2,i);n.push(a);let s=1/a;o>e-4?s=tb[o-e+4-1]:0===o&&(s=0),r.push(s);const u=1/(a-2),l=-u,c=1+u,h=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),D=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,f*p*e),D.set(h,m*p*e);const i=[e,e,e,e,e,e];y.set(i,g*p*e)}const E=new Wl;E.setAttribute("position",new Nl(v,f)),E.setAttribute("uv",new Nl(D,m)),E.setAttribute("faceIndex",new Nl(y,g)),t.push(E),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(nb),i=new ws(0,1,0),a=new cc({name:"SphericalGaussianBlur",defines:{n:nb,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return a}(r,e,t)}return r}_compileMaterial(e){const t=new rc(this._lodPlanes[0],e);this._renderer.compile(t,rb)}_sceneToCubeUV(e,t,n,r,i){const a=new mc(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],u=this._renderer,l=u.autoClear,c=u.toneMapping;u.getClearColor(ib),u.toneMapping=0,u.autoClear=!1;const h=new xl({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new rc(new ac,h);let p=!1;const f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,p=!0):(h.color.copy(ib),p=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(a.up.set(0,o[m],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+s[m],i.y,i.z)):1===t?(a.up.set(0,0,o[m]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+s[m],i.z)):(a.up.set(0,o[m],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+s[m]));const n=this._cubeSize;mb(r,t*n,m>2?n:0,n,n),u.setRenderTarget(r),p&&u.render(d,a),u.render(e,a)}d.geometry.dispose(),d.material.dispose(),u.toneMapping=c,u.autoClear=l,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===wa||e.mapping===Sa;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=vb()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=gb());const i=r?this._cubemapMaterial:this._equirectMaterial,a=new rc(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const o=this._cubeSize;mb(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,rb)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let i=1;i<r;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=hb[(r-i-1)%hb.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new rc(this._lodPlanes[r],u),c=u.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):nb;f>nb&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat(nb));const m=[];let g=0;for(let y=0;y<nb;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const D=this._sizeLods[r];mb(t,3*D*(r>v-4?r-v+4:0),4*(this._cubeSize-D),3*D,2*D),s.setRenderTarget(t),s.render(l,rb)}}function fb(e,t,n){const r=new Zs(e,t,n);return r.texture.mapping=Ba,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function mb(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function gb(){return new cc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function vb(){return new cc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Db(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,o=a===Ta||a===Ma,s=a===wa||a===Sa;if(o||s){let a=t.get(i);const u=void 0!==a?a.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==u)return null===n&&(n=new pb(e)),a=o?n.fromEquirectangular(i,a):n.fromCubemap(i,a),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),a.texture;if(void 0!==a)return a.texture;{const u=i.image;return o&&u&&u.height>0||s&&u&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(u)?(null===n&&(n=new pb(e)),a=o?n.fromEquirectangular(i):n.fromCubemap(i),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),i.addEventListener("dispose",r),a.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function yb(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Is("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Eb(e,t,n,r){const i={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);s.removeEventListener("dispose",o),delete i[s.id];const u=a.get(s);u&&(t.remove(u),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{const e=i.array;o=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const s=new(Ps(n)?Ll:Rl)(n,1);s.version=o;const u=a.get(e);u&&t.remove(u),a.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const i in r)t.update(r[i],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Ab(e,t,n){let r,i,a;function o(t,o,s){0!==s&&(e.drawElementsInstanced(r,o,i,t*a,s),n.update(o,r,s))}this.setMode=function(e){r=e},this.setIndex=function(e){i=e.type,a=e.bytesPerElement},this.render=function(t,o){e.drawElements(r,o,i,t*a),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(e,a,o){if(0===o)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,a,0,i,e,0,o);let s=0;for(let t=0;t<o;t++)s+=a[t];n.update(s,r,1)},this.renderMultiDrawInstances=function(e,s,u,l){if(0===u)return;const c=t.get("WEBGL_multi_draw");if(null===c)for(let t=0;t<e.length;t++)o(e[t]/a,s[t],l[t]);else{c.multiDrawElementsInstancedWEBGL(r,s,0,i,e,0,l,0,u);let t=0;for(let e=0;e<u;e++)t+=s[e]*l[e];n.update(t,r,1)}}}function Cb(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function _b(e,t,n){const r=new WeakMap,i=new $s;return{update:function(a,o,s){const u=a.morphTargetInfluences,l=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,c=void 0!==l?l.length:0;let h=r.get(o);if(void 0===h||h.count!==c){void 0!==h&&h.texture.dispose();const d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],v=o.morphAttributes.color||[];let D=0;!0===d&&(D=1),!0===p&&(D=2),!0===f&&(D=3);let y=o.attributes.position.count*D,E=1;y>t.maxTextureSize&&(E=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);const A=new Float32Array(y*E*4*c),C=new eu(A,y,E,c);C.type=Xa,C.needsUpdate=!0;const _=4*D;for(let x=0;x<c;x++){const F=m[x],w=g[x],S=v[x],T=y*E*4*x;for(let M=0;M<F.count;M++){const B=M*_;!0===d&&(i.fromBufferAttribute(F,M),A[T+B+0]=i.x,A[T+B+1]=i.y,A[T+B+2]=i.z,A[T+B+3]=0),!0===p&&(i.fromBufferAttribute(w,M),A[T+B+4]=i.x,A[T+B+5]=i.y,A[T+B+6]=i.z,A[T+B+7]=0),!0===f&&(i.fromBufferAttribute(S,M),A[T+B+8]=i.x,A[T+B+9]=i.y,A[T+B+10]=i.z,A[T+B+11]=4===S.itemSize?i.w:1)}}function b(){C.dispose(),r.delete(o),o.removeEventListener("dispose",b)}h={count:c,texture:C,size:new xs(y,E)},r.set(o,h),o.addEventListener("dispose",b)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)s.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let P=0;for(let R=0;R<u.length;R++)P+=u[R];const N=o.morphTargetsRelative?1:1-P;s.getUniforms().setValue(e,"morphTargetBaseInfluence",N),s.getUniforms().setValue(e,"morphTargetInfluences",u)}s.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),s.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function bb(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const s=r.render.frame,u=o.geometry,l=t.get(o,u);if(i.get(l)!==s&&(t.update(l),i.set(l,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),i.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),i.set(o,s))),o.isSkinnedMesh){const e=o.skeleton;i.get(e)!==s&&(e.update(),i.set(e,s))}return l},dispose:function(){i=new WeakMap}}}const xb=new Js,Fb=new Hc(1,1),wb=new eu,Sb=new tu,Tb=new Dc,Mb=[],Bb=[],Pb=new Float32Array(16),Nb=new Float32Array(9),Rb=new Float32Array(4);function Lb(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=Mb[i];if(void 0===a&&(a=new Float32Array(i),Mb[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function Ib(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function kb(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Ob(e,t){let n=Bb[t];void 0===n&&(n=new Int32Array(t),Bb[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Ub(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function zb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ib(n,t))return;e.uniform2fv(this.addr,t),kb(n,t)}}function Vb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Ib(n,t))return;e.uniform3fv(this.addr,t),kb(n,t)}}function Gb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ib(n,t))return;e.uniform4fv(this.addr,t),kb(n,t)}}function Hb(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Ib(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),kb(n,t)}else{if(Ib(n,r))return;Rb.set(r),e.uniformMatrix2fv(this.addr,!1,Rb),kb(n,r)}}function jb(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Ib(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),kb(n,t)}else{if(Ib(n,r))return;Nb.set(r),e.uniformMatrix3fv(this.addr,!1,Nb),kb(n,r)}}function Wb(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Ib(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),kb(n,t)}else{if(Ib(n,r))return;Pb.set(r),e.uniformMatrix4fv(this.addr,!1,Pb),kb(n,r)}}function qb(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Xb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ib(n,t))return;e.uniform2iv(this.addr,t),kb(n,t)}}function Kb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ib(n,t))return;e.uniform3iv(this.addr,t),kb(n,t)}}function Yb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ib(n,t))return;e.uniform4iv(this.addr,t),kb(n,t)}}function Jb(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function $b(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ib(n,t))return;e.uniform2uiv(this.addr,t),kb(n,t)}}function Qb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ib(n,t))return;e.uniform3uiv(this.addr,t),kb(n,t)}}function Zb(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ib(n,t))return;e.uniform4uiv(this.addr,t),kb(n,t)}}function ex(e,t,n){const r=this.cache,i=n.allocateTextureUnit();let a;r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),this.type===e.SAMPLER_2D_SHADOW?(Fb.compareFunction=rs,a=Fb):a=xb,n.setTexture2D(t||a,i)}function tx(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Sb,i)}function nx(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Tb,i)}function rx(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||wb,i)}function ix(e,t){e.uniform1fv(this.addr,t)}function ax(e,t){const n=Lb(t,this.size,2);e.uniform2fv(this.addr,n)}function ox(e,t){const n=Lb(t,this.size,3);e.uniform3fv(this.addr,n)}function sx(e,t){const n=Lb(t,this.size,4);e.uniform4fv(this.addr,n)}function ux(e,t){const n=Lb(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function lx(e,t){const n=Lb(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function cx(e,t){const n=Lb(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function hx(e,t){e.uniform1iv(this.addr,t)}function dx(e,t){e.uniform2iv(this.addr,t)}function px(e,t){e.uniform3iv(this.addr,t)}function fx(e,t){e.uniform4iv(this.addr,t)}function mx(e,t){e.uniform1uiv(this.addr,t)}function gx(e,t){e.uniform2uiv(this.addr,t)}function vx(e,t){e.uniform3uiv(this.addr,t)}function Dx(e,t){e.uniform4uiv(this.addr,t)}function yx(e,t,n){const r=this.cache,i=t.length,a=Ob(n,i);Ib(r,a)||(e.uniform1iv(this.addr,a),kb(r,a));for(let o=0;o!==i;++o)n.setTexture2D(t[o]||xb,a[o])}function Ex(e,t,n){const r=this.cache,i=t.length,a=Ob(n,i);Ib(r,a)||(e.uniform1iv(this.addr,a),kb(r,a));for(let o=0;o!==i;++o)n.setTexture3D(t[o]||Sb,a[o])}function Ax(e,t,n){const r=this.cache,i=t.length,a=Ob(n,i);Ib(r,a)||(e.uniform1iv(this.addr,a),kb(r,a));for(let o=0;o!==i;++o)n.setTextureCube(t[o]||Tb,a[o])}function Cx(e,t,n){const r=this.cache,i=t.length,a=Ob(n,i);Ib(r,a)||(e.uniform1iv(this.addr,a),kb(r,a));for(let o=0;o!==i;++o)n.setTexture2DArray(t[o]||wb,a[o])}class _x{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return Ub;case 35664:return zb;case 35665:return Vb;case 35666:return Gb;case 35674:return Hb;case 35675:return jb;case 35676:return Wb;case 5124:case 35670:return qb;case 35667:case 35671:return Xb;case 35668:case 35672:return Kb;case 35669:case 35673:return Yb;case 5125:return Jb;case 36294:return $b;case 36295:return Qb;case 36296:return Zb;case 35678:case 36198:case 36298:case 36306:case 35682:return ex;case 35679:case 36299:case 36307:return tx;case 35680:case 36300:case 36308:case 36293:return nx;case 36289:case 36303:case 36311:case 36292:return rx}}(t.type)}}class bx{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ix;case 35664:return ax;case 35665:return ox;case 35666:return sx;case 35674:return ux;case 35675:return lx;case 35676:return cx;case 5124:case 35670:return hx;case 35667:case 35671:return dx;case 35668:case 35672:return px;case 35669:case 35673:return fx;case 5125:return mx;case 36294:return gx;case 36295:return vx;case 36296:return Dx;case 35678:case 36198:case 36298:case 36306:case 35682:return yx;case 35679:case 36299:case 36307:return Ex;case 35680:case 36300:case 36308:case 36293:return Ax;case 36289:case 36303:case 36311:case 36292:return Cx}}(t.type)}}class xx{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}const Fx=/(\w+)(\])?(\[|\.)?/g;function wx(e,t){e.seq.push(t),e.map[t.id]=t}function Sx(e,t,n){const r=e.name,i=r.length;for(Fx.lastIndex=0;;){const a=Fx.exec(r),o=Fx.lastIndex;let s=a[1];const u="]"===a[2],l=a[3];if(u&&(s|=0),void 0===l||"["===l&&o+2===i){wx(n,void 0===l?new _x(s,e,t):new bx(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new xx(s),wx(n,e)),n=e}}}class Tx{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Sx(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function Mx(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let Bx=0;const Px=new Ms;function Nx(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=i;o<a;o++){const e=o+1;r.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),r)}return i}function Rx(e,t){const n=function(e){zs._getMatrix(Px,zs.workingColorSpace,e);const t="mat3( ".concat(Px.elements.map(e=>e.toFixed(4))," )");switch(zs.getTransfer(e)){case $o:return[t,"LinearTransferOETF"];case Qo:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return["vec4 ".concat(e,"( vec4 value ) {"),"\treturn ".concat(n[1],"( vec4( value.rgb * ").concat(n[0],", value.a ) );"),"}"].join("\n")}function Lx(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Ix=new ws;function kx(){zs.getLuminanceCoefficients(Ix);const e=Ix.x.toFixed(4),t=Ix.y.toFixed(4),n=Ix.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","\tconst vec3 weights = vec3( ".concat(e,", ").concat(t,", ").concat(n," );"),"\treturn dot( weights, rgb );","}"].join("\n")}function Ox(e){return""!==e}function Ux(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function zx(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Vx=/^[ \t]*#include +<([\w\d./]+)>/gm;function Gx(e){return e.replace(Vx,jx)}const Hx=new Map;function jx(e,t){let n=H_[t];if(void 0===n){const e=Hx.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=H_[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return Gx(n)}const Wx=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function qx(e){return e.replace(Wx,Xx)}function Xx(e,t,n,r){let i="";for(let a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function Kx(e){let t="precision ".concat(e.precision," float;\n\tprecision ").concat(e.precision," int;\n\tprecision ").concat(e.precision," sampler2D;\n\tprecision ").concat(e.precision," samplerCube;\n\tprecision ").concat(e.precision," sampler3D;\n\tprecision ").concat(e.precision," sampler2DArray;\n\tprecision ").concat(e.precision," sampler2DShadow;\n\tprecision ").concat(e.precision," samplerCubeShadow;\n\tprecision ").concat(e.precision," sampler2DArrayShadow;\n\tprecision ").concat(e.precision," isampler2D;\n\tprecision ").concat(e.precision," isampler3D;\n\tprecision ").concat(e.precision," isamplerCube;\n\tprecision ").concat(e.precision," isampler2DArray;\n\tprecision ").concat(e.precision," usampler2D;\n\tprecision ").concat(e.precision," usampler3D;\n\tprecision ").concat(e.precision," usamplerCube;\n\tprecision ").concat(e.precision," usampler2DArray;\n\t");return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Yx(e,t,n,r){const i=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const u=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case wa:case Sa:t="ENVMAP_TYPE_CUBE";break;case Ba:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),c=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Sa&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ox).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),m=i.createProgram();let g,v,D=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Ox).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Ox).join("\n"),v.length>0&&(v+="\n")):(g=[Kx(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ox).join("\n"),v=[Kx(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?H_.tonemapping_pars_fragment:"",0!==n.toneMapping?Lx("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",H_.colorspace_pars_fragment,Rx("linearToOutputTexel",n.outputColorSpace),kx(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ox).join("\n")),o=Gx(o),o=Ux(o,n),o=zx(o,n),s=Gx(s),s=Ux(s,n),s=zx(s,n),o=qx(o),s=qx(s),!0!==n.isRawShaderMaterial&&(D="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===cs?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===cs?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=D+g+o,E=D+v+s,A=Mx(i,i.VERTEX_SHADER,y),C=Mx(i,i.FRAGMENT_SHADER,E);function _(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m).trim(),r=i.getShaderInfoLog(A).trim(),a=i.getShaderInfoLog(C).trim();let o=!0,s=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(o=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(i,m,A,C);else{const e=Nx(i,A,"vertex"),r=Nx(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==a||(s=!1);s&&(t.diagnostics={runnable:o,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:a,prefix:v}})}i.deleteShader(A),i.deleteShader(C),b=new Tx(i,m),x=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:o}}return n}(i,m)}let b,x;i.attachShader(m,A),i.attachShader(m,C),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===b&&_(this),b},this.getAttributes=function(){return void 0===x&&_(this),x};let F=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===F&&(F=i.getProgramParameter(m,37297)),F},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Bx++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=A,this.fragmentShader=C,this}let Jx=0;class $x{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Qx(e),t.set(e,n)),n}}class Qx{constructor(e){this.id=Jx++,this.code=e,this.usedTimes=0}}function Zx(e,t,n,r,i,a,o){const s=new zu,u=new $x,l=new Set,c=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let p=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return l.add(e),0===e?"uv":"uv".concat(e)}return{getParameters:function(a,s,c,g,v){const D=g.fog,y=v.geometry,E=a.isMeshStandardMaterial?g.environment:null,A=(a.isMeshStandardMaterial?n:t).get(a.envMap||E),C=A&&A.mapping===Ba?A.image.height:null,_=f[a.type];null!==a.precision&&(p=i.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));const b=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,x=void 0!==b?b.length:0;let F,w,S,T,M=0;if(void 0!==y.morphAttributes.position&&(M=1),void 0!==y.morphAttributes.normal&&(M=2),void 0!==y.morphAttributes.color&&(M=3),_){const e=W_[_];F=e.vertexShader,w=e.fragmentShader}else F=a.vertexShader,w=a.fragmentShader,u.update(a),S=u.getVertexShaderID(a),T=u.getFragmentShaderID(a);const B=e.getRenderTarget(),P=e.state.buffers.depth.getReversed(),N=!0===v.isInstancedMesh,R=!0===v.isBatchedMesh,L=!!a.map,I=!!a.matcap,k=!!A,O=!!a.aoMap,U=!!a.lightMap,z=!!a.bumpMap,V=!!a.normalMap,G=!!a.displacementMap,H=!!a.emissiveMap,j=!!a.metalnessMap,W=!!a.roughnessMap,q=a.anisotropy>0,X=a.clearcoat>0,K=a.dispersion>0,Y=a.iridescence>0,J=a.sheen>0,$=a.transmission>0,Q=q&&!!a.anisotropyMap,Z=X&&!!a.clearcoatMap,ee=X&&!!a.clearcoatNormalMap,te=X&&!!a.clearcoatRoughnessMap,ne=Y&&!!a.iridescenceMap,re=Y&&!!a.iridescenceThicknessMap,ie=J&&!!a.sheenColorMap,ae=J&&!!a.sheenRoughnessMap,oe=!!a.specularMap,se=!!a.specularColorMap,ue=!!a.specularIntensityMap,le=$&&!!a.transmissionMap,ce=$&&!!a.thicknessMap,he=!!a.gradientMap,de=!!a.alphaMap,pe=a.alphaTest>0,fe=!!a.alphaHash,me=!!a.extensions;let ge=0;a.toneMapped&&(null!==B&&!0!==B.isXRRenderTarget||(ge=e.toneMapping));const ve={shaderID:_,shaderType:a.type,shaderName:a.name,vertexShader:F,fragmentShader:w,defines:a.defines,customVertexShaderID:S,customFragmentShaderID:T,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:R,batchingColor:R&&null!==v._colorsTexture,instancing:N,instancingColor:N&&null!==v.instanceColor,instancingMorph:N&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===B?e.outputColorSpace:!0===B.isXRRenderTarget?B.texture.colorSpace:Jo,alphaToCoverage:!!a.alphaToCoverage,map:L,matcap:I,envMap:k,envMapMode:k&&A.mapping,envMapCubeUVHeight:C,aoMap:O,lightMap:U,bumpMap:z,normalMap:V,displacementMap:d&&G,emissiveMap:H,normalMapObjectSpace:V&&1===a.normalMapType,normalMapTangentSpace:V&&0===a.normalMapType,metalnessMap:j,roughnessMap:W,anisotropy:q,anisotropyMap:Q,clearcoat:X,clearcoatMap:Z,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:K,iridescence:Y,iridescenceMap:ne,iridescenceThicknessMap:re,sheen:J,sheenColorMap:ie,sheenRoughnessMap:ae,specularMap:oe,specularColorMap:se,specularIntensityMap:ue,transmission:$,transmissionMap:le,thicknessMap:ce,gradientMap:he,opaque:!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage,alphaMap:de,alphaTest:pe,alphaHash:fe,combine:a.combine,mapUv:L&&m(a.map.channel),aoMapUv:O&&m(a.aoMap.channel),lightMapUv:U&&m(a.lightMap.channel),bumpMapUv:z&&m(a.bumpMap.channel),normalMapUv:V&&m(a.normalMap.channel),displacementMapUv:G&&m(a.displacementMap.channel),emissiveMapUv:H&&m(a.emissiveMap.channel),metalnessMapUv:j&&m(a.metalnessMap.channel),roughnessMapUv:W&&m(a.roughnessMap.channel),anisotropyMapUv:Q&&m(a.anisotropyMap.channel),clearcoatMapUv:Z&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:ee&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:re&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ae&&m(a.sheenRoughnessMap.channel),specularMapUv:oe&&m(a.specularMap.channel),specularColorMapUv:se&&m(a.specularColorMap.channel),specularIntensityMapUv:ue&&m(a.specularIntensityMap.channel),transmissionMapUv:le&&m(a.transmissionMap.channel),thicknessMapUv:ce&&m(a.thicknessMap.channel),alphaMapUv:de&&m(a.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(V||q),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!y.attributes.uv&&(L||de),fog:!!D,useFog:!0===a.fog,fogExp2:!!D&&D.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reverseDepthBuffer:P,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:x,morphTextureStride:M,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:L&&!0===a.map.isVideoTexture&&zs.getTransfer(a.map.colorSpace)===Qo,decodeVideoTextureEmissive:H&&!0===a.emissiveMap.isVideoTexture&&zs.getTransfer(a.emissiveMap.colorSpace)===Qo,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:me&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(me&&!0===a.extensions.multiDraw||R)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return ve.vertexUv1s=l.has(1),ve.vertexUv2s=l.has(2),ve.vertexUv3s=l.has(3),l.clear(),ve},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.supportsVertexTextures&&s.enable(0);t.instancing&&s.enable(1);t.instancingColor&&s.enable(2);t.instancingMorph&&s.enable(3);t.matcap&&s.enable(4);t.envMap&&s.enable(5);t.normalMapObjectSpace&&s.enable(6);t.normalMapTangentSpace&&s.enable(7);t.clearcoat&&s.enable(8);t.iridescence&&s.enable(9);t.alphaTest&&s.enable(10);t.vertexColors&&s.enable(11);t.vertexAlphas&&s.enable(12);t.vertexUv1s&&s.enable(13);t.vertexUv2s&&s.enable(14);t.vertexUv3s&&s.enable(15);t.vertexTangents&&s.enable(16);t.anisotropy&&s.enable(17);t.alphaHash&&s.enable(18);t.batching&&s.enable(19);t.dispersion&&s.enable(20);t.batchingColor&&s.enable(21);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.reverseDepthBuffer&&s.enable(4);t.skinning&&s.enable(5);t.morphTargets&&s.enable(6);t.morphNormals&&s.enable(7);t.morphColors&&s.enable(8);t.premultipliedAlpha&&s.enable(9);t.shadowMapEnabled&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);t.decodeVideoTexture&&s.enable(19);t.decodeVideoTextureEmissive&&s.enable(20);t.alphaToCoverage&&s.enable(21);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=W_[t];n=lc.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,i=c.length;e<i;e++){const t=c[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new Yx(e,n,t,a),c.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){u.remove(e)},programs:c,dispose:function(){u.dispose()}}}function eF(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function tF(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function nF(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function rF(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,o,s){let u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=i,u.groupOrder=a,u.renderOrder=n.renderOrder,u.z=o,u.group=s),t++,u}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,s,u,l){const c=a(e,t,o,s,u,l);o.transmission>0?r.push(c):!0===o.transparent?i.push(c):n.push(c)},unshift:function(e,t,o,s,u,l){const c=a(e,t,o,s,u,l);o.transmission>0?r.unshift(c):!0===o.transparent?i.unshift(c):n.unshift(c)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||tF),r.length>1&&r.sort(t||nF),i.length>1&&i.sort(t||nF)}}}function iF(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new rF,e.set(t,[i])):n>=r.length?(i=new rF,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function aF(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new ws,color:new Al};break;case"SpotLight":n={position:new ws,direction:new ws,color:new Al,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ws,color:new Al,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ws,skyColor:new Al,groundColor:new Al};break;case"RectAreaLight":n={color:new Al,position:new ws,halfWidth:new ws,halfHeight:new ws}}return e[t.id]=n,n}}}let oF=0;function sF(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function uF(e){const t=new aF,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xs};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xs,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let s=0;s<9;s++)r.probe.push(new ws);const i=new ws,a=new Tu,o=new Tu;return{setup:function(i){let a=0,o=0,s=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,l=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,D=0;i.sort(sF);for(let e=0,E=i.length;e<E;e++){const y=i[e],E=y.color,A=y.intensity,C=y.distance,_=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)a+=E.r*A,o+=E.g*A,s+=E.b*A;else if(y.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(y.sh.coefficients[e],A);D++}else if(y.isDirectionalLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[u]=t,r.directionalShadowMap[u]=_,r.directionalShadowMatrix[u]=y.shadow.matrix,p++}r.directional[u]=e,u++}else if(y.isSpotLight){const e=t.get(y);e.position.setFromMatrixPosition(y.matrixWorld),e.color.copy(E).multiplyScalar(A),e.distance=C,e.coneCos=Math.cos(y.angle),e.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),e.decay=y.decay,r.spot[c]=e;const i=y.shadow;if(y.map&&(r.spotLightMap[g]=y.map,g++,i.updateMatrices(y),y.castShadow&&v++),r.spotLightMatrix[c]=i.matrix,y.castShadow){const e=n.get(y);e.shadowIntensity=i.intensity,e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,r.spotShadow[c]=e,r.spotShadowMap[c]=_,m++}c++}else if(y.isRectAreaLight){const e=t.get(y);e.color.copy(E).multiplyScalar(A),e.halfWidth.set(.5*y.width,0,0),e.halfHeight.set(0,.5*y.height,0),r.rectArea[h]=e,h++}else if(y.isPointLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),e.distance=y.distance,e.decay=y.decay,y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[l]=t,r.pointShadowMap[l]=_,r.pointShadowMatrix[l]=y.shadow.matrix,f++}r.point[l]=e,l++}else if(y.isHemisphereLight){const e=t.get(y);e.skyColor.copy(y.color).multiplyScalar(A),e.groundColor.copy(y.groundColor).multiplyScalar(A),r.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=j_.LTC_FLOAT_1,r.rectAreaLTC2=j_.LTC_FLOAT_2):(r.rectAreaLTC1=j_.LTC_HALF_1,r.rectAreaLTC2=j_.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=s;const y=r.hash;y.directionalLength===u&&y.pointLength===l&&y.spotLength===c&&y.rectAreaLength===h&&y.hemiLength===d&&y.numDirectionalShadows===p&&y.numPointShadows===f&&y.numSpotShadows===m&&y.numSpotMaps===g&&y.numLightProbes===D||(r.directional.length=u,r.spot.length=c,r.rectArea.length=h,r.point.length=l,r.hemi.length=d,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=D,y.directionalLength=u,y.pointLength=l,y.spotLength=c,y.rectAreaLength=h,y.hemiLength=d,y.numDirectionalShadows=p,y.numPointShadows=f,y.numSpotShadows=m,y.numSpotMaps=g,y.numLightProbes=D,r.version=oF++)},setupView:function(e,t){let n=0,s=0,u=0,l=0,c=0;const h=t.matrixWorldInverse;for(let d=0,p=e.length;d<p;d++){const t=e[d];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=r.spot[u];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),u++}else if(t.isRectAreaLight){const e=r.rectArea[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),o.identity(),a.copy(t.matrixWorld),a.premultiply(h),o.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),l++}else if(t.isPointLight){const e=r.point[s];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s++}else if(t.isHemisphereLight){const e=r.hemi[c];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),c++}}},state:r}}function lF(e){const t=new uF(e),n=[],r=[];const i={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,n.length=0,r.length=0},state:i,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function cF(e){let t=new WeakMap;return{get:function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=t.get(n);let a;return void 0===i?(a=new lF(e),t.set(n,[a])):r>=i.length?(a=new lF(e),i.push(a)):a=i[r],a},dispose:function(){t=new WeakMap}}}function hF(e,t,n){let r=new Ic;const i=new xs,a=new xs,o=new $s,s=new eh({depthPacking:3201}),u=new th,l={},c=n.maxTextureSize,h={[$i]:1,[Qi]:0,[Zi]:2},d=new cc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new xs},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Wl;f.setAttribute("position",new Nl(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new rc(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function D(n,r){const a=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Zs(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,p,m,null)}function y(t,n,r,i){let a=null;const o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===r.isPointLight?u:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const e=a.uuid,t=n.uuid;let r=l[e];void 0===r&&(r={},l[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i,n.addEventListener("dispose",A)),a=i}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],a.alphaMap=n.alphaMap,a.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=r}return a}function E(n,i,a,o,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),u=n.material;if(Array.isArray(u)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=u[c.materialIndex];if(h&&h.visible){const t=y(n,h,o,s);n.onBeforeShadow(e,n,i,a,r,t,c),e.renderBufferDirect(a,null,r,t,n,c),n.onAfterShadow(e,n,i,a,r,t,c)}}}else if(u.visible){const t=y(n,u,o,s);n.onBeforeShadow(e,n,i,a,r,t,null),e.renderBufferDirect(a,null,r,t,n,null),n.onAfterShadow(e,n,i,a,r,t,null)}}const u=n.children;for(let e=0,t=u.length;e<t;e++)E(u[e],i,a,o,s)}function A(e){e.target.removeEventListener("dispose",A);for(const t in l){const n=l[t],r=e.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(t,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const u=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=3!==v&&3===this.type,f=3===v&&3!==this.type;for(let m=0,g=t.length;m<g;m++){const u=t[m],l=u.shadow;if(void 0===l){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===l.autoUpdate&&!1===l.needsUpdate)continue;i.copy(l.mapSize);const h=l.getFrameExtents();if(i.multiply(h),a.copy(l.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/h.x),i.x=a.x*h.x,l.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/h.y),i.y=a.y*h.y,l.mapSize.y=a.y)),null===l.map||!0===p||!0===f){const e=3!==this.type?{minFilter:La,magFilter:La}:{};null!==l.map&&l.map.dispose(),l.map=new Zs(i.x,i.y,e),l.map.texture.name=u.name+".shadowMap",l.camera.updateProjectionMatrix()}e.setRenderTarget(l.map),e.clear();const g=l.getViewportCount();for(let e=0;e<g;e++){const t=l.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(o),l.updateMatrices(u,e),r=l.getFrustum(),E(n,s,l.camera,u,this.type)}!0!==l.isPointLightShadow&&3===this.type&&D(l,s),l.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(u,l,h)}}const dF={[Da]:1,[Ea]:6,[Ca]:7,[Aa]:5,[ya]:0,[ba]:2,[xa]:4,[_a]:3};function pF(e,t){const n=new function(){let t=!1;const n=new $s;let r=null;const i=new $s(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,i=null,a=null,o=null;return{setReversed:function(e){if(r!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),r=e;const i=o;o=null,this.setClear(i)}},getReversed:function(){return r},setTest:function(t){t?z(e.DEPTH_TEST):V(e.DEPTH_TEST)},setMask:function(t){i===t||n||(e.depthMask(t),i=t)},setFunc:function(t){if(r&&(t=dF[t]),a!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}a=t}},setLocked:function(e){n=e},setClear:function(t){o!==t&&(r&&(t=1-t),e.clearDepth(t),o=t)},reset:function(){n=!1,i=null,a=null,o=null,r=!1}}},i=new function(){let t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(n){t||(n?z(e.STENCIL_TEST):V(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&u===r||(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null}}},a=new WeakMap,o=new WeakMap;let s={},u={},l=new WeakMap,c=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,D=null,y=null,E=new Al(0,0,0),A=0,C=!1,_=null,b=null,x=null,F=null,w=null;const S=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let T=!1,M=0;const B=e.getParameter(e.VERSION);-1!==B.indexOf("WebGL")?(M=parseFloat(/^WebGL (\d)/.exec(B)[1]),T=M>=1):-1!==B.indexOf("OpenGL ES")&&(M=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),T=M>=2);let P=null,N={};const R=e.getParameter(e.SCISSOR_BOX),L=e.getParameter(e.VIEWPORT),I=(new $s).fromArray(R),k=(new $s).fromArray(L);function O(t,n,r,i){const a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<r;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}const U={};function z(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function V(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}U[e.TEXTURE_2D]=O(e.TEXTURE_2D,e.TEXTURE_2D,1),U[e.TEXTURE_CUBE_MAP]=O(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),U[e.TEXTURE_2D_ARRAY]=O(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),U[e.TEXTURE_3D]=O(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),i.setClear(0),z(e.DEPTH_TEST),r.setFunc(3),W(!1),q(1),z(e.CULL_FACE),j(0);const G={[ea]:e.FUNC_ADD,[ta]:e.FUNC_SUBTRACT,[na]:e.FUNC_REVERSE_SUBTRACT};G[103]=e.MIN,G[104]=e.MAX;const H={[ra]:e.ZERO,[ia]:e.ONE,[aa]:e.SRC_COLOR,[sa]:e.SRC_ALPHA,[pa]:e.SRC_ALPHA_SATURATE,[ha]:e.DST_COLOR,[la]:e.DST_ALPHA,[oa]:e.ONE_MINUS_SRC_COLOR,[ua]:e.ONE_MINUS_SRC_ALPHA,[da]:e.ONE_MINUS_DST_COLOR,[ca]:e.ONE_MINUS_DST_ALPHA,[fa]:e.CONSTANT_COLOR,[ma]:e.ONE_MINUS_CONSTANT_COLOR,[ga]:e.CONSTANT_ALPHA,[va]:e.ONE_MINUS_CONSTANT_ALPHA};function j(t,n,r,i,a,o,s,u,l,c){if(0!==t){if(!1===d&&(z(e.BLEND),d=!0),5===t)a=a||n,o=o||r,s=s||i,n===f&&a===v||(e.blendEquationSeparate(G[n],G[a]),f=n,v=a),r===m&&i===g&&o===D&&s===y||(e.blendFuncSeparate(H[r],H[i],H[o],H[s]),m=r,g=i,D=o,y=s),!1!==u.equals(E)&&l===A||(e.blendColor(u.r,u.g,u.b,l),E.copy(u),A=l),p=t,C=!1;else if(t!==p||c!==C){if(f===ea&&v===ea||(e.blendEquation(e.FUNC_ADD),f=ea,v=ea),c)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,D=null,y=null,E.set(0,0,0),A=0,p=t,C=c}}else!0===d&&(V(e.BLEND),d=!1)}function W(t){_!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),_=t)}function q(t){0!==t?(z(e.CULL_FACE),t!==b&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):V(e.CULL_FACE),b=t}function X(t,n,r){t?(z(e.POLYGON_OFFSET_FILL),F===n&&w===r||(e.polygonOffset(n,r),F=n,w=r)):V(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:i},enable:z,disable:V,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=c,i=!1;if(t){r=l.get(n),void 0===r&&(r=[],l.set(n,r));const a=t.textures;if(r.length!==a.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=a.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=a.length,i=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,i=!0);i&&e.drawBuffers(r)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:j,setMaterial:function(t,a){2===t.side?V(e.CULL_FACE):z(e.CULL_FACE);let o=1===t.side;a&&(o=!o),W(o),1===t.blending&&!1===t.transparent?j(0):j(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),n.setMask(t.colorWrite);const s=t.stencilWrite;i.setTest(s),s&&(i.setMask(t.stencilWriteMask),i.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),i.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):V(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:q,setLineWidth:function(t){t!==x&&(T&&e.lineWidth(t),x=t)},setPolygonOffset:X,setScissorTest:function(t){t?z(e.SCISSOR_TEST):V(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+S-1),P!==t&&(e.activeTexture(t),P=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===P?e.TEXTURE0+S-1:P);let i=N[r];void 0===i&&(i={type:void 0,texture:void 0},N[r]=i),i.type===t&&i.texture===n||(P!==r&&(e.activeTexture(r),P=r),e.bindTexture(t,n||U[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=N[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=o.get(n).get(t);a.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),a.set(n,r))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===I.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),I.copy(t))},viewport:function(t){!1===k.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),k.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},P=null,N={},u={},l=new WeakMap,c=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,D=null,y=null,E=new Al(0,0,0),A=0,C=!1,_=null,b=null,x=null,F=null,w=null,I.set(0,0,e.canvas.width,e.canvas.height),k.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),i.reset()}}}function fF(e,t,n,r,i,a,o){const s=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,u="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),l=new xs,c=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(j){}function f(e,t){return p?new OffscreenCanvas(e,t):Ns("canvas")}function m(e,t,n){let r=1;const i=H(e);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*i.width),a=Math.floor(r*i.height);void 0===h&&(h=f(n,a));const o=t?f(n,a):h;o.width=n,o.height=a;return o.getContext("2d").drawImage(e,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+a+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function D(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function y(n,r,i,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;if(r===e.RED&&(i===e.FLOAT&&(s=e.R32F),i===e.HALF_FLOAT&&(s=e.R16F),i===e.UNSIGNED_BYTE&&(s=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.R8UI),i===e.UNSIGNED_SHORT&&(s=e.R16UI),i===e.UNSIGNED_INT&&(s=e.R32UI),i===e.BYTE&&(s=e.R8I),i===e.SHORT&&(s=e.R16I),i===e.INT&&(s=e.R32I)),r===e.RG&&(i===e.FLOAT&&(s=e.RG32F),i===e.HALF_FLOAT&&(s=e.RG16F),i===e.UNSIGNED_BYTE&&(s=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RG8UI),i===e.UNSIGNED_SHORT&&(s=e.RG16UI),i===e.UNSIGNED_INT&&(s=e.RG32UI),i===e.BYTE&&(s=e.RG8I),i===e.SHORT&&(s=e.RG16I),i===e.INT&&(s=e.RG32I)),r===e.RGB_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RGB8UI),i===e.UNSIGNED_SHORT&&(s=e.RGB16UI),i===e.UNSIGNED_INT&&(s=e.RGB32UI),i===e.BYTE&&(s=e.RGB8I),i===e.SHORT&&(s=e.RGB16I),i===e.INT&&(s=e.RGB32I)),r===e.RGBA_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RGBA8UI),i===e.UNSIGNED_SHORT&&(s=e.RGBA16UI),i===e.UNSIGNED_INT&&(s=e.RGBA32UI),i===e.BYTE&&(s=e.RGBA8I),i===e.SHORT&&(s=e.RGBA16I),i===e.INT&&(s=e.RGBA32I)),r===e.RGB&&i===e.UNSIGNED_INT_5_9_9_9_REV&&(s=e.RGB9_E5),r===e.RGBA){const t=o?$o:zs.getTransfer(a);i===e.FLOAT&&(s=e.RGBA32F),i===e.HALF_FLOAT&&(s=e.RGBA16F),i===e.UNSIGNED_BYTE&&(s=t===Qo?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)}return s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||t.get("EXT_color_buffer_float"),s}function E(t,n){let r;return t?null===n||n===qa||n===$a?r=e.DEPTH24_STENCIL8:n===Xa?r=e.DEPTH32F_STENCIL8:n===ja&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===qa||n===$a?r=e.DEPTH_COMPONENT24:n===Xa?r=e.DEPTH_COMPONENT32F:n===ja&&(r=e.DEPTH_COMPONENT16),r}function A(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==La&&e.minFilter!==Oa?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function C(e){const t=e.target;t.removeEventListener("dispose",C),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=d.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&b(e),0===Object.keys(i).length&&d.delete(n)}r.remove(e)}(t),t.isVideoTexture&&c.delete(t)}function _(t){const n=t.target;n.removeEventListener("dispose",_),function(t){const n=r.get(t);t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++){if(Array.isArray(n.__webglFramebuffer[r]))for(let t=0;t<n.__webglFramebuffer[r].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[r][t]);else e.deleteFramebuffer(n.__webglFramebuffer[r]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=t.textures;for(let a=0,s=i.length;a<s;a++){const t=r.get(i[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),r.remove(i[a])}r.remove(t)}(n)}function b(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete d.get(i)[n.__cacheKey],o.memory.textures--}let x=0;function F(t,i){const a=r.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;c.get(e)!==t&&(c.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void N(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const w={[Pa]:e.REPEAT,[Na]:e.CLAMP_TO_EDGE,[Ra]:e.MIRRORED_REPEAT},S={[La]:e.NEAREST,[Ia]:e.NEAREST_MIPMAP_NEAREST,[ka]:e.NEAREST_MIPMAP_LINEAR,[Oa]:e.LINEAR,[Ua]:e.LINEAR_MIPMAP_NEAREST,[za]:e.LINEAR_MIPMAP_LINEAR},T={[es]:e.NEVER,[ss]:e.ALWAYS,[ts]:e.LESS,[rs]:e.LEQUAL,[ns]:e.EQUAL,[os]:e.GEQUAL,[is]:e.GREATER,[as]:e.NOTEQUAL};function M(n,a){if(a.type!==Xa||!1!==t.has("OES_texture_float_linear")||a.magFilter!==Oa&&a.magFilter!==Ua&&a.magFilter!==ka&&a.magFilter!==za&&a.minFilter!==Oa&&a.minFilter!==Ua&&a.minFilter!==ka&&a.minFilter!==za||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,w[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,w[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,w[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,S[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,S[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,T[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===La)return;if(a.minFilter!==ka&&a.minFilter!==za)return;if(a.type===Xa&&!1===t.has("OES_texture_float_linear"))return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){const o=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}}function B(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",C));const i=n.source;let a=d.get(i);void 0===a&&(a={},d.set(i,a));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[s].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&b(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return r}function P(e,t,n){return Math.floor(Math.floor(e/n)/t)}function N(t,o,s){let u=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(u=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(u=e.TEXTURE_3D);const l=B(t,o),c=o.source;n.bindTexture(u,t.__webglTexture,e.TEXTURE0+s);const h=r.get(c);if(c.version!==h.__version||!0===l){n.activeTexture(e.TEXTURE0+s);const t=zs.getPrimaries(zs.workingColorSpace),r=o.colorSpace===Ko?null:zs.getPrimaries(o.colorSpace),d=o.colorSpace===Ko||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(o.image,!1,i.maxTextureSize);p=G(o,p);const f=a.convert(o.format,o.colorSpace),D=a.convert(o.type);let C,_=y(o.internalFormat,f,D,o.colorSpace,o.isVideoTexture);M(u,o);const b=o.mipmaps,x=!0!==o.isVideoTexture,F=void 0===h.__version||!0===l,w=c.dataReady,S=A(o,p);if(o.isDepthTexture)_=E(o.format===ro,o.type),F&&(x?n.texStorage2D(e.TEXTURE_2D,1,_,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,_,p.width,p.height,0,f,D,null));else if(o.isDataTexture)if(b.length>0){x&&F&&n.texStorage2D(e.TEXTURE_2D,S,_,b[0].width,b[0].height);for(let t=0,r=b.length;t<r;t++)C=b[t],x?w&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,C.width,C.height,f,D,C.data):n.texImage2D(e.TEXTURE_2D,t,_,C.width,C.height,0,f,D,C.data);o.generateMipmaps=!1}else x?(F&&n.texStorage2D(e.TEXTURE_2D,S,_,p.width,p.height),w&&function(t,r,i,a){const o=t.updateRanges;if(0===o.length)n.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,i,a,r.data);else{o.sort((e,t)=>e.start-t.start);let s=0;for(let e=1;e<o.length;e++){const t=o[s],n=o[e],i=t.start+t.count,a=P(n.start,r.width,4),u=P(t.start,r.width,4);n.start<=i+1&&a===u&&P(n.start+n.count-1,r.width,4)===a?t.count=Math.max(t.count,n.start+n.count-t.start):(++s,o[s]=n)}o.length=s+1;const u=e.getParameter(e.UNPACK_ROW_LENGTH),l=e.getParameter(e.UNPACK_SKIP_PIXELS),c=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width);for(let t=0,h=o.length;t<h;t++){const s=o[t],u=Math.floor(s.start/4),l=Math.ceil(s.count/4),c=u%r.width,h=Math.floor(u/r.width),d=l,p=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,h),n.texSubImage2D(e.TEXTURE_2D,0,c,h,d,p,i,a,r.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,u),e.pixelStorei(e.UNPACK_SKIP_PIXELS,l),e.pixelStorei(e.UNPACK_SKIP_ROWS,c)}}(o,p,f,D)):n.texImage2D(e.TEXTURE_2D,0,_,p.width,p.height,0,f,D,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){x&&F&&n.texStorage3D(e.TEXTURE_2D_ARRAY,S,_,b[0].width,b[0].height,p.depth);for(let t=0,r=b.length;t<r;t++)if(C=b[t],o.format!==to)if(null!==f)if(x){if(w)if(o.layerUpdates.size>0){const r=sd(C.width,C.height,o.format,o.type);for(const i of o.layerUpdates){const a=C.data.subarray(i*r/C.data.BYTES_PER_ELEMENT,(i+1)*r/C.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,i,C.width,C.height,1,f,a)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,C.width,C.height,p.depth,f,C.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,_,C.width,C.height,p.depth,0,C.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else x?w&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,C.width,C.height,p.depth,f,D,C.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,_,C.width,C.height,p.depth,0,f,D,C.data)}else{x&&F&&n.texStorage2D(e.TEXTURE_2D,S,_,b[0].width,b[0].height);for(let t=0,r=b.length;t<r;t++)C=b[t],o.format!==to?null!==f?x?w&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,C.width,C.height,f,C.data):n.compressedTexImage2D(e.TEXTURE_2D,t,_,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):x?w&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,C.width,C.height,f,D,C.data):n.texImage2D(e.TEXTURE_2D,t,_,C.width,C.height,0,f,D,C.data)}else if(o.isDataArrayTexture)if(x){if(F&&n.texStorage3D(e.TEXTURE_2D_ARRAY,S,_,p.width,p.height,p.depth),w)if(o.layerUpdates.size>0){const t=sd(p.width,p.height,o.format,o.type);for(const r of o.layerUpdates){const i=p.data.subarray(r*t/p.data.BYTES_PER_ELEMENT,(r+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,D,i)}o.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,D,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,p.width,p.height,p.depth,0,f,D,p.data);else if(o.isData3DTexture)x?(F&&n.texStorage3D(e.TEXTURE_3D,S,_,p.width,p.height,p.depth),w&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,D,p.data)):n.texImage3D(e.TEXTURE_3D,0,_,p.width,p.height,p.depth,0,f,D,p.data);else if(o.isFramebufferTexture){if(F)if(x)n.texStorage2D(e.TEXTURE_2D,S,_,p.width,p.height);else{let t=p.width,r=p.height;for(let i=0;i<S;i++)n.texImage2D(e.TEXTURE_2D,i,_,t,r,0,f,D,null),t>>=1,r>>=1}}else if(b.length>0){if(x&&F){const t=H(b[0]);n.texStorage2D(e.TEXTURE_2D,S,_,t.width,t.height)}for(let t=0,r=b.length;t<r;t++)C=b[t],x?w&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,D,C):n.texImage2D(e.TEXTURE_2D,t,_,f,D,C);o.generateMipmaps=!1}else if(x){if(F){const t=H(p);n.texStorage2D(e.TEXTURE_2D,S,_,t.width,t.height)}w&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,D,p)}else n.texImage2D(e.TEXTURE_2D,0,_,f,D,p);g(o)&&v(u),h.__version=c.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}function R(t,i,o,u,l,c){const h=a.convert(o.format,o.colorSpace),d=a.convert(o.type),p=y(o.internalFormat,h,d,o.colorSpace),f=r.get(i),m=r.get(o);if(m.__renderTarget=i,!f.__hasExternalTextures){const t=Math.max(1,i.width>>c),r=Math.max(1,i.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,p,t,r,i.depth,0,h,d,null):n.texImage2D(l,c,p,t,r,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),V(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,u,l,m.__webglTexture,0,z(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,u,l,m.__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function L(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const i=n.depthTexture,a=i&&i.isDepthTexture?i.type:null,o=E(n.stencilBuffer,a),u=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,l=z(n);V(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,l,o,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,l,o,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,o,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const o=t[i],u=a.convert(o.format,o.colorSpace),l=a.convert(o.type),c=y(o.internalFormat,u,l,o.colorSpace),h=z(n);r&&!1===V(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,c,n.width,n.height):V(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function I(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const a=r.get(i.depthTexture);a.__renderTarget=i,a.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),F(i.depthTexture,0);const o=a.__webglTexture,u=z(i);if(i.depthTexture.format===no)V(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,u):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==ro)throw new Error("Unknown depthTexture format");V(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,u):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}function k(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),e){const t=()=>{delete i.__boundDepthTexture,delete i.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),i.__depthDisposeCallback=t}i.__boundDepthTexture=e}if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");const e=t.texture.mipmaps;e&&e.length>0?I(i.__webglFramebuffer[0],t):I(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),void 0===i.__webglDepthbuffer[r])i.__webglDepthbuffer[r]=e.createRenderbuffer(),L(i.__webglDepthbuffer[r],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,a=i.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,a)}}else{const r=t.texture.mipmaps;if(r&&r.length>0?n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[0]):n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=e.createRenderbuffer(),L(i.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=i.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}}n.bindFramebuffer(e.FRAMEBUFFER,null)}const O=[],U=[];function z(e){return Math.min(i.maxSamples,e.samples)}function V(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function G(e,t){const n=e.colorSpace,r=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==Jo&&n!==Ko&&(zs.getTransfer(n)===Qo?r===to&&i===Va||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function H(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(l.width=e.naturalWidth||e.width,l.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(l.width=e.displayWidth,l.height=e.displayHeight):(l.width=e.width,l.height=e.height),l}this.allocateTextureUnit=function(){const e=x;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),x+=1,e},this.resetTextureUnits=function(){x=0},this.setTexture2D=F,this.setTexture2DArray=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?N(a,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?N(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,o){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,o,s){if(6!==o.image.length)return;const u=B(t,o),l=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);const c=r.get(l);if(l.version!==c.__version||!0===u){n.activeTexture(e.TEXTURE0+s);const t=zs.getPrimaries(zs.workingColorSpace),r=o.colorSpace===Ko?null:zs.getPrimaries(o.colorSpace),h=o.colorSpace===Ko||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=d||p?p?o.image[e].image:o.image[e]:m(o.image[e],!0,i.maxCubemapSize),f[e]=G(o,f[e]);const D=f[0],E=a.convert(o.format,o.colorSpace),C=a.convert(o.type),_=y(o.internalFormat,E,C,o.colorSpace),b=!0!==o.isVideoTexture,x=void 0===c.__version||!0===u,F=l.dataReady;let w,S=A(o,D);if(M(e.TEXTURE_CUBE_MAP,o),d){b&&x&&n.texStorage2D(e.TEXTURE_CUBE_MAP,S,_,D.width,D.height);for(let t=0;t<6;t++){w=f[t].mipmaps;for(let r=0;r<w.length;r++){const i=w[r];o.format!==to?null!==E?b?F&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,E,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):b?F&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,E,C,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,i.width,i.height,0,E,C,i.data)}}}else{if(w=o.mipmaps,b&&x){w.length>0&&S++;const t=H(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,S,_,t.width,t.height)}for(let t=0;t<6;t++)if(p){b?F&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,E,C,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,f[t].width,f[t].height,0,E,C,f[t].data);for(let r=0;r<w.length;r++){const i=w[r].image[t].image;b?F&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,E,C,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,i.width,i.height,0,E,C,i.data)}}else{b?F&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,E,C,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,E,C,f[t]);for(let r=0;r<w.length;r++){const i=w[r];b?F&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,E,C,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,E,C,i.image[t])}}}g(o)&&v(e.TEXTURE_CUBE_MAP),c.__version=l.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}(s,t,o):n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(t,n,i){const a=r.get(t);void 0!==n&&R(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&k(t)},this.setupRenderTarget=function(t){const i=t.texture,s=r.get(t),u=r.get(i);t.addEventListener("dispose",_);const l=t.textures,c=!0===t.isWebGLCubeRenderTarget,h=l.length>1;if(h||(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=i.version,o.memory.textures++),c){s.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer[t]=[];for(let n=0;n<i.mipmaps.length;n++)s.__webglFramebuffer[t][n]=e.createFramebuffer()}else s.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)s.__webglFramebuffer[t]=e.createFramebuffer()}else s.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=l.length;t<n;t++){const n=r.get(l[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}if(t.samples>0&&!1===V(t)){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,s.__webglMultisampledFramebuffer);for(let n=0;n<l.length;n++){const r=l[n];s.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,s.__webglColorRenderbuffer[n]);const i=a.convert(r.format,r.colorSpace),o=a.convert(r.type),u=y(r.internalFormat,i,o,r.colorSpace,!0===t.isXRRenderTarget),c=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,u,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,s.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),L(s.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),M(e.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)R(s.__webglFramebuffer[n][r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else R(s.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let i=0,a=l.length;i<a;i++){const a=l[i],o=r.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),M(e.TEXTURE_2D,a),R(s.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,0),g(a)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,u.__webglTexture),M(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)R(s.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,r,n);else R(s.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,r,0);g(i)&&v(r),n.unbindTexture()}t.depthBuffer&&k(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let i=0,a=t.length;i<a;i++){const a=t[i];if(g(a)){const t=D(e),i=r.get(a).__webglTexture;n.bindTexture(t,i),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===V(t)){const i=t.textures,a=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;const l=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=r.get(t),h=i.length>1;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer);const d=t.texture.mipmaps;d&&d.length>0?n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer[0]):n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let n=0;n<i.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),!0===u&&(O.length=0,U.length=0,O.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(O.push(l),U.push(l),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,U)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,O))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,c.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&u){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=k,this.setupFrameBufferTexture=R,this.useMultisampledRTT=V}function mF(e,t){return{convert:function(n){let r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ko;const a=zs.getTransfer(i);if(n===Va)return e.UNSIGNED_BYTE;if(n===Ya)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Ja)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Qa)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===Ga)return e.BYTE;if(n===Ha)return e.SHORT;if(n===ja)return e.UNSIGNED_SHORT;if(n===Wa)return e.INT;if(n===qa)return e.UNSIGNED_INT;if(n===Xa)return e.FLOAT;if(n===Ka)return e.HALF_FLOAT;if(n===Za)return e.ALPHA;if(n===eo)return e.RGB;if(n===to)return e.RGBA;if(n===no)return e.DEPTH_COMPONENT;if(n===ro)return e.DEPTH_STENCIL;if(n===io)return e.RED;if(n===ao)return e.RED_INTEGER;if(n===oo)return e.RG;if(n===so)return e.RG_INTEGER;if(n===uo)return e.RGBA_INTEGER;if(n===lo||n===co||n===ho||n===po)if(a===Qo){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===lo)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===co)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===ho)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===po)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===lo)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===co)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===ho)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===po)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===fo||n===mo||n===go||n===vo){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===fo)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===mo)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===go)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===vo)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Do||n===yo||n===Eo){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===Do||n===yo)return a===Qo?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===Eo)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===Ao||n===Co||n===_o||n===bo||n===xo||n===Fo||n===wo||n===So||n===To||n===Mo||n===Bo||n===Po||n===No||n===Ro){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===Ao)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Co)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===_o)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===bo)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===xo)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Fo)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===wo)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===So)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===To)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Mo)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Bo)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Po)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===No)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Ro)return a===Qo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Lo||n===Io||n===ko){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===Lo)return a===Qo?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Io)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===ko)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Oo||n===Uo||n===zo||n===Vo){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===Lo)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Uo)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===zo)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Vo)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===$a?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class gF{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const r=new Js;e.properties.get(r).__webglTexture=t.texture,t.depthNear===n.depthNear&&t.depthFar===n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new cc({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new rc(new Wc(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class vF extends ps{constructor(e,t){super();const n=this;let r=null,i=1,a=null,o="local-floor",s=1,u=null,l=null,c=null,h=null,d=null,p=null;const f=new gF,m=t.getContextAttributes();let g=null,v=null;const D=[],y=[],E=new xs;let A=null;const C=new mc;C.viewport=new $s;const _=new mc;_.viewport=new $s;const b=[C,_],x=new Hh;let F=null,w=null;function S(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const n=D[t];void 0!==n&&(n.update(e.inputSource,e.frame,u||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function T(){r.removeEventListener("select",S),r.removeEventListener("selectstart",S),r.removeEventListener("selectend",S),r.removeEventListener("squeeze",S),r.removeEventListener("squeezestart",S),r.removeEventListener("squeezeend",S),r.removeEventListener("end",T),r.removeEventListener("inputsourceschange",M);for(let e=0;e<D.length;e++){const t=y[e];null!==t&&(y[e]=null,D[e].disconnect(t))}F=null,w=null,f.reset(),e.setRenderTarget(g),d=null,h=null,c=null,r=null,v=null,L.stop(),n.isPresenting=!1,e.setPixelRatio(A),e.setSize(E.width,E.height,!1),n.dispatchEvent({type:"sessionend"})}function M(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=y.indexOf(n);r>=0&&(y[r]=null,D[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=y.indexOf(n);if(-1===r){for(let e=0;e<D.length;e++){if(e>=y.length){y.push(n),r=e;break}if(null===y[e]){y[e]=n,r=e;break}}if(-1===r)break}const i=D[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=D[e];return void 0===t&&(t=new Cc,D[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=D[e];return void 0===t&&(t=new Cc,D[e]=t),t.getGripSpace()},this.getHand=function(e){let t=D[e];return void 0===t&&(t=new Cc,D[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(e){u=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(l){if(r=l,null!==r){g=e.getRenderTarget(),r.addEventListener("select",S),r.addEventListener("selectstart",S),r.addEventListener("selectend",S),r.addEventListener("squeeze",S),r.addEventListener("squeezestart",S),r.addEventListener("squeezeend",S),r.addEventListener("end",T),r.addEventListener("inputsourceschange",M),!0!==m.xrCompatible&&await t.makeXRCompatible(),A=e.getPixelRatio(),e.getSize(E);if("undefined"!==typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,a=null,o=null;m.depth&&(o=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?ro:no,a=m.stencil?$a:qa);const s={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:i};c=new XRWebGLBinding(r,t),h=c.createProjectionLayer(s),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),v=new Zs(h.textureWidth,h.textureHeight,{format:to,type:Va,depthTexture:new Hc(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new Zs(d.framebufferWidth,d.framebufferHeight,{format:to,type:Va,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(s),u=null,a=await r.requestReferenceSpace(o),L.setContext(r),L.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const B=new ws,P=new ws;function N(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;let t=e.near,n=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(n=f.depthFar)),x.near=_.near=C.near=t,x.far=_.far=C.far=n,F===x.near&&w===x.far||(r.updateRenderState({depthNear:x.near,depthFar:x.far}),F=x.near,w=x.far),C.layers.mask=2|e.layers.mask,_.layers.mask=4|e.layers.mask,x.layers.mask=C.layers.mask|_.layers.mask;const i=e.parent,a=x.cameras;N(x,i);for(let r=0;r<a.length;r++)N(a[r],i);2===a.length?function(e,t,n){B.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const r=B.distanceTo(P),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,p=o*h,f=r/(-c+h),m=f*-c;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=o+f,n=s+f,i=d-m,a=p+(r-m),c=u*s/n*t,h=l*s/n*t;e.projectionMatrix.makePerspective(i,a,c,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(x,C,_):x.projectionMatrix.copy(C.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*vs*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,x,i)},this.getCamera=function(){return x},this.getFoveation=function(){if(null!==h||null!==d)return s},this.setFoveation=function(e){s=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(x)};let R=null;const L=new V_;L.setAnimationLoop(function(t,i){if(l=i.getViewerPose(u||a),p=i,null!==l){const t=l.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==x.cameras.length&&(x.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let a=null;if(null!==d)a=d.getViewport(i);else{const t=c.getViewSubImage(h,i);a=t.viewport,0===r&&(e.setRenderTargetTextures(v,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(v))}let o=b[r];void 0===o&&(o=new mc,o.layers.enable(r),o.viewport=new $s,b[r]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===r&&(x.matrix.copy(o.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),!0===n&&x.cameras.push(o)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&c){const n=c.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&f.init(e,n,r.renderState)}}for(let e=0;e<D.length;e++){const t=y[e],n=D[e];null!==t&&void 0!==n&&n.update(t,i,u||a)}R&&R(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null}),this.setAnimationLoop=function(e){R=e},this.dispose=function(){}}}const DF=new Uu,yF=new Tu;function EF(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const i=t.get(r),a=i.envMap,o=i.envMapRotation;a&&(e.envMap.value=a,DF.copy(o),DF.x*=-1,DF.y*=-1,DF.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(DF.y*=-1,DF.z*=-1),e.envMapRotation.value.setFromMatrix4(yF.makeRotationFromEuler(DF)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,uc(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,a,o,s){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,s)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,o):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function AF(e,t,n,r){let i={},a={},o=[];const s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function u(e,t,n,r){const i=e.value,a=t+"_"+n;if(void 0===r[a])return r[a]="number"===typeof i||"boolean"===typeof i?i:i.clone(),!0;{const e=r[a];if("number"===typeof i||"boolean"===typeof i){if(e!==i)return r[a]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function l(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){const n=t.target;n.removeEventListener("dispose",c);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let d=i[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const r=16;for(let a=0,o=t.length;a<o;a++){const e=Array.isArray(t[a])?t[a]:[t[a]];for(let t=0,i=e.length;t<i;t++){const i=e[t],a=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=a.length;e<t;e++){const t=l(a[e]),o=n%r,s=o%t.boundary,u=o+s;n+=s,0!==u&&r-u<t.storage&&(n+=r-u),i.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,n+=t.storage}}}const i=n%r;i>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",c));const p=h.program;r.updateUBOMapping(n,p);const f=t.render.frame;a[n.id]!==f&&(!function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let i=0,o=r.length;i<o;i++){const t=Array.isArray(r[i])?r[i]:[r[i]];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!0===u(r,i,n,a)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let a=0;a<n.length;a++){const o=n[a],s=l(o);"number"===typeof o||"boolean"===typeof o?(r.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+i,r.__data)):o.isMatrix3?(r.__data[0]=o.elements[0],r.__data[1]=o.elements[1],r.__data[2]=o.elements[2],r.__data[3]=0,r.__data[4]=o.elements[3],r.__data[5]=o.elements[4],r.__data[6]=o.elements[5],r.__data[7]=0,r.__data[8]=o.elements[6],r.__data[9]=o.elements[7],r.__data[10]=o.elements[8],r.__data[11]=0):(o.toArray(r.__data,i),i+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);o=[],i={},a={}}}}const CF=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class _F{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=!0===e.object.isSkinnedMesh,this.refreshUniforms=CF,this.renderId=0}firstInitialization(e){return!1===this.renderObjects.has(e)&&(this.getRenderObjectData(e),!0)}needsVelocity(e){const t=e.getMRT();return null!==t&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(void 0===t){const{geometry:n,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),null!==e.bundle&&(t.version=e.bundle.version),t.material.transmission>0){const{width:n,height:r}=e.context;t.bufferWidth=n,t.bufferHeight=r}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return null!==e.renderer.overrideNodes.modelViewMatrix||null!==e.renderer.overrideNodes.modelNormalViewMatrix}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];null!==r&&void 0!==r&&("object"===typeof r&&void 0!==r.clone?!0===r.isTexture?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e){const{object:t,material:n,geometry:r}=e,i=this.getRenderObjectData(e);if(!0!==i.worldMatrix.equals(t.matrixWorld))return i.worldMatrix.copy(t.matrixWorld),!1;const a=i.material;for(const f in a){const e=a[f],t=n[f];if(void 0!==e.equals){if(!1===e.equals(t))return e.copy(t),!1}else if(!0===t.isTexture){if(e.id!==t.id||e.version!==t.version)return e.id=t.id,e.version=t.version,!1}else if(e!==t)return a[f]=t,!1}if(a.transmission>0){const{width:t,height:n}=e.context;if(i.bufferWidth!==t||i.bufferHeight!==n)return i.bufferWidth=t,i.bufferHeight=n,!1}const o=i.geometry,s=r.attributes,u=o.attributes,l=Object.keys(u),c=Object.keys(s);if(o.id!==r.id)return o.id=r.id,!1;if(l.length!==c.length)return i.geometry.attributes=this.getAttributesData(s),!1;for(const f of l){const e=u[f],t=s[f];if(void 0===t)return delete u[f],!1;if(e.version!==t.version)return e.version=t.version,!1}const h=r.index,d=o.indexVersion,p=h?h.version:null;if(d!==p)return o.indexVersion=p,!1;if(o.drawRange.start!==r.drawRange.start||o.drawRange.count!==r.drawRange.count)return o.drawRange.start=r.drawRange.start,o.drawRange.count=r.drawRange.count,!1;if(i.morphTargetInfluences){let e=!1;for(let n=0;n<i.morphTargetInfluences.length;n++)i.morphTargetInfluences[n]!==t.morphTargetInfluences[n]&&(e=!0);if(e)return!0}return i.center&&!1===i.center.equals(t.center)?(i.center.copy(t.center),!0):(null!==e.bundle&&(i.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=!0===e.object.static,i=null!==e.bundle&&!0===e.bundle.static&&this.getRenderObjectData(e).version===e.bundle.version;if(r||i)return!1;return!0!==this.equals(e)}}function bF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=3735928559^t,r=1103547991^t;if(e instanceof Array)for(let i,a=0;a<e.length;a++)i=e[a],n=Math.imul(n^i,2654435761),r=Math.imul(r^i,1597334677);else for(let i,a=0;a<e.length;a++)i=e.charCodeAt(a),n=Math.imul(n^i,2654435761),r=Math.imul(r^i,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&r)+(n>>>0)}const xF=e=>bF(e),FF=e=>bF(e),wF=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return bF(t)};function SF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=[];!0===e.isNode&&(n.push(e.id),e=e.getSelf());for(const{property:r,childNode:i}of TF(e))n.push(bF(r.slice(0,-4)),i.getCacheKey(t));return bF(n)}function TF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){for(const n in e){if(!0===n.startsWith("_"))continue;const r=e[n];if(!0===Array.isArray(r))for(let e=0;e<r.length;e++){const i=r[e];i&&(!0===i.isNode||t&&"function"===typeof i.toJSON)&&(yield{property:n,index:e,childNode:i})}else if(r&&!0===r.isNode)yield{property:n,childNode:r};else if("object"===typeof r)for(const e in r){const i=r[e];i&&(!0===i.isNode||t&&"function"===typeof i.toJSON)&&(yield{property:n,index:e,childNode:i})}}}()}const MF=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),BF=new WeakMap;function PF(e){return MF.get(e)}function NF(e){if(void 0===e||null===e)return null;const t=typeof e;return!0===e.isNode?"node":"number"===t?"float":"boolean"===t?"bool":"string"===t?"string":"function"===t?"shader":!0===e.isVector2?"vec2":!0===e.isVector3?"vec3":!0===e.isVector4?"vec4":!0===e.isMatrix2?"mat2":!0===e.isMatrix3?"mat3":!0===e.isMatrix4?"mat4":!0===e.isColor?"color":e instanceof ArrayBuffer?"ArrayBuffer":null}function RF(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=e?e.slice(-4):void 0;return 1===n.length&&("vec2"===i?n=[n[0],n[0]]:"vec3"===i?n=[n[0],n[0],n[0]]:"vec4"===i&&(n=[n[0],n[0],n[0],n[0]])),"color"===e?new Al(...n):"vec2"===i?new xs(...n):"vec3"===i?new ws(...n):"vec4"===i?new $s(...n):"mat2"===i?new ad(...n):"mat3"===i?new Ms(...n):"mat4"===i?new Tu(...n):"bool"===e?n[0]||!1:"float"===e||"int"===e||"uint"===e?n[0]||0:"string"===e?n[0]||"":"ArrayBuffer"===e?kF(n[0]):null}function LF(e){let t=BF.get(e);return void 0===t&&(t={},BF.set(e,t)),t}function IF(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return btoa(t)}function kF(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}const OF={VERTEX:"vertex",FRAGMENT:"fragment"},UF={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},zF={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},VF=["fragment","vertex"],GF=["setup","analyze","generate"],HF=[...VF,"compute"],jF=["x","y","z","w"],WF={analyze:"setup",generate:"analyze"};let qF=0;class XF extends ps{static get type(){return"Node"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.nodeType=e,this.updateType=UF.NONE,this.updateBeforeType=UF.NONE,this.updateAfterType=UF.NONE,this.uuid=bs.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:qF++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,UF.FRAME)}onRenderUpdate(e){return this.onUpdate(e,UF.RENDER)}onObjectUpdate(e){return this.onUpdate(e,UF.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of TF(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e=e||this.version!==this._cacheKeyVersion,!0!==e&&null!==this._cacheKey||(this._cacheKey=wF(SF(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=e.increaseUsage(this);if(!0===this.parents){const n=e.getDataFromNode(this,"any");n.stages=n.stages||{},n.stages[e.shaderStage]=n.stages[e.shaderStage]||[],n.stages[e.shaderStage].push(t)}if(1===n){const t=e.getNodeProperties(this);for(const n of Object.values(t))n&&!0===n.isNode&&n.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&!0===n.isNode)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getShared(e);if(this!==n)return n.build(e,t);const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const i=WF[e.buildStage];if(i&&!0!==r.buildStages[i]){const t=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(t)}e.addNode(this),e.addChain(this);let a=null;const o=e.getBuildStage();if("setup"===o){this.updateReference(e);const t=e.getNodeProperties(this);if(!0!==t.initialized){t.initialized=!0,t.outputNode=this.setup(e)||t.outputNode||null;for(const n of Object.values(t))if(n&&!0===n.isNode){if(!0===n.parents){const t=e.getNodeProperties(n);t.parents=t.parents||[],t.parents.push(this)}n.build(e)}}a=t.outputNode}else if("analyze"===o)this.analyze(e,t);else if("generate"===o){if(1===this.generate.length){const n=this.getNodeType(e),r=e.getDataFromNode(this);a=r.snippet,void 0===a?void 0===r.generated?(r.generated=!0,a=this.generate(e)||"",r.snippet=a):(console.warn("THREE.Node: Recursion detected.",this),a=""):void 0!==r.flowCodes&&void 0!==e.context.nodeBlock&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,n,t)}else a=this.generate(e,t)||""}return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return TF(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:a}of t)void 0!==i?(void 0===n[r]&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=a.toJSON(e.meta).uuid):n[r]=a.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(void 0!==e.inputNodes){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const i of e.inputNodes[n])r.push(t[i]);this[n]=r}else if("object"===typeof e.inputNodes[n]){const r={};for(const i in e.inputNodes[n]){const a=e.inputNodes[n][i];r[i]=t[a]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=void 0===e||"string"===typeof e;r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(void 0===i&&(i={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},!0!==r&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){const t=a(e.textures),n=a(e.images),r=a(e.nodes);t.length>0&&(i.textures=t),n.length>0&&(i.images=n),r.length>0&&(i.nodes=r)}return i}}class KF extends XF{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return"".concat(n,"[ ").concat(r," ]")}}class YF extends XF{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))null!==n&&e.getTypeLength(t)!==e.getTypeLength(r)||(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),i=n.build(e,r);return e.format(i,r,t)}}class JF extends XF{static get type(){return"TempNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if("generate"===e.getBuildStage()){const n=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(void 0!==r.propertyName)return e.format(r.propertyName,n,t);if("void"!==n&&"void"!==t&&this.hasDependencies(e)){const i=super.build(e,n),a=e.getVarFromNode(this,null,n),o=e.getPropertyName(a);return e.addLineFlowCode("".concat(o," = ").concat(i),this),r.snippet=i,r.propertyName=o,e.format(r.propertyName,n,t)}}return super.build(e,t)}}class $F extends JF{static get type(){return"JoinNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),i=this.nodes,a=e.getComponentType(n),o=[];let s=0;for(const l of i){if(s>=r){console.error("THREE.TSL: Length of parameters exceeds maximum length of function '".concat(n,"()' type."));break}let t,i=l.getNodeType(e),u=e.getTypeLength(i);s+u>r&&(console.error("THREE.TSL: Length of '".concat(n,"()' data exceeds maximum length of output type.")),u=r-s,i=e.getTypeFromLength(u)),s+=u,t=l.build(e,i);const c=e.getComponentType(i);c!==a&&(t=e.format(t,c,a)),o.push(t)}const u="".concat(e.getType(n),"( ").concat(o.join(", ")," )");return e.format(u,n,t)}}const QF=jF.join("");class ZF extends XF{static get type(){return"SplitNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(jF.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let i=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const o=n.build(e,a);i=this.components.length===r&&this.components===QF.slice(0,this.components.length)?e.format(o,a,t):e.format("".concat(o,".").concat(this.components),this.getNodeType(e),t)}else i=n.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class ew extends JF{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,i=this.getNodeType(e),a=e.getComponentType(r.getNodeType(e)),o=e.getTypeFromLength(n.length,a),s=r.build(e,o),u=t.build(e,i),l=e.getTypeLength(i),c=[];for(let h=0;h<l;h++){const e=jF[h];e===n[0]?(c.push(s),h+=n.length-1):c.push(u+"."+e)}return"".concat(e.getType(i),"( ").concat(c.join(", ")," )")}}class tw extends JF{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),i=n.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+i,this);const s=e.getTypeLength(r),u=[];let l=0;for(let c=0;c<s;c++){const e=jF[c];e===t[l]?(u.push("1.0 - "+o+"."+e),l++):u.push(o+"."+e)}return"".concat(e.getType(r),"( ").concat(u.join(", ")," )")}}class nw extends XF{static get type(){return"InputNode"}constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?NF(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=NF(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=IF(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?RF(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const rw=/float|u?int/;class iw extends nw{static get type(){return"ConstNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return rw.test(n)&&rw.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class aw extends XF{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let ow=null;const sw=new Map;function uw(e,t){if(sw.has(e))console.warn("THREE.TSL: Redefinition of method chaining '".concat(e,"'."));else{if("function"!==typeof t)throw new Error("THREE.TSL: Node element ".concat(e," is not a function"));sw.set(e,t)}}const lw=e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),cw=e=>lw(e).split("").sort().join(""),hw={setup(e,t){const n=t.shift();return e(Iw(n),...t)},get(e,t,n){if("string"===typeof t&&void 0===e[t]){if(!0!==e.isStackNode&&"assign"===t)return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ow.assign(n,...t),n};if(sw.has(t)){const r=sw.get(t);return e.isStackNode?function(){return n.add(r(...arguments))}:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r(n,...t)}}if("self"===t)return e;if(t.endsWith("Assign")&&sw.has(t.slice(0,t.length-6))){const r=sw.get(t.slice(0,t.length-6));return e.isStackNode?function(){return n.assign(arguments.length<=0?void 0:arguments[0],r(...arguments))}:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.assign(r(n,...t))}}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return t=lw(t),Lw(new ZF(n,t));if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(t))return t=cw(t.slice(3).toLowerCase()),n=>Lw(new ew(e,t,Lw(n)));if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(t))return t=cw(t.slice(4).toLowerCase()),()=>Lw(new tw(Lw(e),t));if("width"===t||"height"===t||"depth"===t)return"width"===t?t="x":"height"===t?t="y":"depth"===t&&(t="z"),Lw(new ZF(e,t));if(!0===/^\d+$/.test(t))return Lw(new KF(n,new iw(Number(t),"uint")));if(!0===/^get$/.test(t))return e=>Lw(new aw(n,e))}return Reflect.get(e,t,n)},set:(e,t,n,r)=>"string"!==typeof t||void 0!==e[t]||!0!==/^[xyzwrgbastpq]{1,4}$/.test(t)&&"width"!==t&&"height"!==t&&"depth"!==t&&!0!==/^\d+$/.test(t)?Reflect.set(e,t,n,r):(r[t].assign(n),!0)},dw=new WeakMap,pw=new WeakMap,fw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(const n in e)e[n]=Lw(e[n],t);return e},mw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=e.length;for(let r=0;r<n;r++)e[r]=Lw(e[r],t);return e},gw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=e=>Lw(null!==r?Object.assign(e,r):e);let a,o,s,u=t;function l(t){let n;return n=u?/[a-z]/i.test(u)?u+"()":u:e.type,void 0!==o&&t.length<o?(console.error('THREE.TSL: "'.concat(n,'" parameter length is less than minimum required.')),t.concat(new Array(o-t.length).fill(0))):void 0!==s&&t.length>s?(console.error('THREE.TSL: "'.concat(n,'" parameter length exceeds limit.')),t.slice(0,s)):t}return null===t?a=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i(new e(...kw(l(n))))}:null!==n?(n=Lw(n),a=function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return i(new e(t,...kw(l(a)),n))}):a=function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return i(new e(t,...kw(l(r))))},a.setParameterLength=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 1===t.length?o=s=t[0]:2===t.length&&([o,s]=t),a},a.setName=e=>(u=e,a),a},vw=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Lw(new e(...kw(n)))};class Dw extends XF{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,r=e.getNodeProperties(t),i=t.namespace&&t.namespace===e.namespace?e.getNamespace("once"):"once";if(r[i])return r[i];let a=null;if(t.layout){let r=pw.get(e.constructor);void 0===r&&(r=new WeakMap,pw.set(e.constructor,r));let i=r.get(t);void 0===i&&(i=Lw(e.buildFunctionNode(t)),r.set(t,i)),e.addInclude(i),a=Lw(i.call(n))}else{const r=t.jsFunc,i=null!==n||r.length>1?r(n||[],e):r(e);a=Lw(i)}return t.once&&(r[i]=a),a}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getOutputNamespace();return t[n]=t[n]||this.setupOutput(e),t[n]}build(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null;const r=e.getBuildStage(),i=e.getNodeProperties(this),a=e.getOutputNamespace(),o=this.getOutputNode(e);if("setup"===r){const t=e.getNamespace("initialized");!0!==i[t]&&(i[t]=!0,i[a]=this.getOutputNode(e),i[a].build(e)),n=i[a]}else"analyze"===r?o.build(e,t):"generate"===r&&(n=o.build(e,t)||"");return n}}class yw extends XF{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1,this.namespace=null}setLayout(e){return this.layout=e,this}call(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Iw(e),Lw(new Dw(this,e))}setup(){return this.call()}}const Ew=[!1,!0],Aw=[0,1,2,3],Cw=[-1,-2],_w=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],bw=new Map;for(const n of Ew)bw.set(n,new iw(n));const xw=new Map;for(const n of Aw)xw.set(n,new iw(n,"uint"));const Fw=new Map([...xw].map(e=>new iw(e.value,"int")));for(const n of Cw)Fw.set(n,new iw(n,"int"));const ww=new Map([...Fw].map(e=>new iw(e.value)));for(const n of _w)ww.set(n,new iw(n));for(const n of _w)ww.set(-n,new iw(-n));const Sw={bool:bw,uint:xw,ints:Fw,float:ww},Tw=new Map([...bw,...ww]),Mw=(e,t)=>Tw.has(e)?Tw.get(e):!0===e.isNode?e:new iw(e,t),Bw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if((0===r.length||!["bool","float","int","uint"].includes(e)&&r.every(e=>"object"!==typeof e))&&(r=[RF(e,...r)]),1===r.length&&null!==t&&t.has(r[0]))return Lw(t.get(r[0]));if(1===r.length){const t=Mw(r[0],e);return(e=>{try{return e.getNodeType()}catch(t){return}})(t)===e?Lw(t):Lw(new YF(t,e))}const a=r.map(e=>Mw(e));return Lw(new $F(a,e))}},Pw=e=>"object"===typeof e&&null!==e?e.value:e,Nw=e=>void 0!==e&&null!==e?e.nodeType||e.convertTo||("string"===typeof e?e:null):null;function Rw(e,t){return new Proxy(new yw(e,t),hw)}const Lw=function(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=NF(e);if("node"===n){let t=dw.get(e);return void 0===t&&(t=new Proxy(e,hw),dw.set(e,t),dw.set(t,t)),t}return null===t&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?Lw(Mw(e,t)):"shader"===n?Vw(e):e}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},Iw=function(e){return new fw(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},kw=function(e){return new mw(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},Ow=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new gw(...t)},Uw=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new vw(...t)};let zw=0;const Vw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null;null!==t&&("object"===typeof t?n=t.return:("string"===typeof t?n=t:console.error("THREE.TSL: Invalid layout type."),t=null));const r=new Rw(e,n),i=function(){let e;for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];Iw(i);e=i[0]&&(i[0].isNode||Object.getPrototypeOf(i[0])!==Object.prototype)?[...i]:i[0];const o=r.call(e);return"void"===n&&o.toStack(),o};if(i.shaderNode=r,i.id=r.id,i.getNodeType=function(){return r.getNodeType(...arguments)},i.getCacheKey=function(){return r.getCacheKey(...arguments)},i.setLayout=e=>(r.setLayout(e),i),i.once=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return r.once=!0,r.namespace=e,i},null!==t){if("object"!==typeof t.inputs){const e={name:"fn"+zw++,type:n,inputs:[]};for(const n in t)"return"!==n&&e.inputs.push({name:n,type:t[n]});t=e}i.setLayout(t)}return i},Gw=e=>{ow=e},Hw=()=>ow,jw=function(){return ow.If(...arguments)};function Ww(e){return ow&&ow.add(e),e}uw("toStack",Ww);const qw=new Bw("color"),Xw=new Bw("float",Sw.float),Kw=new Bw("int",Sw.ints),Yw=new Bw("uint",Sw.uint),Jw=new Bw("bool",Sw.bool),$w=new Bw("vec2"),Qw=new Bw("ivec2"),Zw=new Bw("uvec2"),eS=new Bw("bvec2"),tS=new Bw("vec3"),nS=new Bw("ivec3"),rS=new Bw("uvec3"),iS=new Bw("bvec3"),aS=new Bw("vec4"),oS=new Bw("ivec4"),sS=new Bw("uvec4"),uS=new Bw("bvec4"),lS=new Bw("mat2"),cS=new Bw("mat3"),hS=new Bw("mat4");uw("toColor",qw),uw("toFloat",Xw),uw("toInt",Kw),uw("toUint",Yw),uw("toBool",Jw),uw("toVec2",$w),uw("toIVec2",Qw),uw("toUVec2",Zw),uw("toBVec2",eS),uw("toVec3",tS),uw("toIVec3",nS),uw("toUVec3",rS),uw("toBVec3",iS),uw("toVec4",aS),uw("toIVec4",oS),uw("toUVec4",sS),uw("toBVec4",uS),uw("toMat2",lS),uw("toMat3",cS),uw("toMat4",hS);const dS=Ow(KF).setParameterLength(2),pS=(e,t)=>Lw(new YF(Lw(e),t));uw("element",dS),uw("convert",pS);uw("append",e=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),Ww(e)));class fS extends XF{static get type(){return"PropertyNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return!0===this.varying?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const mS=(e,t)=>Lw(new fS(e,t)),gS=(e,t)=>Lw(new fS(e,t,!0)),vS=Uw(fS,"vec4","DiffuseColor"),DS=Uw(fS,"vec3","EmissiveColor"),yS=Uw(fS,"float","Roughness"),ES=Uw(fS,"float","Metalness"),AS=Uw(fS,"float","Clearcoat"),CS=Uw(fS,"float","ClearcoatRoughness"),_S=Uw(fS,"vec3","Sheen"),bS=Uw(fS,"float","SheenRoughness"),xS=Uw(fS,"float","Iridescence"),FS=Uw(fS,"float","IridescenceIOR"),wS=Uw(fS,"float","IridescenceThickness"),SS=Uw(fS,"float","AlphaT"),TS=Uw(fS,"float","Anisotropy"),MS=Uw(fS,"vec3","AnisotropyT"),BS=Uw(fS,"vec3","AnisotropyB"),PS=Uw(fS,"color","SpecularColor"),NS=Uw(fS,"float","SpecularF90"),RS=Uw(fS,"float","Shininess"),LS=Uw(fS,"vec4","Output"),IS=Uw(fS,"float","dashSize"),kS=Uw(fS,"float","gapSize"),OS=Uw(fS,"float","IOR"),US=Uw(fS,"float","Transmission"),zS=Uw(fS,"float","Thickness"),VS=Uw(fS,"float","AttenuationDistance"),GS=Uw(fS,"color","AttenuationColor"),HS=Uw(fS,"float","Dispersion");class jS extends XF{static get type(){return"UniformGroupNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const WS=e=>new jS(e),qS=function(e){return new jS(e,!0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)},XS=qS("frame"),KS=qS("render"),YS=WS("object");class JS extends nw{static get type(){return"UniformNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isUniformNode=!0,this.name="",this.groupNode=YS}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(t=>{const r=e(t,n);void 0!==r&&(this.value=r)},t)}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let i=e.getNodeFromHash(r);void 0===i&&(e.setHashNode(this,r),i=this);const a=i.getInputType(e),o=e.getUniformFromNode(i,a,e.shaderStage,this.name||e.context.label),s=e.getPropertyName(o);return void 0!==e.context.label&&delete e.context.label,e.format(s,n,t)}}const $S=(e,t)=>{const n=Nw(t||e),r=e&&!0===e.isNode?e.node&&e.node.value||e.value:e;return Lw(new JS(r,n))};class QS extends JF{static get type(){return"ArrayNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const ZS=function(){let e;if(1===arguments.length){const t=arguments.length<=0?void 0:arguments[0];e=new QS(null,t.length,t)}else{e=new QS(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}return Lw(e)};uw("toArray",(e,t)=>ZS(Array(t).fill(e)));class eT extends JF{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return"void"!==t?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(!1===e.isAvailable("swizzleAssign")&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return jF.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=e.getNodeProperties(this);r.sourceNode=n,r.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),i=this.needsSplitAssign(e),a=n.getNodeType(e),o=n.build(e),s=r.build(e,a),u=r.getNodeType(e),l=e.getDataFromNode(this);let c;if(!0===l.initialized)"void"!==t&&(c=o);else if(i){const r=e.getVarFromNode(this,null,a),i=e.getPropertyName(r);e.addLineFlowCode("".concat(i," = ").concat(s),this);const u=n.node,l=u.node.context({assign:!0}).build(e);for(let t=0;t<u.components.length;t++){const n=u.components[t];e.addLineFlowCode("".concat(l,".").concat(n," = ").concat(i,"[ ").concat(t," ]"),this)}"void"!==t&&(c=o)}else c="".concat(o," = ").concat(s),"void"!==t&&"void"!==u||(e.addLineFlowCode(c,this),"void"!==t&&(c=o));return l.initialized=!0,e.format(c,a,t)}}const tT=Ow(eT).setParameterLength(2);uw("assign",tT);class nT extends JF{static get type(){return"FunctionCallNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),i=this.parameters,a=(t,n)=>{const r=n.type;let i;return i="pointer"===r?"&"+t.build(e):t.build(e,r),i};if(Array.isArray(i)){if(i.length>r.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=r.length;else if(i.length<r.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<r.length;)i.push(Xw(0));for(let e=0;e<i.length;e++)t.push(a(i[e],r[e]))}else for(const s of r){const e=i[s.name];void 0!==e?t.push(a(e,s)):(console.error("THREE.TSL: Input '".concat(s.name,"' not found in 'Fn()'.")),t.push(a(Xw(0),s)))}const o=n.build(e,"property");return"".concat(o,"( ").concat(t.join(", ")," )")}}const rT=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n=n.length>1||n[0]&&!0===n[0].isNode?kw(n):Iw(n[0]),Lw(new nT(Lw(e),n))};uw("call",rT);const iT={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class aT extends JF{static get type(){return"OperatorNode"}constructor(e,t,n){if(super(),(arguments.length<=3?0:arguments.length-3)>0){var r;let i=new aT(e,t,n);for(let t=0;t<(arguments.length<=3?0:arguments.length-3)-1;t++)i=new aT(e,i,t+3<3||arguments.length<=t+3?void 0:arguments[t+3]);t=i,n=(r=(arguments.length<=3?0:arguments.length-3)-1+3)<3||arguments.length<=r?void 0:arguments[r]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(iT[this.op],t)}getNodeType(e){const t=this.op,n=this.aNode,r=this.bNode,i=n.getNodeType(e),a=r?r.getNodeType(e):null;if("void"===i||"void"===a)return"void";if("%"===t)return i;if("~"===t||"&"===t||"|"===t||"^"===t||">>"===t||"<<"===t)return e.getIntegerType(i);if("!"===t||"&&"===t||"||"===t||"^^"===t)return"bool";if("=="===t||"!="===t||"<"===t||">"===t||"<="===t||">="===t){const t=Math.max(e.getTypeLength(i),e.getTypeLength(a));return t>1?"bvec".concat(t):"bool"}if(e.isMatrix(i)){if("float"===a)return i;if(e.isVector(a))return e.getVectorFromMatrix(i);if(e.isMatrix(a))return i}else if(e.isMatrix(a)){if("float"===i)return a;if(e.isVector(i))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(i)?a:i}generate(e,t){const n=this.op,{aNode:r,bNode:i}=this,a=this.getNodeType(e);let o=null,s=null;"void"!==a?(o=r.getNodeType(e),s=i?i.getNodeType(e):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n||"!="===n?e.isVector(o)?s=o:e.isVector(s)?o=s:o!==s&&(o=s="float"):">>"===n||"<<"===n?(o=a,s=e.changeComponentType(s,"uint")):"%"===n?(o=a,s=e.isInteger(o)&&e.isInteger(s)?s:o):e.isMatrix(o)?"float"===s?s="float":e.isVector(s)?s=e.getVectorFromMatrix(o):e.isMatrix(s)||(o=s=a):o=e.isMatrix(s)?"float"===o?"float":e.isVector(o)?e.getVectorFromMatrix(s):s=a:s=a):o=s=a;const u=r.build(e,o),l=i?i.build(e,s):null,c=e.getFunctionOperator(n);if("void"!==t){const r=e.renderer.coordinateSystem===hs;if("=="===n||"!="===n||"<"===n||">"===n||"<="===n||">="===n)return r&&e.isVector(o)?e.format("".concat(this.getOperatorMethod(e,t),"( ").concat(u,", ").concat(l," )"),a,t):e.format("( ".concat(u," ").concat(n," ").concat(l," )"),a,t);if("%"===n)return e.isInteger(s)?e.format("( ".concat(u," % ").concat(l," )"),a,t):e.format("".concat(this.getOperatorMethod(e,a),"( ").concat(u,", ").concat(l," )"),a,t);if("!"===n||"~"===n)return e.format("(".concat(n).concat(u,")"),o,t);if(c)return e.format("".concat(c,"( ").concat(u,", ").concat(l," )"),a,t);if(e.isMatrix(o)&&"float"===s)return e.format("( ".concat(l," ").concat(n," ").concat(u," )"),a,t);if("float"===o&&e.isMatrix(s))return e.format("".concat(u," ").concat(n," ").concat(l),a,t);{let i="( ".concat(u," ").concat(n," ").concat(l," )");return!r&&"bool"===a&&e.isVector(o)&&e.isVector(s)&&(i="all".concat(i)),e.format(i,a,t)}}if("void"!==o)return c?e.format("".concat(c,"( ").concat(u,", ").concat(l," )"),a,t):e.isMatrix(o)&&"float"===s?e.format("".concat(l," ").concat(n," ").concat(u),a,t):e.format("".concat(u," ").concat(n," ").concat(l),a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const oT=Ow(aT,"+").setParameterLength(2,1/0).setName("add"),sT=Ow(aT,"-").setParameterLength(2,1/0).setName("sub"),uT=Ow(aT,"*").setParameterLength(2,1/0).setName("mul"),lT=Ow(aT,"/").setParameterLength(2,1/0).setName("div"),cT=Ow(aT,"%").setParameterLength(2).setName("mod"),hT=Ow(aT,"==").setParameterLength(2).setName("equal"),dT=Ow(aT,"!=").setParameterLength(2).setName("notEqual"),pT=Ow(aT,"<").setParameterLength(2).setName("lessThan"),fT=Ow(aT,">").setParameterLength(2).setName("greaterThan"),mT=Ow(aT,"<=").setParameterLength(2).setName("lessThanEqual"),gT=Ow(aT,">=").setParameterLength(2).setName("greaterThanEqual"),vT=Ow(aT,"&&").setParameterLength(2,1/0).setName("and"),DT=Ow(aT,"||").setParameterLength(2,1/0).setName("or"),yT=Ow(aT,"!").setParameterLength(1).setName("not"),ET=Ow(aT,"^^").setParameterLength(2).setName("xor"),AT=Ow(aT,"&").setParameterLength(2).setName("bitAnd"),CT=Ow(aT,"~").setParameterLength(2).setName("bitNot"),_T=Ow(aT,"|").setParameterLength(2).setName("bitOr"),bT=Ow(aT,"^").setParameterLength(2).setName("bitXor"),xT=Ow(aT,"<<").setParameterLength(2).setName("shiftLeft"),FT=Ow(aT,">>").setParameterLength(2).setName("shiftRight"),wT=Vw(e=>{let[t]=e;return t.addAssign(1),t}),ST=Vw(e=>{let[t]=e;return t.subAssign(1),t}),TT=Vw(e=>{let[t]=e;const n=Kw(t).toConst();return t.addAssign(1),n}),MT=Vw(e=>{let[t]=e;const n=Kw(t).toConst();return t.subAssign(1),n});uw("add",oT),uw("sub",sT),uw("mul",uT),uw("div",lT),uw("mod",cT),uw("equal",hT),uw("notEqual",dT),uw("lessThan",pT),uw("greaterThan",fT),uw("lessThanEqual",mT),uw("greaterThanEqual",gT),uw("and",vT),uw("or",DT),uw("not",yT),uw("xor",ET),uw("bitAnd",AT),uw("bitNot",CT),uw("bitOr",_T),uw("bitXor",bT),uw("shiftLeft",xT),uw("shiftRight",FT),uw("incrementBefore",wT),uw("decrementBefore",ST),uw("increment",TT),uw("decrement",MT);const BT=(e,t)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),cT(e,t)),PT=(e,t)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),cT(Kw(e),Kw(t)));uw("remainder",BT),uw("modInt",PT);class NT extends JF{static get type(){return"MathNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(super(),(e===NT.MAX||e===NT.MIN)&&arguments.length>3){let i=new NT(e,t,n);for(let t=2;t<arguments.length-1;t++)i=new NT(e,i,arguments[t]);t=i,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(n)?0:e.getTypeLength(n),o=e.isMatrix(r)?0:e.getTypeLength(r);return i>a&&i>o?t:a>o?n:o>i?r:t}getNodeType(e){const t=this.method;return t===NT.LENGTH||t===NT.DISTANCE||t===NT.DOT?"float":t===NT.CROSS?"vec3":t===NT.ALL||t===NT.ANY?"bool":t===NT.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let i=null;if(r===NT.ONE_MINUS)i=sT(1,t);else if(r===NT.RECIPROCAL)i=lT(1,t);else if(r===NT.DIFFERENCE)i=nM(sT(t,n));else if(r===NT.TRANSFORM_DIRECTION){let r=t,a=n;e.isMatrix(r.getNodeType(e))?a=aS(tS(a),0):r=aS(tS(r),0);const o=uT(r,a).xyz;i=KT(o)}return null!==i?i:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let n=this.method;const r=this.getNodeType(e),i=this.getInputType(e),a=this.aNode,o=this.bNode,s=this.cNode,u=e.renderer.coordinateSystem;if(n===NT.NEGATE)return e.format("( - "+a.build(e,i)+" )",r,t);{const l=[];return n===NT.CROSS?l.push(a.build(e,r),o.build(e,r)):u===hs&&n===NT.STEP?l.push(a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":i),o.build(e,i)):u!==hs||n!==NT.MIN&&n!==NT.MAX?n===NT.REFRACT?l.push(a.build(e,i),o.build(e,i),s.build(e,"float")):n===NT.MIX?l.push(a.build(e,i),o.build(e,i),s.build(e,1===e.getTypeLength(s.getNodeType(e))?"float":i)):(u===ds&&n===NT.ATAN&&null!==o&&(n="atan2"),"fragment"===e.shaderStage||n!==NT.DFDX&&n!==NT.DFDY||(console.warn("THREE.TSL: '".concat(n,"' is not supported in the ").concat(e.shaderStage," stage.")),n="/*"+n+"*/"),l.push(a.build(e,i)),null!==o&&l.push(o.build(e,i)),null!==s&&l.push(s.build(e,i))):l.push(a.build(e,i),o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":i)),e.format("".concat(e.getMethod(n,r),"( ").concat(l.join(", ")," )"),r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}NT.ALL="all",NT.ANY="any",NT.RADIANS="radians",NT.DEGREES="degrees",NT.EXP="exp",NT.EXP2="exp2",NT.LOG="log",NT.LOG2="log2",NT.SQRT="sqrt",NT.INVERSE_SQRT="inversesqrt",NT.FLOOR="floor",NT.CEIL="ceil",NT.NORMALIZE="normalize",NT.FRACT="fract",NT.SIN="sin",NT.COS="cos",NT.TAN="tan",NT.ASIN="asin",NT.ACOS="acos",NT.ATAN="atan",NT.ABS="abs",NT.SIGN="sign",NT.LENGTH="length",NT.NEGATE="negate",NT.ONE_MINUS="oneMinus",NT.DFDX="dFdx",NT.DFDY="dFdy",NT.ROUND="round",NT.RECIPROCAL="reciprocal",NT.TRUNC="trunc",NT.FWIDTH="fwidth",NT.TRANSPOSE="transpose",NT.BITCAST="bitcast",NT.EQUALS="equals",NT.MIN="min",NT.MAX="max",NT.STEP="step",NT.REFLECT="reflect",NT.DISTANCE="distance",NT.DIFFERENCE="difference",NT.DOT="dot",NT.CROSS="cross",NT.POW="pow",NT.TRANSFORM_DIRECTION="transformDirection",NT.MIX="mix",NT.CLAMP="clamp",NT.REFRACT="refract",NT.SMOOTHSTEP="smoothstep",NT.FACEFORWARD="faceforward";const RT=Xw(1e-6),LT=Xw(Math.PI),IT=(Math.PI,Ow(NT,NT.ALL).setParameterLength(1)),kT=Ow(NT,NT.ANY).setParameterLength(1),OT=Ow(NT,NT.RADIANS).setParameterLength(1),UT=Ow(NT,NT.DEGREES).setParameterLength(1),zT=Ow(NT,NT.EXP).setParameterLength(1),VT=Ow(NT,NT.EXP2).setParameterLength(1),GT=Ow(NT,NT.LOG).setParameterLength(1),HT=Ow(NT,NT.LOG2).setParameterLength(1),jT=Ow(NT,NT.SQRT).setParameterLength(1),WT=Ow(NT,NT.INVERSE_SQRT).setParameterLength(1),qT=Ow(NT,NT.FLOOR).setParameterLength(1),XT=Ow(NT,NT.CEIL).setParameterLength(1),KT=Ow(NT,NT.NORMALIZE).setParameterLength(1),YT=Ow(NT,NT.FRACT).setParameterLength(1),JT=Ow(NT,NT.SIN).setParameterLength(1),$T=Ow(NT,NT.COS).setParameterLength(1),QT=Ow(NT,NT.TAN).setParameterLength(1),ZT=Ow(NT,NT.ASIN).setParameterLength(1),eM=Ow(NT,NT.ACOS).setParameterLength(1),tM=Ow(NT,NT.ATAN).setParameterLength(1,2),nM=Ow(NT,NT.ABS).setParameterLength(1),rM=Ow(NT,NT.SIGN).setParameterLength(1),iM=Ow(NT,NT.LENGTH).setParameterLength(1),aM=Ow(NT,NT.NEGATE).setParameterLength(1),oM=Ow(NT,NT.ONE_MINUS).setParameterLength(1),sM=Ow(NT,NT.DFDX).setParameterLength(1),uM=Ow(NT,NT.DFDY).setParameterLength(1),lM=Ow(NT,NT.ROUND).setParameterLength(1),cM=Ow(NT,NT.RECIPROCAL).setParameterLength(1),hM=Ow(NT,NT.TRUNC).setParameterLength(1),dM=Ow(NT,NT.FWIDTH).setParameterLength(1),pM=Ow(NT,NT.TRANSPOSE).setParameterLength(1),fM=(e,t)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),hT(e,t)),mM=Ow(NT,NT.MIN).setParameterLength(2,1/0),gM=Ow(NT,NT.MAX).setParameterLength(2,1/0),vM=Ow(NT,NT.STEP).setParameterLength(2),DM=Ow(NT,NT.REFLECT).setParameterLength(2),yM=Ow(NT,NT.DISTANCE).setParameterLength(2),EM=Ow(NT,NT.DIFFERENCE).setParameterLength(2),AM=Ow(NT,NT.DOT).setParameterLength(2),CM=Ow(NT,NT.CROSS).setParameterLength(2),_M=Ow(NT,NT.POW).setParameterLength(2),bM=Ow(NT,NT.POW,2).setParameterLength(1),xM=Ow(NT,NT.POW,3).setParameterLength(1),FM=Ow(NT,NT.POW,4).setParameterLength(1),wM=Ow(NT,NT.TRANSFORM_DIRECTION).setParameterLength(2),SM=e=>uT(rM(e),_M(nM(e),1/3)),TM=e=>AM(e,e),MM=Ow(NT,NT.MIX).setParameterLength(3),BM=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Lw(new NT(NT.CLAMP,Lw(e),Lw(t),Lw(n)))},PM=e=>BM(e),NM=Ow(NT,NT.REFRACT).setParameterLength(3),RM=Ow(NT,NT.SMOOTHSTEP).setParameterLength(3),LM=Ow(NT,NT.FACEFORWARD).setParameterLength(3),IM=Vw(e=>{let[t]=e;const n=AM(t.xy,$w(12.9898,78.233)),r=cT(n,LT);return YT(JT(r).mul(43758.5453))}),kM=(e,t,n)=>MM(t,n,e),OM=(e,t,n)=>RM(t,n,e),UM=(e,t)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),tM(e,t));uw("all",IT),uw("any",kT),uw("equals",fM),uw("radians",OT),uw("degrees",UT),uw("exp",zT),uw("exp2",VT),uw("log",GT),uw("log2",HT),uw("sqrt",jT),uw("inverseSqrt",WT),uw("floor",qT),uw("ceil",XT),uw("normalize",KT),uw("fract",YT),uw("sin",JT),uw("cos",$T),uw("tan",QT),uw("asin",ZT),uw("acos",eM),uw("atan",tM),uw("abs",nM),uw("sign",rM),uw("length",iM),uw("lengthSq",TM),uw("negate",aM),uw("oneMinus",oM),uw("dFdx",sM),uw("dFdy",uM),uw("round",lM),uw("reciprocal",cM),uw("trunc",hM),uw("fwidth",dM),uw("atan2",UM),uw("min",mM),uw("max",gM),uw("step",vM),uw("reflect",DM),uw("distance",yM),uw("dot",AM),uw("cross",CM),uw("pow",_M),uw("pow2",bM),uw("pow3",xM),uw("pow4",FM),uw("transformDirection",wM),uw("mix",kM),uw("clamp",BM),uw("refract",NM),uw("smoothstep",OM),uw("faceForward",LM),uw("difference",EM),uw("saturate",PM),uw("cbrt",SM),uw("transpose",pM),uw("rand",IM);class zM extends XF{static get type(){return"ConditionalNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(void 0===t)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(null!==n){const t=n.getNodeType(e);if(e.getTypeLength(t)>e.getTypeLength(r))return t}return r}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,i=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=i,null!==r&&(e.getDataFromNode(r).parentNodeBlock=i);const a=e.getNodeProperties(this);a.condNode=t,a.ifNode=n.context({nodeBlock:n}),a.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(void 0!==r.nodeProperty)return r.nodeProperty;const{condNode:i,ifNode:a,elseNode:o}=e.getNodeProperties(this),s=e.currentFunctionNode,u="void"!==t,l=u?mS(n).build(e):"";r.nodeProperty=l;const c=i.build(e,"bool");e.addFlowCode("\n".concat(e.tab,"if ( ").concat(c," ) {\n\n")).addFlowTab();let h=a.build(e,n);if(h&&(u?h=l+" = "+h+";":(h="return "+h+";",null===s&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),h="// "+h))),e.removeFlowTab().addFlowCode(e.tab+"\t"+h+"\n\n"+e.tab+"}"),null!==o){e.addFlowCode(" else {\n\n").addFlowTab();let t=o.build(e,n);t&&(u?t=l+" = "+t+";":(t="return "+t+";",null===s&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),t="// "+t))),e.removeFlowTab().addFlowCode(e.tab+"\t"+t+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(l,n,t)}}const VM=Ow(zM).setParameterLength(2,3);uw("select",VM);const GM=function(){return console.warn("THREE.TSL: cond() has been renamed to select()."),VM(...arguments)};uw("cond",GM);class HM extends XF{static get type(){return"ContextNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){const t=e.getContext();e.setContext(s(s({},e.context),this.value)),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext(s(s({},e.context),this.value)),this.node.build(e),e.setContext(t)}generate(e,t){const n=e.getContext();e.setContext(s(s({},e.context),this.value));const r=this.node.build(e,t);return e.setContext(n),r}}const jM=Ow(HM).setParameterLength(1,2),WM=(e,t)=>jM(e,{label:t});uw("context",jM),uw("label",WM);class qM extends XF{static get type(){return"VarNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:i}=e,a=!0===i.backend.isWebGPUBackend;let o=!1,s=!1;r&&(o=e.isDeterministic(t),s=a?r:o);const u=e.getVectorType(this.getNodeType(e)),l=t.build(e,u),c=e.getVarFromNode(this,n,u,void 0,s),h=e.getPropertyName(c);let d=h;if(s)if(a)d=o?"const ".concat(h):"let ".concat(h);else{const n=e.getArrayCount(t);d="const ".concat(e.getVar(c.type,h,n))}return e.addLineFlowCode("".concat(d," = ").concat(l),this),h}}const XM=Ow(qM),KM=function(e){return XM(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null).toStack()},YM=function(e){return XM(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!0).toStack()};uw("toVar",KM),uw("toConst",YM);const JM=e=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),XM(e));uw("temp",JM);class $M extends XF{static get type(){return"VaryingNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(void 0===n){const r=this.name,i=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,i,a,o),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation="fragment"===e.shaderStage),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(OF.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(OF.VERTEX,this.node)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e);if(void 0===t.propertyName){const r=this.getNodeType(e),i=e.getPropertyName(n,OF.VERTEX);e.flowNodeFromShaderStage(OF.VERTEX,this.node,r,i),t.propertyName=i}return e.getPropertyName(n)}}const QM=Ow($M).setParameterLength(1,2),ZM=e=>QM(e);uw("toVarying",QM),uw("toVertexStage",ZM),uw("varying",function(){return console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),QM(...arguments)}),uw("vertexStage",function(){return console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),QM(...arguments)});const eB=Vw(e=>{let[t]=e;const n=t.mul(.9478672986).add(.0521327014).pow(2.4),r=t.mul(.0773993808),i=t.lessThanEqual(.04045);return MM(n,r,i)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),tB=Vw(e=>{let[t]=e;const n=t.pow(.41666).mul(1.055).sub(.055),r=t.mul(12.92),i=t.lessThanEqual(.0031308);return MM(n,r,i)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),nB="WorkingColorSpace";class rB extends JF{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===nB?zs.workingColorSpace:"OutputColorSpace"===t?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let i=t;return!1!==zs.enabled&&n!==r&&n&&r?(zs.getTransfer(n)===Qo&&(i=aS(eB(i.rgb),i.a)),zs.getPrimaries(n)!==zs.getPrimaries(r)&&(i=aS(cS(zs._getMatrix(new Ms,n,r)).mul(i.rgb),i.a)),zs.getTransfer(r)===Qo&&(i=aS(tB(i.rgb),i.a)),i):i}}const iB=(e,t)=>Lw(new rB(Lw(e),nB,t)),aB=(e,t)=>Lw(new rB(Lw(e),t,nB));uw("workingToColorSpace",iB),uw("colorSpaceToWorking",aB);let oB=class extends KF{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class sB extends XF{static get type(){return"ReferenceBaseNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=UF.OBJECT}setGroup(e){return this.group=e,this}element(e){return Lw(new oB(this,Lw(e)))}setNodeType(e){const t=$S(null,e).getSelf();null!==this.group&&t.setGroup(this.group),this.node=t}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.reference;const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class uB extends sB{static get type(){return"RendererReferenceNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e,t,n),this.renderer=n,this.setGroup(KS)}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}const lB=function(e,t){return Lw(new uB(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null))};class cB extends JF{static get type(){return"ToneMappingNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dB,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return wF(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(0===n)return t;let r=null;const i=e.renderer.library.getToneMappingFunction(n);return null!==i?r=aS(i(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}}const hB=(e,t,n)=>Lw(new cB(e,Lw(t),Lw(n))),dB=lB("toneMappingExposure","float");uw("toneMapping",(e,t,n)=>hB(t,n,e));class pB extends nw{static get type(){return"BufferAttributeNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=us,this.instanced=!1,this.attribute=null,this.global=!0,e&&!0===e.isBufferAttribute&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(0===this.bufferStride&&0===this.bufferOffset){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;const t=this.getNodeType(e),n=this.value,r=e.getTypeLength(t),i=this.bufferStride||r,a=this.bufferOffset,o=!0===n.isInterleavedBuffer?n:new bc(n,i),s=new Fc(o,r,a);o.setUsage(this.usage),this.attribute=s,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let i=null;if("vertex"===e.shaderStage||"compute"===e.shaderStage)this.name=r,i=r;else{i=QM(this).build(e,t)}return i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const fB=function(e){return Lw(new pB(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0))},mB=function(e){return fB(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0).setUsage(ls)},gB=function(e){return fB(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0).setInstanced(!0)},vB=function(e){return mB(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0).setInstanced(!0)};uw("toAttribute",e=>fB(e.value));class DB extends XF{static get type(){return"ComputeNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[64];super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=UF.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let r=1;r<t.length;r++)n*=t[r];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore(e){let{renderer:t}=e;t.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){e.getNodeProperties(this).outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if("compute"===n){const t=this.computeNode.build(e,"void");""!==t&&e.addLineFlowCode(t,this)}else{const n=e.getNodeProperties(this).outputComputeNode;if(n)return n.build(e,t)}}}const yB=(e,t,n)=>Lw(new DB(Lw(e),t,n));uw("compute",yB);class EB extends XF{static get type(){return"CacheNode"}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];const o=this.node.build(e,...i);return e.setCache(t),o}}const AB=(e,t)=>Lw(new EB(Lw(e),t)),CB=(e,t)=>e.context({namespace:t});uw("cache",AB);class _B extends XF{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const bB=Ow(_B).setParameterLength(2);uw("bypass",bB);class xB extends XF{static get type(){return"RemapNode"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Xw(0),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Xw(1);super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:a}=this;let o=e.sub(t).div(n.sub(t));return!0===a&&(o=o.clamp()),o.mul(i.sub(r)).add(r)}}const FB=Ow(xB,null,null,{doClamp:!1}).setParameterLength(3,5),wB=Ow(xB).setParameterLength(3,5);uw("remap",FB),uw("remapClamp",wB);class SB extends XF{static get type(){return"ExpressionNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"void"),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if("void"!==n)return e.format(r,n,t);e.addLineFlowCode(r,this)}}const TB=Ow(SB).setParameterLength(1,2),MB=e=>(e?VM(e,TB("discard")):TB("discard")).toStack();uw("discard",MB);class BB extends JF{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup(e){let{context:t}=e,n=this.colorNode||t.color;const r=(null!==this.toneMapping?this.toneMapping:t.toneMapping)||0,i=(null!==this.outputColorSpace?this.outputColorSpace:t.outputColorSpace)||Ko;return 0!==r&&(n=n.toneMapping(r)),i!==Ko&&i!==zs.workingColorSpace&&(n=n.workingToColorSpace(i)),n}}const PB=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Lw(new BB(Lw(e),t,n))};uw("renderOutput",PB);class NB extends JF{static get type(){return"DebugNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",i="-".repeat(r.length);let a="";return a+="// #"+r+"#\n",a+=e.flow.code.replace(/^\t/gm,"")+"\n",a+="/* ... */ "+n+" /* ... */\n",a+="// #"+i+"#\n",null!==t?t(e,a):console.log(a),n}}const RB=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Lw(new NB(Lw(e),t))};uw("debug",RB);class LB extends XF{static get type(){return"AttributeNode"}constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(null===t){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(!0===e.hasGeometryAttribute(t)){const r=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(r),a=e.getAttribute(t,i);if("vertex"===e.shaderStage)return e.format(a.name,i,n);return QM(this).build(e,n)}return console.warn('AttributeNode: Vertex attribute "'.concat(t,'" not found on geometry.')),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const IB=function(e){return Lw(new LB(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null))},kB=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return IB("uv"+(e>0?e:""),"vec2")};class OB extends XF{static get type(){return"TextureSizeNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=null===this.levelNode?"0":this.levelNode.build(e,"int");return e.format("".concat(e.getMethod("textureDimensions"),"( ").concat(n,", ").concat(r," )"),this.getNodeType(e),t)}}const UB=Ow(OB).setParameterLength(1,2);class zB extends JS{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=UF.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&void 0!==n.width){const{width:e,height:t}=n;this.value=Math.log2(Math.max(e,t))}}}const VB=Ow(zB).setParameterLength(1),GB=new Js;class HB extends JS{static get type(){return"TextureNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:GB,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=UF.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(null===t)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===qa?"uvec4":this.value.type===Wa?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return kB(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return null===this._matrixUniform&&(this._matrixUniform=$S(this.value.matrix)),this._matrixUniform.mul(tS(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?UF.OBJECT:UF.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&!0===n.flipY||!0===n.isRenderTargetTexture||!0===n.isFramebufferTexture||!0===n.isDepthTexture)&&(t=this.sampler?t.flipY():t.setY(Kw(UB(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||!0!==n.isTexture)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;null!==r&&!0!==e.context.forceUVContext||!e.context.getUV||(r=e.context.getUV(this,e)),r||(r=this.getDefaultUV()),!0===this.updateMatrix&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let i=this.levelNode;null===i&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,!0===this.sampler?"vec2":"ivec2")}generateSnippet(e,t,n,r,i,a,o,s){const u=this.value;let l;return l=r?e.generateTextureLevel(u,t,n,r,a):i?e.generateTextureBias(u,t,n,i,a):s?e.generateTextureGrad(u,t,n,s,a):o?e.generateTextureCompare(u,t,n,o,a):!1===this.sampler?e.generateTextureLoad(u,t,n,a):e.generateTexture(u,t,n,a),l}generate(e,t){const n=this.value,r=e.getNodeProperties(this),i=super.generate(e,"property");if(/^sampler/.test(t))return i+"_sampler";if(e.isReference(t))return i;{const a=e.getDataFromNode(this);let o=a.propertyName;if(void 0===o){const{uvNode:t,levelNode:n,biasNode:s,compareNode:u,depthNode:l,gradNode:c}=r,h=this.generateUV(e,t),d=n?n.build(e,"float"):null,p=s?s.build(e,"float"):null,f=l?l.build(e,"int"):null,m=u?u.build(e,"float"):null,g=c?[c[0].build(e,"vec2"),c[1].build(e,"vec2")]:null,v=e.getVarFromNode(this);o=e.getPropertyName(v);const D=this.generateSnippet(e,i,h,d,p,f,m,g);e.addLineFlowCode("".concat(o," = ").concat(D),this),a.snippet=D,a.propertyName=o}let s=o;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(s=aB(TB(s,u),n.colorSpace).setup(e).build(e,u)),e.format(s,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Lw(e),t.referenceNode=this.getSelf(),Lw(t)}blur(e){const t=this.clone();t.biasNode=Lw(e).mul(VB(t)),t.referenceNode=this.getSelf();const n=t.value;return!1===t.generateMipmaps&&(n&&!1===n.generateMipmaps||n.minFilter===La||n.magFilter===La)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Lw(t)}level(e){const t=this.clone();return t.levelNode=Lw(e),t.referenceNode=this.getSelf(),Lw(t)}size(e){return UB(this,e)}bias(e){const t=this.clone();return t.biasNode=Lw(e),t.referenceNode=this.getSelf(),Lw(t)}compare(e){const t=this.clone();return t.compareNode=Lw(e),t.referenceNode=this.getSelf(),Lw(t)}grad(e,t){const n=this.clone();return n.gradNode=[Lw(e),Lw(t)],n.referenceNode=this.getSelf(),Lw(n)}depth(e){const t=this.clone();return t.depthNode=Lw(e),t.referenceNode=this.getSelf(),Lw(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;null!==t&&(t.value=e.matrix),!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}const jB=Ow(HB).setParameterLength(1,4).setName("texture"),WB=function(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:GB,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return t&&!0===t.isTextureNode?(e=Lw(t.clone()),e.referenceNode=t.getSelf(),null!==n&&(e.uvNode=Lw(n)),null!==r&&(e.levelNode=Lw(r)),null!==i&&(e.biasNode=Lw(i))):e=jB(t,n,r,i),e},qB=function(){return WB(...arguments).setSampler(!1)};class XB extends JS{static get type(){return"BufferNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const KB=(e,t,n)=>Lw(new XB(e,t,n));class YB extends KF{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class JB extends XB{static get type(){return"UniformArrayNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.array=e,this.elementType=null===t?NF(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=UF.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return"mat2"===e?t="mat2":!0===/mat/.test(e)?t="mat4":"i"===e.charAt(0)?t="ivec4":"u"===e.charAt(0)&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if("float"===n||"int"===n||"uint"===n)for(let r=0;r<e.length;r++){t[4*r]=e[r]}else if("color"===n)for(let r=0;r<e.length;r++){const n=4*r,i=e[r];t[n]=i.r,t[n+1]=i.g,t[n+2]=i.b||0}else if("mat2"===n)for(let r=0;r<e.length;r++){const n=4*r,i=e[r];t[n]=i.elements[0],t[n+1]=i.elements[1],t[n+2]=i.elements[2],t[n+3]=i.elements[3]}else if("mat3"===n)for(let r=0;r<e.length;r++){const n=16*r,i=e[r];t[n]=i.elements[0],t[n+1]=i.elements[1],t[n+2]=i.elements[2],t[n+4]=i.elements[3],t[n+5]=i.elements[4],t[n+6]=i.elements[5],t[n+8]=i.elements[6],t[n+9]=i.elements[7],t[n+10]=i.elements[8],t[n+15]=1}else if("mat4"===n)for(let r=0;r<e.length;r++){const n=16*r,i=e[r];for(let e=0;e<i.elements.length;e++)t[n+e]=i.elements[e]}else for(let r=0;r<e.length;r++){const n=4*r,i=e[r];t[n]=i.x,t[n+1]=i.y,t[n+2]=i.z||0,t[n+3]=i.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const i=this.paddedType,a=e.getTypeLength(i);return"i"===n.charAt(0)&&(r=Int32Array),"u"===n.charAt(0)&&(r=Uint32Array),this.value=new r(t*a),this.bufferCount=t,this.bufferType=i,super.setup(e)}element(e){return Lw(new YB(this,Lw(e)))}}const $B=(e,t)=>Lw(new JB(e,t));const QB=Ow(class extends XF{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}).setParameterLength(1),ZB=$S(0,"uint").label("u_cameraIndex").setGroup(qS("cameraIndex")).toVarying("v_cameraIndex"),eP=$S("float").label("cameraNear").setGroup(KS).onRenderUpdate(e=>{let{camera:t}=e;return t.near}),tP=$S("float").label("cameraFar").setGroup(KS).onRenderUpdate(e=>{let{camera:t}=e;return t.far}),nP=Vw(e=>{let t,{camera:n}=e;if(n.isArrayCamera&&n.cameras.length>0){const e=[];for(const t of n.cameras)e.push(t.projectionMatrix);t=$B(e).setGroup(KS).label("cameraProjectionMatrices").element(n.isMultiViewCamera?QB("gl_ViewID_OVR"):ZB).toVar("cameraProjectionMatrix")}else t=$S("mat4").label("cameraProjectionMatrix").setGroup(KS).onRenderUpdate(e=>{let{camera:t}=e;return t.projectionMatrix});return t}).once()(),rP=Vw(e=>{let t,{camera:n}=e;if(n.isArrayCamera&&n.cameras.length>0){const e=[];for(const t of n.cameras)e.push(t.matrixWorldInverse);t=$B(e).setGroup(KS).label("cameraViewMatrices").element(n.isMultiViewCamera?QB("gl_ViewID_OVR"):ZB).toVar("cameraViewMatrix")}else t=$S("mat4").label("cameraViewMatrix").setGroup(KS).onRenderUpdate(e=>{let{camera:t}=e;return t.matrixWorldInverse});return t}).once()(),iP=$S(new ws).label("cameraPosition").setGroup(KS).onRenderUpdate((e,t)=>{let{camera:n}=e;return t.value.setFromMatrixPosition(n.matrixWorld)}),aP=new Eu;class oP extends XF{static get type(){return"Object3DNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.scope=e,this.object3d=t,this.updateType=UF.OBJECT,this.uniformNode=new JS(null)}getNodeType(){const e=this.scope;return e===oP.WORLD_MATRIX?"mat4":e===oP.POSITION||e===oP.VIEW_POSITION||e===oP.DIRECTION||e===oP.SCALE?"vec3":e===oP.RADIUS?"float":void 0}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===oP.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===oP.POSITION)n.value=n.value||new ws,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===oP.SCALE)n.value=n.value||new ws,n.value.setFromMatrixScale(t.matrixWorld);else if(r===oP.DIRECTION)n.value=n.value||new ws,t.getWorldDirection(n.value);else if(r===oP.VIEW_POSITION){const r=e.camera;n.value=n.value||new ws,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}else if(r===oP.RADIUS){const r=e.object.geometry;null===r.boundingSphere&&r.computeBoundingSphere(),aP.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),n.value=aP.radius}}generate(e){const t=this.scope;return t===oP.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===oP.POSITION||t===oP.VIEW_POSITION||t===oP.DIRECTION||t===oP.SCALE?this.uniformNode.nodeType="vec3":t===oP.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}oP.WORLD_MATRIX="worldMatrix",oP.POSITION="position",oP.SCALE="scale",oP.VIEW_POSITION="viewPosition",oP.DIRECTION="direction",oP.RADIUS="radius";const sP=Ow(oP,oP.POSITION).setParameterLength(1);class uP extends oP{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const lP=Uw(uP,uP.WORLD_MATRIX),cP=$S(new Ms).onObjectUpdate((e,t)=>{let{object:n}=e;return t.value.getNormalMatrix(n.matrixWorld)}),hP=Vw(e=>e.renderer.overrideNodes.modelViewMatrix||dP).once()().toVar("modelViewMatrix"),dP=rP.mul(lP),pP=Vw(e=>(e.context.isHighPrecisionModelViewMatrix=!0,$S("mat4").onObjectUpdate(e=>{let{object:t,camera:n}=e;return t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld)}))).once()().toVar("highpModelViewMatrix"),fP=Vw(e=>{const t=e.context.isHighPrecisionModelViewMatrix;return $S("mat3").onObjectUpdate(e=>{let{object:n,camera:r}=e;return!0!==t&&n.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld),n.normalMatrix.getNormalMatrix(n.modelViewMatrix)})}).once()().toVar("highpModelNormalViewMatrix"),mP=IB("position","vec3"),gP=mP.toVarying("positionLocal"),vP=mP.toVarying("positionPrevious"),DP=Vw(e=>lP.mul(gP).xyz.toVarying(e.getNamespace("v_positionWorld")),"vec3").once("POSITION")(),yP=Vw(e=>gP.transformDirection(lP).toVarying(e.getNamespace("v_positionWorldDirection")).normalize().toVar("positionWorldDirection"),"vec3").once("POSITION")(),EP=Vw(e=>e.context.setupPositionView().toVarying(e.getNamespace("v_positionView")),"vec3").once("POSITION")(),AP=EP.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class CP extends XF{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===hs&&1===n.side?"false":e.getFrontFacing()}}const _P=Uw(CP),bP=Xw(_P).mul(2).sub(1),xP=IB("normal","vec3"),FP=Vw(e=>!1===e.geometry.hasAttribute("normal")?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),tS(0,1,0)):xP,"vec3").once()().toVar("normalLocal"),wP=EP.dFdx().cross(EP.dFdy()).normalize().toVar("normalFlat"),SP=Vw(e=>{let t;return t=!0===e.material.flatShading?wP:QM(RP(FP),"v_normalView").normalize(),t},"vec3").once()().toVar("normalView"),TP=Vw(e=>{let t=SP.transformDirection(rP);return!0!==e.material.flatShading&&(t=QM(t,"v_normalWorld")),t},"vec3").once()().normalize().toVar("normalWorld"),MP=Vw(e=>{let t=e.context.setupNormal().context({getUV:null});return!0!==e.material.flatShading&&(t=t.mul(bP)),t},"vec3").once()().toVar("transformedNormalView"),BP=MP.transformDirection(rP).toVar("transformedNormalWorld"),PP=Vw(e=>{let t=e.context.setupClearcoatNormal().context({getUV:null});return!0!==e.material.flatShading&&(t=t.mul(bP)),t},"vec3").once()().toVar("transformedClearcoatNormalView"),NP=Vw(e=>{let[t,n=lP]=e;const r=cS(n),i=t.div(tS(r[0].dot(r[0]),r[1].dot(r[1]),r[2].dot(r[2])));return r.mul(i).xyz}),RP=Vw((e,t)=>{let[n]=e;const r=t.renderer.overrideNodes.modelNormalViewMatrix;if(null!==r)return r.transformDirection(n);const i=cP.mul(n);return rP.transformDirection(i)}),LP=new Uu,IP=new Tu,kP=$S(0).onReference(e=>{let{material:t}=e;return t}).onObjectUpdate(e=>{let{material:t}=e;return t.refractionRatio}),OP=$S(1).onReference(e=>{let{material:t}=e;return t}).onObjectUpdate(function(e){let{material:t,scene:n}=e;return t.envMap?t.envMapIntensity:n.environmentIntensity}),UP=$S(new Tu).onReference(function(e){return e.material}).onObjectUpdate(function(e){let{material:t,scene:n}=e;const r=null!==n.environment&&null===t.envMap?n.environmentRotation:t.envMapRotation;return r?(LP.copy(r),IP.makeRotationFromEuler(LP)):IP.identity(),IP}),zP=AP.negate().reflect(MP),VP=AP.negate().refract(MP,kP),GP=zP.transformDirection(rP).toVar("reflectVector"),HP=VP.transformDirection(rP).toVar("reflectVector"),jP=new Dc;class WP extends HB{static get type(){return"CubeTextureNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===wa?GP:e.mapping===Sa?HP:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),tS(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.renderer.coordinateSystem!==ds&&n.isRenderTargetTexture||(t=tS(t.x.negate(),t.yz)),UP.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const qP=Ow(WP).setParameterLength(1,4).setName("cubeTexture"),XP=function(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jP,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return t&&!0===t.isCubeTextureNode?(e=Lw(t.clone()),e.referenceNode=t.getSelf(),null!==n&&(e.uvNode=Lw(n)),null!==r&&(e.levelNode=Lw(r)),null!==i&&(e.biasNode=Lw(i))):e=qP(t,n,r,i),e};class KP extends KF{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class YP extends XF{static get type(){return"ReferenceNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=UF.OBJECT}element(e){return Lw(new KP(this,Lw(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;t=null!==this.count?KB(null,e,this.count):Array.isArray(this.getValueFromReference())?$B(null,e):"texture"===e?WB(null):"cubeTexture"===e?XP(null):$S(null,e),null!==this.group&&t.setGroup(this.group),null!==this.name&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.reference;const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const JP=(e,t,n)=>Lw(new YP(e,t,n)),$P=(e,t,n,r)=>Lw(new YP(e,t,r,n));class QP extends YP{static get type(){return"MaterialReferenceNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}const ZP=function(e,t){return Lw(new QP(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null))},eN=Vw(e=>(!1===e.geometry.hasAttribute("tangent")&&e.geometry.computeTangents(),IB("tangent","vec4")))(),tN=eN.xyz.toVar("tangentLocal"),nN=hP.mul(aS(tN,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),rN=Vw((e,t)=>{let[n,r]=e,i=n.mul(eN.w).xyz;return!0!==t.material.flatShading&&(i=QM(i,r)),i}).once(),iN=rN(SP.cross(nN),"v_bitangentView").normalize().toVar("bitangentView"),aN=cS(nN,iN,SP),oN=(()=>{let e=BS.cross(AP);return e=e.cross(BS).normalize(),e=MM(e,MP,TS.mul(yS.oneMinus()).oneMinus().pow2().pow2()).normalize(),e})(),sN=Vw(e=>{const{eye_pos:t,surf_norm:n,mapN:r,uv:i}=e,a=t.dFdx(),o=t.dFdy(),s=i.dFdx(),u=i.dFdy(),l=n,c=o.cross(l),h=l.cross(a),d=c.mul(s.x).add(h.mul(u.x)),p=c.mul(s.y).add(h.mul(u.y)),f=d.dot(d).max(p.dot(p)),m=bP.mul(f.inverseSqrt());return oT(d.mul(r.x,m),p.mul(r.y,m),l.mul(r.z)).normalize()});class uN extends JF{static get type(){return"NormalMapNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=0}setup(e){const{normalMapType:t,scaleNode:n}=this;let r=this.node.mul(2).sub(1);null!==n&&(r=tS(r.xy.mul(n),r.z));let i=null;if(1===t)i=RP(r);else if(0===t){i=!0===e.hasGeometryAttribute("tangent")?aN.mul(r).normalize():sN({eye_pos:EP,surf_norm:SP,mapN:r,uv:kB()})}return i}}const lN=Ow(uN).setParameterLength(1,2),cN=Vw(e=>{let{textureNode:t,bumpScale:n}=e;const r=e=>t.cache().context({getUV:t=>e(t.uvNode||kB()),forceUVContext:!0}),i=Xw(r(e=>e));return $w(Xw(r(e=>e.add(e.dFdx()))).sub(i),Xw(r(e=>e.add(e.dFdy()))).sub(i)).mul(n)}),hN=Vw(e=>{const{surf_pos:t,surf_norm:n,dHdxy:r}=e,i=t.dFdx().normalize(),a=n,o=t.dFdy().normalize().cross(a),s=a.cross(i),u=i.dot(o).mul(bP),l=u.sign().mul(r.x.mul(o).add(r.y.mul(s)));return u.abs().mul(n).sub(l).normalize()});class dN extends JF{static get type(){return"BumpMapNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=null!==this.scaleNode?this.scaleNode:1,t=cN({textureNode:this.textureNode,bumpScale:e});return hN({surf_pos:EP,surf_norm:SP,dHdxy:t})}}const pN=Ow(dN).setParameterLength(1,2),fN=new Map;class mN extends XF{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=fN.get(e);return void 0===n&&(n=ZP(e,t),fN.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===mN.COLOR){const e=void 0!==t.color?this.getColor(n):tS();r=t.map&&!0===t.map.isTexture?e.mul(this.getTexture("map")):e}else if(n===mN.OPACITY){const e=this.getFloat(n);r=t.alphaMap&&!0===t.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(n===mN.SPECULAR_STRENGTH)r=t.specularMap&&!0===t.specularMap.isTexture?this.getTexture("specular").r:Xw(1);else if(n===mN.SPECULAR_INTENSITY){const e=this.getFloat(n);r=t.specularIntensityMap&&!0===t.specularIntensityMap.isTexture?e.mul(this.getTexture(n).a):e}else if(n===mN.SPECULAR_COLOR){const e=this.getColor(n);r=t.specularColorMap&&!0===t.specularColorMap.isTexture?e.mul(this.getTexture(n).rgb):e}else if(n===mN.ROUGHNESS){const e=this.getFloat(n);r=t.roughnessMap&&!0===t.roughnessMap.isTexture?e.mul(this.getTexture(n).g):e}else if(n===mN.METALNESS){const e=this.getFloat(n);r=t.metalnessMap&&!0===t.metalnessMap.isTexture?e.mul(this.getTexture(n).b):e}else if(n===mN.EMISSIVE){const e=this.getFloat("emissiveIntensity"),i=this.getColor(n).mul(e);r=t.emissiveMap&&!0===t.emissiveMap.isTexture?i.mul(this.getTexture(n)):i}else if(n===mN.NORMAL)t.normalMap?(r=lN(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):r=t.bumpMap?pN(this.getTexture("bump").r,this.getFloat("bumpScale")):SP;else if(n===mN.CLEARCOAT){const e=this.getFloat(n);r=t.clearcoatMap&&!0===t.clearcoatMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===mN.CLEARCOAT_ROUGHNESS){const e=this.getFloat(n);r=t.clearcoatRoughnessMap&&!0===t.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===mN.CLEARCOAT_NORMAL)r=t.clearcoatNormalMap?lN(this.getTexture(n),this.getCache(n+"Scale","vec2")):SP;else if(n===mN.SHEEN){const e=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=t.sheenColorMap&&!0===t.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(n===mN.SHEEN_ROUGHNESS){const e=this.getFloat(n);r=t.sheenRoughnessMap&&!0===t.sheenRoughnessMap.isTexture?e.mul(this.getTexture(n).a):e,r=r.clamp(.07,1)}else if(n===mN.ANISOTROPY)if(t.anisotropyMap&&!0===t.anisotropyMap.isTexture){const e=this.getTexture(n);r=lS(QN.x,QN.y,QN.y.negate(),QN.x).mul(e.rg.mul(2).sub($w(1)).normalize().mul(e.b))}else r=QN;else if(n===mN.IRIDESCENCE_THICKNESS){const e=JP("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const i=JP("0","float",t.iridescenceThicknessRange);r=e.sub(i).mul(this.getTexture(n).g).add(i)}else r=e}else if(n===mN.TRANSMISSION){const e=this.getFloat(n);r=t.transmissionMap?e.mul(this.getTexture(n).r):e}else if(n===mN.THICKNESS){const e=this.getFloat(n);r=t.thicknessMap?e.mul(this.getTexture(n).g):e}else if(n===mN.IOR)r=this.getFloat(n);else if(n===mN.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===mN.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===mN.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):Xw(0);else{const t=this.getNodeType(e);r=this.getCache(n,t)}return r}}mN.ALPHA_TEST="alphaTest",mN.COLOR="color",mN.OPACITY="opacity",mN.SHININESS="shininess",mN.SPECULAR="specular",mN.SPECULAR_STRENGTH="specularStrength",mN.SPECULAR_INTENSITY="specularIntensity",mN.SPECULAR_COLOR="specularColor",mN.REFLECTIVITY="reflectivity",mN.ROUGHNESS="roughness",mN.METALNESS="metalness",mN.NORMAL="normal",mN.CLEARCOAT="clearcoat",mN.CLEARCOAT_ROUGHNESS="clearcoatRoughness",mN.CLEARCOAT_NORMAL="clearcoatNormal",mN.EMISSIVE="emissive",mN.ROTATION="rotation",mN.SHEEN="sheen",mN.SHEEN_ROUGHNESS="sheenRoughness",mN.ANISOTROPY="anisotropy",mN.IRIDESCENCE="iridescence",mN.IRIDESCENCE_IOR="iridescenceIOR",mN.IRIDESCENCE_THICKNESS="iridescenceThickness",mN.IOR="ior",mN.TRANSMISSION="transmission",mN.THICKNESS="thickness",mN.ATTENUATION_DISTANCE="attenuationDistance",mN.ATTENUATION_COLOR="attenuationColor",mN.LINE_SCALE="scale",mN.LINE_DASH_SIZE="dashSize",mN.LINE_GAP_SIZE="gapSize",mN.LINE_WIDTH="linewidth",mN.LINE_DASH_OFFSET="dashOffset",mN.POINT_SIZE="size",mN.DISPERSION="dispersion",mN.LIGHT_MAP="light",mN.AO="ao";const gN=Uw(mN,mN.ALPHA_TEST),vN=Uw(mN,mN.COLOR),DN=Uw(mN,mN.SHININESS),yN=Uw(mN,mN.EMISSIVE),EN=Uw(mN,mN.OPACITY),AN=Uw(mN,mN.SPECULAR),CN=Uw(mN,mN.SPECULAR_INTENSITY),_N=Uw(mN,mN.SPECULAR_COLOR),bN=Uw(mN,mN.SPECULAR_STRENGTH),xN=Uw(mN,mN.REFLECTIVITY),FN=Uw(mN,mN.ROUGHNESS),wN=Uw(mN,mN.METALNESS),SN=Uw(mN,mN.NORMAL),TN=Uw(mN,mN.CLEARCOAT),MN=Uw(mN,mN.CLEARCOAT_ROUGHNESS),BN=Uw(mN,mN.CLEARCOAT_NORMAL),PN=Uw(mN,mN.ROTATION),NN=Uw(mN,mN.SHEEN),RN=Uw(mN,mN.SHEEN_ROUGHNESS),LN=Uw(mN,mN.ANISOTROPY),IN=Uw(mN,mN.IRIDESCENCE),kN=Uw(mN,mN.IRIDESCENCE_IOR),ON=Uw(mN,mN.IRIDESCENCE_THICKNESS),UN=Uw(mN,mN.TRANSMISSION),zN=Uw(mN,mN.THICKNESS),VN=Uw(mN,mN.IOR),GN=Uw(mN,mN.ATTENUATION_DISTANCE),HN=Uw(mN,mN.ATTENUATION_COLOR),jN=Uw(mN,mN.LINE_SCALE),WN=Uw(mN,mN.LINE_DASH_SIZE),qN=Uw(mN,mN.LINE_GAP_SIZE),XN=(mN.LINE_WIDTH,Uw(mN,mN.LINE_DASH_OFFSET)),KN=Uw(mN,mN.POINT_SIZE),YN=Uw(mN,mN.DISPERSION),JN=Uw(mN,mN.LIGHT_MAP),$N=Uw(mN,mN.AO),QN=$S(new xs).onReference(function(e){return e.material}).onRenderUpdate(function(e){let{material:t}=e;this.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation))}),ZN=Vw(e=>e.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class eR extends XF{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r,i;if(n===eR.VERTEX)r=e.getVertexIndex();else if(n===eR.INSTANCE)r=e.getInstanceIndex();else if(n===eR.DRAW)r=e.getDrawIndex();else if(n===eR.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===eR.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else{if(n!==eR.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+n);r=e.getSubgroupIndex()}if("vertex"===e.shaderStage||"compute"===e.shaderStage)i=r;else{i=QM(this).build(e,t)}return i}}eR.VERTEX="vertex",eR.INSTANCE="instance",eR.SUBGROUP="subgroup",eR.INVOCATION_LOCAL="invocationLocal",eR.INVOCATION_SUBGROUP="invocationSubgroup",eR.DRAW="draw";const tR=Uw(eR,eR.VERTEX),nR=Uw(eR,eR.INSTANCE),rR=(eR.SUBGROUP,eR.INVOCATION_SUBGROUP,eR.INVOCATION_LOCAL,Uw(eR,eR.DRAW));class iR extends XF{static get type(){return"InstanceNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=UF.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:r}=this;let{instanceMatrixNode:i,instanceColorNode:a}=this;if(null===i){if(t<=1e3)i=KB(n.array,"mat4",Math.max(t,1)).element(nR);else{const e=new Zh(n.array,16,1);this.buffer=e;const t=n.usage===ls?vB:gB,r=[t(e,"vec4",16,0),t(e,"vec4",16,4),t(e,"vec4",16,8),t(e,"vec4",16,12)];i=hS(...r)}this.instanceMatrixNode=i}if(r&&null===a){const e=new Tc(r.array,3),t=r.usage===ls?vB:gB;this.bufferColor=e,a=tS(t(e,"vec3",3,0)),this.instanceColorNode=a}const o=i.mul(gP).xyz;if(gP.assign(o),e.hasGeometryAttribute("normal")){const e=NP(FP,i);FP.assign(e)}null!==this.instanceColorNode&&gS("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==ls&&null!==this.buffer&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==ls&&null!==this.bufferColor&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class aR extends iR{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const oR=Ow(aR).setParameterLength(1);class sR extends XF{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(null===e.getDrawIndex()?this.batchingIdNode=nR:this.batchingIdNode=rR);const t=Vw(e=>{let[t]=e;const n=Kw(UB(qB(this.batchMesh._indirectTexture),0).x),r=Kw(t).mod(n),i=Kw(t).div(n);return qB(this.batchMesh._indirectTexture,Qw(r,i)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),n=t(Kw(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=Kw(UB(qB(r),0).x),a=Xw(n).mul(4).toInt().toVar(),o=a.mod(i),s=a.div(i),u=hS(qB(r,Qw(o,s)),qB(r,Qw(o.add(1),s)),qB(r,Qw(o.add(2),s)),qB(r,Qw(o.add(3),s))),l=this.batchMesh._colorsTexture;if(null!==l){const e=Vw(e=>{let[t]=e;const n=Kw(UB(qB(l),0).x),r=t,i=r.mod(n),a=r.div(n);return qB(l,Qw(i,a)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),t=e(n);gS("vec3","vBatchColor").assign(t)}const c=cS(u);gP.assign(u.mul(gP));const h=FP.div(tS(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2]))),d=c.mul(h).xyz;FP.assign(d),e.hasGeometryAttribute("tangent")&&tN.mulAssign(c)}}const uR=Ow(sR).setParameterLength(1);const lR=new WeakMap;class cR extends XF{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=UF.OBJECT,this.skinIndexNode=IB("skinIndex","uvec4"),this.skinWeightNode=IB("skinWeight","vec4"),this.bindMatrixNode=JP("bindMatrix","mat4"),this.bindMatrixInverseNode=JP("bindMatrixInverse","mat4"),this.boneMatricesNode=$P("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=gP,this.toPositionNode=gP,this.previousBoneMatricesNode=null}getSkinnedPosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.boneMatricesNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.positionNode;const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,o=e.element(n.x),s=e.element(n.y),u=e.element(n.z),l=e.element(n.w),c=i.mul(t),h=oT(o.mul(r.x).mul(c),s.mul(r.y).mul(c),u.mul(r.z).mul(c),l.mul(r.w).mul(c));return a.mul(h).xyz}getSkinnedNormal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.boneMatricesNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FP;const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,o=e.element(n.x),s=e.element(n.y),u=e.element(n.z),l=e.element(n.w);let c=oT(r.x.mul(o),r.y.mul(s),r.z.mul(u),r.w.mul(l));return c=a.mul(c).mul(i),c.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return null===this.previousBoneMatricesNode&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=$P("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,vP)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||!0===LF(e.object).useVelocity}setup(e){this.needsPreviousBoneMatrices(e)&&vP.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const t=this.getSkinnedNormal();FP.assign(t),e.hasGeometryAttribute("tangent")&&tN.assign(t)}return t}generate(e,t){if("void"!==t)return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;lR.get(t)!==e.frameId&&(lR.set(t,e.frameId),null!==this.previousBoneMatricesNode&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const hR=e=>Lw(new cR(e));class dR extends XF{static get type(){return"LoopNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(void 0!==t.stackNode)return t;const n={};for(let a=0,o=this.params.length-1;a<o;a++){const e=this.params[a],t=!0!==e.isNode&&e.name||this.getVarName(a),r=!0!==e.isNode&&e.type||"int";n[t]=TB(t,r)}const r=e.addStack();t.returnsNode=this.params[this.params.length-1](n,e),t.stackNode=r;const i=this.params[0];return!0!==i.isNode&&"function"===typeof i.update&&(t.updateNode=Vw(this.params[0].update)(n)),e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let o=0,s=n.length-1;o<s;o++){const r=n[o];let i,a=!1,s=null,u=null,l=null,c=null,h=null,d=null;if(r.isNode?"bool"===r.getNodeType(e)?(a=!0,c="bool",u=r.build(e,c)):(c="int",l=this.getVarName(o),s="0",u=r.build(e,c),h="<"):(c=r.type||"int",l=r.name||this.getVarName(o),s=r.start,u=r.end,h=r.condition,d=r.update,"number"===typeof s?s=e.generateConst(c,s):s&&s.isNode&&(s=s.build(e,c)),"number"===typeof u?u=e.generateConst(c,u):u&&u.isNode&&(u=u.build(e,c)),void 0!==s&&void 0===u?(s+=" - 1",u="0",h=">="):void 0!==u&&void 0===s&&(s="0",h="<"),void 0===h&&(h=Number(s)>Number(u)?">=":"<")),a)i="while ( ".concat(u," )");else{const n={start:s,end:u},r=n.start,a=n.end;let o;const p=()=>h.includes("<")?"+=":"-=";if(void 0!==d&&null!==d)switch(typeof d){case"function":o=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":o=l+" "+p()+" "+e.generateConst(c,d);break;case"string":o=l+" "+d;break;default:d.isNode?o=l+" "+p()+" "+d.build(e):(console.error("THREE.TSL: 'Loop( { update: ... } )' is not a function, string or number."),o="break /* invalid update */")}else d="int"===c||"uint"===c?h.includes("<")?"++":"--":p()+" 1.",o=l+" "+d;const f=e.getVar(c,l)+" = "+r,m=l+" "+h+" "+a;i="for ( ".concat(f,"; ").concat(m,"; ").concat(o," )")}e.addFlowCode((0===o?"\n":"")+e.tab+i+" {\n\n").addFlowTab()}const i=r.build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode("\n"+e.tab+i);for(let o=0,s=this.params.length-1;o<s;o++)e.addFlowCode((0===o?"":e.tab)+"}\n\n").removeFlowTab();return e.addFlowTab(),a}}const pR=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Lw(new dR(kw(t,"int"))).toStack()},fR=()=>TB("break").toStack(),mR=new WeakMap,gR=new $s,vR=Vw(e=>{let{bufferMap:t,influence:n,stride:r,width:i,depth:a,offset:o}=e;const s=Kw(tR).mul(r).add(o),u=s.div(i),l=s.sub(u.mul(i));return qB(t,Qw(l,u)).depth(a).xyz.mul(n)});class DR extends XF{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=$S(1),this.updateType=UF.OBJECT}setup(e){const{geometry:t}=e,n=void 0!==t.morphAttributes.position,r=t.hasAttribute("normal")&&void 0!==t.morphAttributes.normal,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=void 0!==i?i.length:0,{texture:o,stride:s,size:u}=function(e){const t=void 0!==e.morphAttributes.position,n=void 0!==e.morphAttributes.normal,r=void 0!==e.morphAttributes.color,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=void 0!==i?i.length:0;let o=mR.get(e);if(void 0===o||o.count!==a){void 0!==o&&o.texture.dispose();const s=e.morphAttributes.position||[],u=e.morphAttributes.normal||[],l=e.morphAttributes.color||[];let c=0;!0===t&&(c=1),!0===n&&(c=2),!0===r&&(c=3);let h=e.attributes.position.count*c,d=1;const p=4096;h>p&&(d=Math.ceil(h/p),h=p);const f=new Float32Array(h*d*4*a),m=new eu(f,h,d,a);m.type=Xa,m.needsUpdate=!0;const g=4*c;for(let D=0;D<a;D++){const y=s[D],E=u[D],A=l[D],C=h*d*4*D;for(let _=0;_<y.count;_++){const b=_*g;!0===t&&(gR.fromBufferAttribute(y,_),f[C+b+0]=gR.x,f[C+b+1]=gR.y,f[C+b+2]=gR.z,f[C+b+3]=0),!0===n&&(gR.fromBufferAttribute(E,_),f[C+b+4]=gR.x,f[C+b+5]=gR.y,f[C+b+6]=gR.z,f[C+b+7]=0),!0===r&&(gR.fromBufferAttribute(A,_),f[C+b+8]=gR.x,f[C+b+9]=gR.y,f[C+b+10]=gR.z,f[C+b+11]=4===A.itemSize?gR.w:1)}}function v(){m.dispose(),mR.delete(e),e.removeEventListener("dispose",v)}o={count:a,texture:m,stride:c,size:new xs(h,d)},mR.set(e,o),e.addEventListener("dispose",v)}return o}(t);!0===n&&gP.mulAssign(this.morphBaseInfluence),!0===r&&FP.mulAssign(this.morphBaseInfluence);const l=Kw(u.width);pR(a,e=>{let{i:t}=e;const i=Xw(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?i.assign(qB(this.mesh.morphTexture,Qw(Kw(t).add(1),Kw(nR))).r):i.assign(JP("morphTargetInfluences","float").element(t).toVar()),jw(i.notEqual(0),()=>{!0===n&&gP.addAssign(vR({bufferMap:o,influence:i,stride:s,width:l,depth:t,offset:Kw(0)})),!0===r&&FP.addAssign(vR({bufferMap:o,influence:i,stride:s,width:l,depth:t,offset:Kw(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}const yR=Ow(DR).setParameterLength(1);class ER extends XF{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class AR extends ER{static get type(){return"AONode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class CR extends HM{static get type(){return"LightingContextNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n={directDiffuse:tS().toVar("directDiffuse"),directSpecular:tS().toVar("directSpecular"),indirectDiffuse:tS().toVar("indirectDiffuse"),indirectSpecular:tS().toVar("indirectSpecular")};return{radiance:tS().toVar("radiance"),irradiance:tS().toVar("irradiance"),iblIrradiance:tS().toVar("iblIrradiance"),ambientOcclusion:Xw(1).toVar("ambientOcclusion"),reflectedLight:n,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const _R=Ow(CR);class bR extends ER{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let xR,FR;class wR extends XF{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===wR.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=UF.NONE;return this.scope!==wR.SIZE&&this.scope!==wR.VIEWPORT||(e=UF.RENDER),this.updateType=e,e}update(e){let{renderer:t}=e;const n=t.getRenderTarget();this.scope===wR.VIEWPORT?null!==n?FR.copy(n.viewport):(t.getViewport(FR),FR.multiplyScalar(t.getPixelRatio())):null!==n?(xR.width=n.width,xR.height=n.height):t.getDrawingBufferSize(xR)}setup(){const e=this.scope;let t=null;return t=e===wR.SIZE?$S(xR||(xR=new xs)):e===wR.VIEWPORT?$S(FR||(FR=new $s)):$w(MR.div(TR)),t}generate(e){if(this.scope===wR.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(TR).outputNode.build(e);t="".concat(e.getType("vec2"),"( ").concat(t,".x, ").concat(n,".y - ").concat(t,".y )")}return t}return super.generate(e)}}wR.COORDINATE="coordinate",wR.VIEWPORT="viewport",wR.SIZE="size",wR.UV="uv";const SR=Uw(wR,wR.UV),TR=Uw(wR,wR.SIZE),MR=Uw(wR,wR.COORDINATE),BR=Uw(wR,wR.VIEWPORT),PR=(BR.zw,BR.xy,new xs);class NR extends HB{static get type(){return"ViewportTextureNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:SR,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new Gc,n.minFilter=za),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=UF.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(PR);const n=this.value;n.image.width===PR.width&&n.image.height===PR.height||(n.image.width=PR.width,n.image.height=PR.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const RR=Ow(NR,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let LR=null;class IR extends NR{static get type(){return"ViewportDepthTextureNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:SR,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===LR&&(LR=new Hc),super(e,t,LR)}}const kR=Ow(IR).setParameterLength(0,2);class OR extends XF{static get type(){return"ViewportDepthNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===OR.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup(e){let{camera:t}=e;const{scope:n}=this,r=this.valueNode;let i=null;if(n===OR.DEPTH_BASE)null!==r&&(i=HR().assign(r));else if(n===OR.DEPTH)i=t.isPerspectiveCamera?zR(EP.z,eP,tP):UR(EP.z,eP,tP);else if(n===OR.LINEAR_DEPTH)if(null!==r)if(t.isPerspectiveCamera){const e=VR(r,eP,tP);i=UR(e,eP,tP)}else i=r;else i=UR(EP.z,eP,tP);return i}}OR.DEPTH_BASE="depthBase",OR.DEPTH="depth",OR.LINEAR_DEPTH="linearDepth";const UR=(e,t,n)=>e.add(t).div(t.sub(n)),zR=(e,t,n)=>t.add(e).mul(n).div(n.sub(t).mul(e)),VR=(e,t,n)=>t.mul(n).div(n.sub(t).mul(e).sub(n)),GR=(e,t,n)=>{t=t.max(1e-6).toVar();const r=HT(e.negate().div(t)),i=HT(n.div(t));return r.div(i)},HR=Ow(OR,OR.DEPTH_BASE),jR=Uw(OR,OR.DEPTH),WR=Ow(OR,OR.LINEAR_DEPTH).setParameterLength(0,1);kR();jR.assign=e=>HR(e);class qR extends XF{static get type(){return"ClippingNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qR.DEFAULT;super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===qR.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===qR.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Vw(()=>{const n=Xw().toVar("distanceToPlane"),r=Xw().toVar("distanceToGradient"),i=Xw(1).toVar("clipOpacity"),a=t.length;if(!1===this.hardwareClipping&&a>0){const e=$B(t);pR(a,t=>{let{i:a}=t;const o=e.element(a);n.assign(EP.dot(o.xyz).negate().add(o.w)),r.assign(n.fwidth().div(2)),i.mulAssign(RM(r.negate(),r,n))})}const o=e.length;if(o>0){const t=$B(e),a=Xw(1).toVar("intersectionClipOpacity");pR(o,e=>{let{i:i}=e;const o=t.element(i);n.assign(EP.dot(o.xyz).negate().add(o.w)),r.assign(n.fwidth().div(2)),a.mulAssign(RM(r.negate(),r,n).oneMinus())}),i.mulAssign(a.oneMinus())}vS.a.mulAssign(i),vS.a.equal(0).discard()})()}setupDefault(e,t){return Vw(()=>{const n=t.length;if(!1===this.hardwareClipping&&n>0){const e=$B(t);pR(n,t=>{let{i:n}=t;const r=e.element(n);EP.dot(r.xyz).greaterThan(r.w).discard()})}const r=e.length;if(r>0){const t=$B(e),n=Jw(!0).toVar("clipped");pR(r,e=>{let{i:r}=e;const i=t.element(r);n.assign(EP.dot(i.xyz).greaterThan(i.w).and(n))}),n.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Vw(()=>{const r=$B(e),i=QB(t.getClipDistance());pR(n,e=>{let{i:t}=e;const n=r.element(t),a=EP.dot(n.xyz).sub(n.w).negate();i.element(t).assign(a)})})()}}qR.ALPHA_TO_COVERAGE="alphaToCoverage",qR.DEFAULT="default",qR.HARDWARE="hardware";const XR=Vw(e=>{let[t]=e;return YT(uT(1e4,JT(uT(17,t.x).add(uT(.1,t.y)))).mul(oT(.1,nM(JT(uT(13,t.y).add(t.x))))))}),KR=Vw(e=>{let[t]=e;return XR($w(XR(t.xy),t.z))}),YR=Vw(e=>{let[t]=e;const n=gM(iM(sM(t.xyz)),iM(uM(t.xyz))),r=Xw(1).div(Xw(.05).mul(n)).toVar("pixScale"),i=$w(VT(qT(HT(r))),VT(XT(HT(r)))),a=$w(KR(qT(i.x.mul(t.xyz))),KR(qT(i.y.mul(t.xyz)))),o=YT(HT(r)),s=oT(uT(o.oneMinus(),a.x),uT(o,a.y)),u=mM(o,o.oneMinus()),l=tS(s.mul(s).div(uT(2,u).mul(sT(1,u))),s.sub(uT(.5,u)).div(sT(1,u)),sT(1,sT(1,s).mul(sT(1,s)).div(uT(2,u).mul(sT(1,u))))),c=s.lessThan(u.oneMinus()).select(s.lessThan(u).select(l.x,l.y),l.z);return BM(c,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class JR extends LB{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e);let n;return n=!0===e.hasGeometryAttribute(t)?super.generate(e):e.generateConst(this.nodeType,new $s(1,1,1,1)),n}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const $R=function(){return Lw(new JR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))};class QR extends bl{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{console.warn('THREE.NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}customProgramCacheKey(){return this.type+SF(this)}build(e){this.setup(e)}setupObserver(e){return new _F(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const r=this.setupVertex(e),i=this.vertexNode||r;let a;e.stack.outputNode=i,this.setupHardwareClipping(e),null!==this.geometryNode&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();const o=this.setupClipping(e);if(!0!==this.depthWrite&&!0!==this.depthTest||(null!==n?!0===n.depthBuffer&&this.setupDepth(e):!0===t.depth&&this.setupDepth(e)),null===this.fragmentNode){this.setupDiffuseColor(e),this.setupVariants(e);const r=this.setupLighting(e);null!==o&&e.stack.add(o);const i=aS(r,vS.a).max(0);a=this.setupOutput(e,i),LS.assign(a);const s=null!==this.outputNode;if(s&&(a=this.outputNode),null!==n){const e=t.getMRT(),n=this.mrtNode;null!==e?(s&&LS.assign(a),a=e,null!==n&&(a=e.merge(n))):null!==n&&(a=n)}}else{let t=this.fragmentNode;!0!==t.isOutputStructNode&&(t=aS(t)),a=this.setupOutput(e,t)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(null===e.clippingContext)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const t=e.renderer.samples;this.alphaToCoverage&&t>1?r=Lw(new qR(qR.ALPHA_TO_COVERAGE)):e.stack.add(Lw(new qR))}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,null===e.clippingContext)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(Lw(new qR(qR.HARDWARE))),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(null===r){const e=t.getMRT();e&&e.has("depth")?r=e.get("depth"):!0===t.logarithmicDepthBuffer&&(r=n.isPerspectiveCamera?GR(EP.z,eP,tP):UR(EP.z,eP,tP))}null!==r&&jR.assign(r).toStack()}setupPositionView(){return hP.mul(gP).xyz}setupModelViewProjection(){return nP.mul(EP)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),ZN}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&yR(t).toStack(),!0===t.isSkinnedMesh&&hR(t).toStack(),this.displacementMap){const e=ZP("displacementMap","texture"),t=ZP("displacementScale","float"),n=ZP("displacementBias","float");gP.addAssign(FP.normalize().mul(e.x.mul(t).add(n)))}return t.isBatchedMesh&&uR(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&oR(t).toStack(),null!==this.positionNode&&gP.assign(CB(this.positionNode,"POSITION")),gP}setupDiffuseColor(e){let{object:t,geometry:n}=e;null!==this.maskNode&&Jw(this.maskNode).not().discard();let r=this.colorNode?aS(this.colorNode):vN;if(!0===this.vertexColors&&n.hasAttribute("color")&&(r=r.mul($R())),t.instanceColor){r=gS("vec3","vInstanceColor").mul(r)}if(t.isBatchedMesh&&t._colorsTexture){r=gS("vec3","vBatchColor").mul(r)}vS.assign(r);const i=this.opacityNode?Xw(this.opacityNode):EN;vS.a.assign(vS.a.mul(i));let a=null;(null!==this.alphaTestNode||this.alphaTest>0)&&(a=null!==this.alphaTestNode?Xw(this.alphaTestNode):gN,vS.a.lessThanEqual(a).discard()),!0===this.alphaHash&&vS.a.lessThan(YR(gP)).discard();!1===this.transparent&&1===this.blending&&!1===this.alphaToCoverage?vS.a.assign(1):null===a&&vS.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return!0===this.lights?tS(0):vS.rgb}setupNormal(){return this.normalNode?tS(this.normalNode):SN}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?ZP("envMap","cubeTexture"):ZP("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new bR(JN)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),null!==this.aoNode||e.material.aoMap){const e=null!==this.aoNode?this.aoNode:$N;t.push(new AR(e))}let i=this.lightsNode||e.lightsNode;return t.length>0&&(i=e.renderer.lighting.createNode([...i.getLights(),...t])),i}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,a=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null;let o=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const t=this.setupLightingModel(e)||null;o=_R(a,t,n,r)}else null!==n&&(o=tS(null!==r?MM(o,n,r):n));return(i&&!0===i.isNode||t.emissive&&!0===t.emissive.isColor)&&(DS.assign(tS(i||yN)),o=o.add(DS)),o}setupFog(e,t){const n=e.fogNode;return n&&(LS.assign(t),t=aS(n)),t}setupOutput(e,t){return!0===this.fog&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const t=e[n];void 0===this[n]&&(this[n]=t,t&&t.clone&&(this[n]=t.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,n)&&void 0!==t[n].get&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{},nodes:{}});const n=bl.prototype.toJSON.call(this,e),r=TF(this);n.inputNodes={};for(const{property:a,childNode:o}of r)n.inputNodes[a]=o.toJSON(e).uuid;function i(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(t){const t=i(e.textures),r=i(e.images),a=i(e.nodes);t.length>0&&(n.textures=t),r.length>0&&(n.images=r),a.length>0&&(n.nodes=a)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const ZR=new zc;class eL extends QR{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(ZR),this.setValues(e)}}const tL=new rh;class nL extends QR{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(tL),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Xw(this.offsetNode):XN,t=this.dashScaleNode?Xw(this.dashScaleNode):jN,n=this.dashSizeNode?Xw(this.dashSizeNode):WN,r=this.gapSizeNode?Xw(this.gapSizeNode):qN;IS.assign(n),kS.assign(r);const i=QM(IB("lineDistance").mul(t));(e?i.add(e):i).mod(IS.add(kS)).greaterThan(IS).discard()}}const rL=e=>Lw(e).mul(.5).add(.5),iL=new Qc;class aL extends QR{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(iL),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Xw(this.opacityNode):EN;vS.assign(aB(aS(rL(MP),e),Yo))}}class oL extends JF{static get type(){return"EquirectUVNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yP;super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(2*Math.PI)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return $w(t,n)}}const sL=Ow(oL).setParameterLength(0,1);class uL extends yc{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new ac(5,5,5),a=sL(yP),o=new QR;o.colorNode=WB(t,a,0),o.side=1,o.blending=0;const s=new rc(i,o),u=new _c;u.add(s),t.minFilter===za&&(t.minFilter=Oa);const l=new vc(1,10,this),c=e.getMRT();return e.setMRT(null),l.update(e,u),e.setMRT(c),t.minFilter=n,t.currentGenerateMipmaps=r,s.geometry.dispose(),s.material.dispose(),this}}const lL=new WeakMap;class cL extends JF{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=XP(null);const t=new Dc;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=UF.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const e=r.isTextureNode?r.value:n[r.property];if(e&&e.isTexture){const n=e.mapping;if(n===Ta||n===Ma){if(lL.has(e)){const t=lL.get(e);dL(t,e.mapping),this._cubeTexture=t}else{const n=e.image;if(function(e){return null!==e&&void 0!==e&&e.height>0}(n)){const r=new uL(n.height);r.fromEquirectangularTexture(t,e),dL(r.texture,e.mapping),this._cubeTexture=r.texture,lL.set(e,r.texture),e.addEventListener("dispose",hL)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function hL(e){const t=e.target;t.removeEventListener("dispose",hL);const n=lL.get(t);void 0!==n&&(lL.delete(t),n.dispose())}function dL(e,t){t===Ta?e.mapping=wa:t===Ma&&(e.mapping=Sa)}const pL=Ow(cL).setParameterLength(1);class fL extends ER{static get type(){return"BasicEnvironmentNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.envNode=e}setup(e){e.context.environment=pL(this.envNode)}}class mL extends ER{static get type(){return"BasicLightMapNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.lightMapNode=e}setup(e){const t=Xw(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class gL{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class vL extends gL{constructor(){super()}indirect(e){let{context:t}=e;const n=t.ambientOcclusion,r=t.reflectedLight,i=t.irradianceLightMap;r.indirectDiffuse.assign(aS(0)),i?r.indirectDiffuse.addAssign(i):r.indirectDiffuse.addAssign(aS(1,1,1,0)),r.indirectDiffuse.mulAssign(n),r.indirectDiffuse.mulAssign(vS.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case 0:r.rgb.assign(MM(r.rgb,r.rgb.mul(i.rgb),bN.mul(xN)));break;case 1:r.rgb.assign(MM(r.rgb,i.rgb,bN.mul(xN)));break;case 2:r.rgb.addAssign(i.rgb.mul(bN.mul(xN)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine)}}}const DL=new xl;class yL extends QR{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(DL),this.setValues(e)}setupNormal(){return SP}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new fL(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new mL(JN)),t}setupOutgoingLight(){return vS.rgb}setupLightingModel(){return new vL}}const EL=Vw(e=>{let{f0:t,f90:n,dotVH:r}=e;const i=r.mul(-5.55473).sub(6.98316).mul(r).exp2();return t.mul(i.oneMinus()).add(n.mul(i))}),AL=Vw(e=>e.diffuseColor.mul(1/Math.PI)),CL=Vw(e=>{let{dotNH:t}=e;return RS.mul(Xw(.5)).add(1).mul(Xw(1/Math.PI)).mul(t.pow(RS))}),_L=Vw(e=>{let{lightDirection:t}=e;const n=t.add(AP).normalize(),r=MP.dot(n).clamp(),i=AP.dot(n).clamp(),a=EL({f0:PS,f90:1,dotVH:i}),o=Xw(.25),s=CL({dotNH:r});return a.mul(o).mul(s)});class bL extends vL{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(),this.specular=e}direct(e){let{lightDirection:t,lightColor:n,reflectedLight:r}=e;const i=MP.dot(t).clamp().mul(n);r.directDiffuse.addAssign(i.mul(AL({diffuseColor:vS.rgb}))),!0===this.specular&&r.directSpecular.addAssign(i.mul(_L({lightDirection:t})).mul(bN))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(AL({diffuseColor:vS}))),r.indirectDiffuse.mulAssign(t)}}const xL=new Zc;class FL extends QR{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(xL),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new fL(t):null}setupLightingModel(){return new bL(!1)}}const wL=new Jc;class SL extends QR{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(wL),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new fL(t):null}setupLightingModel(){return new bL}setupVariants(){const e=(this.shininessNode?Xw(this.shininessNode):DN).max(1e-4);RS.assign(e);const t=this.specularNode||AN;PS.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const TL=Vw(e=>{if(!1===e.geometry.hasAttribute("normal"))return Xw(0);const t=SP.dFdx().abs().max(SP.dFdy().abs());return t.x.max(t.y).max(t.z)}),ML=Vw(e=>{const{roughness:t}=e,n=TL();let r=t.max(.0525);return r=r.add(n),r=r.min(1),r}),BL=Vw(e=>{let{alpha:t,dotNL:n,dotNV:r}=e;const i=t.pow2(),a=n.mul(i.add(i.oneMinus().mul(r.pow2())).sqrt()),o=r.mul(i.add(i.oneMinus().mul(n.pow2())).sqrt());return lT(.5,a.add(o).max(RT))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),PL=Vw(e=>{let{alphaT:t,alphaB:n,dotTV:r,dotBV:i,dotTL:a,dotBL:o,dotNV:s,dotNL:u}=e;const l=u.mul(tS(t.mul(r),n.mul(i),s).length()),c=s.mul(tS(t.mul(a),n.mul(o),u).length());return lT(.5,l.add(c)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),NL=Vw(e=>{let{alpha:t,dotNH:n}=e;const r=t.pow2(),i=n.pow2().mul(r.oneMinus()).oneMinus();return r.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),RL=Xw(1/Math.PI),LL=Vw(e=>{let{alphaT:t,alphaB:n,dotNH:r,dotTH:i,dotBH:a}=e;const o=t.mul(n),s=tS(n.mul(i),t.mul(a),o.mul(r)),u=s.dot(s),l=o.div(u);return RL.mul(o.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),IL=Vw(e=>{const{lightDirection:t,f0:n,f90:r,roughness:i,f:a,USE_IRIDESCENCE:o,USE_ANISOTROPY:s}=e,u=e.normalView||MP,l=i.pow2(),c=t.add(AP).normalize(),h=u.dot(t).clamp(),d=u.dot(AP).clamp(),p=u.dot(c).clamp(),f=AP.dot(c).clamp();let m,g,v=EL({f0:n,f90:r,dotVH:f});if(Pw(o)&&(v=xS.mix(v,a)),Pw(s)){const e=MS.dot(t),n=MS.dot(AP),r=MS.dot(c),i=BS.dot(t),a=BS.dot(AP),o=BS.dot(c);m=PL({alphaT:SS,alphaB:l,dotTV:n,dotBV:a,dotTL:e,dotBL:i,dotNV:d,dotNL:h}),g=LL({alphaT:SS,alphaB:l,dotNH:p,dotTH:r,dotBH:o})}else m=BL({alpha:l,dotNL:h,dotNV:d}),g=NL({alpha:l,dotNH:p});return v.mul(m).mul(g)}),kL=Vw(e=>{let{roughness:t,dotNV:n}=e;const r=aS(-1,-.0275,-.572,.022),i=aS(1,.0425,1.04,-.04),a=t.mul(r).add(i),o=a.x.mul(a.x).min(n.mul(-9.28).exp2()).mul(a.x).add(a.y);return $w(-1.04,1.04).mul(o).add(a.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),OL=Vw(e=>{const{dotNV:t,specularColor:n,specularF90:r,roughness:i}=e,a=kL({dotNV:t,roughness:i});return n.mul(a.x).add(r.mul(a.y))}),UL=Vw(e=>{let{f:t,f90:n,dotVH:r}=e;const i=r.oneMinus().saturate(),a=i.mul(i),o=i.mul(a,a).clamp(0,.9999);return t.sub(tS(n).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),zL=Vw(e=>{let{roughness:t,dotNH:n}=e;const r=t.pow2(),i=Xw(1).div(r),a=n.pow2().oneMinus().max(.0078125);return Xw(2).add(i).mul(a.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),VL=Vw(e=>{let{dotNV:t,dotNL:n}=e;return Xw(1).div(Xw(4).mul(n.add(t).sub(n.mul(t))))}).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),GL=Vw(e=>{let{lightDirection:t}=e;const n=t.add(AP).normalize(),r=MP.dot(t).clamp(),i=MP.dot(AP).clamp(),a=MP.dot(n).clamp(),o=zL({roughness:bS,dotNH:a}),s=VL({dotNV:i,dotNL:r});return _S.mul(o).mul(s)}),HL=Vw(e=>{let{N:t,V:n,roughness:r}=e;const i=t.dot(n).saturate(),a=$w(r,i.oneMinus().sqrt());return a.assign(a.mul(.984375).add(.0078125)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),jL=Vw(e=>{let{f:t}=e;const n=t.length();return gM(n.mul(n).add(t.z).div(n.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),WL=Vw(e=>{let{v1:t,v2:n}=e;const r=t.dot(n),i=r.abs().toVar(),a=i.mul(.0145206).add(.4965155).mul(i).add(.8543985).toVar(),o=i.add(4.1616724).mul(i).add(3.417594).toVar(),s=a.div(o),u=r.greaterThan(0).select(s,gM(r.mul(r).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(s));return t.cross(n).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),qL=Vw(e=>{let{N:t,V:n,P:r,mInv:i,p0:a,p1:o,p2:s,p3:u}=e;const l=o.sub(a).toVar(),c=u.sub(a).toVar(),h=l.cross(c),d=tS().toVar();return jw(h.dot(r.sub(a)).greaterThanEqual(0),()=>{const e=n.sub(t.mul(n.dot(t))).normalize(),l=t.cross(e).negate(),c=i.mul(cS(e,l,t).transpose()).toVar(),h=c.mul(a.sub(r)).normalize().toVar(),p=c.mul(o.sub(r)).normalize().toVar(),f=c.mul(s.sub(r)).normalize().toVar(),m=c.mul(u.sub(r)).normalize().toVar(),g=tS(0).toVar();g.addAssign(WL({v1:h,v2:p})),g.addAssign(WL({v1:p,v2:f})),g.addAssign(WL({v1:f,v2:m})),g.addAssign(WL({v1:m,v2:h})),d.assign(tS(jL({f:g})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),XL=1/6,KL=e=>uT(XL,uT(e,uT(e,e.negate().add(3)).sub(3)).add(1)),YL=e=>uT(XL,uT(e,uT(e,uT(3,e).sub(6))).add(4)),JL=e=>uT(XL,uT(e,uT(e,uT(-3,e).add(3)).add(3)).add(1)),$L=e=>uT(XL,_M(e,3)),QL=e=>KL(e).add(YL(e)),ZL=e=>JL(e).add($L(e)),eI=e=>oT(-1,YL(e).div(KL(e).add(YL(e)))),tI=e=>oT(1,$L(e).div(JL(e).add($L(e)))),nI=(e,t,n)=>{const r=e.uvNode,i=uT(r,t.zw).add(.5),a=qT(i),o=YT(i),s=QL(o.x),u=ZL(o.x),l=eI(o.x),c=tI(o.x),h=eI(o.y),d=tI(o.y),p=$w(a.x.add(l),a.y.add(h)).sub(.5).mul(t.xy),f=$w(a.x.add(c),a.y.add(h)).sub(.5).mul(t.xy),m=$w(a.x.add(l),a.y.add(d)).sub(.5).mul(t.xy),g=$w(a.x.add(c),a.y.add(d)).sub(.5).mul(t.xy),v=QL(o.y).mul(oT(s.mul(e.sample(p).level(n)),u.mul(e.sample(f).level(n)))),D=ZL(o.y).mul(oT(s.mul(e.sample(m).level(n)),u.mul(e.sample(g).level(n))));return v.add(D)},rI=Vw(e=>{let[t,n=Xw(3)]=e;const r=$w(t.size(Kw(n))),i=$w(t.size(Kw(n.add(1)))),a=lT(1,r),o=lT(1,i),s=nI(t,aS(a,r),qT(n)),u=nI(t,aS(o,i),XT(n));return YT(n).mix(s,u)}),iI=Vw(e=>{let[t,n,r,i,a]=e;const o=tS(NM(n.negate(),KT(t),lT(1,i))),s=tS(iM(a[0].xyz),iM(a[1].xyz),iM(a[2].xyz));return KT(o).mul(r.mul(s))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),aI=Vw(e=>{let[t,n]=e;return t.mul(BM(n.mul(2).sub(2),0,1))}).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),oI=RR(),sI=RR(),uI=Vw((e,t)=>{let[n,r,i]=e,{material:a}=t;const o=(1===a.side?oI:sI).sample(n),s=HT(TR.x).mul(aI(r,i));return rI(o,s)}),lI=Vw(e=>{let[t,n,r]=e;return jw(r.notEqual(0),()=>{const e=GT(n).negate().div(r);return zT(e.negate().mul(t))}),tS(1)}).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),cI=Vw(e=>{let t,n,[r,i,a,o,s,u,l,c,h,d,p,f,m,g,v]=e;if(v){t=aS().toVar(),n=tS().toVar();const e=p.sub(1).mul(v.mul(.025)),s=tS(p.sub(e),p,p.add(e));pR({start:0,end:3},e=>{let{i:u}=e;const p=s.element(u),v=iI(r,i,f,p,c),D=l.add(v),y=d.mul(h.mul(aS(D,1))),E=$w(y.xy.div(y.w)).toVar();E.addAssign(1),E.divAssign(2),E.assign($w(E.x,E.y.oneMinus()));const A=uI(E,a,p);t.element(u).assign(A.element(u)),t.a.addAssign(A.a),n.element(u).assign(o.element(u).mul(lI(iM(v),m,g).element(u)))}),t.a.divAssign(3)}else{const e=iI(r,i,f,p,c),s=l.add(e),u=d.mul(h.mul(aS(s,1))),v=$w(u.xy.div(u.w)).toVar();v.addAssign(1),v.divAssign(2),v.assign($w(v.x,v.y.oneMinus())),t=uI(v,a,p),n=o.mul(lI(iM(e),m,g))}const D=n.rgb.mul(t.rgb),y=r.dot(i).clamp(),E=tS(OL({dotNV:y,specularColor:s,specularF90:u,roughness:a})),A=n.r.add(n.g,n.b).div(3);return aS(E.oneMinus().mul(D),t.a.oneMinus().mul(A).oneMinus())}),hI=cS(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),dI=(e,t)=>e.sub(t).div(e.add(t)).pow2(),pI=Vw(e=>{let{outsideIOR:t,eta2:n,cosTheta1:r,thinFilmThickness:i,baseF0:a}=e;const o=MM(t,n,RM(0,.03,i)),s=t.div(o).pow2().mul(r.pow2().oneMinus()).oneMinus();jw(s.lessThan(0),()=>tS(1));const u=s.sqrt(),l=dI(o,t),c=EL({f0:l,f90:1,dotVH:r}),h=c.oneMinus(),d=o.lessThan(t).select(Math.PI,0),p=Xw(Math.PI).sub(d),f=(e=>{const t=e.sqrt();return tS(1).add(t).div(tS(1).sub(t))})(a.clamp(0,.9999)),m=dI(f,o.toVec3()),g=EL({f0:m,f90:1,dotVH:u}),v=tS(f.x.lessThan(o).select(Math.PI,0),f.y.lessThan(o).select(Math.PI,0),f.z.lessThan(o).select(Math.PI,0)),D=o.mul(i,u,2),y=tS(p).add(v),E=c.mul(g).clamp(1e-5,.9999),A=E.sqrt(),C=h.pow2().mul(g).div(tS(1).sub(E)),_=c.add(C).toVar(),b=C.sub(h).toVar();return pR({start:1,end:2,condition:"<=",name:"m"},e=>{let{m:t}=e;b.mulAssign(A);const n=((e,t)=>{const n=e.mul(2*Math.PI*1e-9),r=tS(54856e-17,44201e-17,52481e-17),i=tS(1681e3,1795300,2208400),a=tS(43278e5,93046e5,66121e5),o=Xw(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(t.x).cos()).mul(n.pow2().mul(-45282e5).exp());let s=r.mul(a.mul(2*Math.PI).sqrt()).mul(i.mul(n).add(t).cos()).mul(n.pow2().negate().mul(a).exp());return s=tS(s.x.add(o),s.y,s.z).div(1.0685e-7),hI.mul(s)})(Xw(t).mul(D),Xw(t).mul(y)).mul(2);_.addAssign(b.mul(n))}),_.max(tS(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),fI=Vw(e=>{let{normal:t,viewDir:n,roughness:r}=e;const i=t.dot(n).saturate(),a=r.pow2(),o=VM(r.lessThan(.25),Xw(-339.2).mul(a).add(Xw(161.4).mul(r)).sub(25.9),Xw(-8.48).mul(a).add(Xw(14.3).mul(r)).sub(9.95)),s=VM(r.lessThan(.25),Xw(44).mul(a).sub(Xw(23.7).mul(r)).add(3.26),Xw(1.97).mul(a).sub(Xw(3.27).mul(r)).add(.72));return VM(r.lessThan(.25),0,Xw(.1).mul(r).sub(.025)).add(o.mul(i).add(s).exp()).mul(1/Math.PI).saturate()}),mI=tS(.04),gI=Xw(1);class vI extends gL{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=i,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(!0===this.clearcoat&&(this.clearcoatRadiance=tS().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=tS().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=tS().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=tS().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=tS().toVar("sheenSpecularIndirect")),!0===this.iridescence){const e=MP.dot(AP).clamp();this.iridescenceFresnel=pI({outsideIOR:Xw(1),eta2:FS,cosTheta1:e,thinFilmThickness:wS,baseF0:PS}),this.iridescenceF0=UL({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(!0===this.transmission){const t=DP,n=iP.sub(DP).normalize(),r=BP,i=e.context;i.backdrop=cI(r,n,yS,vS,PS,NS,t,lP,rP,nP,OS,zS,GS,VS,this.dispersion?HS:null),i.backdropAlpha=US,vS.a.mulAssign(MM(1,i.backdrop.a,US))}super.start(e)}computeMultiscattering(e,t,n){const r=MP.dot(AP).clamp(),i=kL({roughness:yS,dotNV:r}),a=(this.iridescenceF0?xS.mix(PS,this.iridescenceF0):PS).mul(i.x).add(n.mul(i.y)),o=i.x.add(i.y).oneMinus(),s=PS.add(PS.oneMinus().mul(.047619)),u=a.mul(s).div(o.mul(s).oneMinus());e.addAssign(a),t.addAssign(u.mul(o))}direct(e){let{lightDirection:t,lightColor:n,reflectedLight:r}=e;const i=MP.dot(t).clamp().mul(n);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(i.mul(GL({lightDirection:t}))),!0===this.clearcoat){const e=PP.dot(t).clamp().mul(n);this.clearcoatSpecularDirect.addAssign(e.mul(IL({lightDirection:t,f0:mI,f90:gI,roughness:CS,normalView:PP})))}r.directDiffuse.addAssign(i.mul(AL({diffuseColor:vS.rgb}))),r.directSpecular.addAssign(i.mul(IL({lightDirection:t,f0:PS,f90:1,roughness:yS,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea(e){let{lightColor:t,lightPosition:n,halfWidth:r,halfHeight:i,reflectedLight:a,ltc_1:o,ltc_2:s}=e;const u=n.add(r).sub(i),l=n.sub(r).sub(i),c=n.sub(r).add(i),h=n.add(r).add(i),d=MP,p=AP,f=EP.toVar(),m=HL({N:d,V:p,roughness:yS}),g=o.sample(m).toVar(),v=s.sample(m).toVar(),D=cS(tS(g.x,0,g.y),tS(0,1,0),tS(g.z,0,g.w)).toVar(),y=PS.mul(v.x).add(PS.oneMinus().mul(v.y)).toVar();a.directSpecular.addAssign(t.mul(y).mul(qL({N:d,V:p,P:f,mInv:D,p0:u,p1:l,p2:c,p3:h}))),a.directDiffuse.addAssign(t.mul(vS).mul(qL({N:d,V:p,P:f,mInv:cS(1,0,0,0,1,0,0,0,1),p0:u,p1:l,p2:c,p3:h})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(AL({diffuseColor:vS})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(n.mul(_S,fI({normal:MP,viewDir:AP,roughness:bS}))),!0===this.clearcoat){const e=PP.dot(AP).clamp(),t=OL({dotNV:e,specularColor:mI,specularF90:gI,roughness:CS});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(t))}const i=tS().toVar("singleScattering"),a=tS().toVar("multiScattering"),o=n.mul(1/Math.PI);this.computeMultiscattering(i,a,NS);const s=i.add(a),u=vS.mul(s.r.max(s.g).max(s.b).oneMinus());r.indirectSpecular.addAssign(t.mul(i)),r.indirectSpecular.addAssign(a.mul(o)),r.indirectDiffuse.addAssign(u.mul(o))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,r=MP.dot(AP).clamp().add(t),i=yS.mul(-16).oneMinus().negate().exp2(),a=t.sub(r.pow(i).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(t),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(a)}finish(e){let{context:t}=e;const{outgoingLight:n}=t;if(!0===this.clearcoat){const e=PP.dot(AP).clamp(),t=EL({dotVH:e,f0:mI,f90:gI}),r=n.mul(AS.mul(t).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(AS));n.assign(r)}if(!0===this.sheen){const e=_S.r.max(_S.g).max(_S.b).mul(.157).oneMinus(),t=n.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);n.assign(t)}}}const DI=Xw(1),yI=Xw(-2),EI=Xw(.8),AI=Xw(-1),CI=Xw(.4),_I=Xw(2),bI=Xw(.305),xI=Xw(3),FI=Xw(.21),wI=Xw(4),SI=Xw(4),TI=Xw(16),MI=Vw(e=>{let[t]=e;const n=tS(nM(t)).toVar(),r=Xw(-1).toVar();return jw(n.x.greaterThan(n.z),()=>{jw(n.x.greaterThan(n.y),()=>{r.assign(VM(t.x.greaterThan(0),0,3))}).Else(()=>{r.assign(VM(t.y.greaterThan(0),1,4))})}).Else(()=>{jw(n.z.greaterThan(n.y),()=>{r.assign(VM(t.z.greaterThan(0),2,5))}).Else(()=>{r.assign(VM(t.y.greaterThan(0),1,4))})}),r}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),BI=Vw(e=>{let[t,n]=e;const r=$w().toVar();return jw(n.equal(0),()=>{r.assign($w(t.z,t.y).div(nM(t.x)))}).ElseIf(n.equal(1),()=>{r.assign($w(t.x.negate(),t.z.negate()).div(nM(t.y)))}).ElseIf(n.equal(2),()=>{r.assign($w(t.x.negate(),t.y).div(nM(t.z)))}).ElseIf(n.equal(3),()=>{r.assign($w(t.z.negate(),t.y).div(nM(t.x)))}).ElseIf(n.equal(4),()=>{r.assign($w(t.x.negate(),t.z).div(nM(t.y)))}).Else(()=>{r.assign($w(t.x,t.y).div(nM(t.z)))}),uT(.5,r.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),PI=Vw(e=>{let[t]=e;const n=Xw(0).toVar();return jw(t.greaterThanEqual(EI),()=>{n.assign(DI.sub(t).mul(AI.sub(yI)).div(DI.sub(EI)).add(yI))}).ElseIf(t.greaterThanEqual(CI),()=>{n.assign(EI.sub(t).mul(_I.sub(AI)).div(EI.sub(CI)).add(AI))}).ElseIf(t.greaterThanEqual(bI),()=>{n.assign(CI.sub(t).mul(xI.sub(_I)).div(CI.sub(bI)).add(_I))}).ElseIf(t.greaterThanEqual(FI),()=>{n.assign(bI.sub(t).mul(wI.sub(xI)).div(bI.sub(FI)).add(xI))}).Else(()=>{n.assign(Xw(-2).mul(HT(uT(1.16,t))))}),n}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),NI=Vw(e=>{let[t,n]=e;const r=t.toVar();r.assign(uT(2,r).sub(1));const i=tS(r,1).toVar();return jw(n.equal(0),()=>{i.assign(i.zyx)}).ElseIf(n.equal(1),()=>{i.assign(i.xzy),i.xz.mulAssign(-1)}).ElseIf(n.equal(2),()=>{i.x.mulAssign(-1)}).ElseIf(n.equal(3),()=>{i.assign(i.zyx),i.xz.mulAssign(-1)}).ElseIf(n.equal(4),()=>{i.assign(i.xzy),i.xy.mulAssign(-1)}).ElseIf(n.equal(5),()=>{i.z.mulAssign(-1)}),i}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),RI=Vw(e=>{let[t,n,r,i,a,o]=e;const s=Xw(r),u=tS(n),l=BM(PI(s),yI,o),c=YT(l),h=qT(l),d=tS(LI(t,u,h,i,a,o)).toVar();return jw(c.notEqual(0),()=>{const e=tS(LI(t,u,h.add(1),i,a,o)).toVar();d.assign(MM(d,e,c))}),d}),LI=Vw(e=>{let[t,n,r,i,a,o]=e;const s=Xw(r).toVar(),u=tS(n),l=Xw(MI(u)).toVar(),c=Xw(gM(SI.sub(s),0)).toVar();s.assign(gM(s,SI));const h=Xw(VT(s)).toVar(),d=$w(BI(u,l).mul(h.sub(2)).add(1)).toVar();return jw(l.greaterThan(2),()=>{d.y.addAssign(h),l.subAssign(3)}),d.x.addAssign(l.mul(h)),d.x.addAssign(c.mul(uT(3,TI))),d.y.addAssign(uT(4,VT(o).sub(h))),d.x.mulAssign(i),d.y.mulAssign(a),t.sample(d).grad($w(),$w())}),II=Vw(e=>{let{envMap:t,mipInt:n,outputDirection:r,theta:i,axis:a,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:s,CUBEUV_MAX_MIP:u}=e;const l=$T(i),c=r.mul(l).add(a.cross(r).mul(JT(i))).add(a.mul(a.dot(r).mul(l.oneMinus())));return LI(t,c,n,o,s,u)}),kI=Vw(e=>{let{n:t,latitudinal:n,poleAxis:r,outputDirection:i,weights:a,samples:o,dTheta:s,mipInt:u,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}=e;const p=tS(VM(n,r,CM(r,i))).toVar();jw(p.equal(tS(0)),()=>{p.assign(tS(i.z,0,i.x.negate()))}),p.assign(KT(p));const f=tS().toVar();return f.addAssign(a.element(0).mul(II({theta:0,axis:p,outputDirection:i,mipInt:u,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}))),pR({start:Kw(1),end:t},e=>{let{i:t}=e;jw(t.greaterThanEqual(o),()=>{fR()});const n=Xw(s.mul(Xw(t))).toVar();f.addAssign(a.element(t).mul(II({theta:n.mul(-1),axis:p,outputDirection:i,mipInt:u,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}))),f.addAssign(a.element(t).mul(II({theta:n,axis:p,outputDirection:i,mipInt:u,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d})))}),aS(f,1)}),OI=[.125,.215,.35,.446,.526,.582],UI=20,zI=new Ih(-1,1,1,-1,0,1),VI=new mc(90,1),GI=new Al;let HI=null,jI=0,WI=0;const qI=(1+Math.sqrt(5))/2,XI=1/qI,KI=[new ws(-qI,XI,0),new ws(qI,XI,0),new ws(-XI,0,qI),new ws(XI,0,qI),new ws(0,qI,-XI),new ws(0,qI,XI),new ws(-1,1,-1),new ws(1,1,-1),new ws(-1,1,1),new ws(1,1,1)],YI=new ws,JI=new WeakMap,$I=[3,1,5,0,4,2],QI=NI(kB(),IB("faceIndex")).normalize(),ZI=tS(QI.x,QI.y,QI.z);class ek{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:a=256,position:o=YI,renderTarget:s=null}=i;if(this._setSize(a),!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const a=s||this._allocateTarget();return i.renderTarget=a,this.fromSceneAsync(e,t,n,r,i),a}HI=this._renderer.getRenderTarget(),jI=this._renderer.getActiveCubeFace(),WI=this._renderer.getActiveMipmapLevel();const u=s||this._allocateTarget();return u.depthBuffer=!0,this._init(u),this._sceneToCubeUV(e,n,r,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return!1===this._hasInitialized&&await this._renderer.init(),this.fromScene(e,t,n,r,i)}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=ik(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=ak(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===wa||e.mapping===Sa?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(HI,jI,WI),e.scissorTest=!1,nk(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),HI=this._renderer.getRenderTarget(),jI=this._renderer.getActiveCubeFace(),WI=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){return tk(3*Math.max(this._cubeSize,112),4*this._cubeSize)}_init(e){if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=tk(e.width,e.height);const{_lodMax:t}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=function(e){const t=[],n=[],r=[],i=[];let a=e;const o=e-4+1+OI.length;for(let s=0;s<o;s++){const o=Math.pow(2,a);n.push(o);let u=1/o;s>e-4?u=OI[s-e+4-1]:0===s&&(u=0),r.push(u);const l=1/(o-2),c=-l,h=1+l,d=[c,c,h,c,h,h,c,c,h,h,c,h],p=6,f=6,m=3,g=2,v=1,D=new Float32Array(m*f*p),y=new Float32Array(g*f*p),E=new Float32Array(v*f*p);for(let e=0;e<p;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0],i=$I[e];D.set(r,m*f*i),y.set(d,g*f*i);const a=[i,i,i,i,i,i];E.set(a,v*f*i)}const A=new Wl;A.setAttribute("position",new Nl(D,m)),A.setAttribute("uv",new Nl(y,g)),A.setAttribute("faceIndex",new Nl(E,v)),t.push(A),i.push(new rc(A,null)),a>4&&a--}return{lodPlanes:t,sizeLods:n,sigmas:r,lodMeshes:i}}(t)),this._blurMaterial=function(e,t,n){const r=$B(new Array(UI).fill(0)),i=$S(new ws(0,1,0)),a=$S(0),o=Xw(UI),u=$S(0),l=$S(1),c=WB(null),h=$S(0),d=Xw(1/t),p=Xw(1/n),f=Xw(e),m={n:o,latitudinal:u,weights:r,poleAxis:i,outputDirection:ZI,dTheta:a,samples:l,envMap:c,mipInt:h,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f},g=rk("blur");return g.fragmentNode=kI(s(s({},m),{},{latitudinal:u.equal(1)})),JI.set(g,m),g}(t,e.width,e.height)}}async _compileMaterial(e){const t=new rc(this._lodPlanes[0],e);await this._renderer.compile(t,zI)}_sceneToCubeUV(e,t,n,r,i){const a=VI;a.near=t,a.far=n;const o=[1,1,1,1,-1,1],s=[1,-1,1,-1,1,-1],u=this._renderer,l=u.autoClear;u.getClearColor(GI),u.autoClear=!1;let c=this._backgroundBox;if(null===c){const e=new xl({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1});c=new rc(new ac,e)}let h=!1;const d=e.background;d?d.isColor&&(c.material.color.copy(d),e.background=null,h=!0):(c.material.color.copy(GI),h=!0),u.setRenderTarget(r),u.clear(),h&&u.render(c,a);for(let p=0;p<6;p++){const t=p%3;0===t?(a.up.set(0,o[p],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+s[p],i.y,i.z)):1===t?(a.up.set(0,0,o[p]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+s[p],i.z)):(a.up.set(0,o[p],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+s[p]));const n=this._cubeSize;nk(r,t*n,p>2?n:0,n,n),u.render(e,a)}u.autoClear=l,e.background=d}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===wa||e.mapping===Sa;r?null===this._cubemapMaterial&&(this._cubemapMaterial=ik(e)):null===this._equirectMaterial&&(this._equirectMaterial=ak(e));const i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=i;const o=this._cubeSize;nk(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,zI)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let i=1;i<r;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=KI[(r-i-1)%KI.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const l=this._lodMeshes[r];l.material=u;const c=JI.get(u),h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):UI;f>UI&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat(UI));const m=[];let g=0;for(let y=0;y<UI;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.samples.value=f,c.weights.array=m,c.latitudinal.value="latitudinal"===a?1:0,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const D=this._sizeLods[r];nk(t,3*D*(r>v-4?r-v+4:0),4*(this._cubeSize-D),3*D,2*D),s.setRenderTarget(t),s.render(l,zI)}}function tk(e,t){const n=new Qs(e,t,{magFilter:Oa,minFilter:Oa,generateMipmaps:!1,type:Ka,format:to,colorSpace:Jo});return n.texture.mapping=Ba,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function nk(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function rk(e){const t=new QR;return t.depthTest=!1,t.depthWrite=!1,t.blending=0,t.name="PMREM_".concat(e),t}function ik(e){const t=rk("cubemap");return t.fragmentNode=XP(e,ZI),t}function ak(e){const t=rk("equirect");return t.fragmentNode=WB(e,sL(ZI),0),t}const ok=new WeakMap;function sk(e,t,n){const r=function(e){let t=ok.get(e);void 0===t&&(t=new WeakMap,ok.set(e,t));return t}(t);let i=r.get(e);if((void 0!==i?i.pmremVersion:-1)!==e.pmremVersion){const t=e.image;if(e.isCubeTexture){if(!function(e){if(null===e||void 0===e)return!1;let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(t))return null;i=n.fromCubemap(e,i)}else{if(!function(e){return null!==e&&void 0!==e&&e.height>0}(t))return null;i=n.fromEquirectangular(e,i)}i.pmremVersion=e.pmremVersion,r.set(e,i)}return i.texture}class uk extends JF{static get type(){return"PMREMNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new Js;r.isRenderTargetTexture=!0,this._texture=WB(r),this._width=$S(0),this._height=$S(0),this._maxMip=$S(0),this.updateBeforeType=UF.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=function(e){const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(t=!0===r.isPMREMTexture?r:sk(r,e.renderer,this._generator),null!==t&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){null===this._generator&&(this._generator=new ek(e.renderer)),this.updateBefore(e);let t=this.uvNode;null===t&&e.context.getUV&&(t=e.context.getUV(this)),t=UP.mul(tS(t.x,t.y.negate(),t.z));let n=this.levelNode;return null===n&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),RI(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),null!==this._generator&&this._generator.dispose()}}const lk=Ow(uk).setParameterLength(1,3),ck=new WeakMap;class hk extends ER{static get type(){return"EnvironmentNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const e=n.isTextureNode?n.value:t[n.property];let r=ck.get(e);void 0===r&&(r=lk(e),ck.set(e,r)),n=r}const r=!0===t.useAnisotropy||t.anisotropy>0?oN:MP,i=n.context(dk(yS,r)).mul(OP),a=n.context(pk(BP)).mul(Math.PI).mul(OP),o=AB(i),s=AB(a);e.context.radiance.addAssign(o),e.context.iblIrradiance.addAssign(s);const u=e.context.lightingModel.clearcoatRadiance;if(u){const e=n.context(dk(CS,PP)).mul(OP),t=AB(e);u.addAssign(t)}}}const dk=(e,t)=>{let n=null;return{getUV:()=>(null===n&&(n=AP.negate().reflect(t),n=e.mul(e).mix(n,t).normalize(),n=n.transformDirection(rP)),n),getTextureLevel:()=>e}},pk=e=>({getUV:()=>e,getTextureLevel:()=>Xw(1)}),fk=new Kc;class mk extends QR{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(fk),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return null===t&&e.environmentNode&&(t=e.environmentNode),t?new hk(t):null}setupLightingModel(){return new vI}setupSpecular(){const e=MM(tS(.04),vS.rgb,ES);PS.assign(e),NS.assign(1)}setupVariants(){const e=this.metalnessNode?Xw(this.metalnessNode):wN;ES.assign(e);let t=this.roughnessNode?Xw(this.roughnessNode):FN;t=ML({roughness:t}),yS.assign(t),this.setupSpecular(),vS.assign(aS(vS.rgb.mul(e.oneMinus()),vS.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const gk=new Yc;class vk extends mk{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(gk),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){const e=this.iorNode?Xw(this.iorNode):VN;OS.assign(e),PS.assign(MM(mM(bM(OS.sub(1).div(OS.add(1))).mul(_N),tS(1)).mul(CN),vS.rgb,ES)),NS.assign(MM(CN,1,ES))}setupLightingModel(){return new vI(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const e=this.clearcoatNode?Xw(this.clearcoatNode):TN,t=this.clearcoatRoughnessNode?Xw(this.clearcoatRoughnessNode):MN;AS.assign(e),CS.assign(ML({roughness:t}))}if(this.useSheen){const e=this.sheenNode?tS(this.sheenNode):NN,t=this.sheenRoughnessNode?Xw(this.sheenRoughnessNode):RN;_S.assign(e),bS.assign(t)}if(this.useIridescence){const e=this.iridescenceNode?Xw(this.iridescenceNode):IN,t=this.iridescenceIORNode?Xw(this.iridescenceIORNode):kN,n=this.iridescenceThicknessNode?Xw(this.iridescenceThicknessNode):ON;xS.assign(e),FS.assign(t),wS.assign(n)}if(this.useAnisotropy){const e=(this.anisotropyNode?$w(this.anisotropyNode):LN).toVar();TS.assign(e.length()),jw(TS.equal(0),()=>{e.assign($w(1,0))}).Else(()=>{e.divAssign($w(TS)),TS.assign(TS.saturate())}),SS.assign(TS.pow2().mix(yS.pow2(),1)),MS.assign(aN[0].mul(e.x).add(aN[1].mul(e.y))),BS.assign(aN[1].mul(e.x).sub(aN[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?Xw(this.transmissionNode):UN,t=this.thicknessNode?Xw(this.thicknessNode):zN,n=this.attenuationDistanceNode?Xw(this.attenuationDistanceNode):GN,r=this.attenuationColorNode?tS(this.attenuationColorNode):HN;if(US.assign(e),zS.assign(t),VS.assign(n),GS.assign(r),this.useDispersion){const e=this.dispersionNode?Xw(this.dispersionNode):YN;HS.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?tS(this.clearcoatNormalNode):BN}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const Dk=Vw(e=>{let{normal:t,lightDirection:n,builder:r}=e;const i=t.dot(n),a=$w(i.mul(.5).add(.5),0);if(r.material.gradientMap){const e=ZP("gradientMap","texture").context({getUV:()=>a});return tS(e.r)}{const e=a.fwidth().mul(.5);return MM(tS(.7),tS(1),RM(Xw(.7).sub(e.x),Xw(.7).add(e.x),a.x))}});class yk extends gL{direct(e,t){let{lightDirection:n,lightColor:r,reflectedLight:i}=e;const a=Dk({normal:xP,lightDirection:n,builder:t}).mul(r);i.directDiffuse.addAssign(a.mul(AL({diffuseColor:vS.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(AL({diffuseColor:vS}))),r.indirectDiffuse.mulAssign(t)}}const Ek=new $c;class Ak extends QR{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Ek),this.setValues(e)}setupLightingModel(){return new yk}}class Ck extends JF{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=tS(AP.z,0,AP.x.negate()).normalize(),t=AP.cross(e);return $w(e.dot(MP),t.dot(MP)).mul(.495).add(.5)}}const _k=Uw(Ck),bk=new nh;class xk extends QR{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(bk),this.setValues(e)}setupVariants(e){const t=_k;let n;n=e.material.matcap?ZP("matcap","texture").context({getUV:()=>t}):tS(MM(.2,.8,t.y)),vS.rgb.mulAssign(n.rgb)}}class Fk extends JF{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if("vec2"===this.getNodeType(e)){const e=t.cos(),r=t.sin();return lS(e,r,r.negate(),e).mul(n)}{const e=t,r=hS(aS(1,0,0,0),aS(0,$T(e.x),JT(e.x).negate(),0),aS(0,JT(e.x),$T(e.x),0),aS(0,0,0,1)),i=hS(aS($T(e.y),0,JT(e.y),0),aS(0,1,0,0),aS(JT(e.y).negate(),0,$T(e.y),0),aS(0,0,0,1)),a=hS(aS($T(e.z),JT(e.z).negate(),0,0),aS(JT(e.z),$T(e.z),0,0),aS(0,0,1,0),aS(0,0,0,1));return r.mul(i).mul(a).mul(aS(n,1)).xyz}}}const wk=Ow(Fk).setParameterLength(2),Sk=new wc;class Tk extends QR{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Sk),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,r=this.sizeAttenuation,{positionNode:i,rotationNode:a,scaleNode:o}=this,s=hP.mul(tS(i||0));let u=$w(lP[0].xyz.length(),lP[1].xyz.length());if(null!==o&&(u=u.mul($w(o))),!1===r)if(n.isPerspectiveCamera)u=u.mul(s.z.negate());else{const e=Xw(2).div(nP.element(1).element(1));u=u.mul(e.mul(2))}let l=mP.xy;if(t.center&&!0===t.center.isVector2){const e=((e,t,n)=>Lw(new sB(e,t,n)))("center","vec2",t);l=l.sub(e.sub(.5))}l=l.mul(u);const c=Xw(a||PN),h=wk(l,c);return aS(s.xy.add(h),s.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Mk=new Vc;class Bk extends Tk{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Mk),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return hP.mul(tS(e||gP)).xyz}setupVertex(e){const t=super.setupVertex(e);if(!0!==e.material.isNodeMaterial)return t;const{rotationNode:n,scaleNode:r,sizeNode:i}=this,a=mP.xy.toVar(),o=BR.z.div(BR.w);if(n&&n.isNode){const e=Xw(n);a.assign(wk(a,e))}let s=null!==i?$w(i):KN;return!0===this.sizeAttenuation&&(s=s.mul(s.div(EP.z.negate()))),r&&r.isNode&&(s=s.mul($w(r))),a.mulAssign(s.mul(2)),a.assign(a.div(BR.z)),a.y.assign(a.y.mul(o)),a.assign(a.mul(t.w)),t.addAssign(aS(a,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class Pk extends gL{constructor(){super(),this.shadowNode=Xw(1).toVar("shadowMask")}direct(e){let{lightNode:t}=e;null!==t.shadowNode&&this.shadowNode.mulAssign(t.shadowNode)}finish(e){let{context:t}=e;vS.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(vS.rgb)}}const Nk=new Xc;class Rk extends QR{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Nk),this.setValues(e)}setupLightingModel(){return new Pk}}mS("vec3"),mS("vec3"),mS("vec3");class Lk{constructor(e,t){this.nodes=e,this.info=t,this._context="undefined"!==typeof self?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,null!==this._animationLoop&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Ik{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let r=0;r<e.length-1;r++){const t=e[r];!1===n.has(t)&&n.set(t,new WeakMap),n=n.get(t)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return!1;return t.delete(e[e.length-1])}}let kk=0;class Ok{constructor(e,t,n,r,i,a,o,s,u,l){this.id=kk++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=i,this.scene=a,this.camera=o,this.lightsNode=s,this.context=u,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=l,this.clippingContextCacheKey=null!==l?l.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(null!==this.attributes)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set;for(const i of e){const e=i.node&&i.node.attribute?i.node.attribute:t.getAttribute(i.name);if(void 0===e)continue;n.push(e);const a=e.isInterleavedBufferAttribute?e.data:e;r.add(a)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:i}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),s=null!==o;let u=1;if(!0===n.isInstancedBufferGeometry?u=n.instanceCount:void 0!==e.count&&(u=Math.max(0,e.count)),0===u)return null;if(a.instanceCount=u,!0===e.isBatchedMesh)return a;let l=1;!0!==t.wireframe||e.isPoints||e.isLineSegments||e.isLine||e.isLineLoop||(l=2);let c=i.start*l,h=(i.start+i.count)*l;null!==r&&(c=Math.max(c,r.start*l),h=Math.min(h,(r.start+r.count)*l));const d=n.attributes.position;let p=1/0;s?p=o.count:void 0!==d&&null!==d&&(p=d.count),c=Math.max(c,0),h=Math.min(h,p);const f=h-c;return f<0||f===1/0?null:(a.vertexCount=f,a.firstVertex=c,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let e=0,n=r.length;e<n;e++){t+=r[e].id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const r of function(e){const t=Object.keys(e);let n=Object.getPrototypeOf(e);for(;n;){const e=Object.getOwnPropertyDescriptors(n);for(const n in e)if(void 0!==e[n]){const r=e[n];r&&"function"===typeof r.get&&t.push(n)}n=Object.getPrototypeOf(n)}return t}(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const e=t[r];let i;if(null!==e){const t=typeof e;"number"===t?i=0!==e?"1":"0":"object"===t?(i="{",e.isTexture&&(i+=e.mapping),i+="}"):i=String(e)}else i=String(e);n+=i+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",null!==e._colorsTexture&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",xF(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return!0!==this.material.isShadowPassMaterial&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=wF(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=wF(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Uk=[];class zk{constructor(e,t,n,r,i,a){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=i,this.info=a,this.chainMaps={}}get(e,t,n,r,i,a,o,s){const u=this.getChainMap(s);Uk[0]=e,Uk[1]=t,Uk[2]=a,Uk[3]=i;let l=u.get(Uk);return void 0===l?(l=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,i,a,o,s),u.set(Uk,l)):(l.updateClipping(o),l.needsGeometryUpdate&&l.setGeometry(e.geometry),(l.version!==t.version||l.needsUpdate)&&(l.initialCacheKey!==l.getCacheKey()?(l.dispose(),l=this.get(e,t,n,r,i,a,o,s)):l.version=t.version)),Uk.length=0,l}getChainMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this.chainMaps[e]||(this.chainMaps[e]=new Ik)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,i,a,o,s,u,l,c){const h=this.getChainMap(c),d=new Ok(e,t,n,r,i,a,o,s,u,l);return d.onDispose=()=>{this.pipelines.delete(d),this.bindings.delete(d),this.nodes.delete(d),h.delete(d.getChainArray())},d}}class Vk{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Gk=1,Hk=2,jk=3,Wk=4,qk=16;class Xk extends Vk{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return null!==t&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(void 0===n.version)t===Gk?this.backend.createAttribute(e):t===Hk?this.backend.createIndexAttribute(e):t===jk?this.backend.createStorageAttribute(e):t===Wk&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const t=this._getBufferAttribute(e);(n.version<t.version||t.usage===ls)&&(this.backend.updateAttribute(e),n.version=t.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Kk(e){return null!==e.index?e.index.version:e.attributes.position.version}function Yk(e){const t=[],n=e.index,r=e.attributes.position;if(null!==n){const e=n.array;for(let n=0,r=e.length;n<r;n+=3){const r=e[n+0],i=e[n+1],a=e[n+2];t.push(r,i,i,a,a,r)}}else{for(let e=0,n=r.array.length/3-1;e<n;e+=3){const n=e+0,r=e+1,i=e+2;t.push(n,r,r,i,i,n)}}const i=new(Ps(t)?Ll:Rl)(t,1);return i.version=Kk(e),i}class Jk extends Vk{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&!0===this.get(t).initialized}updateForRender(e){!1===this.has(e)&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry;this.get(t).initialized=!0,this.info.memory.geometries++;const n=()=>{this.info.memory.geometries--;const r=t.index,i=e.getAttributes();null!==r&&this.attributes.delete(r);for(const e of i)this.attributes.delete(e);const a=this.wireframes.get(t);void 0!==a&&this.attributes.delete(a),t.removeEventListener("dispose",n)};t.addEventListener("dispose",n)}updateAttributes(e){const t=e.getAttributes();for(const i of t)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,jk):this.updateAttribute(i,Gk);const n=this.getIndex(e);null!==n&&this.updateAttribute(n,Hk);const r=e.geometry.indirect;null!==r&&this.updateAttribute(r,Wk)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?void 0===this.attributeCall.get(e)?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(!0===n.wireframe){const e=this.wireframes;let n=e.get(t);void 0===n?(n=Yk(t),e.set(t,n)):n.version!==Kk(t)&&(this.attributes.delete(n),n=Yk(t),e.set(t,n)),r=n}return r}}class $k{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class Qk{constructor(e){this.cacheKey=e,this.usedTimes=0}}class Zk extends Qk{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class eO extends Qk{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let tO=0;class nO{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.id=tO++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=i,this.usedTimes=0}}class rO extends Vk{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let o=this.programs.compute.get(a.computeShader);void 0===o&&(i&&0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram),o=new nO(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),n.createProgram(o));const s=this._getComputeCacheKey(e,o);let u=this.caches.get(s);void 0===u&&(i&&0===i.usedTimes&&this._releasePipeline(i),u=this._getComputePipeline(e,o,s,t)),u.usedTimes++,o.usedTimes++,r.version=e.version,r.pipeline=u}return r.pipeline}getForRender(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),o=e.material?e.material.name:"";let s=this.programs.vertex.get(a.vertexShader);void 0===s&&(i&&0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),s=new nO(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,s),n.createProgram(s));let u=this.programs.fragment.get(a.fragmentShader);void 0===u&&(i&&0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram),u=new nO(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,u),n.createProgram(u));const l=this._getRenderCacheKey(e,s,u);let c=this.caches.get(l);void 0===c?(i&&0===i.usedTimes&&this._releasePipeline(i),c=this._getRenderPipeline(e,s,u,l,t)):e.pipeline=c,c.usedTimes++,s.usedTimes++,u.usedTimes++,r.pipeline=c}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,0===t.usedTimes&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,0===t.computeProgram.usedTimes&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,0===t.vertexProgram.usedTimes&&this._releaseProgram(t.vertexProgram),0===t.fragmentProgram.usedTimes&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let i=this.caches.get(n);return void 0===i&&(i=new eO(n,t),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(e,t,n,r,i){r=r||this._getRenderCacheKey(e,t,n);let a=this.caches.get(r);return void 0===a&&(a=new Zk(r,t,n),this.caches.set(r,a),e.pipeline=a,this.backend.createRenderPipeline(e,i)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return void 0===t.pipeline||t.version!==e.version}_needsRenderUpdate(e){return void 0===this.get(e).pipeline||this.backend.needsRenderUpdate(e)}}class iO extends Vk{constructor(e,t,n,r,i,a){super(),this.backend=e,this.textures=n,this.pipelines=i,this.attributes=r,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const e=this.get(n);void 0===e.bindGroup&&(this._init(n),this.backend.createBindings(n,t,0),e.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const e=this.get(n);void 0===e.bindGroup&&(this._init(n),this.backend.createBindings(n,t,0),e.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const e=t.attribute,n=e.isIndirectStorageBufferAttribute?Wk:jk;this.attributes.update(e,n)}}_update(e,t){const{backend:n}=this;let r=!1,i=!0,a=0,o=0;for(const s of e.bindings){if(s.isNodeUniformsGroup){if(!1===this.nodes.updateGroup(s))continue}if(s.isStorageBuffer){const e=s.attribute,t=e.isIndirectStorageBufferAttribute?Wk:jk;this.attributes.update(e,t)}if(s.isUniformBuffer){s.update()&&n.updateBinding(s)}else if(s.isSampler)s.update();else if(s.isSampledTexture){const e=this.textures.get(s.texture);s.needsBindingsUpdate(e.generation)&&(r=!0);const t=s.update(),u=s.texture;t&&this.textures.updateTexture(u);const l=n.get(u);if(void 0!==l.externalTexture||e.isDefaultTexture?i=!1:(a=10*a+u.id,o+=u.version),!0===n.isWebGPUBackend&&void 0===l.texture&&void 0===l.externalTexture&&(console.error("Bindings._update: binding should be available:",s,t,u,s.textureNode.value,r),this.textures.updateTexture(u),r=!0),!0===u.isStorageTexture){const e=this.get(u);!0===s.store?e.needsMipmap=!0:this.textures.needsMipmaps(u)&&!0===e.needsMipmap&&(this.backend.generateMipmaps(u),e.needsMipmap=!1)}}}!0===r&&this.backend.updateBindings(e,t,i?a:0,o)}}function aO(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?e.z-t.z:e.id-t.id}function oO(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function sO(e){return(e.transmission>0||e.transmissionNode)&&2===e.side&&!1===e.forceSinglePass}class uO{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,i,a,o){let s=this.renderItems[this.renderItemsIndex];return void 0===s?(s={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:i,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=s):(s.id=e.id,s.object=e,s.geometry=t,s.material=n,s.groupOrder=r,s.renderOrder=e.renderOrder,s.z=i,s.group=a,s.clippingContext=o),this.renderItemsIndex++,s}push(e,t,n,r,i,a,o){const s=this.getNextRenderItem(e,t,n,r,i,a,o);!0===e.occlusionTest&&this.occlusionQueryCount++,!0===n.transparent||n.transmission>0?(sO(n)&&this.transparentDoublePass.push(s),this.transparent.push(s)):this.opaque.push(s)}unshift(e,t,n,r,i,a,o){const s=this.getNextRenderItem(e,t,n,r,i,a,o);!0===n.transparent||n.transmission>0?(sO(n)&&this.transparentDoublePass.unshift(s),this.transparent.unshift(s)):this.opaque.unshift(s)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||aO),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||oO),this.transparent.length>1&&this.transparent.sort(t||oO)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const t=this.renderItems[e];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.groupOrder=null,t.renderOrder=null,t.z=null,t.group=null,t.clippingContext=null}}}const lO=[];class cO{constructor(e){this.lighting=e,this.lists=new Ik}get(e,t){const n=this.lists;lO[0]=e,lO[1]=t;let r=n.get(lO);return void 0===r&&(r=new uO(this.lighting,e,t),n.set(lO,r)),lO.length=0,r}dispose(){this.lists=new Ik}}let hO=0;class dO{constructor(){this.id=hO++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new $s,this.scissor=!1,this.scissorValue=new $s,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return pO(this)}}function pO(e){const{textures:t,activeCubeFace:n}=e,r=[n];for(const i of t)r.push(i.id);return FF(r)}const fO=[],mO=new _c,gO=new hc;class vO{constructor(){this.chainMaps={}}get(e,t){let n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(fO[0]=e,fO[1]=t,null===r)n="default";else{const e=r.texture.format,t=r.textures.length;n="".concat(t,":").concat(e,":").concat(r.samples,":").concat(r.depthBuffer,":").concat(r.stencilBuffer)}const i=this._getChainMap(n);let a=i.get(fO);return void 0===a&&(a=new dO,i.set(fO,a)),fO.length=0,null!==r&&(a.sampleCount=0===r.samples?1:r.samples),a}getForClear(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.get(mO,gO,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ik)}dispose(){this.chainMaps={}}}const DO=new ws;class yO extends Vk{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.get(e),r=0===e.samples?1:e.samples,i=n.depthTextureMips||(n.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),s=o.width>>t,u=o.height>>t;let l=e.depthTexture||i[t];const c=!0===e.depthBuffer||!0===e.stencilBuffer;let h=!1;void 0===l&&c&&(l=new Hc,l.format=e.stencilBuffer?ro:no,l.type=e.stencilBuffer?$a:qa,l.image.width=s,l.image.height=u,l.image.depth=o.depth,l.isArrayTexture=!0===e.multiview&&o.depth>1,i[t]=l),n.width===o.width&&o.height===n.height||(h=!0,l&&(l.needsUpdate=!0,l.image.width=s,l.image.height=u,l.image.depth=l.isArrayTexture?l.image.depth:1)),n.width=o.width,n.height=o.height,n.textures=a,n.depthTexture=l||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(h=!0,l&&(l.needsUpdate=!0),n.sampleCount=r);const d={sampleCount:r};if(!0!==e.isXRRenderTarget){for(let e=0;e<a.length;e++){const t=a[e];h&&(t.needsUpdate=!0),this.updateTexture(t,d)}l&&this.updateTexture(l,d)}if(!0!==n.initialized){n.initialized=!0;const t=()=>{e.removeEventListener("dispose",t);for(let e=0;e<a.length;e++)this._destroyTexture(a[e]);l&&this._destroyTexture(l),this.delete(e)};e.addEventListener("dispose",t)}}updateTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.get(e);if(!0===n.initialized&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(r&&!0===n.initialized&&(i.destroySampler(e),i.destroyTexture(e)),e.isFramebufferTexture){const t=this.renderer.getRenderTarget();e.type=t?t.texture.type:Va}const{width:a,height:o,depth:s}=this.getSize(e);if(t.width=a,t.height=o,t.depth=s,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,r||!0===e.isStorageTexture)i.createSampler(e),i.createTexture(e,t),n.generation=e.version;else{if(!0!==n.initialized&&i.createSampler(e),e.version>0){const r=e.image;if(void 0===r)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(!1===r.complete)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const n=[];for(const t of e.images)n.push(t);t.images=n}else t.image=r;void 0!==n.isDefaultTexture&&!0!==n.isDefaultTexture||(i.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),!0===e.source.dataReady&&i.updateTexture(e,t),t.needsMipmaps&&0===e.mipmaps.length&&i.generateMipmaps(e)}}else i.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version}if(!0!==n.initialized){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const t=()=>{e.removeEventListener("dispose",t),this._destroyTexture(e)};e.addEventListener("dispose",t)}n.version=e.version}getSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DO,n=e.images?e.images[0]:e.image;return n?(void 0!==n.image&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return r=e.isCompressedTexture?e.mipmaps?e.mipmaps.length:1:Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return!0===e.isCompressedTexture||e.generateMipmaps}_destroyTexture(e){!0===this.has(e)&&(this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e),this.info.memory.textures--)}}class EO extends Al{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.a=r}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.a=r,super.set(e,t,n)}copy(e){return void 0!==e.a&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class AO extends fS{static get type(){return"ParameterNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class CO extends XF{static get type(){return"StackNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new Rw(t);return this._currentCond=VM(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new Rw(t),r=VM(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new Rw(e),this}Switch(e){return this._expressionNode=Lw(e),this}Case(){var e;const t=[];if(!(arguments.length>=2))throw new Error("TSL: Invalid parameter length. Case() requires at least two parameters.");for(let a=0;a<arguments.length-1;a++)t.push(this._expressionNode.equal(Lw(a<0||arguments.length<=a?void 0:arguments[a])));const n=new Rw((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e]);let r=t[0];for(let a=1;a<t.length;a++)r=r.or(t[a]);const i=VM(r,n);return null===this._currentCond?(this._currentCond=i,this.add(this._currentCond)):(this._currentCond.elseNode=i,this._currentCond=i,this)}Default(e){return this.Else(e),this}build(e){const t=Hw();Gw(this);const n=e.buildStage;for(const o of this.nodes)if("setup"===n)o.build(e);else if("analyze"===n)o.build(e,this);else if("generate"===n){const t=e.getDataFromNode(o,"any").stages,n=t&&t[e.shaderStage];if(o.isVarNode&&n&&1===n.length&&n[0]&&n[0].isStackNode)continue;o.build(e,"void")}Gw(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}else(){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...arguments)}elseif(){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...arguments)}}const _O=Ow(CO).setParameterLength(0,1);new Nc,new ws,new ws,new ws,new Tu,new ws(0,0,-1),new $s,new ws,new ws,new $s,new xs;const bO=new Qs;SR.flipX();bO.depthTexture=new Hc(1,1);const xO=new Ih(-1,1,1,-1,0,1);class FO extends Wl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super();const t=!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new kl([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new kl(t,2))}}const wO=new FO;class SO extends rc{constructor(){super(wO,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.camera=xO,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,xO)}render(e){e.render(this,xO)}}const TO=new Uu,MO=new Tu;class BO extends XF{static get type(){return"SceneNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BO.BACKGROUND_BLURRINESS,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=null!==this.scene?this.scene:e.scene;let r;return t===BO.BACKGROUND_BLURRINESS?r=JP("backgroundBlurriness","float",n):t===BO.BACKGROUND_INTENSITY?r=JP("backgroundIntensity","float",n):t===BO.BACKGROUND_ROTATION?r=$S("mat4").label("backgroundRotation").setGroup(KS).onRenderUpdate(()=>{const e=n.background;return null!==e&&e.isTexture&&e.mapping!==Fa?(TO.copy(n.backgroundRotation),TO.x*=-1,TO.y*=-1,TO.z*=-1,MO.makeRotationFromEuler(TO)):MO.identity(),MO}):console.error("THREE.SceneNode: Unknown scope:",t),r}}BO.BACKGROUND_BLURRINESS="backgroundBlurriness",BO.BACKGROUND_INTENSITY="backgroundIntensity",BO.BACKGROUND_ROTATION="backgroundRotation";const PO=Uw(BO,BO.BACKGROUND_BLURRINESS),NO=Uw(BO,BO.BACKGROUND_INTENSITY),RO=Uw(BO,BO.BACKGROUND_ROTATION);const LO=Vw(e=>{let{texture:t,uv:n}=e;const r=1e-4,i=tS().toVar();return jw(n.x.lessThan(r),()=>{i.assign(tS(1,0,0))}).ElseIf(n.y.lessThan(r),()=>{i.assign(tS(0,1,0))}).ElseIf(n.z.lessThan(r),()=>{i.assign(tS(0,0,1))}).ElseIf(n.x.greaterThan(.9999),()=>{i.assign(tS(-1,0,0))}).ElseIf(n.y.greaterThan(.9999),()=>{i.assign(tS(0,-1,0))}).ElseIf(n.z.greaterThan(.9999),()=>{i.assign(tS(0,0,-1))}).Else(()=>{const e=.01,r=t.sample(n.add(tS(-.01,0,0))).r.sub(t.sample(n.add(tS(e,0,0))).r),a=t.sample(n.add(tS(0,-.01,0))).r.sub(t.sample(n.add(tS(0,e,0))).r),o=t.sample(n.add(tS(0,0,-.01))).r.sub(t.sample(n.add(tS(0,0,e))).r);i.assign(tS(r,a,o))}),i.normalize()});class IO extends HB{static get type(){return"Texture3DNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return tS(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return!e.isFlipY()||!0!==n.isRenderTargetTexture&&!0!==n.isFramebufferTexture||(t=this.sampler?t.flipY():t.setY(Kw(UB(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return LO({texture:this,uv:e})}}const kO=Ow(IO).setParameterLength(1,3);new WeakMap;const OO=new xs;class UO extends HB{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class zO extends UO{static get type(){return"PassMultipleTextureNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class VO extends JF{static get type(){return"PassNode"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new Hc;i.isRenderTargetTexture=!0,i.name="depth";const a=new Qs(this._width*this._pixelRatio,this._height*this._pixelRatio,s({type:Ka},r));a.texture.name="output",a.depthTexture=i,this.renderTarget=a,this._textures={output:a.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=$S(0),this._cameraFar=$S(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=UF.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];if(void 0===t){t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)}return t}getPreviousTexture(e){let t=this._previousTextures[e];return void 0===t&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(void 0!==t){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"output",t=this._textureNodes[e];return void 0===t&&(t=Lw(new zO(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"output",t=this._previousTextureNodes[e];return void 0===t&&(void 0===this._textureNodes[e]&&this.getTextureNode(e),t=Lw(new zO(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"depth",t=this._viewZNodes[e];if(void 0===t){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=VR(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"depth",t=this._linearDepthNodes[e];if(void 0===t){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=UR(i,n,r)}return t}setup(e){let{renderer:t}=e;return this.renderTarget.samples=void 0===this.options.samples?t.samples:this.options.samples,!0===t.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.renderTarget.texture.type=t.getColorBufferType(),this.scope===VO.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,i;const a=t.getOutputRenderTarget();a&&!0===a.isXRRenderTarget?(i=1,r=t.xr.getCamera(),t.xr.updateCamera(r),OO.set(a.width,a.height)):(r=this.camera,i=t.getPixelRatio(),t.getSize(OO)),this._pixelRatio=i,this.setSize(OO.width,OO.height);const o=t.getRenderTarget(),s=t.getMRT(),u=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,null!==this._layers&&(r.layers.mask=this._layers.mask);for(const l in this._previousTextures)this.toggleTexture(l);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,r),t.setRenderTarget(o),t.setMRT(s),r.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,r=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}VO.COLOR="color",VO.DEPTH="depth";const GO=Vw(e=>{let[t,n]=e;return t.mul(n).clamp()}).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),HO=Vw(e=>{let[t,n]=e;return t=t.mul(n),t.div(t.add(1)).clamp()}).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),jO=Vw(e=>{let[t,n]=e;t=t.mul(n),t=t.sub(.004).max(0);const r=t.mul(t.mul(6.2).add(.5)),i=t.mul(t.mul(6.2).add(1.7)).add(.06);return r.div(i).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),WO=Vw(e=>{let[t]=e;const n=t.mul(t.add(.0245786)).sub(90537e-9),r=t.mul(t.add(.432951).mul(.983729)).add(.238081);return n.div(r)}),qO=Vw(e=>{let[t,n]=e;const r=cS(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=cS(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return t=t.mul(n).div(.6),t=r.mul(t),t=WO(t),t=i.mul(t),t.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),XO=cS(tS(1.6605,-.1246,-.0182),tS(-.5876,1.1329,-.1006),tS(-.0728,-.0083,1.1187)),KO=cS(tS(.6274,.0691,.0164),tS(.3293,.9195,.088),tS(.0433,.0113,.8956)),YO=Vw(e=>{let[t]=e;const n=tS(t).toVar(),r=tS(n.mul(n)).toVar(),i=tS(r.mul(r)).toVar();return Xw(15.5).mul(i.mul(r)).sub(uT(40.14,i.mul(n))).add(uT(31.96,i).sub(uT(6.868,r.mul(n))).add(uT(.4298,r).add(uT(.1191,n).sub(.00232))))}),JO=Vw(e=>{let[t,n]=e;const r=tS(t).toVar(),i=cS(tS(.856627153315983,.137318972929847,.11189821299995),tS(.0951212405381588,.761241990602591,.0767994186031903),tS(.0482516061458583,.101439036467562,.811302368396859)),a=cS(tS(1.1271005818144368,-.1413297634984383,-.14132976349843826),tS(-.11060664309660323,1.157823702216272,-.11060664309660294),tS(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=Xw(-12.47393),s=Xw(4.026069);return r.mulAssign(n),r.assign(KO.mul(r)),r.assign(i.mul(r)),r.assign(gM(r,1e-10)),r.assign(HT(r)),r.assign(r.sub(o).div(s.sub(o))),r.assign(BM(r,0,1)),r.assign(YO(r)),r.assign(a.mul(r)),r.assign(_M(gM(tS(0),r),tS(2.2))),r.assign(XO.mul(r)),r.assign(BM(r,0,1)),r}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),$O=Vw(e=>{let[t,n]=e;const r=Xw(.76),i=Xw(.15);t=t.mul(n);const a=mM(t.r,mM(t.g,t.b)),o=VM(a.lessThan(.08),a.sub(uT(6.25,a.mul(a))),.04);t.subAssign(o);const s=gM(t.r,gM(t.g,t.b));jw(s.lessThan(r),()=>t);const u=sT(1,r),l=sT(1,u.mul(u).div(s.add(u.sub(r))));t.mulAssign(l.div(s));const c=sT(1,lT(1,i.mul(s.sub(l)).add(1)));return MM(t,tS(l),c)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class QO extends XF{static get type(){return"CodeNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class ZO extends QO{static get type(){return"FunctionNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return void 0===n&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,i=n.type,a=e.getCodeFromNode(this,i);""!==r&&(a.name=r);const o=e.getPropertyName(a),s=this.getNodeFunction(e).getCode(o);return a.code=s+"\n","property"===t?o:e.format("".concat(o,"()"),i,t)}}class eU extends Map{get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.has(e))return super.get(e);if(null!==t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const a=t(...r);return this.set(e,a),a}}}new eU;function tU(e){let t;const n=e.context.getViewZ;return void 0!==n&&(t=n(this)),(t||EP.z).negate()}const nU=Vw((e,t)=>{let[n,r]=e;const i=tU(t);return RM(n,r,i)}),rU=Vw((e,t)=>{let[n]=e;const r=tU(t);return n.mul(n,r,r).negate().exp().oneMinus()}),iU=Vw(e=>{let[t,n]=e;return aS(n.toFloat().mix(LS.rgb,t.toVec3()),LS.a)});Ow(class extends XF{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;!0===n.backend.isWebGLBackend?e.addFlowCode("\t// ".concat(t,"Barrier \n")):e.addLineFlowCode("".concat(t,"Barrier()"),this)}});class aU extends XF{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,i=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,s=this.valueNode,u=[];u.push("&".concat(o.build(e,a))),null!==s&&u.push(s.build(e,a));const l="".concat(e.getMethod(r,i),"( ").concat(u.join(", ")," )");if(!(1===n.length&&!0===n[0].isStackNode))return void 0===t.constNode&&(t.constNode=TB(l,i).toConst()),t.constNode.build(e);e.addLineFlowCode(l,this)}}aU.ATOMIC_LOAD="atomicLoad",aU.ATOMIC_STORE="atomicStore",aU.ATOMIC_ADD="atomicAdd",aU.ATOMIC_SUB="atomicSub",aU.ATOMIC_MAX="atomicMax",aU.ATOMIC_MIN="atomicMin",aU.ATOMIC_AND="atomicAnd",aU.ATOMIC_OR="atomicOr",aU.ATOMIC_XOR="atomicXor";Ow(aU);let oU;function sU(e){oU=oU||new WeakMap;let t=oU.get(e);return void 0===t&&oU.set(e,t={}),t}function uU(e){const t=sU(e);return t.shadowMatrix||(t.shadowMatrix=$S("mat4").setGroup(KS).onRenderUpdate(t=>(!0===e.castShadow&&!1!==t.renderer.shadowMap.enabled||e.shadow.updateMatrices(e),e.shadow.matrix)))}function lU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DP;const n=uU(e).mul(t);return n.xyz.div(n.w)}function cU(e){const t=sU(e);return t.position||(t.position=$S(new ws).setGroup(KS).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.matrixWorld)))}function hU(e){const t=sU(e);return t.targetPosition||(t.targetPosition=$S(new ws).setGroup(KS).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.target.matrixWorld)))}function dU(e){const t=sU(e);return t.viewPosition||(t.viewPosition=$S(new ws).setGroup(KS).onRenderUpdate((t,n)=>{let{camera:r}=t;n.value=n.value||new ws,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}))}const pU=e=>rP.transformDirection(cU(e).sub(hU(e))),fU=(e,t)=>{for(const n of t)if(n.isAnalyticLightNode&&n.light.id===e)return n;return null},mU=new WeakMap,gU=[];class vU extends XF{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=tS().toVar(),this.totalSpecularNode=tS().toVar(),this.outgoingLightNode=tS().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const t=e[n];if(gU.push(t.id),gU.push(t.castShadow?1:0),!0===t.isSpotLight){const e=null!==t.map?t.map.id:-1,n=t.colorNode?t.colorNode.getCacheKey():-1;gU.push(e,n)}}const t=FF(gU);return gU.length=0,t}getHash(e){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(e);const t=[];for(const e of this._lightNodes)t.push(e.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=(e=>e.sort((e,t)=>e.id-t.id))(this._lights),i=e.renderer.library;for(const a of r)if(a.isNode)t.push(Lw(a));else{let e=null;if(null!==n&&(e=fU(a.id,n)),null===e){const e=i.getLightNodeClass(a.constructor);if(null===e){console.warn("LightsNode.setupNodeLights: Light node not found for ".concat(a.constructor.name));continue}let n=null;mU.has(a)?n=mU.get(a):(n=Lw(new e(a)),mU.set(a,n)),t.push(n)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.direct(s(s({},n),{},{lightNode:t,reflectedLight:i}),e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.directRectArea(s(s({},n),{},{lightNode:t,reflectedLight:i}),e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return null===this._lightNodes&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,i=r.lightingModel,a=e.getNodeProperties(this);if(i){const{totalDiffuseNode:t,totalSpecularNode:o}=this;r.outgoingLight=n;const s=e.addStack();a.nodes=s.nodes,i.start(e);const{backdrop:u,backdropAlpha:l}=r,{directDiffuse:c,directSpecular:h,indirectDiffuse:d,indirectSpecular:p}=r.reflectedLight;let f=c.add(d);null!==u&&(f=tS(null!==l?l.mix(f,u):u),r.material.transparent=!0),t.assign(f),o.assign(h.add(p)),n.assign(t.add(o)),i.finish(e),n=n.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class DU extends XF{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=UF.RENDER,this.isShadowBaseNode=!0}setupShadowPosition(e){let{context:t,material:n}=e;yU.assign(n.receivedShadowPositionNode||t.shadowPositionWorld||DP)}}const yU=mS("vec3","shadowPositionWorld");function EU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.toneMapping=e.toneMapping,t.toneMappingExposure=e.toneMappingExposure,t.outputColorSpace=e.outputColorSpace,t.renderTarget=e.getRenderTarget(),t.activeCubeFace=e.getActiveCubeFace(),t.activeMipmapLevel=e.getActiveMipmapLevel(),t.renderObjectFunction=e.getRenderObjectFunction(),t.pixelRatio=e.getPixelRatio(),t.mrt=e.getMRT(),t.clearColor=e.getClearColor(t.clearColor||new Al),t.clearAlpha=e.getClearAlpha(),t.autoClear=e.autoClear,t.scissorTest=e.getScissorTest(),t}function AU(e,t){return t=EU(e,t),e.setMRT(null),e.setRenderObjectFunction(null),e.setClearColor(0,1),e.autoClear=!0,t}function CU(e,t){e.toneMapping=t.toneMapping,e.toneMappingExposure=t.toneMappingExposure,e.outputColorSpace=t.outputColorSpace,e.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),e.setRenderObjectFunction(t.renderObjectFunction),e.setPixelRatio(t.pixelRatio),e.setMRT(t.mrt),e.setClearColor(t.clearColor,t.clearAlpha),e.autoClear=t.autoClear,e.setScissorTest(t.scissorTest)}function _U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.background=e.background,t.backgroundNode=e.backgroundNode,t.overrideMaterial=e.overrideMaterial,t}function bU(e,t){return t=_U(e,t),e.background=null,e.backgroundNode=null,e.overrideMaterial=null,t}function xU(e,t){e.background=t.background,e.backgroundNode=t.backgroundNode,e.overrideMaterial=t.overrideMaterial}function FU(e,t,n){return n=bU(t,n=AU(e,n))}function wU(e,t,n){CU(e,n),xU(t,n)}const SU=new WeakMap,TU=Vw(e=>{let{depthTexture:t,shadowCoord:n,depthLayer:r}=e,i=WB(t,n.xy).label("t_basic");return t.isArrayTexture&&(i=i.depth(r)),i.compare(n.z)}),MU=Vw(e=>{let{depthTexture:t,shadowCoord:n,shadow:r,depthLayer:i}=e;const a=(e,n)=>{let r=WB(t,e);return t.isArrayTexture&&(r=r.depth(i)),r.compare(n)},o=JP("mapSize","vec2",r).setGroup(KS),s=JP("radius","float",r).setGroup(KS),u=$w(1).div(o),l=u.x.negate().mul(s),c=u.y.negate().mul(s),h=u.x.mul(s),d=u.y.mul(s),p=l.div(2),f=c.div(2),m=h.div(2),g=d.div(2);return oT(a(n.xy.add($w(l,c)),n.z),a(n.xy.add($w(0,c)),n.z),a(n.xy.add($w(h,c)),n.z),a(n.xy.add($w(p,f)),n.z),a(n.xy.add($w(0,f)),n.z),a(n.xy.add($w(m,f)),n.z),a(n.xy.add($w(l,0)),n.z),a(n.xy.add($w(p,0)),n.z),a(n.xy,n.z),a(n.xy.add($w(m,0)),n.z),a(n.xy.add($w(h,0)),n.z),a(n.xy.add($w(p,g)),n.z),a(n.xy.add($w(0,g)),n.z),a(n.xy.add($w(m,g)),n.z),a(n.xy.add($w(l,d)),n.z),a(n.xy.add($w(0,d)),n.z),a(n.xy.add($w(h,d)),n.z)).mul(1/17)}),BU=Vw(e=>{let{depthTexture:t,shadowCoord:n,shadow:r,depthLayer:i}=e;const a=(e,n)=>{let r=WB(t,e);return t.isArrayTexture&&(r=r.depth(i)),r.compare(n)},o=JP("mapSize","vec2",r).setGroup(KS),s=$w(1).div(o),u=s.x,l=s.y,c=n.xy,h=YT(c.mul(o).add(.5));return c.subAssign(h.mul(s)),oT(a(c,n.z),a(c.add($w(u,0)),n.z),a(c.add($w(0,l)),n.z),a(c.add(s),n.z),MM(a(c.add($w(u.negate(),0)),n.z),a(c.add($w(u.mul(2),0)),n.z),h.x),MM(a(c.add($w(u.negate(),l)),n.z),a(c.add($w(u.mul(2),l)),n.z),h.x),MM(a(c.add($w(0,l.negate())),n.z),a(c.add($w(0,l.mul(2))),n.z),h.y),MM(a(c.add($w(u,l.negate())),n.z),a(c.add($w(u,l.mul(2))),n.z),h.y),MM(MM(a(c.add($w(u.negate(),l.negate())),n.z),a(c.add($w(u.mul(2),l.negate())),n.z),h.x),MM(a(c.add($w(u.negate(),l.mul(2))),n.z),a(c.add($w(u.mul(2),l.mul(2))),n.z),h.x),h.y)).mul(1/9)}),PU=Vw(e=>{let{depthTexture:t,shadowCoord:n,depthLayer:r}=e;const i=Xw(1).toVar();let a=WB(t).sample(n.xy);t.isArrayTexture&&(a=a.depth(r)),a=a.rg;const o=vM(n.z,a.x);return jw(o.notEqual(Xw(1)),()=>{const e=n.z.sub(a.x),t=gM(0,a.y.mul(a.y));let r=t.div(t.add(e.mul(e)));r=BM(sT(r,.3).div(.95-.3)),i.assign(BM(gM(o,r)))}),i}),NU=Vw(e=>{let[t,n,r]=e,i=DP.sub(t).length();return i=i.sub(n).div(r.sub(n)),i=i.saturate(),i}),RU=e=>{let t=SU.get(e);if(void 0===t){const n=e.isPointLight?(e=>{const t=e.shadow.camera,n=JP("near","float",t).setGroup(KS),r=JP("far","float",t).setGroup(KS),i=sP(e);return NU(i,n,r)})(e):null;t=new QR,t.colorNode=aS(0,0,0,1),t.depthNode=n,t.isShadowPassMaterial=!0,t.name="ShadowMaterial",t.fog=!1,SU.set(e,t)}return t},LU=new Ik,IU=[],kU=(e,t,n,r)=>{IU[0]=e,IU[1]=t;let i=LU.get(IU);return void 0!==i&&i.shadowType===n&&i.useVelocity===r||(i=function(i,a,o,s,u,l){if(!0===i.castShadow||i.receiveShadow&&3===n){r&&(LF(i).useVelocity=!0),i.onBeforeShadow(e,i,o,t.camera,s,a.overrideMaterial,l);for(var c=arguments.length,h=new Array(c>6?c-6:0),d=6;d<c;d++)h[d-6]=arguments[d];e.renderObject(i,a,o,s,u,l,...h),i.onAfterShadow(e,i,o,t.camera,s,a.overrideMaterial,l)}},i.shadowType=n,i.useVelocity=r,LU.set(IU,i)),IU[0]=null,IU[1]=null,i},OU=Vw(e=>{let{samples:t,radius:n,size:r,shadowPass:i,depthLayer:a}=e;const o=Xw(0).toVar("meanVertical"),s=Xw(0).toVar("squareMeanVertical"),u=t.lessThanEqual(Xw(1)).select(Xw(0),Xw(2).div(t.sub(1))),l=t.lessThanEqual(Xw(1)).select(Xw(0),Xw(-1));pR({start:Kw(0),end:Kw(t),type:"int",condition:"<"},e=>{let{i:t}=e;const c=l.add(Xw(t).mul(u));let h=i.sample(oT(MR.xy,$w(0,c).mul(n)).div(r));i.value.isArrayTexture&&(h=h.depth(a)),h=h.x,o.addAssign(h),s.addAssign(h.mul(h))}),o.divAssign(t),s.divAssign(t);const c=jT(s.sub(o.mul(o)));return $w(o,c)}),UU=Vw(e=>{let{samples:t,radius:n,size:r,shadowPass:i,depthLayer:a}=e;const o=Xw(0).toVar("meanHorizontal"),s=Xw(0).toVar("squareMeanHorizontal"),u=t.lessThanEqual(Xw(1)).select(Xw(0),Xw(2).div(t.sub(1))),l=t.lessThanEqual(Xw(1)).select(Xw(0),Xw(-1));pR({start:Kw(0),end:Kw(t),type:"int",condition:"<"},e=>{let{i:t}=e;const c=l.add(Xw(t).mul(u));let h=i.sample(oT(MR.xy,$w(c,0).mul(n)).div(r));i.value.isArrayTexture&&(h=h.depth(a)),o.addAssign(h.x),s.addAssign(oT(h.y.mul(h.y),h.x.mul(h.x)))}),o.divAssign(t),s.divAssign(t);const c=jT(s.sub(o.mul(o)));return $w(o,c)}),zU=[TU,MU,BU,PU];let VU;const GU=new SO;class HU extends DU{static get type(){return"ShadowNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,t){let{filterFn:n,depthTexture:r,shadowCoord:i,shadow:a,depthLayer:o}=t;const s=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),u=n({depthTexture:r,shadowCoord:i,shadow:a,depthLayer:o});return s.select(u,Xw(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,i=JP("bias","float",n).setGroup(KS);let a,o=t;if(n.camera.isOrthographicCamera||!0!==r.logarithmicDepthBuffer)o=o.xyz.div(o.w),a=o.z,r.coordinateSystem===ds&&(a=a.mul(2).sub(1));else{const e=o.w;o=o.xy.div(e);const t=JP("near","float",n.camera).setGroup(KS),r=JP("far","float",n.camera).setGroup(KS);a=GR(e.negate(),t,r)}return o=tS(o.x,o.y.oneMinus(),a.add(i)),o}getShadowFilterFn(e){return zU[e]}setupRenderTarget(e,t){const n=new Hc(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=ts;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){const{renderer:t}=e,{light:n,shadow:r}=this,i=t.shadowMap.type,{depthTexture:a,shadowMap:o}=this.setupRenderTarget(r,e);if(r.camera.updateProjectionMatrix(),3===i&&!0!==r.isPointLightShadow){a.compareFunction=null,o.depth>1?(o._vsmShadowMapVertical||(o._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:oo,type:Ka,depth:o.depth,depthBuffer:!1}),o._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=o._vsmShadowMapVertical,o._vsmShadowMapHorizontal||(o._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:oo,type:Ka,depth:o.depth,depthBuffer:!1}),o._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=o._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:oo,type:Ka,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:oo,type:Ka,depthBuffer:!1}));let t=WB(a);a.isArrayTexture&&(t=t.depth(this.depthLayer));let n=WB(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(n=n.depth(this.depthLayer));const i=JP("blurSamples","float",r).setGroup(KS),s=JP("radius","float",r).setGroup(KS),u=JP("mapSize","vec2",r).setGroup(KS);let l=this.vsmMaterialVertical||(this.vsmMaterialVertical=new QR);l.fragmentNode=OU({samples:i,radius:s,size:u,shadowPass:t,depthLayer:this.depthLayer}).context(e.getSharedContext()),l.name="VSMVertical",l=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new QR),l.fragmentNode=UU({samples:i,radius:s,size:u,shadowPass:n,depthLayer:this.depthLayer}).context(e.getSharedContext()),l.name="VSMHorizontal"}const s=JP("intensity","float",r).setGroup(KS),u=JP("normalBias","float",r).setGroup(KS),l=uU(n).mul(yU.add(BP.mul(u))),c=this.setupShadowCoord(e,l),h=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(null===h)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const d=3===i&&!0!==r.isPointLightShadow?this.vsmShadowMapHorizontal.texture:a,p=this.setupShadowFilter(e,{filterFn:h,shadowTexture:o.texture,depthTexture:d,shadowCoord:c,shadow:r,depthLayer:this.depthLayer});let f=WB(o.texture,c);a.isArrayTexture&&(f=f.depth(this.depthLayer));const m=MM(1,p.rgb.mix(f,1),s.mul(f.a)).toVar();return this.shadowMap=o,this.shadow.map=o,m}setup(e){if(!1!==e.renderer.shadowMap.enabled)return Vw(()=>{let t=this._node;return this.setupShadowPosition(e),null===t&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:a}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth),i.render(a,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:i,scene:a,camera:o}=e,s=i.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;const l=r.camera.layers.mask;0===(4294967294&r.camera.layers.mask)&&(r.camera.layers.mask=o.layers.mask);const c=i.getRenderObjectFunction(),h=i.getMRT(),d=!!h&&h.has("velocity");VU=FU(i,a,VU),a.overrideMaterial=RU(n),i.setRenderObjectFunction(kU(i,r,s,d)),i.setClearColor(0,0),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(c),3===s&&!0!==r.isPointLightShadow&&this.vsmPass(i),r.camera.layers.mask=l,wU(i,a,VU)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),GU.material=this.vsmMaterialVertical,GU.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),GU.material=this.vsmMaterialHorizontal,GU.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const jU=(e,t)=>Lw(new HU(e,t)),WU=new Al,qU=Vw(e=>{let[t,n]=e;const r=t.toVar(),i=nM(r),a=lT(1,gM(i.x,gM(i.y,i.z)));i.mulAssign(a),r.mulAssign(a.mul(n.mul(2).oneMinus()));const o=$w(r.xy).toVar(),s=n.mul(1.5).oneMinus();return jw(i.z.greaterThanEqual(s),()=>{jw(r.z.greaterThan(0),()=>{o.x.assign(sT(4,r.x))})}).ElseIf(i.x.greaterThanEqual(s),()=>{const e=rM(r.x);o.x.assign(r.z.mul(e).add(e.mul(2)))}).ElseIf(i.y.greaterThanEqual(s),()=>{const e=rM(r.y);o.x.assign(r.x.add(e.mul(2)).add(2)),o.y.assign(r.z.mul(e).sub(2))}),$w(.125,.25).mul(o).add($w(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),XU=Vw(e=>{let{depthTexture:t,bd3D:n,dp:r,texelSize:i}=e;return WB(t,qU(n,i.y)).compare(r)}),KU=Vw(e=>{let{depthTexture:t,bd3D:n,dp:r,texelSize:i,shadow:a}=e;const o=JP("radius","float",a).setGroup(KS),s=$w(-1,1).mul(o).mul(i.y);return WB(t,qU(n.add(s.xyy),i.y)).compare(r).add(WB(t,qU(n.add(s.yyy),i.y)).compare(r)).add(WB(t,qU(n.add(s.xyx),i.y)).compare(r)).add(WB(t,qU(n.add(s.yyx),i.y)).compare(r)).add(WB(t,qU(n,i.y)).compare(r)).add(WB(t,qU(n.add(s.xxy),i.y)).compare(r)).add(WB(t,qU(n.add(s.yxy),i.y)).compare(r)).add(WB(t,qU(n.add(s.xxx),i.y)).compare(r)).add(WB(t,qU(n.add(s.yxx),i.y)).compare(r)).mul(1/9)}),YU=Vw(e=>{let{filterFn:t,depthTexture:n,shadowCoord:r,shadow:i}=e;const a=r.xyz.toVar(),o=a.length(),s=$S("float").setGroup(KS).onRenderUpdate(()=>i.camera.near),u=$S("float").setGroup(KS).onRenderUpdate(()=>i.camera.far),l=JP("bias","float",i).setGroup(KS),c=$S(i.mapSize).setGroup(KS),h=Xw(1).toVar();return jw(o.sub(u).lessThanEqual(0).and(o.sub(s).greaterThanEqual(0)),()=>{const e=o.sub(s).div(u.sub(s)).toVar();e.addAssign(l);const r=a.normalize(),d=$w(1).div(c.mul($w(4,2)));h.assign(t({depthTexture:n,bd3D:r,dp:e,texelSize:d,shadow:i}))}),h}),JU=new $s,$U=new xs,QU=new xs;class ZU extends HU{static get type(){return"PointShadowNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}getShadowFilterFn(e){return 0===e?XU:KU}setupShadowCoord(e,t){return t}setupShadowFilter(e,t){let{filterFn:n,shadowTexture:r,depthTexture:i,shadowCoord:a,shadow:o}=t;return YU({filterFn:n,shadowTexture:r,depthTexture:i,shadowCoord:a,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:a}=e,o=t.getFrameExtents();QU.copy(t.mapSize),QU.multiply(o),n.setSize(QU.width,QU.height),$U.copy(t.mapSize);const s=i.autoClear,u=i.getClearColor(WU),l=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha),i.clear();const c=t.getViewportCount();for(let h=0;h<c;h++){const e=t.getViewport(h),o=$U.x*e.x,s=QU.y-$U.y-$U.y*e.y;JU.set(o,s,$U.x*e.z,$U.y*e.w),n.viewport.copy(JU),t.updateMatrices(r,h),i.render(a,t.camera)}i.autoClear=s,i.setClearColor(u,l)}}const ez=(e,t)=>Lw(new ZU(e,t));class tz extends ER{static get type(){return"AnalyticLightNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.light=e,this.color=new Al,this.colorNode=e&&e.colorNode||$S(this.color).setGroup(KS),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=UF.FRAME}getHash(){return this.light.uuid}getLightVector(e){return dU(this.light).sub(e.context.positionView||EP)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return jU(this.light)}setupShadow(e){const{renderer:t}=e;if(!1===t.shadowMap.enabled)return;let n=this.shadowColorNode;if(null===n){const e=this.light.shadow.shadowNode;let t;t=void 0!==e?Lw(e):this.setupShadowNode(),this.shadowNode=t,this.shadowColorNode=n=this.colorNode.mul(t),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const nz=Vw(e=>{let{lightDistance:t,cutoffDistance:n,decayExponent:r}=e;const i=t.pow(r).max(.01).reciprocal();return n.greaterThan(0).select(i.mul(t.div(n).pow4().oneMinus().clamp().pow2()),i)}),rz=e=>{let{color:t,lightVector:n,cutoffDistance:r,decayExponent:i}=e;const a=n.normalize(),o=n.length(),s=nz({lightDistance:o,cutoffDistance:r,decayExponent:i});return{lightDirection:a,lightColor:t.mul(s)}};class iz extends tz{static get type(){return"PointLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.cutoffDistanceNode=$S(0).setGroup(KS),this.decayExponentNode=$S(2).setGroup(KS)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return ez(this.light)}setupDirect(e){return rz({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Vw((e,t)=>{let[n=kB()]=e,{renderer:r,material:i}=t;const a=TM(n.mul(2).sub(1));let o;if(i.alphaToCoverage&&r.samples>1){const e=Xw(a.fwidth()).toVar();o=RM(e.oneMinus(),e.add(1),a).oneMinus()}else o=VM(a.greaterThan(1),0,1);return o});const az=Vw(e=>{let[t,n]=e;const r=t.x,i=t.y,a=t.z;let o=n.element(0).mul(.886227);return o=o.add(n.element(1).mul(1.023328).mul(i)),o=o.add(n.element(2).mul(1.023328).mul(a)),o=o.add(n.element(3).mul(1.023328).mul(r)),o=o.add(n.element(4).mul(.858086).mul(r).mul(i)),o=o.add(n.element(5).mul(.858086).mul(i).mul(a)),o=o.add(n.element(6).mul(a.mul(a).mul(.743125).sub(.247708))),o=o.add(n.element(7).mul(.858086).mul(r).mul(a)),o=o.add(n.element(8).mul(.429043).mul(uT(r,r).sub(uT(i,i)))),o});const oz=new EO;class sz extends Vk{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(null===i)r._clearColor.getRGB(oz),oz.a=r._clearColor.a;else if(!0===i.isColor)i.getRGB(oz),oz.a=1,a=!0;else if(!0===i.isNode){const s=this.get(e),u=i;oz.copy(r._clearColor);let l=s.backgroundMesh;if(void 0===l){const h=jM(aS(u).mul(NO),{getUV:()=>RO.mul(TP),getTextureLevel:()=>PO});let d=ZN;d=d.setZ(d.w);const p=new QR;function f(){i.removeEventListener("dispose",f),l.material.dispose(),l.geometry.dispose()}p.name="Background.material",p.side=1,p.depthTest=!1,p.depthWrite=!1,p.allowOverride=!1,p.fog=!1,p.lights=!1,p.vertexNode=d,p.colorNode=h,s.backgroundMeshNode=h,s.backgroundMesh=l=new rc(new qc(1,32,32),p),l.frustumCulled=!1,l.name="Background.mesh",l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},i.addEventListener("dispose",f)}const c=u.getCacheKey();s.backgroundCacheKey!==c&&(s.backgroundMeshNode.node=aS(u).mul(NO),s.backgroundMeshNode.needsUpdate=!0,l.material.needsUpdate=!0,s.backgroundCacheKey=c),t.unshift(l,l.geometry,l.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",i);const o=r.xr.getEnvironmentBlendMode();if("additive"===o?oz.set(0,0,0,1):"alpha-blend"===o&&oz.set(0,0,0,0),!0===r.autoClear||!0===a){const m=n.clearColorValue;m.r=oz.r,m.g=oz.g,m.b=oz.b,m.a=oz.a,!0!==r.backend.isWebGLBackend&&!0!==r.alpha||(m.r*=m.a,m.g*=m.a,m.b*=m.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=!0===r.autoClearColor,n.clearDepth=!0===r.autoClearDepth,n.clearStencil=!0===r.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let uz=0;class lz{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=uz++}}class cz{constructor(e,t,n,r,i,a,o,s,u){let l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=l,this.nodeAttributes=r,this.bindings=i,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=s,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings){if(!0!==t.bindings[0].groupNode.shared){const n=new lz(t.name,[],t.index,t);e.push(n);for(const e of t.bindings)n.bindings.push(e.clone())}else e.push(t)}return e}}class hz{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class dz{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class pz{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class fz extends pz{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}}class mz{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let gz=0;class vz{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.id=gz++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return void 0===t&&null!==this.parent&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class Dz{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class yz{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Ez extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class Az extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xs),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class Cz extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ws),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class _z extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new $s),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class bz extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Al),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class xz extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ad),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class Fz extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ms),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class wz extends yz{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tu),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class Sz extends Ez{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Tz extends Az{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Mz extends Cz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Bz extends _z{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Pz extends bz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Nz extends xz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Rz extends Fz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Lz extends wz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const Iz=new WeakMap,kz=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Oz=e=>/e/g.test(e)?String(e).replace(/\+/g,""):(e=Number(e))+(e%1?"":".0");class Uz{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=_O(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new vz,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=Iz.get(this.renderer);return void 0===e&&(e=new Ik,Iz.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new Qs(e,t,n)}createCubeRenderTarget(e,t){return new uL(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let i,a=!0;for(const o of t)r.push(o),a=a&&!0!==o.groupNode.shared;return a?(i=n.get(r),void 0===i&&(i=new lz(e,r,this.bindingsIndexes[e].group,r),n.set(r,i))):i=new lz(e,r,this.bindingsIndexes[e].group,r),i}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return void 0===r&&(void 0===this.bindingsIndexes[e]&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(null===e){const t={},n=this.bindings;for(const e of HF)for(const r in n[e]){const i=n[e][r];(t[r]||(t[r]=[])).push(...i)}e=[];for(const r in t){const n=t[r],i=this._getBindGroup(r,n);e.push(i)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((e,t)=>e.bindings[0].groupNode.order-t.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){!1===this.nodes.includes(e)&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){!1===this.sequentialNodes.includes(e)&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes){e.getUpdateType()!==UF.NONE&&this.updateNodes.push(e.getSelf())}for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==UF.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==UF.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Oa||e.magFilter===Ua||e.magFilter===ka||e.magFilter===za||e.minFilter===Oa||e.minFilter===Ua||e.minFilter===ka||e.minFilter===za}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return s({},this.context),this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.getDataFromNode(e);return void 0===n.cache&&(n.cache=new vz(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=void 0===t.usageCount?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.generateArrayDeclaration(e,t)+"( ";for(let i=0;i<t;i++){const a=n?n[i]:null;r+=null!==a?a.build(this,e):this.generateConst(e),i<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=[];for(const i of t){const{name:e,type:t}=i;n&&n[e]&&n[e].isNode?r.push(n[e].build(this,t)):r.push(this.generateConst(t))}return e+"( "+r.join(", ")+" )"}generateConst(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===t&&("float"===e||"int"===e||"uint"===e?t=0:"bool"===e?t=!1:"color"===e?t=new Al:"vec2"===e?t=new xs:"vec3"===e?t=new ws:"vec4"===e&&(t=new $s)),"float"===e)return Oz(t);if("int"===e)return"".concat(Math.round(t));if("uint"===e)return t>=0?"".concat(Math.round(t),"u"):"0u";if("bool"===e)return t?"true":"false";if("color"===e)return"".concat(this.getType("vec3"),"( ").concat(Oz(t.r),", ").concat(Oz(t.g),", ").concat(Oz(t.b)," )");const n=this.getTypeLength(e),r=this.getComponentType(e),i=e=>this.generateConst(r,e);if(2===n)return"".concat(this.getType(e),"( ").concat(i(t.x),", ").concat(i(t.y)," )");if(3===n)return"".concat(this.getType(e),"( ").concat(i(t.x),", ").concat(i(t.y),", ").concat(i(t.z)," )");if(4===n&&"mat2"!==e)return"".concat(this.getType(e),"( ").concat(i(t.x),", ").concat(i(t.y),", ").concat(i(t.z),", ").concat(i(t.w)," )");if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return"".concat(this.getType(e),"( ").concat(t.elements.map(i).join(", ")," )");if(n>4)return"".concat(this.getType(e),"()");throw new Error("NodeBuilder: Type '".concat(e,"' not found in generate constant attempt."))}getType(e){return"color"===e?"vec3":e}hasGeometryAttribute(e){return this.geometry&&void 0!==this.geometry.getAttribute(e)}getAttribute(e,t){const n=this.attributes;for(const i of n)if(i.name===e)return i;const r=new hz(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"samplerComparison"===e||"texture"===e||"cubeTexture"===e||"storageTexture"===e||"depthTexture"===e||"texture3D"===e}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Wa)return"int";if(t===qa)return"uint"}return"float"}getElementType(e){return"mat2"===e?"vec2":"mat3"===e?"vec3":"mat4"===e?"vec4":this.getComponentType(e)}getComponentType(e){if("float"===(e=this.getVectorType(e))||"bool"===e||"int"===e||"uint"===e)return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return null===t?null:"b"===t[1]?"bool":"i"===t[1]?"int":"u"===t[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e?"vec4":e}getTypeFromLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float";if(1===e)return t;let n=PF(e);const r="float"===t?"":t[0];return!0===/mat2/.test(t)&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return kz.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,i=e.normalized;let a;return e instanceof Il||!0===i||(a=this.getTypeFromArray(n)),this.getTypeFromLength(r,a)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return null!==n?Number(n[1]):"float"===t||"bool"===t||"int"===t||"uint"===t?1:!0===/mat2/.test(e)?4:!0===/mat3/.test(e)?9:!0===/mat4/.test(e)?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return"int"===t||"uint"===t?e:this.changeComponentType(e,"int")}addStack(){return this.stack=_O(this.stack),this.stacks.push(Hw()||this.stack),Gw(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,Gw(this.stacks.pop()),e}getDataFromNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n=null===n?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);return void 0===r&&(r={},n.setData(e,r)),void 0===r[t]&&(r[t]={}),r[t]}getNodeProperties(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"any";const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let r=n.bufferAttribute;if(void 0===r){const i=this.uniforms.index++;r=new hz("nodeAttribute"+i,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage;const i=this.getDataFromNode(e,r,this.globalCache);let a=i.structType;if(void 0===a){const e=this.structs.index++;null===n&&(n="StructType"+e),a=new Dz(n,t),this.structs[r].push(a),i.structType=a}return a}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=this.getDataFromNode(e,n,this.globalCache);let a=i.uniform;if(void 0===a){const o=this.uniforms.index++;a=new dz(r||"nodeUniform"+o,t,e),this.uniforms[n].push(a),this.registerDeclaration(a),i.uniform=a}return a}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getNodeType(this),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=this.getDataFromNode(e,r);let o=a.variable;if(void 0===o){const s=i?"_const":"_var",u=this.vars[r]||(this.vars[r]=[]),l=this.vars[s]||(this.vars[s]=0);null===t&&(t=(i?"nodeConst":"nodeVar")+l,this.vars[s]++);const c=this.getArrayCount(e);o=new pz(t,n,i,c),i||u.push(o),this.registerDeclaration(o),a.variable=o}return o}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode))&&(!e.cNode||this.isDeterministic(e.cNode));if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode));if(e.isArrayNode){if(null!==e.values)for(const t of e.values)if(!this.isDeterministic(t))return!1;return!0}return!!e.isConstNode}getVaryingFromNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getNodeType(this),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const a=this.getDataFromNode(e,"any");let o=a.varying;if(void 0===o){const e=this.varyings,s=e.length;null===t&&(t="nodeVarying"+s),o=new fz(t,n,r,i),e.push(o),this.registerDeclaration(o),a.varying=o}return o}get namespace(){return this.context.namespace}getOutputNamespace(){return this.getNamespace("outputNode")}getNamespace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=this.namespace;let n;return n=t?e?t+"_"+e:t:e,n}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let i=1,a=r;for(;void 0!==n[a];)a=r+"_"+i++;i>1&&(e.name=a,console.warn("THREE.TSL: Declaration name '".concat(r,"' of '").concat(e.type,"' already in use. Renamed to '").concat(a,"'."))),n[a]=e}getCodeFromNode(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage;const r=this.getDataFromNode(e);let i=r.code;if(void 0===i){const e=this.codes[n]||(this.codes[n]=[]),a=e.length;i=new mz("nodeCode"+a,t),e.push(i),r.code=i}return i}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let i=!0,a=t;for(;a;){if(!0===r.get(a)){i=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(i)for(const o of n)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),i=r.flowCodes||(r.flowCodes=[]),a=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);i.push(t),a.set(n,!0)}addLineFlowCode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return""===e||(null!==t&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e+=";\n"),this.flow.code+=e),this}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new ZO,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let e=0;const t=Object.values(this);return{next:()=>({value:t[e],done:e++>=t.length})}}};for(const a of t.inputs)n[a.name]=new AO(a.type,a.name);e.layout=null;const r=e.call(n),i=this.flowStagesNode(r,t.type);return e.layout=t,i}flowStagesNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.flow,r=this.vars,i=this.declarations,a=this.cache,o=this.buildStage,s=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new vz,this.stack=_O();for(const l of GF)this.setBuildStage(l),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=i,this.cache=a,this.stack=s,this.setBuildStage(o),u}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=this.tab,a=this.cache,o=this.shaderStage,u=this.context;this.setShaderStage(e);const l=s({},this.context);delete l.nodeBlock,this.cache=this.globalCache,this.tab="\t",this.context=l;let c=null;if("generate"===this.buildStage){const i=this.flowChildNode(t,n);null!==r&&(i.code+="".concat(this.tab+r," = ").concat(i.result,";\n")),this.flowCode[e]=this.flowCode[e]+i.code,c=i}else c=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=i,this.context=u,c}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"".concat(null!==n?this.generateArrayDeclaration(e,n):this.getType(e)," ").concat(t)}getVars(e){let t="";const n=this.vars[e];if(void 0!==n)for(const r of n)t+="".concat(this.getVar(r.type,r.name),"; ");return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(void 0!==t)for(const r of t)n+=r.code+"\n";return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(null!==t){let e=n.library.fromMaterial(t);null===e&&(console.error('NodeMaterial: Material "'.concat(t.type,'" is not compatible.')),e=new QR),e.build(this)}else this.addFlow("compute",e);for(const r of GF){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const e of HF){this.setShaderStage(e);const t=this.flowNodes[e];for(const e of t)"generate"===r?this.flowNode(e):e.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if("float"===t||"int"===t||"uint"===t)return new Sz(e);if("vec2"===t||"ivec2"===t||"uvec2"===t)return new Tz(e);if("vec3"===t||"ivec3"===t||"uvec3"===t)return new Mz(e);if("vec4"===t||"ivec4"===t||"uvec4"===t)return new Bz(e);if("color"===t)return new Pz(e);if("mat2"===t)return new Nz(e);if("mat3"===t)return new Rz(e);if("mat4"===t)return new Lz(e);throw new Error('Uniform "'.concat(t,'" not declared.'))}format(e,t,n){if((t=this.getVectorType(t))===(n=this.getVectorType(n))||null===n||this.isReference(n))return e;const r=this.getTypeLength(t),i=this.getTypeLength(n);return 16===r&&9===i?"".concat(this.getType(n),"( ").concat(e,"[ 0 ].xyz, ").concat(e,"[ 1 ].xyz, ").concat(e,"[ 2 ].xyz )"):9===r&&4===i?"".concat(this.getType(n),"( ").concat(e,"[ 0 ].xy, ").concat(e,"[ 1 ].xy )"):r>4||i>4||0===i?e:r===i?"".concat(this.getType(n),"( ").concat(e," )"):r>i?(e="bool"===n?"all( ".concat(e," )"):"".concat(e,".").concat("xyz".slice(0,i)),this.format(e,this.getTypeFromLength(i,this.getComponentType(t)),n)):4===i&&r>1?"".concat(this.getType(n),"( ").concat(this.format(e,t,"vec3"),", 1.0 )"):2===r?"".concat(this.getType(n),"( ").concat(this.format(e,t,"vec2"),", 0.0 )"):(1===r&&i>1&&t!==this.getComponentType(n)&&(e="".concat(this.getType(this.getComponentType(n)),"( ").concat(e," )")),"".concat(this.getType(n),"( ").concat(e," )"))}getSignature(){return"// Three.js r".concat(Hi," - Node System\n")}*[Symbol.iterator](){}createNodeMaterial(){throw new Error("THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NodeMaterial","() instead."))}}class zz{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return void 0===n&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===UF.FRAME){const{frameMap:t}=this._getMaps(this.updateBeforeMap,n);t.get(n)!==this.frameId&&!1!==e.updateBefore(this)&&t.set(n,this.frameId)}else if(t===UF.RENDER){const{renderMap:t}=this._getMaps(this.updateBeforeMap,n);t.get(n)!==this.renderId&&!1!==e.updateBefore(this)&&t.set(n,this.renderId)}else t===UF.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===UF.FRAME){const{frameMap:t}=this._getMaps(this.updateAfterMap,n);t.get(n)!==this.frameId&&!1!==e.updateAfter(this)&&t.set(n,this.frameId)}else if(t===UF.RENDER){const{renderMap:t}=this._getMaps(this.updateAfterMap,n);t.get(n)!==this.renderId&&!1!==e.updateAfter(this)&&t.set(n,this.renderId)}else t===UF.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===UF.FRAME){const{frameMap:t}=this._getMaps(this.updateMap,n);t.get(n)!==this.frameId&&!1!==e.update(this)&&t.set(n,this.frameId)}else if(t===UF.RENDER){const{renderMap:t}=this._getMaps(this.updateMap,n);t.get(n)!==this.renderId&&!1!==e.update(this)&&t.set(n,this.renderId)}else t===UF.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class Vz{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=i}}Vz.isNodeFunctionInput=!0;class Gz extends tz{static get type(){return"DirectionalLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}setupDirect(){const e=this.colorNode;return{lightDirection:pU(this.light),lightColor:e}}}const Hz=new Tu,jz=new Tu;let Wz=null;class qz extends tz{static get type(){return"RectAreaLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.halfHeight=$S(new ws).setGroup(KS),this.halfWidth=$S(new ws).setGroup(KS),this.updateType=UF.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;jz.identity(),Hz.copy(t.matrixWorld),Hz.premultiply(n),jz.extractRotation(Hz),this.halfWidth.value.set(.5*t.width,0,0),this.halfHeight.value.set(0,.5*t.height,0),this.halfWidth.value.applyMatrix4(jz),this.halfHeight.value.applyMatrix4(jz)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=WB(Wz.LTC_FLOAT_1),n=WB(Wz.LTC_FLOAT_2)):(t=WB(Wz.LTC_HALF_1),n=WB(Wz.LTC_HALF_2));const{colorNode:r,light:i}=this;return{lightColor:r,lightPosition:dU(i),halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){Wz=e}}class Xz extends tz{static get type(){return"SpotLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.coneCosNode=$S(0).setGroup(KS),this.penumbraCosNode=$S(0).setGroup(KS),this.cutoffDistanceNode=$S(0).setGroup(KS),this.decayExponentNode=$S(0).setGroup(KS),this.colorNode=$S(this.color).setGroup(KS)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:r}=this;return RM(n,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return void 0===n&&(n=lU(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:i}=this,a=this.getLightVector(e),o=a.normalize(),s=o.dot(pU(i)),u=this.getSpotAttenuation(e,s),l=a.length(),c=nz({lightDistance:l,cutoffDistance:n,decayExponent:r});let h,d,p=t.mul(u).mul(c);if(i.colorNode?(d=this.getLightCoord(e),h=i.colorNode(d)):i.map&&(d=this.getLightCoord(e),h=WB(i.map,d.xy).onRenderUpdate(()=>i.map)),h){p=d.mul(2).sub(1).abs().lessThan(1).all().select(p.mul(h),p)}return{lightColor:p,lightDirection:o}}}class Kz extends Xz{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let r=null;if(n&&!0===n.isTexture){const e=t.acos().mul(1/Math.PI);r=WB(n,$w(e,0),0).r}else r=super.getSpotAttenuation(t);return r}}const Yz=Vw(e=>{let[t,n]=e;const r=t.abs().sub(n);return iM(gM(r,0)).add(mM(gM(r.x,r.y),0))});class Jz extends Xz{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),null===t.aspect){let e=1;null!==t.map&&(e=t.map.width/t.map.height),t.shadow.aspect=e}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=this.penumbraCosNode,n=this.getLightCoord(e),r=n.xyz.div(n.w),i=Yz(r.xy.sub($w(.5)),$w(.5)),a=lT(-1,sT(1,eM(t)).sub(1));return PM(i.mul(-2).mul(a))}}class $z extends tz{static get type(){return"AmbientLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}setup(e){let{context:t}=e;t.irradiance.addAssign(this.colorNode)}}class Qz extends tz{static get type(){return"HemisphereLightNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(e),this.lightPositionNode=cU(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=$S(new Al).setGroup(KS)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,i=TP.dot(r).mul(.5).add(.5),a=MM(n,t,i);e.context.irradiance.addAssign(a)}}class Zz extends tz{static get type(){return"LightProbeNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null);const e=[];for(let t=0;t<9;t++)e.push(new ws);this.lightProbe=$B(e)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=az(TP,this.lightProbe);e.context.irradiance.addAssign(t)}}class eV{parseFunction(){console.warn("Abstract function.")}}class tV{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}}tV.isNodeFunction=!0;const nV=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,rV=/[a-z_0-9]+/gi,iV="#pragma main";class aV extends tV{constructor(e){const{type:t,inputs:n,name:r,precision:i,inputsCode:a,blockCode:o,headerCode:s}=(e=>{const t=(e=e.trim()).indexOf(iV),n=-1!==t?e.slice(t+12):e,r=n.match(nV);if(null!==r&&5===r.length){const i=r[4],a=[];let o=null;for(;null!==(o=rV.exec(i));)a.push(o);const s=[];let u=0;for(;u<a.length;){const e="const"===a[u][0];!0===e&&u++;let t=a[u][0];"in"===t||"out"===t||"inout"===t?u++:t="";const n=a[u++][0];let r=Number.parseInt(a[u][0]);!1===Number.isNaN(r)?u++:r=null;const i=a[u++][0];s.push(new Vz(n,i,r,t,e))}const l=n.substring(r[0].length),c=void 0!==r[3]?r[3]:"";return{type:r[2],inputs:s,name:c,precision:void 0!==r[1]?r[1]:"",inputsCode:i,blockCode:l,headerCode:-1!==t?e.slice(0,t):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(e);super(t,n,r,i),this.inputsCode=a,this.blockCode=o,this.headerCode=s}getCode(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.name;const n=this.blockCode;if(""!==n){const{type:r,inputsCode:i,headerCode:a,precision:o}=this;let s="".concat(r," ").concat(t," ( ").concat(i.trim()," )");""!==o&&(s="".concat(o," ").concat(s)),e=a+s+n}else e="";return e}}class oV extends eV{parseFunction(e){return new aV(e)}}const sV=new WeakMap,uV=[],lV=[];class cV extends Vk{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new zz,this.nodeBuilderCache=new Map,this.callHashCache=new Ik,this.groupsData=new Ik,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===YS.name)return!0;if(n===KS.name){const t=this.get(e),n=this.nodeFrame.renderId;return t.renderId!==n&&(t.renderId=n,!0)}if(n===XS.name){const t=this.get(e),n=this.nodeFrame.frameId;return t.frameId!==n&&(t.frameId=n,!0)}uV[0]=t,uV[1]=e;let r=this.groupsData.get(uV);return void 0===r&&this.groupsData.set(uV,r={}),uV.length=0,r.version!==t.version&&(r.version=t.version,!0)}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(e);if(n=r.get(i),void 0===n){const t=this.backend.createNodeBuilder(e.object,this.renderer);t.scene=e.scene,t.material=e.material,t.camera=e.camera,t.context.material=e.material,t.lightsNode=e.lightsNode,t.environmentNode=this.getEnvironmentNode(e.scene),t.fogNode=this.getFogNode(e.scene),t.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&t.enableMultiview(),t.build(),n=this._createNodeBuilderState(t),r.set(i,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,0===t.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new cz(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){uV[0]=e,uV[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(uV)||{};if(r.callId!==n){const i=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&lV.push(t.getCacheKey(!0)),i&&lV.push(i.getCacheKey()),a&&lV.push(a.getCacheKey()),lV.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),lV.push(this.renderer.shadowMap.enabled?1:0),r.callId=n,r.cacheKey=FF(lV),this.callHashCache.set(uV,r),lV.length=0}return uV.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=0===e.backgroundBlurriness&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&0===t.backgroundBlurriness;if(t.background!==n||r){const i=this.getCacheNode("background",n,()=>{if(!0===n.isCubeTexture||n.mapping===Ta||n.mapping===Ma||n.mapping===Ba){if(e.backgroundBlurriness>0||n.mapping===Ba)return lk(n);{let e;return e=!0===n.isCubeTexture?XP(n):WB(n),pL(e)}}if(!0===n.isTexture)return WB(n,SR.flipY()).setUpdateMatrix(!0);!0!==n.isColor&&console.error("WebGPUNodes: Unsupported background configuration.",n)},r);t.backgroundNode=i,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=i.get(t);return(void 0===a||r)&&(a=n(),i.set(t,a)),a}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const e=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const e=JP("color","color",n).setGroup(KS),t=JP("density","float",n).setGroup(KS);return iU(e,rU(t))}if(n.isFog){const e=JP("color","color",n).setGroup(KS),t=JP("near","float",n).setGroup(KS),r=JP("far","float",n).setGroup(KS);return iU(e,nU(t,r))}console.error("THREE.Renderer: Unsupported fog configuration.",n)});t.fogNode=e,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const e=this.getCacheNode("environment",n,()=>!0===n.isCubeTexture?XP(n):!0===n.isTexture?WB(n):void console.error("Nodes: Unsupported environment configuration.",n));t.environmentNode=e,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.renderer,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=n,a.camera=r,a.material=i,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return sV.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?kO(e,tS(SR,QB("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):WB(e,SR).renderOutput(t.toneMapping,t.currentColorSpace);return sV.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new zz,this.nodeBuilderCache=new Map,this.cacheLib={}}}const hV=new Nc;class dV{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Ms,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==e&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let i=0;i<r;i++){hV.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const r=t[n+i],a=hV.normal;r.x=-a.x,r.y=-a.y,r.z=-a.z,r.w=hV.constant}}updateGlobal(e,t){this.shadowPass=null!==e.overrideMaterial&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,i=r.length;let a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+i){a.length=o+i;for(let e=0;e<i;e++)a[o+e]=new $s;n=!0}this.projectPlanes(r,a,o),n&&(this.version++,this.cacheKey="".concat(this.intersectionPlanes.length,":").concat(this.unionPlanes.length))}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return void 0===t&&(t=new dV(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class pV{constructor(e,t){this.bundleGroup=e,this.camera=t}}const fV=[];class mV{constructor(){this.bundles=new Ik}get(e,t){const n=this.bundles;fV[0]=e,fV[1]=t;let r=n.get(fV);return void 0===r&&(r=new pV(e,t),n.set(fV,r)),fV.length=0,r}dispose(){this.bundles=new Ik}}class gV{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(null!==n){t=new n;for(const n in e)t[n]=e[n]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t))console.warn("Redefinition of node ".concat(t));else{if("function"!==typeof e)throw new Error("Node class ".concat(e.name," is not a class."));if("function"===typeof t||"object"===typeof t)throw new Error("Base class ".concat(t," is not a class."));n.set(t,e)}}addClass(e,t,n){if(n.has(t))console.warn("Redefinition of node ".concat(t.name));else{if("function"!==typeof e)throw new Error("Node class ".concat(e.name," is not a class."));if("function"!==typeof t)throw new Error("Base class ".concat(t.name," is not a class."));n.set(t,e)}}}const vV=new vU,DV=[];class yV extends Ik{constructor(){super()}createNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(new vU).setLights(e)}getNode(e,t){if(e.isQuadMesh)return vV;DV[0]=e,DV[1]=t;let n=this.get(DV);return void 0===n&&(n=this.createNode(),this.set(DV,n)),DV.length=0,n}}class EV extends Qs{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const AV=new ws,CV=new ws;class _V extends ps{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new mc,this._cameraL.viewport=new $s,this._cameraR=new mc,this._cameraR.viewport=new $s,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new Hh,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._frameBufferTargets=null,this._createXRLayer=SV.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new xs,this._onSessionEvent=xV.bind(this),this._onSessionEnd=FV.bind(this),this._onInputSourcesChange=wV.bind(this),this._onAnimationFrame=TV.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers="undefined"!==typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(null!==this._glProjLayer||null!==this._glBaseLayer)return this._foveation}setFoveation(e){this._foveation=e,null!==this._glProjLayer&&(this._glProjLayer.fixedFoveation=e),null!==this._glBaseLayer&&void 0!==this._glBaseLayer.fixedFoveation&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(null!==this._session)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,i,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};const u=new Wc(e,t),l=new EV(i,a,{format:to,type:Va,depthTexture:new Hc(i,a,s.stencil?$a:qa,void 0,void 0,void 0,void 0,void 0,void 0,s.stencil?ro:no),stencilBuffer:s.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});l.autoAllocateDepthBuffer=!0;const c=new xl({color:16777215,side:0});c.map=l.texture,c.map.offset.y=1,c.map.repeat.y=-1;const h=new rc(u,c);h.position.copy(n),h.quaternion.copy(r);const d={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:i,pixelheight:a,plane:h,material:c,rendercall:o,renderTarget:l};if(this._layers.push(d),null!==this._session){d.plane.material=new xl({color:16777215,side:0}),d.plane.material.blending=5,d.plane.material.blendEquation=ea,d.plane.material.blendSrc=ra,d.plane.material.blendDst=ra,d.xrlayer=this._createXRLayer(d);const e=this._session.renderState.layers;e.unshift(d.xrlayer),this._session.updateRenderState({layers:e})}else l.isXRRenderTarget=!1;return h}createCylinderLayer(e,t,n,r,i,a,o,s){let u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};const l=new jc(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),c=new EV(a,o,{format:to,type:Va,depthTexture:new Hc(a,o,u.stencil?$a:qa,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?ro:no),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});c.autoAllocateDepthBuffer=!0;const h=new xl({color:16777215,side:1});h.map=c.texture,h.map.offset.y=1,h.map.repeat.y=-1;const d=new rc(l,h);d.position.copy(r),d.quaternion.copy(i);const p={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:i,pixelwidth:a,pixelheight:o,plane:d,material:h,rendercall:s,renderTarget:c};if(this._layers.push(p),null!==this._session){p.plane.material=new xl({color:16777215,side:1}),p.plane.material.blending=5,p.plane.material.blendEquation=ea,p.plane.material.blendSrc=ra,p.plane.material.blendDst=ra,p.xrlayer=this._createXRLayer(p);const e=this._session.renderState.layers;e.unshift(p.xrlayer),this._session.updateRenderState({layers:e})}else c.isXRRenderTarget=!1;return d}renderLayers(){const e=new ws,t=new Fs,n=this._renderer,r=this.isPresenting,i=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;const o=new xs;n.getSize(o);const s=n._quad;for(const u of this._layers)if(u.renderTarget.isXRRenderTarget=null!==this._session,u.renderTarget.hasExternalTextures=u.renderTarget.isXRRenderTarget,u.renderTarget.isXRRenderTarget&&this._supportsLayers){u.xrlayer.transform=new XRRigidTransform(u.plane.getWorldPosition(e),u.plane.getWorldQuaternion(t));const r=this._glBinding.getSubImage(u.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(u.renderTarget,r.colorTexture,void 0),n._setXRLayerSize(u.renderTarget.width,u.renderTarget.height),n.setOutputRenderTarget(u.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:i,quad:a}=this._frameBufferTargets.get(u.renderTarget)||{frameBufferTarget:null,quad:null};i?(n._frameBufferTarget=i,n._quad=a):(n._quad=new SO(new QR),this._frameBufferTargets.set(u.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),u.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(u.renderTarget),u.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(i),n._frameBufferTarget=a,n._setXRLayerSize(o.x,o.y),n._quad=s,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,i=r.getContextAttributes();if(this._session=e,null!==e){if(!0===n.isWebGPUBackend)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),!0===this._useLayers){let n=null,a=null,o=null;t.depth&&(o=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,n=t.stencil?ro:no,a=t.stencil?$a:qa);const s={colorFormat:r.RGBA8,depthFormat:o,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(s.textureType="texture-array",this._useMultiview=!0);const u=new XRWebGLBinding(e,r),l=u.createProjectionLayer(s),c=[l];this._glBinding=u,this._glProjLayer=l,t.setPixelRatio(1),t._setXRLayerSize(l.textureWidth,l.textureHeight);const h=this._useMultiview?2:1,d=new Hc(l.textureWidth,l.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n,h);if(this._xrRenderTarget=new EV(l.textureWidth,l.textureHeight,{format:to,type:Va,colorSpace:t.outputColorSpace,depthTexture:d,stencilBuffer:t.stencil,samples:i.antialias?4:0,resolveDepthBuffer:!1===l.ignoreDepthValues,resolveStencilBuffer:!1===l.ignoreDepthValues,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget.hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._supportsLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers)for(const e of this._layers)e.plane.material=new xl({color:16777215,side:"cylinder"===e.type?1:0}),e.plane.material.blending=5,e.plane.material.blendEquation=ea,e.plane.material.blendSrc=ra,e.plane.material.blendDst=ra,e.xrlayer=this._createXRLayer(e),c.unshift(e.xrlayer);e.updateRenderState({layers:c})}else{const n={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},i=new XRWebGLLayer(e,r,n);this._glBaseLayer=i,e.updateRenderState({baseLayer:i}),t.setPixelRatio(1),t._setXRLayerSize(i.framebufferWidth,i.framebufferHeight),this._xrRenderTarget=new EV(i.framebufferWidth,i.framebufferHeight,{format:to,type:Va,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:!1===i.ignoreDepthValues,resolveStencilBuffer:!1===i.ignoreDepthValues}),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(null===t)return;const n=e.near,r=e.far,i=this._cameraXR,a=this._cameraL,o=this._cameraR;i.near=o.near=a.near=n,i.far=o.far=a.far=r,i.isMultiViewCamera=this._useMultiview,this._currentDepthNear===i.near&&this._currentDepthFar===i.far||(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),a.layers.mask=2|e.layers.mask,o.layers.mask=4|e.layers.mask,i.layers.mask=a.layers.mask|o.layers.mask;const s=e.parent,u=i.cameras;bV(i,s);for(let l=0;l<u.length;l++)bV(u[l],s);2===u.length?function(e,t,n){AV.setFromMatrixPosition(t.matrixWorld),CV.setFromMatrixPosition(n.matrixWorld);const r=AV.distanceTo(CV),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,p=o*h,f=r/(-c+h),m=f*-c;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=o+f,n=s+f,i=d-m,a=p+(r-m),c=u*s/n*t,h=l*s/n*t;e.projectionMatrix.makePerspective(i,a,c,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(i,a,o):i.projectionMatrix.copy(a.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*vs*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,i,s)}_getController(e){let t=this._controllers[e];return void 0===t&&(t=new Cc,this._controllers[e]=t),t}}function bV(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}function xV(e){const t=this._controllerInputSources.indexOf(e.inputSource);if(-1===t)return;const n=this._controllers[t];if(void 0!==n){const t=this.getReferenceSpace();n.update(e.inputSource,e.frame,t),n.dispatchEvent({type:e.type,data:e.inputSource})}}function FV(){const e=this._session,t=this._renderer;e.removeEventListener("select",this._onSessionEvent),e.removeEventListener("selectstart",this._onSessionEvent),e.removeEventListener("selectend",this._onSessionEvent),e.removeEventListener("squeeze",this._onSessionEvent),e.removeEventListener("squeezestart",this._onSessionEvent),e.removeEventListener("squeezeend",this._onSessionEvent),e.removeEventListener("end",this._onSessionEnd),e.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let n=0;n<this._controllers.length;n++){const e=this._controllerInputSources[n];null!==e&&(this._controllerInputSources[n]=null,this._controllers[n].disconnect(e))}if(this._currentDepthNear=null,this._currentDepthFar=null,t._resetXRState(),this._session=null,this._xrRenderTarget=null,!0===this._supportsLayers)for(const n of this._layers)n.renderTarget=new EV(n.pixelwidth,n.pixelheight,{format:to,type:Va,depthTexture:new Hc(n.pixelwidth,n.pixelheight,n.stencilBuffer?$a:qa,void 0,void 0,void 0,void 0,void 0,void 0,n.stencilBuffer?ro:no),stencilBuffer:n.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),n.renderTarget.isXRRenderTarget=!1,n.plane.material=n.material,n.material.map=n.renderTarget.texture,n.material.map.offset.y=1,n.material.map.repeat.y=-1,delete n.xrlayer;this.isPresenting=!1,this._useMultiview=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function wV(e){const t=this._controllers,n=this._controllerInputSources;for(let r=0;r<e.removed.length;r++){const i=e.removed[r],a=n.indexOf(i);a>=0&&(n[a]=null,t[a].disconnect(i))}for(let r=0;r<e.added.length;r++){const i=e.added[r];let a=n.indexOf(i);if(-1===a){for(let e=0;e<t.length;e++){if(e>=n.length){n.push(i),a=e;break}if(null===n[e]){n[e]=i,a=e;break}}if(-1===a)break}const o=t[a];o&&o.connect(i)}}function SV(e){return"quad"===e.type?this._glBinding.createQuadLayer({transform:new XRRigidTransform(e.translation,e.quaternion),width:e.width/2,height:e.height/2,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(e.translation,e.quaternion),radius:e.radius,centralAngle:e.centralAngle,aspectRatio:e.aspectRatio,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1})}function TV(e,t){if(void 0===t)return;const n=this._cameraXR,r=this._renderer,i=r.backend,a=this._glBaseLayer,o=this.getReferenceSpace(),s=t.getViewerPose(o);if(this._xrFrame=t,null!==s){const e=s.views;null!==this._glBaseLayer&&i.setXRTarget(a.framebuffer);let t=!1;e.length!==n.cameras.length&&(n.cameras.length=0,t=!0);for(let r=0;r<e.length;r++){const o=e[r];let s;if(!0===this._useLayers){const e=this._glBinding.getViewSubImage(this._glProjLayer,o);s=e.viewport,0===r&&i.setXRRenderTargetTextures(this._xrRenderTarget,e.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:e.depthStencilTexture)}else s=a.getViewport(o);let u=this._cameras[r];void 0===u&&(u=new mc,u.layers.enable(r),u.viewport=new $s,this._cameras[r]=u),u.matrix.fromArray(o.transform.matrix),u.matrix.decompose(u.position,u.quaternion,u.scale),u.projectionMatrix.fromArray(o.projectionMatrix),u.projectionMatrixInverse.copy(u.projectionMatrix).invert(),u.viewport.set(s.x,s.y,s.width,s.height),0===r&&(n.matrix.copy(u.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)),!0===t&&n.cameras.push(u)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let u=0;u<this._controllers.length;u++){const e=this._controllerInputSources[u],n=this._controllers[u];null!==e&&void 0!==n&&n.update(e,t,o)}this._currentAnimationLoop&&this._currentAnimationLoop(e,t),t.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:t}),this._xrFrame=null}const MV=new _c,BV=new xs,PV=new $s,NV=new Ic,RV=new Uc,LV=new Tu,IV=new $s;class kV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:i=!0,stencil:a=!1,antialias:o=!1,samples:s=0,getFallback:u=null,colorBufferType:l=Ka,multiview:c=!1}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=s||!0===o?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=Yo,this.toneMapping=0,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=a,this.info=new $k,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new gV,this.lighting=new yV,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new $s(0,0,this._width,this._height),this._scissor=new $s(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new SO(new QR),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const h=!0===this.alpha?0:1;this._clearColor=new EO(0,0,0,h),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=l,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:1},this.xr=new _V(this,c),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(e,t,n)=>{await this.compileAsync(e,t);const r=this._renderLists.get(e,t),i=this._renderContexts.get(e,t,this._renderTarget),a=e.overrideMaterial||n.material,o=this._objects.get(n,a,e,t,r.lightsNode,i,i.clippingContext),{fragmentShader:s,vertexShader:u}=o.getNodeBuilderState();return{fragmentShader:s,vertexShader:u}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return null!==this._initPromise||(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(r){if(null===this._getFallback)return void t(r);try{this.backend=n=this._getFallback(r),await n.init(this)}catch(r){return void t(r)}}this._nodes=new cV(this,n),this._animation=new Lk(this._nodes,this.info),this._attributes=new Xk(n),this._background=new sz(this,this._nodes),this._geometries=new Jk(this._attributes,this.info),this._textures=new yO(this,n,this.info),this._pipelines=new rO(n,this._nodes),this._bindings=new iO(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new zk(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new cO(this.lighting),this._bundles=new mV,this._renderContexts=new vO,this._animation.start(),this._initialized=!0,e(this)})),this._initPromise}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();const r=this._nodes.nodeFrame,i=r.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,s=this._compilationPromises,u=!0===e.isScene?e:MV;null===n&&(n=e);const l=this._renderTarget,c=this._renderContexts.get(n,t,l),h=this._activeMipmapLevel,d=[];this._currentRenderContext=c,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=d,r.renderId++,r.update(),c.depth=this.depth,c.stencil=this.stencil,c.clippingContext||(c.clippingContext=new dV),c.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,l);const p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,c.clippingContext),n!==e&&n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&p.pushLight(e)}),p.finish(),null!==l){this._textures.updateRenderTarget(l,h);const e=this._textures.get(l);c.textures=e.textures,c.depthTexture=e.depthTexture}else c.textures=null,c.depthTexture=null;this._background.update(u,p,c);const f=p.opaque,m=p.transparent,g=p.transparentDoublePass,v=p.lightsNode;!0===this.opaque&&f.length>0&&this._renderObjects(f,t,u,v),!0===this.transparent&&m.length>0&&this._renderTransparents(m,g,t,u,v),r.renderId=i,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=s,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(d)}async renderAsync(e,t){!1===this._initialized&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}set highPrecision(e){!0===e?(this.overrideNodes.modelViewMatrix=pP,this.overrideNodes.modelNormalViewMatrix=fP):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===pP&&this.overrideNodes.modelNormalViewMatrix===fP}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t="THREE.WebGPURenderer: ".concat(e.api," Device Lost:\n\nMessage: ").concat(e.message);e.reason&&(t+="\nReason: ".concat(e.reason)),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:i,renderList:a}=e,o=this._currentRenderContext,s=this._bundles.get(r,i),u=this.backend.get(s);void 0===u.renderContexts&&(u.renderContexts=new Set);const l=r.version!==u.version,c=!1===u.renderContexts.has(o)||l;if(u.renderContexts.add(o),c){this.backend.beginBundle(o),(void 0===u.renderObjects||l)&&(u.renderObjects=[]),this._currentRenderBundle=s;const{transparentDoublePass:e,transparent:c,opaque:h}=a;!0===this.opaque&&h.length>0&&this._renderObjects(h,i,t,n),!0===this.transparent&&c.length>0&&this._renderTransparents(c,e,i,t,n),this._currentRenderBundle=null,this.backend.finishBundle(o,s),u.version=r.version}else{const{renderObjects:e}=u;for(let t=0,n=e.length;t<n;t++){const n=e[t];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(o,s)}render(e,t){if(!1===this._initialized)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(!1===(0!==e)&&!1===(t!==Jo))return null;const{width:n,height:r}=this.getDrawingBufferSize(BV),{depth:i,stencil:a}=this;let o=this._frameBufferTarget;null===o&&(o=new Qs(n,r,{depthBuffer:i,stencilBuffer:a,type:this._colorBufferType,format:to,colorSpace:Jo,generateMipmaps:!1,minFilter:Oa,magFilter:Oa,samples:this.samples}),o.isPostProcessingRenderTarget=!0,this._frameBufferTarget=o);const s=this.getOutputRenderTarget();return o.depthBuffer=i,o.stencilBuffer=a,null!==s?o.setSize(s.width,s.height,s.depth):o.setSize(n,r,1),o.viewport.copy(this._viewport),o.scissor.copy(this._scissor),o.viewport.multiplyScalar(this._pixelRatio),o.scissor.multiplyScalar(this._pixelRatio),o.scissorTest=this._scissorTest,o.multiview=null!==s&&s.multiview,o.resolveDepthBuffer=null===s||s.resolveDepthBuffer,o.autoAllocateDepthBuffer=null!==s&&s.autoAllocateDepthBuffer,o}_renderScene(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!0===this._isDeviceLost)return;const r=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,a=i.renderId,o=this._currentRenderContext,s=this._currentRenderObjectFunction,u=!0===e.isScene?e:MV,l=this._renderTarget||this._outputRenderTarget,c=this._activeCubeFace,h=this._activeMipmapLevel;let d;null!==r?(d=r,this.setRenderTarget(d)):d=l;const p=this._renderContexts.get(e,t,d);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls;const f=this.coordinateSystem,m=this.xr;if(t.coordinateSystem!==f&&!1===m.isPresenting&&(t.coordinateSystem=f,t.updateProjectionMatrix(),t.isArrayCamera))for(const S of t.cameras)S.coordinateSystem=f,S.updateProjectionMatrix();!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===m.enabled&&!0===m.isPresenting&&(!0===m.cameraAutoUpdate&&m.updateCamera(t),t=m.getCamera());let g=this._viewport,v=this._scissor,D=this._pixelRatio;null!==d&&(g=d.viewport,v=d.scissor,D=1),this.getDrawingBufferSize(BV),PV.set(0,0,BV.width,BV.height);const y=void 0===g.minDepth?0:g.minDepth,E=void 0===g.maxDepth?1:g.maxDepth;p.viewportValue.copy(g).multiplyScalar(D).floor(),p.viewportValue.width>>=h,p.viewportValue.height>>=h,p.viewportValue.minDepth=y,p.viewportValue.maxDepth=E,p.viewport=!1===p.viewportValue.equals(PV),p.scissorValue.copy(v).multiplyScalar(D).floor(),p.scissor=this._scissorTest&&!1===p.scissorValue.equals(PV),p.scissorValue.width>>=h,p.scissorValue.height>>=h,p.clippingContext||(p.clippingContext=new dV),p.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,d);const A=t.isArrayCamera?RV:NV;t.isArrayCamera||(LV.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),A.setFromProjectionMatrix(LV,f));const C=this._renderLists.get(e,t);if(C.begin(),this._projectObject(e,t,0,C,p.clippingContext),C.finish(),!0===this.sortObjects&&C.sort(this._opaqueSort,this._transparentSort),null!==d){this._textures.updateRenderTarget(d,h);const e=this._textures.get(d);p.textures=e.textures,p.depthTexture=e.depthTexture,p.width=e.width,p.height=e.height,p.renderTarget=d,p.depth=d.depthBuffer,p.stencil=d.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=this.domElement.width,p.height=this.domElement.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=h,p.height>>=h,p.activeCubeFace=c,p.activeMipmapLevel=h,p.occlusionQueryCount=C.occlusionQueryCount,this._background.update(u,C,p),p.camera=t,this.backend.beginRender(p);const{bundles:_,lightsNode:b,transparentDoublePass:x,transparent:F,opaque:w}=C;return _.length>0&&this._renderBundles(_,u,b),!0===this.opaque&&w.length>0&&this._renderObjects(w,t,u,b),!0===this.transparent&&F.length>0&&this._renderTransparents(F,x,t,u,b),this.backend.finishRender(p),i.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=s,null!==r&&(this.setRenderTarget(l,c,h),this._renderOutput(d)),u.onAfterRender(this,e,t,d),p}_setXRLayerSize(e,t){this._width=e,this._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),!0===n&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,n,r),o.minDepth=i,o.maxDepth=a}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!1===this._initialized)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const r=this._renderTarget||this._getFrameBufferTarget();let i=null;if(null!==r){this._textures.updateRenderTarget(r);const e=this._textures.get(r);i=this._renderContexts.getForClear(r),i.textures=e.textures,i.depthTexture=e.depthTexture,i.width=e.width,i.height=e.height,i.renderTarget=r,i.depth=r.depthBuffer,i.stencil=r.stencilBuffer,i.clearColorValue=this.backend.getClearColor(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,i),null!==r&&null===this._renderTarget&&this._renderOutput(r)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];!1===this._initialized&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:0}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:Jo}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||null===this._renderTarget}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),null!==this._frameBufferTarget&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{null!==e&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(!0===this._isDeviceLost)return;if(!1===this._initialized)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,i=this._pipelines,a=this._bindings,o=this._nodes,s=Array.isArray(e)?e:[e];if(void 0===s[0]||!0!==s[0].isComputeNode)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const u of s){if(!1===i.has(u)){const e=()=>{u.removeEventListener("dispose",e),i.delete(u),a.delete(u),o.delete(u)};u.addEventListener("dispose",e);const t=u.onInitFunction;null!==t&&t.call(u,{renderer:this})}o.updateForCompute(u),a.updateForCompute(u);const t=a.getForCompute(u),n=i.getForCompute(u,t);r.compute(e,u,t,n)}r.finishCompute(e),t.renderId=n}async computeAsync(e){!1===this._initialized&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return!1===this._initialized&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"render";return!1===this._initialized&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return!1===this._initialized?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){!1===this._initialized&&await this.init(),this._textures.updateTexture(e)}initTexture(e){!1===this._initialized&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!==t)if(t.isVector2)t=IV.set(t.x,t.y,e.image.width,e.image.height).floor();else{if(!t.isVector4)return void console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");t=IV.copy(t).floor()}else t=IV.set(0,0,e.image.width,e.image.height);let n,r=this._currentRenderContext;null!==r?n=r.renderTarget:(n=this._renderTarget||this._getFrameBufferTarget(),null!==n&&(this._textures.updateRenderTarget(n),r=this._textures.get(n))),this._textures.updateTexture(e,{renderTarget:n}),this.backend.copyFramebufferToTexture(e,r,t)}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,i,a)}async readRenderTargetPixelsAsync(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return this.backend.copyTextureToBuffer(e.textures[a],t,n,r,i,o)}_projectObject(e,t,n,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const a=t.isArrayCamera?RV:NV;if(!e.frustumCulled||a.intersectsSprite(e,t)){!0===this.sortObjects&&IV.setFromMatrixPosition(e.matrixWorld).applyMatrix4(LV);const{geometry:t,material:a}=e;a.visible&&r.push(e,t,a,n,IV.z,null,i)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const a=t.isArrayCamera?RV:NV;if(!e.frustumCulled||a.intersectsObject(e,t)){const{geometry:t,material:a}=e;if(!0===this.sortObjects&&(null===t.boundingSphere&&t.computeBoundingSphere(),IV.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(LV)),Array.isArray(a)){const o=t.groups;for(let s=0,u=o.length;s<u;s++){const u=o[s],l=a[u.materialIndex];l&&l.visible&&r.push(e,t,l,n,IV.z,u,i)}}else a.visible&&r.push(e,t,a,n,IV.z,null,i)}}if(!0===e.isBundleGroup&&void 0!==this.backend.beginBundle){const n=r;(r=this._renderLists.get(e,t)).begin(),n.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const a=e.children;for(let o=0,s=a.length;o<s;o++)this._projectObject(a[o],t,n,r,i)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,i){if(t.length>0){for(const{material:e}of t)e.side=1;this._renderObjects(t,n,r,i,"backSide");for(const{material:e}of t)e.side=0;this._renderObjects(e,n,r,i);for(const{material:e}of t)e.side=2}else this._renderObjects(e,n,r,i)}_renderObjects(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;for(let a=0,o=e.length;a<o;a++){const{object:o,geometry:s,material:u,group:l,clippingContext:c}=e[a];this._currentRenderObjectFunction(o,n,t,s,u,l,r,c,i)}}renderObject(e,t,n,r,i,a,o){let s,u,l,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;if(e.onBeforeRender(this,t,n,r,i,a),!0===i.allowOverride&&null!==t.overrideMaterial){const e=t.overrideMaterial;i.positionNode&&i.positionNode.isNode&&(s=e.positionNode,e.positionNode=i.positionNode),e.alphaTest=i.alphaTest,e.alphaMap=i.alphaMap,e.transparent=i.transparent||i.transmission>0,e.isShadowPassMaterial&&(e.side=null===i.shadowSide?i.side:i.shadowSide,i.depthNode&&i.depthNode.isNode&&(l=e.depthNode,e.depthNode=i.depthNode),i.castShadowNode&&i.castShadowNode.isNode&&(u=e.colorNode,e.colorNode=i.castShadowNode),i.castShadowPositionNode&&i.castShadowPositionNode.isNode&&(s=e.positionNode,e.positionNode=i.castShadowPositionNode)),i=e}!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,this._handleObjectFunction(e,i,t,n,o,a,c,"backSide"),i.side=0,this._handleObjectFunction(e,i,t,n,o,a,c,h),i.side=2):this._handleObjectFunction(e,i,t,n,o,a,c,h),void 0!==s&&(t.overrideMaterial.positionNode=s),void 0!==l&&(t.overrideMaterial.depthNode=l),void 0!==u&&(t.overrideMaterial.colorNode=u),e.onAfterRender(this,t,n,r,i,a)}_renderObjectDirect(e,t,n,r,i,a,o,s){const u=this._objects.get(e,t,n,r,i,this._currentRenderContext,o,s);u.drawRange=e.geometry.drawRange,u.group=a;const l=this._nodes.needsRefresh(u);if(l&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),null!==this._currentRenderBundle){this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup}this.backend.draw(u,this.info),l&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,n,r,i,a,o,s){const u=this._objects.get(e,t,n,r,i,this._currentRenderContext,o,s);u.drawRange=e.geometry.drawRange,u.group=a,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class OV{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}class UV extends OV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return(e=this._buffer.byteLength)+(qk-e%qk)%qk;var e}get buffer(){return this._buffer}update(){return!0}}class zV extends UV{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isUniformBuffer=!0}}let VV=0;class GV extends zV{constructor(e,t){super("UniformBuffer_"+VV++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class HV extends zV{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(null===e){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,r=this.uniforms.length;n<r;n++){const r=this.uniforms[n],i=r.boundary,a=r.itemSize*e,o=t%qk,s=o%i,u=o+s;t+=s,0!==u&&qk-u<a&&(t+=qk-u),r.offset=t/e,t+=a}return Math.ceil(t/qk)*qk}update(){let e=!1;for(const t of this.uniforms)!0===this.updateByType(t)&&(e=!0);return e}updateByType(e){return e.isNumberUniform?this.updateNumber(e):e.isVector2Uniform?this.updateVector2(e):e.isVector3Uniform?this.updateVector3(e):e.isVector4Uniform?this.updateVector4(e):e.isColorUniform?this.updateColor(e):e.isMatrix3Uniform?this.updateMatrix3(e):e.isMatrix4Uniform?this.updateMatrix4(e):void console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i]!==r){this._getBufferForType(a)[i]=n[i]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y){const e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z){const e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z||n[i+4]!==r.w){const e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,e[i+3]=n[i+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset;if(n[i+0]!==r.r||n[i+1]!==r.g||n[i+2]!==r.b){const e=this.buffer;e[i+0]=n[i+0]=r.r,e[i+1]=n[i+1]=r.g,e[i+2]=n[i+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;if(n[i+0]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2]||n[i+4]!==r[3]||n[i+5]!==r[4]||n[i+6]!==r[5]||n[i+8]!==r[6]||n[i+9]!==r[7]||n[i+10]!==r[8]){const e=this.buffer;e[i+0]=n[i+0]=r[0],e[i+1]=n[i+1]=r[1],e[i+2]=n[i+2]=r[2],e[i+4]=n[i+4]=r[3],e[i+5]=n[i+5]=r[4],e[i+6]=n[i+6]=r[5],e[i+8]=n[i+8]=r[6],e[i+9]=n[i+9]=r[7],e[i+10]=n[i+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;if(!1===function(e,t,n){for(let r=0,i=t.length;r<i;r++)if(e[n+r]!==t[r])return!1;return!0}(n,r,i)){this.buffer.set(r,i),function(e,t,n){for(let r=0,i=t.length;r<i;r++)e[n+r]=t[r]}(n,r,i),t=!0}return t}_getBufferForType(e){return"int"===e||"ivec2"===e||"ivec3"===e||"ivec4"===e?new Int32Array(this.buffer.buffer):"uint"===e||"uvec2"===e||"uvec3"===e||"uvec4"===e?new Uint32Array(this.buffer.buffer):this.buffer}}let jV=0;class WV extends HV{constructor(e,t){super(e),this.id=jV++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let qV=0;class XV extends OV{constructor(e,t){super(e),this.id=qV++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version&&(this.version=e.version,!0)}}class KV extends XV{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class YV extends KV{constructor(e,t,n){super(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.isSampledCubeTexture=!0}}class JV extends KV{constructor(e,t,n){super(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.isSampledTexture3D=!0}}const $V={textureDimensions:"textureSize",equals:"equal"},QV={low:"lowp",medium:"mediump",high:"highp"},ZV={swizzleAssign:!0,storageBuffer:!1},eG={perspective:"smooth",linear:"noperspective"},tG={centroid:"centroid","flat first":"flat","flat either":"flat"},nG="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\nprecision highp sampler2DArray;\n\nprecision highp usampler2D;\nprecision highp usampler3D;\nprecision highp usamplerCube;\nprecision highp usampler2DArray;\n\nprecision highp isampler2D;\nprecision highp isampler3D;\nprecision highp isamplerCube;\nprecision highp isampler2DArray;\n\nprecision lowp sampler2DShadow;\nprecision lowp sampler2DArrayShadow;\nprecision lowp samplerCubeShadow;\n";class rG extends Uz{constructor(e,t){super(e,t,new oV),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==Ko}getMethod(e){return $V[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const i of t.inputs)r.push(this.getType(i.type)+" "+i.name);return"".concat(this.getType(t.type)," ").concat(t.name,"( ").concat(r.join(", ")," ) {\n\n\t").concat(n.vars,"\n\n").concat(n.code,"\n\treturn ").concat(n.result,";\n\n}")}setupPBO(e){const t=e.value;if(void 0===t.pbo){const e=t.array,n=t.count*t.itemSize,{itemSize:r}=t,i=t.array.constructor.name.toLowerCase().includes("int");let a=i?ao:io;2===r?a=i?so:oo:3===r?a=i?1032:eo:4===r&&(a=i?uo:to);const o={Float32Array:Xa,Uint8Array:Va,Uint16Array:ja,Uint32Array:qa,Int8Array:Ga,Int16Array:Ha,Int32Array:Wa,Uint8ClampedArray:Va},s=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/r))));let u=Math.ceil(n/r/s);s*u*r<n&&u++;const l=s*u*r,c=new e.constructor(l);c.set(e,0),t.array=c;const h=new Sc(t.array,s,u,a,o[t.array.constructor.name]||Xa);h.needsUpdate=!0,h.isPBOTexture=!0;const d=new HB(h,null,null);d.setPrecision("high"),t.pboNode=d,t.pbo=d.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;return e.isNodeUniform&&!0!==e.node.isTextureNode&&!0!==e.node.isBufferNode?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){this.renderer.backend.get(r).pbo=r.pbo}const i=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),a=this.getPropertyName(i);this.increaseUsage(n);const o=n.build(this,"uint"),s=this.getDataFromNode(e);let u=s.propertyName;if(void 0===u){const n=this.getVarFromNode(e);u=this.getPropertyName(n);const i=this.getDataFromNode(t);let l=i.propertySizeName;void 0===l&&(l=u+"Size",this.getVarFromNode(t,l,"uint"),this.addLineFlowCode("".concat(l," = uint( textureSize( ").concat(a,", 0 ).x )"),e),i.propertySizeName=l);const{itemSize:c}=r,h="."+jF.join("").slice(0,c),d="ivec2(".concat(o," % ").concat(l,", ").concat(o," / ").concat(l,")"),p=this.generateTextureLoad(null,a,d,null,"0");let f="vec4";r.pbo.type===qa?f="uvec4":r.pbo.type===Wa&&(f="ivec4"),this.addLineFlowCode("".concat(u," = ").concat(f,"(").concat(p,")").concat(h),e),s.propertyName=u}return u}generateTextureLoad(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0";return r?"texelFetch( ".concat(t,", ivec3( ").concat(n,", ").concat(r," ), ").concat(i," )"):"texelFetch( ".concat(t,", ").concat(n,", ").concat(i," )")}generateTexture(e,t,n,r){return e.isDepthTexture?(r&&(n="vec4( ".concat(n,", ").concat(r," )")),"texture( ".concat(t,", ").concat(n," ).x")):(r&&(n="vec3( ".concat(n,", ").concat(r," )")),"texture( ".concat(t,", ").concat(n," )"))}generateTextureLevel(e,t,n,r){return"textureLod( ".concat(t,", ").concat(n,", ").concat(r," )")}generateTextureBias(e,t,n,r){return"texture( ".concat(t,", ").concat(n,", ").concat(r," )")}generateTextureGrad(e,t,n,r){return"textureGrad( ".concat(t,", ").concat(n,", ").concat(r[0],", ").concat(r[1]," )")}generateTextureCompare(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===a)return i?"texture( ".concat(t,", vec4( ").concat(n,", ").concat(i,", ").concat(r," ) )"):"texture( ".concat(t,", vec3( ").concat(n,", ").concat(r," ) )");console.error("WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ".concat(a," shader."))}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const r of n)t.push("".concat(this.getVar(r.type,r.name,r.count),";"));return t.join("\n\t")}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const a of t){let t=null,i=!1;if("texture"===a.type||"texture3D"===a.type){const e=a.node.value;let n="";!0!==e.isDataTexture&&!0!==e.isData3DTexture||(e.type===qa?n="u":e.type===Wa&&(n="i")),t="texture3D"===a.type&&!1===e.isArrayTexture?"".concat(n,"sampler3D ").concat(a.name,";"):e.compareFunction?!0===e.isArrayTexture?"sampler2DArrayShadow ".concat(a.name,";"):"sampler2DShadow ".concat(a.name,";"):!0===e.isArrayTexture||!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?"".concat(n,"sampler2DArray ").concat(a.name,";"):"".concat(n,"sampler2D ").concat(a.name,";")}else if("cubeTexture"===a.type)t="samplerCube ".concat(a.name,";");else if("buffer"===a.type){const e=a.node,n=this.getType(e.bufferType),r=e.bufferCount,i=r>0?r:"";t="".concat(e.name," {\n\t").concat(n," ").concat(a.name,"[").concat(i,"];\n};\n")}else{const n=this.getVectorType(a.type);t="".concat(n," ").concat(this.getPropertyName(a,e),";"),i=!0}const o=a.node.precision;if(null!==o&&(t=QV[o]+" "+t),i){t="\t"+t;const e=a.groupNode.name;(r[e]||(r[e]=[])).push(t)}else t="uniform "+t,n.push(t)}let i="";for(const a in r){const t=r[a];i+=this._getGLSLUniformStruct(e+"_"+a,t.join("\n"))+"\n"}return i+=n.join("\n"),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Wa){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;!1===(r instanceof Uint32Array||r instanceof Int32Array)&&(t=t.slice(1))}return t}getAttributes(e){let t="";if("vertex"===e||"compute"===e){const e=this.getAttributesArray();let n=0;for(const r of e)t+="layout( location = ".concat(n++," ) in ").concat(r.type," ").concat(r.name,";\n")}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push("\t".concat(n.type," ").concat(n.name,";"));return t.join("\n")}getStructs(e){const t=[],n=this.structs[e],r=[];for(const i of n)if(i.output)for(const e of i.members)r.push("layout( location = ".concat(e.index," ) out ").concat(e.type," ").concat(e.name,";"));else{let e="struct "+i.name+" {\n";e+=this.getStructMembers(i),e+="\n};\n",t.push(e)}return 0===r.length&&r.push("layout( location = 0 ) out vec4 fragColor;"),"\n"+r.join("\n")+"\n\n"+t.join("\n")}getVaryings(e){let t="";const n=this.varyings;if("vertex"===e||"compute"===e)for(const r of n){"compute"===e&&(r.needsInterpolation=!0);const n=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const e=eG[r.interpolationType]||r.interpolationType,i=tG[r.interpolationSampling]||"";t+="".concat(e," ").concat(i," out ").concat(n," ").concat(r.name,";\n")}else{const e=n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":"";t+="".concat(e,"out ").concat(n," ").concat(r.name,";\n")}else t+="".concat(n," ").concat(r.name,";\n")}else if("fragment"===e)for(const r of n)if(r.needsInterpolation){const e=this.getType(r.type);if(r.interpolationType){const n=eG[r.interpolationType]||r.interpolationType,i=tG[r.interpolationSampling]||"";t+="".concat(n," ").concat(i," in ").concat(e," ").concat(r.name,";\n")}else{const n=e.includes("int")||e.includes("uv")||e.includes("iv")?"flat ":"";t+="".concat(n,"in ").concat(e," ").concat(r.name,";\n")}}for(const r of this.builtins[e])t+="".concat(r,";\n");return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){const e=this.object.workgroupSize.reduce((e,t)=>e*t,1);return"uint( gl_InstanceID ) % ".concat(e,"u")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage;const r=this.extensions[n]||(this.extensions[n]=new Map);!1===r.has(e)&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if("vertex"===e){const t=this.renderer.backend.extensions;this.object.isBatchedMesh&&t.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(void 0!==n)for(const{name:r,behavior:i}of n.values())t.push("#extension ".concat(r," : ").concat(i));return t.join("\n")}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=ZV[e];if(void 0===t){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance"}if(void 0!==n){const e=this.renderer.backend.extensions;e.has(n)&&(e.get(n),t=!0)}ZV[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push("out float gl_ClipDistance[ ".concat(e," ]"))}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],i=this.getPropertyName(r.attributeNode);i&&(t+="".concat(r.varyingName," = ").concat(i,";\n\t"))}return t}_getGLSLUniformStruct(e,t){return"\nlayout( std140 ) uniform ".concat(e," {\n").concat(t,"\n};")}_getGLSLVertexCode(e){return"#version 300 es\n\n".concat(this.getSignature(),"\n\n// extensions\n").concat(e.extensions,"\n\n// precision\n").concat(nG,"\n\n// uniforms\n").concat(e.uniforms,"\n\n// varyings\n").concat(e.varyings,"\n\n// attributes\n").concat(e.attributes,"\n\n// codes\n").concat(e.codes,"\n\nvoid main() {\n\n\t// vars\n\t").concat(e.vars,"\n\n\t// transforms\n\t").concat(e.transforms,"\n\n\t// flow\n\t").concat(e.flow,"\n\n\tgl_PointSize = 1.0;\n\n}\n")}_getGLSLFragmentCode(e){return"#version 300 es\n\n".concat(this.getSignature(),"\n\n// extensions\n").concat(e.extensions,"\n\n// precision\n").concat(nG,"\n\n// uniforms\n").concat(e.uniforms,"\n\n// varyings\n").concat(e.varyings,"\n\n// codes\n").concat(e.codes,"\n\n// structs\n").concat(e.structs,"\n\nvoid main() {\n\n\t// vars\n\t").concat(e.vars,"\n\n\t// flow\n\t").concat(e.flow,"\n\n}\n")}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n="// code\n\n";n+=this.flowCode[t];const r=this.flowNodes[t],i=r[r.length-1];for(const e of r){const r=this.getFlowData(e),a=e.name;a&&(n.length>0&&(n+="\n"),n+="\t// flow -> ".concat(a,"\n\t")),n+="".concat(r.code,"\n\t"),e===i&&"compute"!==t&&(n+="// result\n\t","vertex"===t?(n+="gl_Position = ",n+="".concat(r.result,";")):"fragment"===t&&(e.outputNode.isOutputStructNode||(n+="fragColor = ",n+="".concat(r.result,";"))))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache);let o=a.uniformGPU;if(void 0===o){const r=e.groupNode,s=r.name,u=this.getBindGroupArray(s,n);if("texture"===t)o=new KV(i.name,i.node,r),u.push(o);else if("cubeTexture"===t)o=new YV(i.name,i.node,r),u.push(o);else if("texture3D"===t)o=new JV(i.name,i.node,r),u.push(o);else if("buffer"===t){e.name="NodeBuffer_".concat(e.id),i.name="buffer".concat(e.id);const t=new GV(e,r);t.name=e.name,u.push(t),o=t}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let a=e[s];void 0===a&&(a=new WV(n+"_"+s,r),e[s]=a,u.push(a)),o=this.getNodeUniform(i,t),a.addUniform(o)}a.uniformGPU=o}return i}}let iG=null,aG=null;class oG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=!0===e.trackTimestamp}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"render";if(!this.trackTimestamp)return void Is("WebGPURenderer: Timestamp tracking is disabled.");const t=this.timestampQueryPool[e];if(!t)return void Is("WebGPURenderer: No timestamp query pool for type '".concat(e,"' found."));const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return iG=iG||new xs,this.renderer.getDrawingBufferSize(iG)}setScissorTest(){}getClearColor(){const e=this.renderer;return aG=aG||new EO,e.getClearColor(aG),aG.getRGB(aG),aG}getDomElement(){let e=this.domElement;return null===e&&(e=void 0!==this.parameters.canvas?this.parameters.canvas:Rs(),"setAttribute"in e&&e.setAttribute("data-engine","three.js r".concat(Hi," webgpu")),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let sG,uG,lG=0;class cG{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return"".concat(this.baseId,"|").concat(this.activeBufferIndex)}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class hG{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,i=e.array,a=e.usage||r.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,s=n.get(o);let u,l=s.bufferGPU;if(void 0===l&&(l=this._createBuffer(r,t,i,a),s.bufferGPU=l,s.bufferType=t,s.version=o.version),i instanceof Float32Array)u=r.FLOAT;else if(i instanceof Uint16Array)u=e.isFloat16BufferAttribute?r.HALF_FLOAT:r.UNSIGNED_SHORT;else if(i instanceof Int16Array)u=r.SHORT;else if(i instanceof Uint32Array)u=r.UNSIGNED_INT;else if(i instanceof Int32Array)u=r.INT;else if(i instanceof Int8Array)u=r.BYTE;else if(i instanceof Uint8Array)u=r.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);u=r.UNSIGNED_BYTE}let c={bufferGPU:l,bufferType:t,type:u,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:u===r.INT||u===r.UNSIGNED_INT||e.gpuType===Wa,id:lG++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const e=this._createBuffer(r,t,i,a);c=new cG(c,e)}n.set(e,c)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,i=e.isInterleavedBufferAttribute?e.data:e,a=t.get(i),o=a.bufferType,s=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(o,a.bufferGPU),0===s.length)n.bufferSubData(o,0,r);else{for(let e=0,t=s.length;e<t;e++){const t=s[e];n.bufferSubData(o,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}i.clearUpdateRanges()}n.bindBuffer(o,null),a.version=i.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(r),a=e.array,o=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const s=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,s),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const u=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,s),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,u),n.deleteBuffer(s),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,n,r){const i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,n,r),e.bindBuffer(t,null),i}}class dG{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;sG={[ea]:e.FUNC_ADD,[ta]:e.FUNC_SUBTRACT,[na]:e.FUNC_REVERSE_SUBTRACT},uG={[ra]:e.ZERO,[ia]:e.ONE,[aa]:e.SRC_COLOR,[sa]:e.SRC_ALPHA,[pa]:e.SRC_ALPHA_SATURATE,[ha]:e.DST_COLOR,[la]:e.DST_ALPHA,[oa]:e.ONE_MINUS_SRC_COLOR,[ua]:e.ONE_MINUS_SRC_ALPHA,[da]:e.ONE_MINUS_DST_COLOR,[ca]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=(new $s).fromArray(t),this.currentViewport=(new $s).fromArray(n),this._tempVec4=new $s}enable(e){const{enabled:t}=this;!0!==t[e]&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;!1!==t[e]&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;0!==e?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,r,i,a,o,s){const{gl:u}=this;if(0!==e){if(!1===this.currentBlendingEnabled&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),5===e)i=i||t,a=a||n,o=o||r,t===this.currentBlendEquation&&i===this.currentBlendEquationAlpha||(u.blendEquationSeparate(sG[t],sG[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),n===this.currentBlendSrc&&r===this.currentBlendDst&&a===this.currentBlendSrcAlpha&&o===this.currentBlendDstAlpha||(u.blendFuncSeparate(uG[n],uG[r],uG[a],uG[o]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1;else if(e!==this.currentBlending||s!==this.currentPremultipledAlpha){if(this.currentBlendEquation===ea&&this.currentBlendEquationAlpha===ea||(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=ea,this.currentBlendEquationAlpha=ea),s)switch(e){case 1:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case 2:u.blendFunc(u.ONE,u.ONE);break;case 3:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case 4:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case 2:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case 3:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case 4:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=s}}else!0===this.currentBlendingEnabled&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1)}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(!1===this.currentScissor.equals(i)){const{gl:e}=this;e.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(!1===this.currentViewport.equals(i)){const{gl:e}=this;e.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){this.currentStencilFunc===e&&this.currentStencilRef===t&&this.currentStencilFuncMask===n||(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){this.currentStencilFail===e&&this.currentStencilZFail===t&&this.currentStencilZPass===n||(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;2===e.side?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let i=1===e.side;t&&(i=!i),this.setFlipSided(i),1===e.blending&&!1===e.transparent?this.setBlending(0):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n){const e=12288;for(let t=0;t<8;t++)t<n?this.enable(e+t):this.disable(e+t)}}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===t&&this.currentPolygonOffsetUnits===n||(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e&&(this.gl.useProgram(e),this.currentProgram=e,!0)}setVertexState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.gl;return(this.currentVAO!==e||this.currentIndex!==t)&&(n.bindVertexArray(e),null!==t&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0)}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t&&(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0)}drawBuffers(e,t){const{gl:n}=this;let r=[],i=!1;if(null!==e.textures){r=this.currentDrawbuffers.get(t),void 0===r&&(r=[],this.currentDrawbuffers.set(t,r));const a=e.textures;if(r.length!==a.length||r[0]!==n.COLOR_ATTACHMENT0){for(let e=0,t=a.length;e<t;e++)r[e]=n.COLOR_ATTACHMENT0+e;r.length=a.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;void 0===e&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:i,currentBoundTextures:a,maxTextures:o}=this;void 0===n&&(n=null===i?r.TEXTURE0+o-1:i);let s=a[n];void 0===s&&(s={type:void 0,texture:void 0},a[n]=s),s.type===e&&s.texture===t||(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),s.type=e,s.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,i="".concat(e,"-").concat(t);return this.currentBoundBufferBases[i]!==n&&(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[i]=n,!0)}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];void 0!==r&&void 0!==r.type&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class pG{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ko;const{gl:n,extensions:r}=this;let i;const a=zs.getTransfer(t);if(e===Va)return n.UNSIGNED_BYTE;if(e===Ya)return n.UNSIGNED_SHORT_4_4_4_4;if(e===Ja)return n.UNSIGNED_SHORT_5_5_5_1;if(e===Qa)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===Ga)return n.BYTE;if(e===Ha)return n.SHORT;if(e===ja)return n.UNSIGNED_SHORT;if(e===Wa)return n.INT;if(e===qa)return n.UNSIGNED_INT;if(e===Xa)return n.FLOAT;if(e===Ka)return n.HALF_FLOAT;if(e===Za)return n.ALPHA;if(e===eo)return n.RGB;if(e===to)return n.RGBA;if(e===no)return n.DEPTH_COMPONENT;if(e===ro)return n.DEPTH_STENCIL;if(e===io)return n.RED;if(e===ao)return n.RED_INTEGER;if(e===oo)return n.RG;if(e===so)return n.RG_INTEGER;if(e===uo)return n.RGBA_INTEGER;if(e===lo||e===co||e===ho||e===po)if(a===Qo){if(i=r.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(e===lo)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===co)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===ho)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===po)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=r.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===lo)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===co)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===ho)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===po)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===fo||e===mo||e===go||e===vo){if(i=r.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===fo)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===mo)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===go)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===vo)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Do||e===yo||e===Eo){if(i=r.get("WEBGL_compressed_texture_etc"),null===i)return null;if(e===Do||e===yo)return a===Qo?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===Eo)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(e===Ao||e===Co||e===_o||e===bo||e===xo||e===Fo||e===wo||e===So||e===To||e===Mo||e===Bo||e===Po||e===No||e===Ro){if(i=r.get("WEBGL_compressed_texture_astc"),null===i)return null;if(e===Ao)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Co)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===_o)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===bo)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===xo)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Fo)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===wo)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===So)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===To)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Mo)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Bo)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Po)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===No)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Ro)return a===Qo?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===Lo){if(i=r.get("EXT_texture_compression_bptc"),null===i)return null;if(e===Lo)return a===Qo?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(e===Oo||e===Uo||e===zo||e===Vo){if(i=r.get("EXT_texture_compression_rgtc"),null===i)return null;if(e===Lo)return i.COMPRESSED_RED_RGTC1_EXT;if(e===Uo)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===zo)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Vo)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===$a?n.UNSIGNED_INT_24_8:void 0!==n[e]?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{!function i(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED)return e.deleteSync(t),void r();a!==e.TIMEOUT_EXPIRED?(e.deleteSync(t),n()):requestAnimationFrame(i)}()})}}let fG,mG,gG,vG=!1;class DG{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},!1===vG&&(this._init(),vG=!0)}_init(){const e=this.gl;fG={[Pa]:e.REPEAT,[Na]:e.CLAMP_TO_EDGE,[Ra]:e.MIRRORED_REPEAT},mG={[La]:e.NEAREST,[Ia]:e.NEAREST_MIPMAP_NEAREST,[ka]:e.NEAREST_MIPMAP_LINEAR,[Oa]:e.LINEAR,[Ua]:e.LINEAR_MIPMAP_NEAREST,[za]:e.LINEAR_MIPMAP_LINEAR},gG={[es]:e.NEVER,[ss]:e.ALWAYS,[ts]:e.LESS,[rs]:e.LEQUAL,[ns]:e.EQUAL,[os]:e.GEQUAL,[is]:e.GREATER,[as]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return n=!0===e.isCubeTexture?t.TEXTURE_CUBE_MAP:!0===e.isArrayTexture||!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:!0===e.isData3DTexture?t.TEXTURE_3D:t.TEXTURE_2D,n}getInternalFormat(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{gl:a,extensions:o}=this;if(null!==e){if(void 0!==a[e])return a[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let s=t;if(t===a.RED&&(n===a.FLOAT&&(s=a.R32F),n===a.HALF_FLOAT&&(s=a.R16F),n===a.UNSIGNED_BYTE&&(s=a.R8),n===a.UNSIGNED_SHORT&&(s=a.R16),n===a.UNSIGNED_INT&&(s=a.R32UI),n===a.BYTE&&(s=a.R8I),n===a.SHORT&&(s=a.R16I),n===a.INT&&(s=a.R32I)),t===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.R8UI),n===a.UNSIGNED_SHORT&&(s=a.R16UI),n===a.UNSIGNED_INT&&(s=a.R32UI),n===a.BYTE&&(s=a.R8I),n===a.SHORT&&(s=a.R16I),n===a.INT&&(s=a.R32I)),t===a.RG&&(n===a.FLOAT&&(s=a.RG32F),n===a.HALF_FLOAT&&(s=a.RG16F),n===a.UNSIGNED_BYTE&&(s=a.RG8),n===a.UNSIGNED_SHORT&&(s=a.RG16),n===a.UNSIGNED_INT&&(s=a.RG32UI),n===a.BYTE&&(s=a.RG8I),n===a.SHORT&&(s=a.RG16I),n===a.INT&&(s=a.RG32I)),t===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RG8UI),n===a.UNSIGNED_SHORT&&(s=a.RG16UI),n===a.UNSIGNED_INT&&(s=a.RG32UI),n===a.BYTE&&(s=a.RG8I),n===a.SHORT&&(s=a.RG16I),n===a.INT&&(s=a.RG32I)),t===a.RGB){const e=i?$o:zs.getTransfer(r);n===a.FLOAT&&(s=a.RGB32F),n===a.HALF_FLOAT&&(s=a.RGB16F),n===a.UNSIGNED_BYTE&&(s=a.RGB8),n===a.UNSIGNED_SHORT&&(s=a.RGB16),n===a.UNSIGNED_INT&&(s=a.RGB32UI),n===a.BYTE&&(s=a.RGB8I),n===a.SHORT&&(s=a.RGB16I),n===a.INT&&(s=a.RGB32I),n===a.UNSIGNED_BYTE&&(s=e===Qo?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(s=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(s=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(s=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(s=a.RGB9_E5)}if(t===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RGB8UI),n===a.UNSIGNED_SHORT&&(s=a.RGB16UI),n===a.UNSIGNED_INT&&(s=a.RGB32UI),n===a.BYTE&&(s=a.RGB8I),n===a.SHORT&&(s=a.RGB16I),n===a.INT&&(s=a.RGB32I)),t===a.RGBA){const e=i?$o:zs.getTransfer(r);n===a.FLOAT&&(s=a.RGBA32F),n===a.HALF_FLOAT&&(s=a.RGBA16F),n===a.UNSIGNED_BYTE&&(s=a.RGBA8),n===a.UNSIGNED_SHORT&&(s=a.RGBA16),n===a.UNSIGNED_INT&&(s=a.RGBA32UI),n===a.BYTE&&(s=a.RGBA8I),n===a.SHORT&&(s=a.RGBA16I),n===a.INT&&(s=a.RGBA32I),n===a.UNSIGNED_BYTE&&(s=e===Qo?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(s=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(s=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(s=a.RGBA16UI),n===a.UNSIGNED_INT&&(s=a.RGBA32UI),n===a.BYTE&&(s=a.RGBA8I),n===a.SHORT&&(s=a.RGBA16I),n===a.INT&&(s=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(s=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(s=a.DEPTH_COMPONENT24),n===a.FLOAT&&(s=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(s=a.DEPTH24_STENCIL8),s!==a.R16F&&s!==a.R32F&&s!==a.RG16F&&s!==a.RG32F&&s!==a.RGBA16F&&s!==a.RGBA32F||o.get("EXT_color_buffer_float"),s}setTextureParameters(e,t){const{gl:n,extensions:r,backend:i}=this,a=zs.getPrimaries(zs.workingColorSpace),o=t.colorSpace===Ko?null:zs.getPrimaries(t.colorSpace),s=t.colorSpace===Ko||a===o?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,s),n.texParameteri(e,n.TEXTURE_WRAP_S,fG[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,fG[t.wrapT]),e!==n.TEXTURE_3D&&e!==n.TEXTURE_2D_ARRAY||t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,fG[t.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,mG[t.magFilter]);const u=void 0!==t.mipmaps&&t.mipmaps.length>0,l=t.minFilter===Oa&&u?za:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,mG[l]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,gG[t.compareFunction])),!0===r.has("EXT_texture_filter_anisotropic")){if(t.magFilter===La)return;if(t.minFilter!==ka&&t.minFilter!==za)return;if(t.type===Xa&&!1===r.has("OES_texture_float_linear"))return;if(t.anisotropy>1){const a=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,i=this.getGLTextureType(e);let a=r[i];void 0===a&&(a=t.createTexture(),n.state.bindTexture(i,a),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),r[i]=a),n.set(e,{textureGPU:a,glTextureType:i,isDefault:!0})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:i,width:a,height:o,depth:s}=t,u=r.utils.convert(e.format,e.colorSpace),l=r.utils.convert(e.type),c=this.getInternalFormat(e.internalFormat,u,l,e.colorSpace,e.isVideoTexture),h=n.createTexture(),d=this.getGLTextureType(e);r.state.bindTexture(d,h),this.setTextureParameters(d,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,c,a,o,s):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,c,a,o,s):e.isVideoTexture||n.texStorage2D(d,i,c,a,o),r.set(e,{textureGPU:h,glTextureType:d,glFormat:u,glType:l,glInternalFormat:c})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:i,glTextureType:a,glFormat:o,glType:s}=r.get(t),{width:u,height:l}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(a,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,u,l,o,s,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:i}=t,{textureGPU:a,glTextureType:o,glFormat:s,glType:u,glInternalFormat:l}=this.backend.get(e);if(!e.isRenderTargetTexture&&void 0!==a)if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){const r=e.mipmaps,i=t.image;for(let t=0;t<r.length;t++){const a=r[t];e.isCompressedArrayTexture?e.format!==n.RGBA?null!==s?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,a.width,a.height,i.depth,s,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,a.width,a.height,i.depth,s,u,a.data):null!==s?n.compressedTexSubImage2D(n.TEXTURE_2D,t,0,0,a.width,a.height,s,a.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const e=t.images;for(let t=0;t<6;t++){const a=yG(e[t]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,r,i,s,u,a)}}else if(e.isDataArrayTexture||e.isArrayTexture){const e=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,e.width,e.height,e.depth,s,u,e.data)}else if(e.isData3DTexture){const e=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,e.width,e.height,e.depth,s,u,e.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(o,0,l,s,u,t.image);else{const e=yG(t.image);n.texSubImage2D(o,0,0,0,r,i,s,u,e)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:i}=n.get(e);n.state.bindTexture(i,r),t.generateMipmap(i)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const e in r.framebuffers)t.deleteFramebuffer(r.framebuffers[e]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let e=0;e<r.msaaRenderbuffers.length;e++)t.deleteRenderbuffer(r.msaaRenderbuffers[e]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:r,renderTarget:i}=n.get(e);this.deallocateRenderBuffers(i),t.deleteTexture(r),n.delete(e)}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const{gl:o,backend:s}=this,{state:u}=this.backend,{textureGPU:l,glTextureType:c,glType:h,glFormat:d}=s.get(t);let p,f,m,g,v,D,y,E,A;u.bindTexture(c,l);const C=e.isCompressedTexture?e.mipmaps[a]:e.image;if(null!==n)p=n.max.x-n.min.x,f=n.max.y-n.min.y,m=n.isBox3?n.max.z-n.min.z:1,g=n.min.x,v=n.min.y,D=n.isBox3?n.min.z:0;else{const t=Math.pow(2,-i);p=Math.floor(C.width*t),f=Math.floor(C.height*t),m=e.isDataArrayTexture||e.isArrayTexture?C.depth:e.isData3DTexture?Math.floor(C.depth*t):1,g=0,v=0,D=0}null!==r?(y=r.x,E=r.y,A=r.z):(y=0,E=0,A=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const _=o.getParameter(o.UNPACK_ROW_LENGTH),b=o.getParameter(o.UNPACK_IMAGE_HEIGHT),x=o.getParameter(o.UNPACK_SKIP_PIXELS),F=o.getParameter(o.UNPACK_SKIP_ROWS),w=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,C.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,C.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,g),o.pixelStorei(o.UNPACK_SKIP_ROWS,v),o.pixelStorei(o.UNPACK_SKIP_IMAGES,D);const S=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const n=s.get(e),r=s.get(t),i=s.get(n.renderTarget),a=s.get(r.renderTarget),l=i.framebuffers[n.cacheKey],c=a.framebuffers[r.cacheKey];u.bindFramebuffer(o.READ_FRAMEBUFFER,l),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,c);let h=o.COLOR_BUFFER_BIT;e.isDepthTexture&&(h=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(g,v,p,f,y,E,p,f,h,o.NEAREST),u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else S?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(c,a,y,E,A,p,f,m,d,h,C.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(c,a,y,E,A,p,f,m,d,C.data):o.texSubImage3D(c,a,y,E,A,p,f,m,d,h,C):e.isDataTexture?o.texSubImage2D(c,a,y,E,p,f,d,h,C.data):e.isCompressedTexture?o.compressedTexSubImage2D(c,a,y,E,C.width,C.height,d,C.data):o.texSubImage2D(c,a,y,E,p,f,d,h,C);o.pixelStorei(o.UNPACK_ROW_LENGTH,_),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,b),o.pixelStorei(o.UNPACK_SKIP_PIXELS,x),o.pixelStorei(o.UNPACK_SKIP_ROWS,F),o.pixelStorei(o.UNPACK_SKIP_IMAGES,w),0===a&&t.generateMipmaps&&o.generateMipmap(c),u.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:i}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:s,z:u,w:l}=n,c=!0===e.isDepthTexture||t.renderTarget&&t.renderTarget.samples>0,h=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(c){const n=0!==o||0!==s;let c,d;if(!0===e.isDepthTexture?(c=r.DEPTH_BUFFER_BIT,d=r.DEPTH_ATTACHMENT,t.stencil&&(c|=r.STENCIL_BUFFER_BIT)):(c=r.COLOR_BUFFER_BIT,d=r.COLOR_ATTACHMENT0),n){const e=this.backend.get(t.renderTarget),n=e.framebuffers[t.getCacheKey()],d=e.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,n),i.bindFramebuffer(r.READ_FRAMEBUFFER,d);const p=h-s-l;r.blitFramebuffer(o,p,o+u,p+l,o,p,o+u,p+l,c,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,n),i.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,p,u,l),i.unbindTexture()}else{const e=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,e),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,d,r.TEXTURE_2D,a,0),r.blitFramebuffer(0,0,u,l,0,0,u,l,c,r.NEAREST),r.deleteFramebuffer(e)}}else i.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,h-l-s,u,l),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{gl:i}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:s,stencilBuffer:u,width:l,height:c}=a;if(i.bindRenderbuffer(i.RENDERBUFFER,e),s&&!u){let t=i.DEPTH_COMPONENT24;if(!0===r){this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,a.samples,t,l,c)}else n>0?(o&&o.isDepthTexture&&o.type===i.FLOAT&&(t=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,t,l,c)):i.renderbufferStorage(i.RENDERBUFFER,t,l,c);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else s&&u&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,l,c):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,l,c),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,r,i,a){const{backend:o,gl:s}=this,{textureGPU:u,glFormat:l,glType:c}=this.backend.get(e),h=s.createFramebuffer();s.bindFramebuffer(s.READ_FRAMEBUFFER,h);const d=e.isCubeTexture?s.TEXTURE_CUBE_MAP_POSITIVE_X+a:s.TEXTURE_2D;s.framebufferTexture2D(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,d,u,0);const p=this._getTypedArrayType(c),f=r*i*this._getBytesPerTexel(c,l),m=s.createBuffer();s.bindBuffer(s.PIXEL_PACK_BUFFER,m),s.bufferData(s.PIXEL_PACK_BUFFER,f,s.STREAM_READ),s.readPixels(t,n,r,i,l,c,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const g=new p(f/p.BYTES_PER_ELEMENT);return s.bindBuffer(s.PIXEL_PACK_BUFFER,m),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,g),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),s.deleteFramebuffer(h),g}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error("Unsupported WebGL type: ".concat(e))}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;return e===n.UNSIGNED_BYTE&&(r=1),e!==n.UNSIGNED_SHORT_4_4_4_4&&e!==n.UNSIGNED_SHORT_5_5_5_1&&e!==n.UNSIGNED_SHORT_5_6_5&&e!==n.UNSIGNED_SHORT&&e!==n.HALF_FLOAT||(r=2),e!==n.UNSIGNED_INT&&e!==n.FLOAT||(r=4),t===n.RGBA?4*r:t===n.RGB?3*r:t===n.ALPHA?r:void 0}}function yG(e){return e.isDataTexture?e.image.data:"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e:e.data}class EG{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return void 0===t&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class AG{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const CG={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class _G{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:i,type:a,info:o,index:s}=this;0!==s?n.drawElements(r,t,a,e):n.drawArrays(r,e,t),o.update(i,t,1)}renderInstances(e,t,n){const{gl:r,mode:i,type:a,index:o,object:s,info:u}=this;0!==n&&(0!==o?r.drawElementsInstanced(i,t,a,e,n):r.drawArraysInstanced(i,e,t,n),u.update(s,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:i,object:a,info:o}=this;if(0===n)return;const s=r.get("WEBGL_multi_draw");if(null===s)for(let u=0;u<n;u++)this.render(e[u],t[u]);else{0!==this.index?s.multiDrawElementsWEBGL(i,t,0,this.type,e,0,n):s.multiDrawArraysWEBGL(i,e,0,t,0,n);let r=0;for(let e=0;e<n;e++)r+=t[e];o.update(a,r,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:i,mode:a,object:o,info:s}=this;if(0===n)return;const u=i.get("WEBGL_multi_draw");if(null===u)for(let l=0;l<n;l++)this.renderInstances(e[l],t[l],r[l]);else{0!==this.index?u.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,r,0,n):u.multiDrawArraysInstancedWEBGL(a,e,0,t,0,r,0,n);let i=0;for(let e=0;e<n;e++)i+=t[e]*r[e];s.update(o,i,1)}}}class bG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class xG extends bG{constructor(e,t){if(super(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext)return console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),void(this.trackTimestamp=!1);this.queries=[];for(let n=0;n<this.maxQueries;n++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return Is("WebGPUTimestampQueryPool [".concat(this.type,"]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.").concat(this.type.toUpperCase()," ).")),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null==t)return;if(null!==this.activeQuery)return;const n=this.queries[t];if(n)try{"inactive"===this.queryStates.get(t)&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){console.error("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null!=t&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[n,r]of this.queryStates)if("ended"===r){const t=this.queries[n];e.push(this.resolveQuery(t))}if(0===e.length)return this.lastValue;const t=(await Promise.all(e)).reduce((e,t)=>e+t,0);return this.lastValue=t,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,t}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed)return void t(this.lastValue);let n,r=!1;const i=e=>{r||(r=!0,n&&(clearTimeout(n),n=null),t(e))},a=()=>{if(this.isDisposed)i(this.lastValue);else try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))return void i(this.lastValue);if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE))return void(n=setTimeout(a,1));const r=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(r)/1e6)}catch(r){console.error("Error checking query:",r),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}const FG=new xs;class wG extends oG{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=void 0!==t.context?t.context:e.domElement.getContext("webgl2",n);function i(t){t.preventDefault();const n={api:"WebGL",message:t.statusMessage||"Unknown reason",reason:null,originalEvent:t};e.onDeviceLost(n)}this._onContextLost=i,e.domElement.addEventListener("webglcontextlost",i,!1),this.gl=r,this.extensions=new EG(this),this.capabilities=new AG(this),this.attributeUtils=new hG(this),this.textureUtils=new DG(this),this.bufferRenderer=new _G(this),this.state=new dG(this),this.utils=new pG(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return hs}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){!0!==this.gl.getContextAttributes().xrCompatible&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),null!==n){const t=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:t}),!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!0===e.autoAllocateDepthBuffer&&!1===e.multiview&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new xG(this.gl,t,2048));const n=this.timestampQueryPool[t];null!==n.allocateQueriesForContext(e)&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:e,height:n}=this.getDrawingBufferSize(FG);t.viewport(0,0,e,n)}if(e.scissor){const{x:n,y:r,width:i,height:a}=e.scissorValue;t.scissor(n,e.height-a-r,i,a)}this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),i=r.previousContext;n.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(null!==o)for(let s=0;s<o.length;s++){const e=o[s];e.generateMipmaps&&this.generateMipmaps(e)}if(this._currentContext=i,null!==e.textures&&e.renderTarget){const r=this.get(e.renderTarget),{resolveDepthBuffer:i,samples:a}=e.renderTarget;if(a>0&&!1===this._useMultisampledExtension(e.renderTarget)){const i=r.framebuffers[e.getCacheKey()],a=t.COLOR_BUFFER_BIT,o=r.msaaFrameBuffer,s=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,o),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,i);for(let n=0;n<s.length;n++)if(e.scissor){const{x:n,y:i,width:o,height:s}=e.scissorValue,u=e.height-s-i;t.blitFramebuffer(n,u,n+o,u+s,n,u,n+o,u+s,a,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,r.invalidationArray,n,u,o,s)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,r.invalidationArray)}else if(!1===i&&r.framebuffers){const i=r.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,i),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,r.depthInvalidationArray)}}if(null!==i)if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:e,height:t}=this.getDrawingBufferSize(FG);n.viewport(0,0,e,t)}this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const e=new WeakSet,{gl:i}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let o=0;for(let t=0;t<n.length;t++){const a=n[t];null!==a&&(i.getQueryParameter(a,i.QUERY_RESULT_AVAILABLE)&&(0===i.getQueryParameter(a,i.QUERY_RESULT)&&e.add(r[t]),n[t]=null,i.deleteQuery(a),o++))}o<n.length?requestAnimationFrame(a):t.occluded=e};a()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:i,height:a}=e.viewportValue;t.viewport(n,e.height-a-r,i,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const{gl:a,renderer:o}=this;if(null===r){r={textures:null,clearColorValue:this.getClearColor()}}let s=0;if(e&&(s|=a.COLOR_BUFFER_BIT),t&&(s|=a.DEPTH_BUFFER_BIT),n&&(s|=a.STENCIL_BUFFER_BIT),0!==s){let u;u=r.clearColorValue?r.clearColorValue:this.getClearColor();const l=o.getClearDepth(),c=o.getClearStencil();if(t&&this.state.setDepthMask(!0),null===r.textures)a.clearColor(u.r,u.g,u.b,u.a),a.clear(s);else{if(i&&this._setFramebuffer(r),e)for(let e=0;e<r.textures.length;e++)0===e?a.clearBufferfv(a.COLOR,e,[u.r,u.g,u.b,u.a]):a.clearBufferfv(a.COLOR,e,[0,0,0,1]);t&&n?a.clearBufferfi(a.DEPTH_STENCIL,0,l,c):t?a.clearBufferfv(a.DEPTH,0,[l]):n&&a.clearBufferiv(a.STENCIL,0,[c])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,r){const{state:i,gl:a}=this;!1===this.discard&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:o,transformBuffers:s,attributes:u}=this.get(r),l=this._getVaoKey(u),c=this.vaoCache[l];void 0===c?this._createVao(u):i.setVertexState(c),i.useProgram(o),this._bindUniforms(n);const h=this._getTransformFeedback(s);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,h),a.beginTransformFeedback(a.POINTS),u[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,t.count):a.drawArrays(a.POINTS,0,t.count),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let d=0;d<s.length;d++){const e=s[d];e.pbo&&this.textureUtils.copyBufferToTexture(e.transformBuffer,e.pbo),e.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:r,context:i,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(n),{gl:s,state:u}=this,l=this.get(i),c=e.getDrawParameters();if(null===c)return;this._bindUniforms(e.getBindings());const h=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(r,h,a),u.useProgram(o);const d=this.get(e);let p=d.staticVao;if(void 0===p||d.geometryId!==e.geometry.id){const t=this._getVaoKey(e.getAttributes());if(p=this.vaoCache[t],void 0===p){let t;({vaoGPU:p,staticVao:t}=this._createVao(e.getAttributes())),t&&(d.staticVao=p,d.geometryId=e.geometry.id)}}const f=e.getIndex(),m=null!==f?this.get(f).bufferGPU:null;u.setVertexState(p,m);const g=l.lastOcclusionObject;if(g!==t&&void 0!==g){if(null!==g&&!0===g.occlusionTest&&(s.endQuery(s.ANY_SAMPLES_PASSED),l.occlusionQueryIndex++),!0===t.occlusionTest){const e=s.createQuery();s.beginQuery(s.ANY_SAMPLES_PASSED,e),l.occlusionQueries[l.occlusionQueryIndex]=e,l.occlusionQueryObjects[l.occlusionQueryIndex]=t}l.lastOcclusionObject=t}const v=this.bufferRenderer;t.isPoints?v.mode=s.POINTS:t.isLineSegments?v.mode=s.LINES:t.isLine?v.mode=s.LINE_STRIP:t.isLineLoop?v.mode=s.LINE_LOOP:!0===r.wireframe?(u.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=s.LINES):v.mode=s.TRIANGLES;const{vertexCount:D,instanceCount:y}=c;let{firstVertex:E}=c;if(v.object=t,null!==f){E*=f.array.BYTES_PER_ELEMENT;const e=this.get(f);v.index=f.count,v.type=e.type}else v.index=0;const A=()=>{t.isBatchedMesh?null!==t._multiDrawInstances?(Is("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Is("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):y>1?v.renderInstances(E,D,y):v.render(E,D)};if(!0===e.camera.isArrayCamera&&e.camera.cameras.length>0&&!1===e.camera.isMultiViewCamera){const n=this.get(e.camera),r=e.camera.cameras,i=e.getBindingGroup("cameraIndex").bindings[0];if(void 0===n.indexesGPU||n.indexesGPU.length!==r.length){const e=new Uint32Array([0,0,0,0]),t=[];for(let n=0,i=r.length;n<i;n++){const r=s.createBuffer();e[0]=n,s.bindBuffer(s.UNIFORM_BUFFER,r),s.bufferData(s.UNIFORM_BUFFER,e,s.STATIC_DRAW),t.push(r)}n.indexesGPU=t}const a=this.get(i),o=this.renderer.getPixelRatio(),l=this._currentContext.renderTarget,c=this._isRenderCameraDepthArray(this._currentContext),h=this._currentContext.activeCubeFace;if(c){const e=this.get(l.depthTexture);if(e.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){e.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:t}=l;for(let e=0,n=r.length;e<n;e++)this.renderer._activeCubeFace=e,this._currentContext.activeCubeFace=e,this._setFramebuffer(this._currentContext),this.clear(!1,!0,t,this._currentContext,!1);this.renderer._activeCubeFace=h,this._currentContext.activeCubeFace=h}}for(let d=0,p=r.length;d<p;d++){const i=r[d];if(t.layers.test(i.layers)){c&&(this.renderer._activeCubeFace=d,this._currentContext.activeCubeFace=d,this._setFramebuffer(this._currentContext));const t=i.viewport;if(void 0!==t){const n=t.x*o,r=t.y*o,i=t.width*o,a=t.height*o;u.viewport(Math.floor(n),Math.floor(e.context.height-a-r),Math.floor(i),Math.floor(a))}u.bindBufferBase(s.UNIFORM_BUFFER,a.index,n.indexesGPU[d]),A()}this._currentContext.activeCubeFace=h,this.renderer._activeCubeFace=h}}else A()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,i,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,a)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new rG(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,i="fragment"===n?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,r),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:i,vertexProgram:a}=r,o=n.createProgram(),s=this.get(i).shaderGPU,u=this.get(a).shaderGPU;if(n.attachShader(o,s),n.attachShader(o,u),n.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:s,vertexShader:u}),null!==t&&this.parallel){const i=new Promise(t=>{const i=this.parallel,a=()=>{n.getProgramParameter(o,i.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),t()):requestAnimationFrame(a)};a()});t.push(i)}else this._completeCompile(e,r)}_handleSource(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=i;o<a;o++){const e=o+1;r.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[o]))}return r.join("\n")}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+this._handleSource(e.getShaderSource(t),r)}return i}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,i=r.getProgramInfoLog(e).trim();if(!1===r.getProgramParameter(e,r.LINK_STATUS))if("function"===typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(r,e,n,t);else{const a=this._getShaderErrors(r,n,"vertex"),o=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+i+"\n"+a+"\n"+o)}else""!==i&&console.warn("THREE.WebGLProgram: Program Info Log:",i)}}_completeCompile(e,t){const{state:n,gl:r}=this,i=this.get(t),{programGPU:a,fragmentShader:o,vertexShader:s}=i;!1===r.getProgramParameter(a,r.LINK_STATUS)&&this._logProgramError(a,o,s),n.useProgram(a);const u=e.getBindings();this._setupBindings(u,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:n,gl:r}=this,i={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(i);const{computeProgram:a}=e,o=r.createProgram(),s=this.get(i).shaderGPU,u=this.get(a).shaderGPU,l=a.transforms,c=[],h=[];for(let m=0;m<l.length;m++){const e=l[m];c.push(e.varyingName),h.push(e.attributeNode)}r.attachShader(o,s),r.attachShader(o,u),r.transformFeedbackVaryings(o,c,r.SEPARATE_ATTRIBS),r.linkProgram(o),!1===r.getProgramParameter(o,r.LINK_STATUS)&&this._logProgramError(o,s,u),n.useProgram(o),this._setupBindings(t,o);const d=a.attributes,p=[],f=[];for(let m=0;m<d.length;m++){const e=d[m].node.attribute;p.push(e),this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER)}for(let m=0;m<h.length;m++){const e=h[m].attribute;this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER);const t=this.get(e);f.push(t)}this.set(e,{programGPU:o,transformBuffers:f,attributes:p})}createBindings(e,t){if(!1===this._knownBindings.has(t)){this._knownBindings.add(t);let e=0,n=0;for(const r of t){this.set(r,{textures:n,uniformBuffers:e});for(const t of r.bindings)t.isUniformBuffer&&e++,t.isSampledTexture&&n++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,i=n.textures;for(const a of e.bindings)if(a.isUniformsGroup||a.isUniformBuffer){const e=a.buffer,n=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,e,t.DYNAMIC_DRAW),this.set(a,{index:r++,bufferGPU:n})}else if(a.isSampledTexture){const{textureGPU:e,glTextureType:t}=this.get(a.texture);this.set(a,{index:i++,textureGPU:e,glTextureType:t})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,r=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(CG).filter(t=>CG[t]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.textureUtils.copyTextureToTexture(e,t,n,r,i,a)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(null!==e.textures){const i=e.renderTarget,a=this.get(i),{samples:o,depthBuffer:s,stencilBuffer:u}=i,l=!0===i.isWebGLCubeRenderTarget,c=!0===i.isRenderTarget3D,h=i.depth>1,d=!0===i.isXRRenderTarget,p=!0===d&&!0===i.hasExternalTextures;let f=a.msaaFrameBuffer,m=a.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),v=this.extensions.get("OVR_multiview2"),D=this._useMultisampledExtension(i),y=pO(e);let E;if(l?(a.cubeFramebuffers||(a.cubeFramebuffers={}),E=a.cubeFramebuffers[y]):d&&!1===p?E=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),E=a.framebuffers[y]),void 0===E){E=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,E);const r=e.textures,s=[];if(l){a.cubeFramebuffers[y]=E;const{textureGPU:e}=this.get(r[0]),n=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,e,0)}else{a.framebuffers[y]=E;for(let n=0;n<r.length;n++){const a=r[n],s=this.get(a);s.renderTarget=e.renderTarget,s.cacheKey=y;const u=t.COLOR_ATTACHMENT0+n;if(i.multiview)v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,u,s.textureGPU,0,o,0,2);else if(c||h){const e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,u,s.textureGPU,0,e)}else D?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,u,t.TEXTURE_2D,s.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,u,t.TEXTURE_2D,s.textureGPU,0)}n.drawBuffers(e,E)}const d=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===i.autoAllocateDepthBuffer){const n=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(n,e,0,D),a.xrDepthRenderbuffer=n,s.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,n),t.framebufferRenderbuffer(t.FRAMEBUFFER,d,t.RENDERBUFFER,n)}else if(null!==e.depthTexture){s.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const n=this.get(e.depthTexture);if(n.renderTarget=e.renderTarget,n.cacheKey=y,i.multiview)v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,d,n.textureGPU,0,o,0,2);else if(p&&D)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,d,t.TEXTURE_2D,n.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){const e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,d,n.textureGPU,0,e)}else t.framebufferTexture2D(t.FRAMEBUFFER,d,t.TEXTURE_2D,n.textureGPU,0)}a.depthInvalidationArray=s}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,E);const r=this.renderer._activeCubeFace,i=this.get(e.depthTexture),a=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,a,i.textureGPU,0,r)}if(d||D||i.multiview){n.bindFramebuffer(t.FRAMEBUFFER,E);const r=this.get(e.textures[0]);i.multiview?v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,r.textureGPU,0,o,0,2):D?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0);const s=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===i.autoAllocateDepthBuffer){const e=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,s,t.RENDERBUFFER,e)}else{const n=this.get(e.depthTexture);i.multiview?v.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,s,n.textureGPU,0,o,0,2):D?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,s,t.TEXTURE_2D,n.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,s,t.TEXTURE_2D,n.textureGPU,0)}}}if(o>0&&!1===D&&!i.multiview){if(void 0===f){const r=[];f=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,f);const i=[],l=e.textures;for(let n=0;n<l.length;n++){if(i[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i[n]),r.push(t.COLOR_ATTACHMENT0+n),s){const e=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r.push(e)}const a=e.textures[n],l=this.get(a);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,l.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,i[n])}if(a.msaaFrameBuffer=f,a.msaaRenderbuffers=i,void 0===m){m=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e,o),a.depthRenderbuffer=m;const n=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r.push(n)}a.invalidationArray=r}r=a.msaaFrameBuffer}else r=E}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){t+=":"+this.get(e[n]).id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let r="",i=!0;t.bindVertexArray(n);for(let a=0;a<e.length;a++){const n=e[a],o=this.get(n);let s,u;r+=":"+o.id,t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(a),(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&(i=!1),!0===n.isInterleavedBufferAttribute?(s=n.data.stride*o.bytesPerElement,u=n.offset*o.bytesPerElement):(s=0,u=0),o.isInteger?t.vertexAttribIPointer(a,n.itemSize,o.type,s,u):t.vertexAttribPointer(a,n.itemSize,o.type,n.normalized,s,u),n.isInstancedBufferAttribute&&!n.isInterleavedBufferAttribute?t.vertexAttribDivisor(a,n.meshPerAttribute):n.isInterleavedBufferAttribute&&n.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(a,n.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[r]=n,{vaoGPU:n,staticVao:i}}_getTransformFeedback(e){let t="";for(let i=0;i<e.length;i++)t+=":"+e[i].id;let n=this.transformFeedbackCache[t];if(void 0!==n)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let i=0;i<e.length;i++){const t=e[i];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,i,t.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const e of r.bindings){const r=this.get(e).index;if(e.isUniformsGroup||e.isUniformBuffer){const i=n.getUniformBlockIndex(t,e.name);n.uniformBlockBinding(t,i,r)}else if(e.isSampledTexture){const i=n.getUniformLocation(t,e.name);n.uniform1i(i,r)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const e of r.bindings){const r=this.get(e),i=r.index;e.isUniformsGroup||e.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,i,r.bufferGPU):e.isSampledTexture&&n.bindTexture(r.glTextureType,r.textureGPU,t.TEXTURE0+i)}}_useMultisampledExtension(e){return!0===e.multiview||e.samples>0&&!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!1!==e.autoAllocateDepthBuffer}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const SG="point-list",TG="line-list",MG="line-strip",BG="triangle-list",PG="triangle-strip",NG="never",RG="less",LG="equal",IG="less-equal",kG="greater",OG="not-equal",UG="greater-equal",zG="always",VG="store",GG="load",HG="clear",jG="ccw",WG="none",qG="front",XG="back",KG="uint16",YG="uint32",JG="r8unorm",$G="r8snorm",QG="r8uint",ZG="r8sint",eH="r16uint",tH="r16sint",nH="r16float",rH="rg8unorm",iH="rg8snorm",aH="rg8uint",oH="rg8sint",sH="r32uint",uH="r32sint",lH="r32float",cH="rg16uint",hH="rg16sint",dH="rg16float",pH="rgba8unorm",fH="rgba8unorm-srgb",mH="rgba8snorm",gH="rgba8uint",vH="rgba8sint",DH="bgra8unorm",yH="bgra8unorm-srgb",EH="rgb9e5ufloat",AH="rgb10a2unorm",CH="rgb10a2unorm",_H="rg32uint",bH="rg32sint",xH="rg32float",FH="rgba16uint",wH="rgba16sint",SH="rgba16float",TH="rgba32uint",MH="rgba32sint",BH="rgba32float",PH="depth16unorm",NH="depth24plus",RH="depth24plus-stencil8",LH="depth32float",IH="depth32float-stencil8",kH="bc1-rgba-unorm",OH="bc1-rgba-unorm-srgb",UH="bc2-rgba-unorm",zH="bc2-rgba-unorm-srgb",VH="bc3-rgba-unorm",GH="bc3-rgba-unorm-srgb",HH="bc4-r-unorm",jH="bc4-r-snorm",WH="bc5-rg-unorm",qH="bc5-rg-snorm",XH="bc6h-rgb-ufloat",KH="bc6h-rgb-float",YH="bc7-rgba-unorm",JH="bc7-rgba-srgb",$H="etc2-rgb8unorm",QH="etc2-rgb8unorm-srgb",ZH="etc2-rgb8a1unorm",ej="etc2-rgb8a1unorm-srgb",tj="etc2-rgba8unorm",nj="etc2-rgba8unorm-srgb",rj="eac-r11unorm",ij="eac-r11snorm",aj="eac-rg11unorm",oj="eac-rg11snorm",sj="astc-4x4-unorm",uj="astc-4x4-unorm-srgb",lj="astc-5x4-unorm",cj="astc-5x4-unorm-srgb",hj="astc-5x5-unorm",dj="astc-5x5-unorm-srgb",pj="astc-6x5-unorm",fj="astc-6x5-unorm-srgb",mj="astc-6x6-unorm",gj="astc-6x6-unorm-srgb",vj="astc-8x5-unorm",Dj="astc-8x5-unorm-srgb",yj="astc-8x6-unorm",Ej="astc-8x6-unorm-srgb",Aj="astc-8x8-unorm",Cj="astc-8x8-unorm-srgb",_j="astc-10x5-unorm",bj="astc-10x5-unorm-srgb",xj="astc-10x6-unorm",Fj="astc-10x6-unorm-srgb",wj="astc-10x8-unorm",Sj="astc-10x8-unorm-srgb",Tj="astc-10x10-unorm",Mj="astc-10x10-unorm-srgb",Bj="astc-12x10-unorm",Pj="astc-12x10-unorm-srgb",Nj="astc-12x12-unorm",Rj="astc-12x12-unorm-srgb",Lj="clamp-to-edge",Ij="repeat",kj="mirror-repeat",Oj="linear",Uj="nearest",zj="zero",Vj="one",Gj="src",Hj="one-minus-src",jj="src-alpha",Wj="one-minus-src-alpha",qj="dst",Xj="one-minus-dst",Kj="dst-alpha",Yj="one-minus-dst-alpha",Jj="src-alpha-saturated",$j="constant",Qj="one-minus-constant",Zj="add",eW="subtract",tW="reverse-subtract",nW="min",rW="max",iW=0,aW=15,oW="keep",sW="zero",uW="replace",lW="invert",cW="increment-clamp",hW="decrement-clamp",dW="increment-wrap",pW="decrement-wrap",fW="storage",mW="read-only-storage",gW="write-only",vW="read-only",DW="read-write",yW="non-filtering",EW="comparison",AW="float",CW="unfilterable-float",_W="depth",bW="sint",xW="uint",FW="2d",wW="3d",SW="2d",TW="2d-array",MW="cube",BW="3d",PW="all",NW="vertex",RW="instance",LW={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class IW extends OV{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class kW extends IW{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class OW extends UV{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let UW=0;class zW extends OW{constructor(e,t){super("StorageBuffer_"+UW++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:zF.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class VW extends Vk{constructor(e){super(),this.device=e;this.mipmapSampler=e.createSampler({minFilter:Oj}),this.flipYSampler=e.createSampler({minFilter:Uj}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})}getTransferPipeline(e){let t=this.transferPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:"mipmap-".concat(e),vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:PG,stripIndexFormat:YG},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:"flipY-".concat(e),vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:PG,stripIndexFormat:YG},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=t.format,{width:i,height:a}=t.size,o=this.getTransferPipeline(r),s=this.getFlipYPipeline(r),u=this.device.createTexture({size:{width:i,height:a,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),l=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:SW,baseArrayLayer:n}),c=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:SW,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),d=(e,t,n)=>{const r=e.getBindGroupLayout(0),i=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:t}]}),a=h.beginRenderPass({colorAttachments:[{view:n,loadOp:HG,storeOp:VG,clearValue:[0,0,0,0]}]});a.setPipeline(e),a.setBindGroup(0,i),a.draw(4,1,0,0),a.end()};d(o,l,c),d(s,c,l),this.device.queue.submit([h.finish()]),u.destroy()}generateMipmaps(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=this.get(e);void 0===r.useCount&&(r.useCount=0,r.layers=[]);const i=r.layers[n]||this._mipmapCreateBundles(e,t,n),a=this.device.createCommandEncoder({});this._mipmapRunBundles(a,i),this.device.queue.submit([a.finish()]),0!==r.useCount&&(r.layers[n]=i),r.useCount++}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),i=r.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:SW,baseArrayLayer:n});const o=[];for(let s=1;s<t.mipLevelCount;s++){const u=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),l=e.createView({baseMipLevel:s,mipLevelCount:1,dimension:SW,baseArrayLayer:n}),c={colorAttachments:[{view:l,loadOp:HG,storeOp:VG,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[t.format]});h.setPipeline(r),h.setBindGroup(0,u),h.draw(4,1,0,0),o.push({renderBundles:[h.finish()],passDescriptor:c}),a=l}return o}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const n=t[r],i=e.beginRenderPass(n.passDescriptor);i.executeBundles(n.renderBundles),i.end()}}}const GW={[es]:"never",[ts]:"less",[ns]:"equal",[rs]:"less-equal",[is]:"greater",[os]:"greater-equal",[ss]:"always",[as]:"not-equal"},HW=[0,1,3,2,4,5];class jW{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new Hc,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,r=t.get(e),i={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};i.magFilter===Oj&&i.minFilter===Oj&&i.mipmapFilter===Oj&&(i.maxAnisotropy=e.anisotropy),e.isDepthTexture&&null!==e.compareFunction&&(i.compare=GW[e.compareFunction]),r.sampler=n.createSampler(i)}createDefaultTexture(e){let t;const n=WW(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===t.needsMipmaps&&(t.needsMipmaps=!1),void 0===t.levels&&(t.levels=1),void 0===t.depth&&(t.depth=1);const{width:i,height:a,depth:o,levels:s}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),l=e.internalFormat||t.format||WW(e,n.device);r.format=l;const{samples:c,primarySamples:h,isMSAA:d}=n.utils.getTextureSampleData(e);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===e.isStorageTexture&&(p|=GPUTextureUsage.STORAGE_BINDING),!0!==e.isCompressedTexture&&!0!==e.isCompressedArrayTexture&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const f={label:e.name,size:{width:i,height:a,depthOrArrayLayers:o},mipLevelCount:s,sampleCount:h,dimension:u,format:l,usage:p};if(e.isVideoTexture){const t=e.source.data,n=new VideoFrame(t);f.size.width=n.displayWidth,f.size.height=n.displayHeight,n.close(),r.externalTexture=t}else{if(void 0===l)return console.warn("WebGPURenderer: Texture format not supported."),void this.createDefaultTexture(e);e.isCubeTexture&&(f.textureBindingViewDimension=MW),r.texture=n.device.createTexture(f)}if(d){const e=Object.assign({},f);e.label=e.label+"-msaa",e.sampleCount=c,r.msaaTexture=n.device.createTexture(e)}r.initialized=!0,r.textureDescriptorGPU=f}destroyTexture(e){const t=this.backend,n=t.get(e);void 0!==n.texture&&n.texture.destroy(),void 0!==n.msaaTexture&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){delete this.backend.get(e).sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let e=0;e<n;e++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,e)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.backend,{width:r,height:i}=n.getDrawingBufferSize(),a=this.depthTexture,o=n.get(a).texture;let s,u;if(t?(s=ro,u=$a):e&&(s=no,u=qa),void 0!==o){if(a.image.width===r&&a.image.height===i&&a.format===s&&a.type===u)return o;this.destroyTexture(a)}return a.name="depthBuffer",a.format=s,a.type=u,a.image.width=r,a.image.height=i,this.createTexture(a,{width:r,height:i}),n.get(a).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:r}=n;if(!e.isRenderTargetTexture&&void 0!==r){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let i=0;i<t.image.depth;i++)this._copyBufferToTexture(t.image,n.texture,r,i,e.flipY,i);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,r,e.flipY,e.premultiplyAlpha);else if(e.isVideoTexture){const t=e.source.data;n.externalTexture=t}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY,e.premultiplyAlpha);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,r,i,a){const o=this.backend.device,s=this.backend.get(e),u=s.texture,l=s.textureDescriptorGPU.format,c=this._getBytesPerTexel(l);let h=r*c;h=256*Math.ceil(h/256);const d=o.createBuffer({size:r*i*c,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=o.createCommandEncoder();p.copyTextureToBuffer({texture:u,origin:{x:t,y:n,z:a}},{buffer:d,bytesPerRow:h},{width:r,height:i});const f=this._getTypedArrayType(l);o.queue.submit([p.finish()]),await d.mapAsync(GPUMapMode.READ);return new f(d.getMappedRange())}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const n=new Js;n.minFilter=La,n.magFilter=La,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const n=new Dc;n.minFilter=La,n.magFilter=La,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(null===e){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,r,i){for(let a=0;a<6;a++){const o=e[a],s=!0===r?HW[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,n,s,r):this._copyImageToTexture(o,t,n,s,r,i)}}_copyImageToTexture(e,t,n,r,i,a){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r},premultipliedAlpha:a},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return null===e&&(this._passUtils=e=new VW(this.backend.device)),e}_generateMipmaps(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=this.backend.device,s=e.data,u=this._getBytesPerTexel(n.format),l=e.width*u;o.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},s,{offset:e.width*e.height*u*a,bytesPerRow:l},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===i&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,i=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const s=e[o],u=s.width,l=s.height,c=a?n.size.depthOrArrayLayers:1,h=Math.ceil(u/i.width)*i.byteLength,d=h*Math.ceil(l/i.height);for(let e=0;e<c;e++)r.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:e}},s.data,{offset:e*d,bytesPerRow:h,rowsPerImage:Math.ceil(l/i.height)},{width:Math.ceil(u/i.width)*i.width,height:Math.ceil(l/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){return e===kH||e===OH?{byteLength:8,width:4,height:4}:e===UH||e===zH||e===VH||e===GH?{byteLength:16,width:4,height:4}:e===HH||e===jH?{byteLength:8,width:4,height:4}:e===WH||e===qH||e===XH||e===KH||e===YH||e===JH?{byteLength:16,width:4,height:4}:e===$H||e===QH||e===ZH||e===ej?{byteLength:8,width:4,height:4}:e===tj||e===nj?{byteLength:16,width:4,height:4}:e===rj||e===ij?{byteLength:8,width:4,height:4}:e===aj||e===oj||e===sj||e===uj?{byteLength:16,width:4,height:4}:e===lj||e===cj?{byteLength:16,width:5,height:4}:e===hj||e===dj?{byteLength:16,width:5,height:5}:e===pj||e===fj?{byteLength:16,width:6,height:5}:e===mj||e===gj?{byteLength:16,width:6,height:6}:e===vj||e===Dj?{byteLength:16,width:8,height:5}:e===yj||e===Ej?{byteLength:16,width:8,height:6}:e===Aj||e===Cj?{byteLength:16,width:8,height:8}:e===_j||e===bj?{byteLength:16,width:10,height:5}:e===xj||e===Fj?{byteLength:16,width:10,height:6}:e===wj||e===Sj?{byteLength:16,width:10,height:8}:e===Tj||e===Mj?{byteLength:16,width:10,height:10}:e===Bj||e===Pj?{byteLength:16,width:12,height:10}:e===Nj||e===Rj?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(e){let t=Lj;return e===Pa?t=Ij:e===Ra&&(t=kj),t}_convertFilterMode(e){let t=Oj;return e!==La&&e!==Ia&&e!==ka||(t=Uj),t}_getBytesPerTexel(e){return e===JG||e===$G||e===QG||e===ZG?1:e===eH||e===tH||e===nH||e===rH||e===iH||e===aH||e===oH?2:e===sH||e===uH||e===lH||e===cH||e===hH||e===dH||e===pH||e===fH||e===mH||e===gH||e===vH||e===DH||e===yH||e===EH||e===AH||e===CH||e===LH||e===NH||e===RH||e===IH?4:e===_H||e===bH||e===xH||e===FH||e===wH||e===SH?8:e===TH||e===MH||e===BH?16:void 0}_getTypedArrayType(e){return e===QG?Uint8Array:e===ZG?Int8Array:e===JG?Uint8Array:e===$G?Int8Array:e===aH?Uint8Array:e===oH?Int8Array:e===rH?Uint8Array:e===iH?Int8Array:e===gH?Uint8Array:e===vH?Int8Array:e===pH?Uint8Array:e===mH?Int8Array:e===eH?Uint16Array:e===tH?Int16Array:e===cH?Uint16Array:e===hH?Int16Array:e===FH?Uint16Array:e===wH?Int16Array:e===nH||e===dH||e===SH?Uint16Array:e===sH?Uint32Array:e===uH?Int32Array:e===lH?Float32Array:e===_H?Uint32Array:e===bH?Int32Array:e===xH?Float32Array:e===TH?Uint32Array:e===MH?Int32Array:e===BH?Float32Array:e===DH||e===yH?Uint8Array:e===AH||e===EH||e===CH?Uint32Array:e===LH?Float32Array:e===NH||e===RH?Uint32Array:e===IH?Float32Array:void 0}_getDimension(e){let t;return t=e.isData3DTexture?wW:FW,t}}function WW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=e.format,r=e.type,i=e.colorSpace,a=zs.getTransfer(i);let o;if(!0===e.isCompressedTexture||!0===e.isCompressedArrayTexture)switch(n){case co:o=a===Qo?OH:kH;break;case ho:o=a===Qo?zH:UH;break;case po:o=a===Qo?GH:VH;break;case yo:o=a===Qo?QH:$H;break;case Eo:o=a===Qo?nj:tj;break;case Ao:o=a===Qo?uj:sj;break;case Co:o=a===Qo?cj:lj;break;case _o:o=a===Qo?dj:hj;break;case bo:o=a===Qo?fj:pj;break;case xo:o=a===Qo?gj:mj;break;case Fo:o=a===Qo?Dj:vj;break;case wo:o=a===Qo?Ej:yj;break;case So:o=a===Qo?Cj:Aj;break;case To:o=a===Qo?bj:_j;break;case Mo:o=a===Qo?Fj:xj;break;case Bo:o=a===Qo?Sj:wj;break;case Po:o=a===Qo?Mj:Tj;break;case No:o=a===Qo?Pj:Bj;break;case Ro:o=a===Qo?Rj:Nj;break;case to:o=a===Qo?fH:pH;break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}else switch(n){case to:switch(r){case Ga:o=mH;break;case Ha:o=wH;break;case ja:o=FH;break;case qa:o=TH;break;case Wa:o=MH;break;case Va:o=a===Qo?fH:pH;break;case Ka:o=SH;break;case Xa:o=BH;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case eo:if(r===Qa)o=EH;else console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",r);break;case io:switch(r){case Ga:o=$G;break;case Ha:o=tH;break;case ja:o=eH;break;case qa:o=sH;break;case Wa:o=uH;break;case Va:o=JG;break;case Ka:o=nH;break;case Xa:o=lH;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case oo:switch(r){case Ga:o=iH;break;case Ha:o=hH;break;case ja:o=cH;break;case qa:o=_H;break;case Wa:o=bH;break;case Va:o=rH;break;case Ka:o=dH;break;case Xa:o=xH;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case no:switch(r){case ja:o=PH;break;case qa:o=NH;break;case Xa:o=LH;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case ro:switch(r){case $a:o=RH;break;case Xa:t&&!1===t.features.has(LW.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=IH;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case ao:switch(r){case Wa:o=uH;break;case qa:o=sH;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case so:switch(r){case Wa:o=bH;break;case qa:o=_H;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case uo:switch(r){case Wa:o=MH;break;case qa:o=TH;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}return o}const qW=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,XW=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,KW={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"};class YW extends tV{constructor(e){const{type:t,inputs:n,name:r,inputsCode:i,blockCode:a,outputType:o}=(e=>{const t=(e=e.trim()).match(qW);if(null!==t&&4===t.length){const n=t[2],r=[];let i=null;for(;null!==(i=XW.exec(n));)r.push({name:i[1],type:i[2]});const a=[];for(let e=0;e<r.length;e++){const{name:t,type:n}=r[e];let i=n;i.startsWith("ptr")?i="pointer":(i.startsWith("texture")&&(i=n.split("<")[0]),i=KW[i]),a.push(new Vz(i,t))}const o=e.substring(t[0].length),s=t[3]||"void",u=void 0!==t[1]?t[1]:"";return{type:KW[s]||s,inputs:a,name:u,inputsCode:n,blockCode:o,outputType:s}}throw new Error("FunctionNode: Function is not a WGSL code.")})(e);super(t,n,r),this.inputsCode=i,this.blockCode=a,this.outputType=o}getCode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.name;const t="void"!==this.outputType?"-> "+this.outputType:"";return"fn ".concat(e," ( ").concat(this.inputsCode.trim()," ) ").concat(t)+this.blockCode}}class JW extends eV{parseFunction(e){return new YW(e)}}const $W="undefined"!==typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},QW={[zF.READ_ONLY]:"read",[zF.WRITE_ONLY]:"write",[zF.READ_WRITE]:"read_write"},ZW={[Pa]:"repeat",[Na]:"clamp",[Ra]:"mirror"},eq={vertex:$W?$W.VERTEX:1,fragment:$W?$W.FRAGMENT:2,compute:$W?$W.COMPUTE:4},tq={instance:!0,swizzleAssign:!1,storageBuffer:!0},nq={"^^":"tsl_xor"},rq={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},iq={},aq={tsl_xor:new QO("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new QO("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new QO("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new QO("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new QO("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new QO("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new QO("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new QO("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new QO("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new QO("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new QO("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new QO("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new QO("\nfn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {\n\n\tlet res = vec2f( iRes );\n\n\tlet uvScaled = coord * res;\n\tlet uvWrapping = ( ( uvScaled % res ) + res ) % res;\n\n\t// https://www.shadertoy.com/view/WtyXRy\n\n\tlet uv = uvWrapping - 0.5;\n\tlet iuv = floor( uv );\n\tlet f = fract( uv );\n\n\tlet rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );\n\tlet rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );\n\tlet rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );\n\tlet rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );\n\n\treturn mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );\n\n}\n")},oq={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};"undefined"!==typeof navigator&&/Windows/g.test(navigator.userAgent)&&(aq.pow_float=new QO("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),aq.pow_vec2=new QO("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[aq.pow_float]),aq.pow_vec3=new QO("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[aq.pow_float]),aq.pow_vec4=new QO("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[aq.pow_float]),oq.pow_float="tsl_pow_float",oq.pow_vec2="tsl_pow_vec2",oq.pow_vec3="tsl_pow_vec3",oq.pow_vec4="tsl_pow_vec4");let sq="";!0!==("undefined"!==typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))&&(sq+="diagnostic( off, derivative_uniformity );\n");class uq extends Uz{constructor(e,t){super(e,t,new JW),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==Ko}_generateTextureSample(e,t,n,r){return"fragment"===(arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.shaderStage)?r?"textureSample( ".concat(t,", ").concat(t,"_sampler, ").concat(n,", ").concat(r," )"):"textureSample( ".concat(t,", ").concat(t,"_sampler, ").concat(n," )"):this._generateTextureSampleLevel(e,t,n,"0",r)}_generateVideoSample(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage;if("fragment"===n)return"textureSampleBaseClampToEdge( ".concat(e,", ").concat(e,"_sampler, vec2<f32>( ").concat(t,".x, 1.0 - ").concat(t,".y ) )");console.error("WebGPURenderer: THREE.VideoTexture does not support ".concat(n," shader."))}_generateTextureSampleLevel(e,t,n,r,i){return!1===this.isUnfilterable(e)?"textureSampleLevel( ".concat(t,", ").concat(t,"_sampler, ").concat(n,", ").concat(r," )"):this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,r):this.generateTextureLod(e,t,n,i,r)}generateWrapFunction(e){const t="tsl_coord_".concat(ZW[e.wrapS],"S_").concat(ZW[e.wrapT],"_").concat(e.isData3DTexture?"3d":"2d","T");let n=iq[t];if(void 0===n){const r=[],i=e.isData3DTexture?"vec3f":"vec2f";let a="fn ".concat(t,"( coord : ").concat(i," ) -> ").concat(i," {\n\n\treturn ").concat(i,"(\n");const o=(e,t)=>{e===Pa?(r.push(aq.repeatWrapping_float),a+="\t\ttsl_repeatWrapping_float( coord.".concat(t," )")):e===Na?(r.push(aq.clampWrapping_float),a+="\t\ttsl_clampWrapping_float( coord.".concat(t," )")):e===Ra?(r.push(aq.mirrorWrapping_float),a+="\t\ttsl_mirrorWrapping_float( coord.".concat(t," )")):(a+="\t\tcoord.".concat(t),console.warn('WebGPURenderer: Unsupported texture wrap type "'.concat(e,'" for vertex shader.')))};o(e.wrapS,"x"),a+=",\n",o(e.wrapT,"y"),e.isData3DTexture&&(a+=",\n",o(e.wrapR,"z")),a+="\n\t);\n\n}\n",iq[t]=n=new QO(a,r)}return n.build(this),t}generateArrayDeclaration(e,t){return"array< ".concat(this.getType(e),", ").concat(t," >")}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);void 0===r.dimensionsSnippet&&(r.dimensionsSnippet={});let i=r.dimensionsSnippet[n];if(void 0===r.dimensionsSnippet[n]){let a,o;const{primarySamples:s}=this.renderer.backend.utils.getTextureSampleData(e),u=s>1;o=e.isData3DTexture?"vec3<u32>":"vec2<u32>",a=u||e.isVideoTexture||e.isStorageTexture?t:"".concat(t).concat(n?", u32( ".concat(n," )"):""),i=new qM(new SB("textureDimensions( ".concat(a," )"),o)),r.dimensionsSnippet[n]=i,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new qM(new SB("textureNumLayers(".concat(t,")"),"u32"))),e.isTextureCube&&(r.cubeFaceCount=new qM(new SB("6u","u32")))}return i.build(this)}generateFilteredTexture(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0u";this._include("biquadraticTexture");const i=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,r);return"tsl_biquadraticTexture( ".concat(t,", ").concat(i,"( ").concat(n," ), ").concat(a,", u32( ").concat(r," ) )")}generateTextureLod(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0u";const a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,i),s=e.isData3DTexture?"vec3":"vec2",u="".concat(s,"<u32>( ").concat(a,"( ").concat(n," ) * ").concat(s,"<f32>( ").concat(o," ) )");return this.generateTextureLoad(e,t,u,r,i)}generateTextureLoad(e,t,n,r){let i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0u";return!0===e.isVideoTexture?i="textureLoad( ".concat(t,", ").concat(n," )"):r?i="textureLoad( ".concat(t,", ").concat(n,", ").concat(r,", u32( ").concat(a," ) )"):(i="textureLoad( ".concat(t,", ").concat(n,", u32( ").concat(a," ) )"),this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(i+=".x")),i}generateTextureStore(e,t,n,r,i){let a;return a=r?"textureStore( ".concat(t,", ").concat(n,", ").concat(r,", ").concat(i," )"):"textureStore( ".concat(t,", ").concat(n,", ").concat(i," )"),a}isSampleCompare(e){return!0===e.isDepthTexture&&null!==e.compareFunction}isUnfilterable(e){return"float"!==this.getComponentTypeFromTexture(e)||!this.isAvailable("float32Filterable")&&!0===e.isDataTexture&&e.type===Xa||!1===this.isSampleCompare(e)&&e.minFilter===La&&e.magFilter===La||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.shaderStage,a=null;return a=!0===e.isVideoTexture?this._generateVideoSample(t,n,i):this.isUnfilterable(e)?this.generateTextureLod(e,t,n,r,"0",i):this._generateTextureSample(e,t,n,r,i),a}generateTextureGrad(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===a)return"textureSampleGrad( ".concat(t,", ").concat(t,"_sampler, ").concat(n,",  ").concat(r[0],", ").concat(r[1]," )");console.error("WebGPURenderer: THREE.TextureNode.gradient() does not support ".concat(a," shader."))}generateTextureCompare(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===a)return!0===e.isDepthTexture&&!0===e.isArrayTexture?"textureSampleCompare( ".concat(t,", ").concat(t,"_sampler, ").concat(n,", ").concat(i,", ").concat(r," )"):"textureSampleCompare( ".concat(t,", ").concat(t,"_sampler, ").concat(n,", ").concat(r," )");console.error("WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ".concat(a," shader."))}generateTextureLevel(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage,o=null;return o=!0===e.isVideoTexture?this._generateVideoSample(t,n,a):this._generateTextureSampleLevel(e,t,n,r,i),o}generateTextureBias(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===a)return"textureSampleBias( ".concat(t,", ").concat(t,"_sampler, ").concat(n,", ").concat(r," )");console.error("WebGPURenderer: THREE.TextureNode.biasNode does not support ".concat(a," shader."))}getPropertyName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;if(!0===e.isNodeVarying&&!0===e.needsInterpolation){if("vertex"===t)return"varyings.".concat(e.name)}else if(!0===e.isNodeUniform){const t=e.name,n=e.type;return"texture"===n||"cubeTexture"===n||"storageTexture"===n||"texture3D"===n?t:"buffer"===n||"storageBuffer"===n||"indirectStorageBuffer"===n?this.isCustomStruct(e)?t:t+".value":e.groupNode.name+"."+t}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=nq[e];return void 0!==t?(this._include(t),t):null}getNodeAccess(e,t){return"compute"!==t?zF.READ_ONLY:e.access}getStorageAccess(e,t){return QW[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache);if(void 0===a.uniformGPU){let o;const s=e.groupNode,u=s.name,l=this.getBindGroupArray(u,n);if("texture"===t||"cubeTexture"===t||"storageTexture"===t||"texture3D"===t){let r=null;const a=this.getNodeAccess(e,n);if("texture"===t||"storageTexture"===t?r=new KV(i.name,i.node,s,a):"cubeTexture"===t?r=new YV(i.name,i.node,s,a):"texture3D"===t&&(r=new JV(i.name,i.node,s,a)),r.store=!0===e.isStorageTextureNode,r.setVisibility(eq[n]),!1===this.isUnfilterable(e.value)&&!1===r.store){const e=new kW("".concat(i.name,"_sampler"),i.node,s);e.setVisibility(eq[n]),l.push(e,r),o=[e,r]}else l.push(r),o=[r]}else if("buffer"===t||"storageBuffer"===t||"indirectStorageBuffer"===t){const a=new("buffer"===t?GV:zW)(e,s);a.setVisibility(eq[n]),l.push(a),o=a,i.name=r||"NodeBuffer_"+i.id}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let r=e[u];void 0===r&&(r=new WV(u,s),r.setVisibility(eq[n]),e[u]=r,l.push(r)),o=this.getNodeUniform(i,t),r.addUniform(o)}a.uniformGPU=o}return i}getBuiltin(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage;const i=this.builtins[r]||(this.builtins[r]=new Map);return!1===i.has(e)&&i.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;return void 0!==this.builtins[t]&&this.builtins[t].has(e)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(a.name+" : "+this.getType(a.type));let i="fn ".concat(t.name,"( ").concat(r.join(", ")," ) -> ").concat(this.getType(t.type)," {\n").concat(n.vars,"\n").concat(n.code,"\n");return n.result&&(i+="\treturn ".concat(n.result,";\n")),i+="\n}\n",i}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(void 0!==n)for(const r of n)t.push("enable ".concat(r,";"));return t.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances","array<f32, ".concat(e," >"),"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(void 0!==n)for(const{name:r,property:i,type:a}of n.values())t.push("@builtin( ".concat(r," ) ").concat(i," : ").concat(a));return t.join(",\n\t")}getScopedArray(e,t,n,r){return!1===this.scopedArrays.has(e)&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if("compute"!==e)return;const t=[];for(const{name:n,scope:r,bufferType:i,bufferCount:a}of this.scopedArrays.values()){const e=this.getType(i);t.push("var<".concat(r,"> ").concat(n,": array< ").concat(e,", ").concat(a," >;"))}return t.join("\n")}getAttributes(e){const t=[];if("compute"===e&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===e||"compute"===e){const e=this.getBuiltins("attribute");e&&t.push(e);const n=this.getAttributesArray();for(let r=0,i=n.length;r<i;r++){const e=n[r],i=e.name,a=this.getType(e.type);t.push("@location( ".concat(r," ) ").concat(i," : ").concat(a))}}return t.join(",\n\t")}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let i=this.getType(n.type);n.atomic&&(i="atomic< "+i+" >"),t.push("\t".concat(r+n.name," : ").concat(i))}return e.output&&t.push("\t".concat(this.getBuiltins("output"))),t.join(",\n")}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const e=[];for(const t of n){let n="struct ".concat(t.name," {\n");n+=this.getStructMembers(t),n+="\n};",e.push(n)}t="\n"+e.join("\n\n")+"\n"}return t}getVar(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r="var ".concat(t," : ");return r+=null!==n?this.generateArrayDeclaration(e,n):this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const r of n)t.push("\t".concat(this.getVar(r.type,r.name,r.count),";"));return"\n".concat(t.join("\n"),"\n")}getVaryings(e){const t=[];if("vertex"===e&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===e||"fragment"===e){const n=this.varyings,r=this.vars[e];for(let i=0;i<n.length;i++){const a=n[i];if(a.needsInterpolation){let e="@location( ".concat(i," )");if(a.interpolationType){const t=null!==a.interpolationSampling?", ".concat(a.interpolationSampling," )"):" )";e+=" @interpolate( ".concat(a.interpolationType).concat(t)}else/^(int|uint|ivec|uvec)/.test(a.type)&&(e+=" @interpolate( ".concat(this.renderer.backend.compatibilityMode?"flat, either":"flat"," )"));t.push("".concat(e," ").concat(a.name," : ").concat(this.getType(a.type)))}else"vertex"===e&&!1===r.includes(a)&&r.push(a)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(",\n\t");return"vertex"===e?this._getWGSLStruct("VaryingsStruct","\t"+r):r}isCustomStruct(e){const t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&null!==n.structTypeNode,i=n.value&&n.value.array&&"number"===typeof n.value.itemSize&&n.value.array.length>n.value.itemSize;return r&&!i}getUniforms(e){const t=this.uniforms[e],n=[],r=[],i=[],a={};for(const s of t){const t=s.groupNode.name,i=this.bindingsIndexes[t];if("texture"===s.type||"cubeTexture"===s.type||"storageTexture"===s.type||"texture3D"===s.type){const t=s.node.value;let r;!1===this.isUnfilterable(t)&&!0!==s.node.isStorageTextureNode&&(this.isSampleCompare(t)?n.push("@binding( ".concat(i.binding++," ) @group( ").concat(i.group," ) var ").concat(s.name,"_sampler : sampler_comparison;")):n.push("@binding( ".concat(i.binding++," ) @group( ").concat(i.group," ) var ").concat(s.name,"_sampler : sampler;")));let a="";const{primarySamples:o}=this.renderer.backend.utils.getTextureSampleData(t);if(o>1&&(a="_multisampled"),!0===t.isCubeTexture)r="texture_cube<f32>";else if(!0===t.isDepthTexture)r=this.renderer.backend.compatibilityMode&&null===t.compareFunction?"texture".concat(a,"_2d<f32>"):"texture_depth".concat(a,"_2d").concat(!0===t.isArrayTexture?"_array":"");else if(!0===t.isArrayTexture||!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture)r="texture_2d_array<f32>";else if(!0===t.isVideoTexture)r="texture_external";else if(!0===t.isData3DTexture)r="texture_3d<f32>";else if(!0===s.node.isStorageTextureNode){const n=WW(t),i=this.getStorageAccess(s.node,e);r="texture_storage_2d<".concat(n,", ").concat(i,">")}else{const e=this.getComponentTypeFromTexture(t).charAt(0);r="texture".concat(a,"_2d<").concat(e,"32>")}n.push("@binding( ".concat(i.binding++," ) @group( ").concat(i.group," ) var ").concat(s.name," : ").concat(r,";"))}else if("buffer"===s.type||"storageBuffer"===s.type||"indirectStorageBuffer"===s.type){const t=s.node,n=this.getType(t.getNodeType(this)),a=t.bufferCount,o=a>0&&"buffer"===s.type?", "+a:"",u=t.isStorageBufferNode?"storage, ".concat(this.getStorageAccess(t,e)):"uniform";if(this.isCustomStruct(s))r.push("@binding( ".concat(i.binding++," ) @group( ").concat(i.group," ) var<").concat(u,"> ").concat(s.name," : ").concat(n,";"));else{const e=t.isAtomic?"atomic<".concat(n,">"):"".concat(n),a="\tvalue : array< ".concat(e).concat(o," >");r.push(this._getWGSLStructBinding(s.name,a,u,i.binding++,i.group))}}else{const e=this.getType(this.getVectorType(s.type)),t=s.groupNode.name;(a[t]||(a[t]={index:i.binding++,id:i.group,snippets:[]})).snippets.push("\t".concat(s.name," : ").concat(e))}}for(const s in a){const e=a[s];i.push(this._getWGSLStructBinding(s,e.snippets.join(",\n"),"uniform",e.index,e.id))}let o=n.join("\n");return o+=r.join("\n"),o+=i.join("\n"),o}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r="// code\n\n";r+=this.flowCode[t];const i=this.flowNodes[t],a=i[i.length-1],o=a.outputNode,s=void 0!==o&&!0===o.isOutputStructNode;for(const e of i){const i=this.getFlowData(e),u=e.name;if(u&&(r.length>0&&(r+="\n"),r+="\t// flow -> ".concat(u,"\n")),r+="".concat(i.code,"\n\t"),e===a&&"compute"!==t)if(r+="// result\n\n\t","vertex"===t)r+="varyings.Vertex = ".concat(i.result,";");else if("fragment"===t)if(s)n.returnType=o.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+="return ".concat(i.result,";");else{let e="\t@location(0) color: vec4<f32>";const t=this.getBuiltins("output");t&&(e+=",\n\t"+t),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",e),n.structs+="\nvar<private> output : OutputStruct;",r+="output.color = ".concat(i.result,";\n\n\treturn output;")}}n.flow=r}this.shaderStage=null,null!==this.material?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==n&&(t=this._getWGSLMethod(e+"_"+n)),void 0===t&&(t=this._getWGSLMethod(e)),t||e}getType(e){return rq[e]||e}isAvailable(e){let t=tq[e];return void 0===t&&("float32Filterable"===e?t=this.renderer.hasFeature("float32-filterable"):"clipDistance"===e&&(t=this.renderer.hasFeature("clip-distances")),tq[e]=t),t}_getWGSLMethod(e){return void 0!==aq[e]&&this._include(e),oq[e]}_include(e){const t=aq[e];return t.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return"".concat(this.getSignature(),"\n// directives\n").concat(e.directives,"\n\n// structs\n").concat(e.structs,"\n\n// uniforms\n").concat(e.uniforms,"\n\n// varyings\n").concat(e.varyings,"\nvar<private> varyings : VaryingsStruct;\n\n// codes\n").concat(e.codes,"\n\n@vertex\nfn main( ").concat(e.attributes," ) -> VaryingsStruct {\n\n\t// vars\n\t").concat(e.vars,"\n\n\t// flow\n\t").concat(e.flow,"\n\n\treturn varyings;\n\n}\n")}_getWGSLFragmentCode(e){return"".concat(this.getSignature(),"\n// global\n").concat(sq,"\n\n// structs\n").concat(e.structs,"\n\n// uniforms\n").concat(e.uniforms,"\n\n// codes\n").concat(e.codes,"\n\n@fragment\nfn main( ").concat(e.varyings," ) -> ").concat(e.returnType," {\n\n\t// vars\n\t").concat(e.vars,"\n\n\t// flow\n\t").concat(e.flow,"\n\n}\n")}_getWGSLComputeCode(e,t){return"".concat(this.getSignature(),"\n// directives\n").concat(e.directives,"\n\n// system\nvar<private> instanceIndex : u32;\n\n// locals\n").concat(e.scopedArrays,"\n\n// structs\n").concat(e.structs,"\n\n// uniforms\n").concat(e.uniforms,"\n\n// codes\n").concat(e.codes,"\n\n@compute @workgroup_size( ").concat(t," )\nfn main( ").concat(e.attributes," ) {\n\n\t// system\n\tinstanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(").concat(t,") + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(").concat(t,");\n\n\t// vars\n\t").concat(e.vars,"\n\n\t// flow\n\t").concat(e.flow,"\n\n}\n")}_getWGSLStruct(e,t){return"\nstruct ".concat(e," {\n").concat(t,"\n};")}_getWGSLStructBinding(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=e+"Struct",o=this._getWGSLStruct(a,t);return"".concat(o,"\n@binding( ").concat(r," ) @group( ").concat(i," )\nvar<").concat(n,"> ").concat(e," : ").concat(a,";")}}class lq{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return null!==e.depthTexture?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=RH:e.depth&&(t=NH),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const e=this.backend.renderer,n=e.getRenderTarget();t=n?n.samples:e.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&null!==e.renderTarget&&!0!==e.isDepthTexture&&!0!==e.isFramebufferTexture;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return t=null!==e.textures?this.getTextureFormatGPU(e.textures[0]):this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return null!==e.textures?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){return e.isPoints?SG:e.isLineSegments||e.isMesh&&!0===t.wireframe?TG:e.isLine?MG:e.isMesh?BG:void 0}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),2===t&&(t=4)),t}getSampleCountRenderContext(e){return null!==e.textures?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(void 0===e)return navigator.gpu.getPreferredCanvasFormat();if(e===Va)return DH;if(e===Ka)return SH;throw new Error("Unsupported outputType")}}const cq=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),hq=new Map([[Il,["float16"]]]),dq=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class pq{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,i=r.get(n);let a=i.buffer;if(void 0===a){const o=r.device;let s=n.array;if(!1===e.normalized)if(s.constructor===Int16Array||s.constructor===Int8Array)s=new Int32Array(s);else if((s.constructor===Uint16Array||s.constructor===Uint8Array)&&(s=new Uint32Array(s),t&GPUBufferUsage.INDEX))for(let e=0;e<s.length;e++)65535===s[e]&&(s[e]=4294967295);if(n.array=s,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){s=new s.constructor(4*n.count);for(let e=0;e<n.count;e++)s.set(n.array.subarray(3*e,3*e+3),4*e);n.itemSize=4,n.array=s,i._force3to4BytesAlignment=!0}const u=s.byteLength,l=u+(4-u%4)%4;a=o.createBuffer({label:n.name,size:l,usage:t,mappedAtCreation:!0}),new s.constructor(a.getMappedRange()).set(s),a.unmap(),i.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,i=n.get(t),a=n.get(t).buffer;let o=t.array;if(!0===i._force3to4BytesAlignment){o=new o.constructor(4*t.count);for(let e=0;e<t.count;e++)o.set(t.array.subarray(3*e,3*e+3),4*e);t.array=o}const s=this._isTypedArray(o),u=t.updateRanges;if(0===u.length)r.queue.writeBuffer(a,0,o,0);else{const e=s?1:o.BYTES_PER_ELEMENT;for(let t=0,n=u.length;t<n;t++){const n=u[t];let l,c;if(!0===i._force3to4BytesAlignment){l=4*Math.floor(n.start/3)*e,c=4*Math.ceil(n.count/3)*e}else l=n.start*e,c=n.count*e;const h=l*(s?o.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(a,h,o,l,c)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const e=t[r],i=e.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(e);let o=n.get(a);if(void 0===o){let t,r;!0===e.isInterleavedBufferAttribute?(t=e.data.stride*i,r=e.data.isInstancedInterleavedBuffer?RW:NW):(t=e.itemSize*i,r=e.isInstancedBufferAttribute?RW:NW),!1!==e.normalized||e.array.constructor!==Int16Array&&e.array.constructor!==Uint16Array||(t=4),o={arrayStride:t,attributes:[],stepMode:r},n.set(a,o)}const s=this._getVertexFormat(e),u=!0===e.isInterleavedBufferAttribute?e.offset*i:0;o.attributes.push({shaderLocation:r,offset:u,format:s})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,r=t.get(this._getBufferAttribute(e)).buffer,i=r.size,a=n.createBuffer({label:"".concat(e.name,"_readback"),size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o=n.createCommandEncoder({label:"readback_encoder_".concat(e.name)});o.copyBufferToBuffer(r,0,a,0,i);const s=o.finish();n.queue.submit([s]),await a.mapAsync(GPUMapMode.READ);const u=a.getMappedRange(),l=new e.array.constructor(u.slice(0));return a.unmap(),l.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,i=e.constructor;let a;if(1===t)a=dq.get(r);else{const e=(hq.get(i)||cq.get(r))[n?1:0];if(e){const n=r.BYTES_PER_ELEMENT*t,i=4*Math.floor((n+3)/4)/r.BYTES_PER_ELEMENT;if(i%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a="".concat(e,"x").concat(i)}}return a||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),a}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class fq{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,r=[];let i=0;for(const a of e.bindings){const e={binding:i++,visibility:a.visibility};if(a.isUniformBuffer||a.isStorageBuffer){const t={};a.isStorageBuffer&&(4&a.visibility&&(a.access===zF.READ_WRITE||a.access===zF.WRITE_ONLY)?t.type=fW:t.type=mW),e.buffer=t}else if(a.isSampler){const n={};a.texture.isDepthTexture&&(null!==a.texture.compareFunction?n.type=EW:t.compatibilityMode&&(n.type=yW)),e.sampler=n}else if(a.isSampledTexture&&a.texture.isVideoTexture)e.externalTexture={};else if(a.isSampledTexture&&a.store){const t={};t.format=this.backend.get(a.texture).texture.format;const n=a.access;t.access=n===zF.READ_WRITE?DW:n===zF.WRITE_ONLY?gW:vW,e.storageTexture=t}else if(a.isSampledTexture){const n={},{primarySamples:r}=t.utils.getTextureSampleData(a.texture);if(r>1&&(n.multisampled=!0,a.texture.isDepthTexture||(n.sampleType=CW)),a.texture.isDepthTexture)t.compatibilityMode&&null===a.texture.compareFunction?n.sampleType=CW:n.sampleType=_W;else if(a.texture.isDataTexture||a.texture.isDataArrayTexture||a.texture.isData3DTexture){const e=a.texture.type;e===Wa?n.sampleType=bW:e===qa?n.sampleType=xW:e===Xa&&(this.backend.hasFeature("float32-filterable")?n.sampleType=AW:n.sampleType=CW)}a.isSampledCubeTexture?n.viewDimension=MW:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?n.viewDimension=TW:a.isSampledTexture3D&&(n.viewDimension=BW),e.texture=n}else console.error('WebGPUBindingUtils: Unsupported binding "'.concat(a,'".'));r.push(e)}return n.createBindGroupLayout({entries:r})}createBindings(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{backend:i,bindGroupLayoutCache:a}=this,o=i.get(e);let s,u=a.get(e.bindingsReference);void 0===u&&(u=this.createBindingsLayout(e),a.set(e.bindingsReference,u)),n>0&&(void 0===o.groups&&(o.groups=[],o.versions=[]),o.versions[n]===r&&(s=o.groups[n])),void 0===s&&(s=this.createBindGroup(e,u),n>0&&(o.groups[n]=s,o.versions[n]=r)),o.group=s,o.layout=u}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,i=t.get(e).buffer;n.queue.writeBuffer(i,0,r,0)}createBindGroupIndex(e,t){const n=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=e[0],a=n.createBuffer({label:"bindingCameraIndex_"+i,size:16,usage:r});n.queue.writeBuffer(a,0,e,0);const o=[{binding:0,resource:{buffer:a}}];return n.createBindGroup({label:"bindGroupCameraIndex_"+i,layout:t,entries:o})}createBindGroup(e,t){const n=this.backend,r=n.device;let i=0;const a=[];for(const o of e.bindings){if(o.isUniformBuffer){const e=n.get(o);if(void 0===e.buffer){const t=o.byteLength,n=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=r.createBuffer({label:"bindingBuffer_"+o.name,size:t,usage:n});e.buffer=i}a.push({binding:i,resource:{buffer:e.buffer}})}else if(o.isStorageBuffer){const e=n.get(o);if(void 0===e.buffer){const t=o.attribute;e.buffer=n.get(t).buffer}a.push({binding:i,resource:{buffer:e.buffer}})}else if(o.isSampler){const e=n.get(o.texture);a.push({binding:i,resource:e.sampler})}else if(o.isSampledTexture){const e=n.get(o.texture);let t;if(void 0!==e.externalTexture)t=r.importExternalTexture({source:e.externalTexture});else{const n=o.store?1:e.texture.mipLevelCount,r="view-".concat(e.texture.width,"-").concat(e.texture.height,"-").concat(n);if(t=e[r],void 0===t){const i=PW;let a;a=o.isSampledCubeTexture?MW:o.isSampledTexture3D?BW:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?TW:SW,t=e[r]=e.texture.createView({aspect:i,dimension:a,mipLevelCount:n})}}a.push({binding:i,resource:t})}i++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}}class mq{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:i,pipeline:a}=e,{vertexProgram:o,fragmentProgram:s}=a,u=this.backend,l=u.device,c=u.utils,h=u.get(a),d=[];for(const S of e.getBindings()){const e=u.get(S);d.push(e.layout)}const p=u.attributeUtils.createShaderVertexBuffers(e);let f;0===r.blending||1===r.blending&&!1===r.transparent||(f=this._getBlending(r));let m={};!0===r.stencilWrite&&(m={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const g=this._getColorWriteMask(r),v=[];if(null!==e.context.textures){const t=e.context.textures;for(let e=0;e<t.length;e++){const n=c.getTextureFormatGPU(t[e]);v.push({format:n,blend:f,writeMask:g})}}else{const t=c.getCurrentColorFormat(e.context);v.push({format:t,blend:f,writeMask:g})}const D=u.get(o).module,y=u.get(s).module,E=this._getPrimitiveState(n,i,r),A=this._getDepthCompare(r),C=c.getCurrentDepthStencilFormat(e.context),_=this._getSampleCount(e.context),b={label:"renderPipeline_".concat(r.name||r.type,"_").concat(r.id),vertex:Object.assign({},D,{buffers:p}),fragment:Object.assign({},y,{targets:v}),primitive:E,multisample:{count:_,alphaToCoverageEnabled:r.alphaToCoverage&&_>1},layout:l.createPipelineLayout({bindGroupLayouts:d})},x={},F=e.context.depth,w=e.context.stencil;if(!0!==F&&!0!==w||(!0===F&&(x.format=C,x.depthWriteEnabled=r.depthWrite,x.depthCompare=A),!0===w&&(x.stencilFront=m,x.stencilBack={},x.stencilReadMask=r.stencilFuncMask,x.stencilWriteMask=r.stencilWriteMask),!0===r.polygonOffset&&(x.depthBias=r.polygonOffsetUnits,x.depthBiasSlopeScale=r.polygonOffsetFactor,x.depthBiasClamp=0),b.depthStencil=x),null===t)h.pipeline=l.createRenderPipeline(b);else{const e=new Promise(e=>{l.createRenderPipelineAsync(b).then(t=>{h.pipeline=t,e()})});t.push(e)}}createBundleEncoder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"renderBundleEncoder";const n=this.backend,{utils:r,device:i}=n,a=r.getCurrentDepthStencilFormat(e),o={label:t,colorFormats:[r.getCurrentColorFormat(e)],depthStencilFormat:a,sampleCount:this._getSampleCount(e)};return i.createRenderBundleEncoder(o)}createComputePipeline(e,t){const n=this.backend,r=n.device,i=n.get(e.computeProgram).module,a=n.get(e),o=[];for(const s of t){const e=n.get(s);o.push(e.layout)}a.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,n;const r=e.blending,i=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(5===r){const r=null!==e.blendSrcAlpha?e.blendSrcAlpha:i,s=null!==e.blendDstAlpha?e.blendDstAlpha:a,u=null!==e.blendEquationAlpha?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(u)}}else{const i=(e,r,i,a)=>{t={srcFactor:e,dstFactor:r,operation:Zj},n={srcFactor:i,dstFactor:a,operation:Zj}};if(e.premultipliedAlpha)switch(r){case 1:i(Vj,Wj,Vj,Wj);break;case 2:i(Vj,Vj,Vj,Vj);break;case 3:i(zj,Hj,zj,Vj);break;case 4:i(zj,Gj,zj,jj)}else switch(r){case 1:i(jj,Wj,Vj,Wj);break;case 2:i(jj,Vj,jj,Vj);break;case 3:i(zj,Hj,zj,Vj);break;case 4:i(zj,Gj,zj,Gj)}}if(void 0!==t&&void 0!==n)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case ra:t=zj;break;case 201:t=Vj;break;case 202:t=Gj;break;case 203:t=Hj;break;case sa:t=jj;break;case ua:t=Wj;break;case 208:t=qj;break;case 209:t=Xj;break;case 206:t=Kj;break;case 207:t=Yj;break;case 210:t=Jj;break;case 211:t=$j;break;case 212:t=Qj;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case 512:t=NG;break;case 519:t=zG;break;case 513:t=RG;break;case 515:t=IG;break;case 514:t=LG;break;case 518:t=UG;break;case 516:t=kG;break;case 517:t=OG;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case Zo:t=oW;break;case 0:t=sW;break;case 7681:t=uW;break;case 5386:t=lW;break;case 7682:t=cW;break;case 7683:t=hW;break;case 34055:t=dW;break;case 34056:t=pW;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case ea:t=Zj;break;case 101:t=eW;break;case 102:t=tW;break;case 103:t=nW;break;case 104:t=rW;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},i=this.backend.utils;switch(r.topology=i.getPrimitiveTopology(e,n),null!==t.index&&!0===e.isLine&&!0!==e.isLineSegments&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?KG:YG),n.side){case 0:r.frontFace=jG,r.cullMode=XG;break;case 1:r.frontFace=jG,r.cullMode=qG;break;case 2:r.frontFace=jG,r.cullMode=WG;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side)}return r}_getColorWriteMask(e){return!0===e.colorWrite?aW:iW}_getDepthCompare(e){let t;if(!1===e.depthTest)t=zG;else{const n=e.depthFunc;switch(n){case 0:t=NG;break;case 1:t=zG;break;case 2:t=RG;break;case 3:t=IG;break;case 4:t=LG;break;case 5:t=UG;break;case 6:t=kG;break;case 7:t=OG;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class gq extends bG{constructor(e,t){super(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:"queryset_global_timestamp_".concat(t)});const n=8*this.maxQueries;this.resolveBuffer=this.device.createBuffer({label:"buffer_timestamp_resolve_".concat(t),size:n,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:"buffer_timestamp_result_".concat(t),size:n,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return Is("WebGPUTimestampQueryPool [".concat(this.type,"]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.").concat(this.type.toUpperCase()," ).")),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||0===this.currentQueryIndex||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if("unmapped"!==this.resultBuffer.mapState)return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=8*t;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const i=r.finish();if(this.device.queue.submit([i]),"unmapped"!==this.resultBuffer.mapState)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let o=0;for(const[,s]of e){const e=a[s],t=a[s+1];o+=Number(t-e)/1e6}return this.resultBuffer.unmap(),this.lastValue=o,o}catch(e){return console.error("Error resolving queries:",e),"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&"mapped"===this.resultBuffer.mapState)try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class vq extends oG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===e.alpha||e.alpha,this.parameters.compatibilityMode=void 0!==e.compatibilityMode&&e.compatibilityMode,this.parameters.requiredLimits=void 0===e.requiredLimits?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new lq(this),this.attributeUtils=new pq(this),this.bindingUtils=new fq(this),this.pipelineUtils=new mq(this),this.textureUtils=new jW(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(void 0===t.device){const e={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},r="undefined"!==typeof navigator?await navigator.gpu.requestAdapter(e):null;if(null===r)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const i=Object.values(LW),a=[];for(const t of i)r.features.has(t)&&a.push(t);const o={requiredFeatures:a,requiredLimits:t.requiredLimits};n=await r.requestDevice(o)}else n=t.device;n.lost.then(t=>{const n={api:"WebGPU",message:t.message||"Unknown reason",reason:t.reason||null,originalEvent:t};e.onDeviceLost(n)});const r=void 0!==t.context?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=r;const i=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(LW.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i}),this.updateSize()}get coordinateSystem(){return ds}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(null===e){const t=this.renderer;e={colorAttachments:[{view:null}]},!0!==this.renderer.depth&&!0!==this.renderer.stencil||(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(t.depth,t.stencil).createView()});const n=e.colorAttachments[0];this.renderer.samples>0?n.view=this.colorBuffer.createView():n.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.renderTarget,r=this.get(n);let i=r.descriptors;if(void 0===i||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==e.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==n.samples){i={},r.descriptors=i;const e=()=>{n.removeEventListener("dispose",e),this.delete(n)};!1===n.hasEventListener("dispose",e)&&n.addEventListener("dispose",e)}const a=e.getCacheKey();let o=i[a];if(void 0===o){const t=e.textures,u=[];let l;const c=this._isRenderCameraDepthArray(e);for(let r=0;r<t.length;r++){const i=this.get(t[r]),a={label:"colorAttachment_".concat(r),baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:SW};if(n.isRenderTarget3D)l=e.activeCubeFace,a.baseArrayLayer=0,a.dimension=BW,a.depthOrArrayLayers=t[r].image.depth;else if(n.isRenderTarget&&t[r].image.depth>1)if(!0===c){const t=e.camera.cameras;for(let e=0;e<t.length;e++){const t=s(s({},a),{},{baseArrayLayer:e,arrayLayerCount:1,dimension:SW}),n=i.texture.createView(t);u.push({view:n,resolveTarget:void 0,depthSlice:void 0})}}else a.dimension=TW,a.depthOrArrayLayers=t[r].image.depth;if(!0!==c){const e=i.texture.createView(a);let t,n;void 0!==i.msaaTexture?(t=i.msaaTexture.createView(),n=e):(t=e,n=void 0),u.push({view:t,resolveTarget:n,depthSlice:l})}}if(o={textureViews:u},e.depth){const t=this.get(e.depthTexture),n={};e.depthTexture.isArrayTexture&&(n.dimension=SW,n.arrayLayerCount=1,n.baseArrayLayer=e.activeCubeFace),o.depthStencilView=t.texture.createView(n)}i[a]=o,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=n.dimensions}const u={colorAttachments:[]};for(let s=0;s<o.textureViews.length;s++){const e=o.textureViews[s];let n={r:0,g:0,b:0,a:1};0===s&&t.clearValue&&(n=t.clearValue),u.colorAttachments.push({view:e.view,depthSlice:e.depthSlice,resolveTarget:e.resolveTarget,loadOp:t.loadOp||GG,storeOp:t.storeOp||VG,clearValue:n})}return o.depthStencilView&&(u.depthStencilAttachment={view:o.depthStencilView}),u}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let i,a;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:r,label:"occlusionQuerySet_".concat(e.id)}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null),a=null===e.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(e,{loadOp:GG}),this.initTimestampQuery(e,a),a.occlusionQuerySet=i;const o=a.depthStencilAttachment;if(null!==e.textures){const t=a.colorAttachments;for(let n=0;n<t.length;n++){const r=t[n];e.clearColor?(r.clearValue=0===n?e.clearColorValue:{r:0,g:0,b:0,a:1},r.loadOp=HG):r.loadOp=GG,r.storeOp=VG}}else{const t=a.colorAttachments[0];e.clearColor?(t.clearValue=e.clearColorValue,t.loadOp=HG):t.loadOp=GG,t.storeOp=VG}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=HG):o.depthLoadOp=GG,o.depthStoreOp=VG),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=HG):o.stencilLoadOp=GG,o.stencilStoreOp=VG);const s=n.createCommandEncoder({label:"renderContext_"+e.id});if(!0===this._isRenderCameraDepthArray(e)){const n=e.camera.cameras;t.layerDescriptors&&t.layerDescriptors.length===n.length?this._updateDepthLayerDescriptors(e,t,n):this._createDepthLayerDescriptors(e,t,a,n),t.bundleEncoders=[],t.bundleSets=[];for(let r=0;r<n.length;r++){const n=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+r),i={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(n),t.bundleSets.push(i)}t.currentPass=null}else{const n=s.beginRenderPass(a);if(t.currentPass=n,e.viewport&&this.updateViewport(e),e.scissor){const{x:t,y:r,width:i,height:a}=e.scissorValue;n.setScissorRect(t,r,i,a)}}t.descriptor=a,t.encoder=s,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){const i=n.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let o=0;o<r.length;o++){const r=s(s({},n),{},{colorAttachments:[s(s({},n.colorAttachments[0]),{},{view:n.colorAttachments[o].view})]});if(n.depthStencilAttachment){const t=o;a.viewCache[t]||(a.viewCache[t]=a.texture.createView({dimension:SW,baseArrayLayer:o,arrayLayerCount:1})),r.depthStencilAttachment={view:a.viewCache[t],depthLoadOp:i.depthLoadOp||HG,depthStoreOp:i.depthStoreOp||VG,depthClearValue:i.depthClearValue||1},e.stencil&&(r.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,r.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,r.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else r.depthStencilAttachment=s({},i);t.layerDescriptors.push(r)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){const n=t.layerDescriptors[r];if(n.depthStencilAttachment){const t=n.depthStencilAttachment;e.depth&&(e.clearDepth?(t.depthClearValue=e.clearDepthValue,t.depthLoadOp=HG):t.depthLoadOp=GG),e.stencil&&(e.clearStencil?(t.stencilClearValue=e.clearStencilValue,t.stencilLoadOp=HG):t.stencilLoadOp=GG)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(!0===this._isRenderCameraDepthArray(e)){const n=[];for(let e=0;e<t.bundleEncoders.length;e++){const r=t.bundleEncoders[e];n.push(r.finish())}for(let i=0;i<t.layerDescriptors.length;i++)if(i<n.length){const a=t.layerDescriptors[i],o=r.beginRenderPass(a);if(e.viewport){const{x:t,y:n,width:r,height:i,minDepth:a,maxDepth:s}=e.viewportValue;o.setViewport(t,n,r,i,a,s)}if(e.scissor){const{x:t,y:n,width:r,height:i}=e.scissorValue;o.setScissorRect(t,n,r,i)}o.executeBundles([n[i]]),o.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const r=8*n;let i=this.occludedResolveCache.get(r);void 0===i&&(i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,i));const a=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,i,0),t.encoder.copyBufferToBuffer(i,0,a,0,r),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),null!==e.textures){const t=e.textures;for(let e=0;e<t.length;e++){const n=t[e];!0===n.generateMipmaps&&this.textureUtils.generateMipmaps(n)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const e=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const i=n.getMappedRange(),a=new BigUint64Array(i);for(let t=0;t<r.length;t++)a[t]===BigInt(0)&&e.add(r[t]);n.destroy(),t.occluded=e}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:a,minDepth:o,maxDepth:s}=e.viewportValue;t.setViewport(n,r,i,a,o,s)}getClearColor(){const e=super.getClearColor();return!0===this.renderer.alpha&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=this.device,a=this.renderer;let o,s,u,l,c=[];if(e){const e=this.getClearColor();s={r:e.r,g:e.g,b:e.b,a:e.a}}if(null===r){u=a.depth,l=a.stencil;const t=this._getDefaultRenderPassDescriptor();if(e){c=t.colorAttachments;const e=c[0];e.clearValue=s,e.loadOp=HG,e.storeOp=VG}(u||l)&&(o=t.depthStencilAttachment)}else{u=r.depth,l=r.stencil;const i={loadOp:e?HG:GG,clearValue:e?s:void 0};u&&(i.depthLoadOp=t?HG:GG,i.depthClearValue=t?a.getClearDepth():void 0,i.depthStoreOp=VG),l&&(i.stencilLoadOp=n?HG:GG,i.stencilClearValue=n?a.getClearStencil():void 0,i.stencilStoreOp=VG);const h=this._getRenderPassDescriptor(r,i);c=h.colorAttachments,o=h.depthStencilAttachment}u&&o&&void 0===o.depthLoadOp&&(t?(o.depthLoadOp=HG,o.depthClearValue=a.getClearDepth(),o.depthStoreOp=VG):(o.depthLoadOp=GG,o.depthStoreOp=VG)),l&&o&&void 0===o.stencilLoadOp&&(n?(o.stencilLoadOp=HG,o.stencilClearValue=a.getClearStencil(),o.stencilStoreOp=VG):(o.stencilLoadOp=GG,o.stencilStoreOp=VG));const h=i.createCommandEncoder({label:"clear"});h.beginRenderPass({colorAttachments:c,depthStencilAttachment:o}).end(),i.queue.submit([h.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r){const{passEncoderGPU:i}=this.get(e),a=this.get(r).pipeline;this.pipelineUtils.setPipeline(i,a);for(let l=0,c=n.length;l<c;l++){const e=n[l],t=this.get(e);i.setBindGroup(l,t.group)}const o=this.device.limits.maxComputeWorkgroupsPerDimension,s=this.get(t);void 0===s.dispatchSize&&(s.dispatchSize={x:0,y:1,z:1});const{dispatchSize:u}=s;t.dispatchCount>o?(u.x=Math.min(t.dispatchCount,o),u.y=Math.ceil(t.dispatchCount/o)):u.x=t.dispatchCount,i.dispatchWorkgroups(u.x,u.y,u.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:r,context:i,pipeline:a}=e,o=e.getBindings(),s=this.get(i),u=this.get(a).pipeline,l=e.getIndex(),c=null!==l,h=e.getDrawParameters();if(null===h)return;const d=(t,n)=>{this.pipelineUtils.setPipeline(t,u),n.pipeline=u;const a=n.bindingGroups;for(let e=0,r=o.length;e<r;e++){const n=o[e],r=this.get(n);a[n.index]!==n.id&&(t.setBindGroup(n.index,r.group),a[n.index]=n.id)}if(!0===c&&n.index!==l){const e=this.get(l).buffer,r=l.array instanceof Uint16Array?KG:YG;t.setIndexBuffer(e,r),n.index=l}const h=e.getVertexBuffers();for(let e=0,r=h.length;e<r;e++){const r=h[e];if(n.attributes[e]!==r){const i=this.get(r).buffer;t.setVertexBuffer(e,i),n.attributes[e]=r}}!0===i.stencil&&!0===r.stencilWrite&&s.currentStencilRef!==r.stencilRef&&(t.setStencilReference(r.stencilRef),s.currentStencilRef=r.stencilRef)},p=(r,i)=>{if(d(r,i),!0===n.isBatchedMesh){const e=n._multiDrawStarts,i=n._multiDrawCounts,a=n._multiDrawCount,o=n._multiDrawInstances;null!==o&&Is("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let s=0;s<a;s++){const a=o?o[s]:1,u=a>1?0:s;!0===c?r.drawIndexed(i[s],a,e[s]/l.array.BYTES_PER_ELEMENT,0,u):r.draw(i[s],a,e[s],u),t.update(n,i[s],a)}}else if(!0===c){const{vertexCount:i,instanceCount:a,firstVertex:o}=h,s=e.getIndirect();if(null!==s){const e=this.get(s).buffer;r.drawIndexedIndirect(e,0)}else r.drawIndexed(i,a,o,0,0);t.update(n,i,a)}else{const{vertexCount:i,instanceCount:a,firstVertex:o}=h,s=e.getIndirect();if(null!==s){const e=this.get(s).buffer;r.drawIndirect(e,0)}else r.draw(i,a,o,0);t.update(n,i,a)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const t=this.get(e.camera),r=e.camera.cameras,a=e.getBindingGroup("cameraIndex");if(void 0===t.indexesGPU||t.indexesGPU.length!==r.length){const e=this.get(a),n=[],i=new Uint32Array([0,0,0,0]);for(let t=0,a=r.length;t<a;t++){i[0]=t;const r=this.bindingUtils.createBindGroupIndex(i,e.layout);n.push(r)}t.indexesGPU=n}const o=this.renderer.getPixelRatio();for(let e=0,u=r.length;e<u;e++){const u=r[e];if(n.layers.test(u.layers)){const n=u.viewport;let r=s.currentPass,l=s.currentSets;if(s.bundleEncoders){r=s.bundleEncoders[e],l=s.bundleSets[e]}n&&r.setViewport(Math.floor(n.x*o),Math.floor(n.y*o),Math.floor(n.width*o),Math.floor(n.height*o),i.viewportValue.minDepth,i.viewportValue.maxDepth),a&&t.indexesGPU&&(r.setBindGroup(a.index,t.indexesGPU[e]),l.bindingGroups[a.index]=a.id),p(r,l)}}}else if(s.currentPass){if(void 0!==s.occlusionQuerySet){const e=s.lastOcclusionObject;e!==n&&(null!==e&&!0===e.occlusionTest&&(s.currentPass.endOcclusionQuery(),s.occlusionQueryIndex++),!0===n.occlusionTest&&(s.currentPass.beginOcclusionQuery(s.occlusionQueryIndex),s.occlusionQueryObjects[s.occlusionQueryIndex]=n),s.lastOcclusionObject=n)}p(s.currentPass,s.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,i=this.utils,a=i.getSampleCountRenderContext(e.context),o=i.getCurrentColorSpace(e.context),s=i.getCurrentColorFormat(e.context),u=i.getCurrentDepthStencilFormat(e.context),l=i.getPrimitiveTopology(n,r);let c=!1;return t.material===r&&t.materialVersion===r.version&&t.transparent===r.transparent&&t.blending===r.blending&&t.premultipliedAlpha===r.premultipliedAlpha&&t.blendSrc===r.blendSrc&&t.blendDst===r.blendDst&&t.blendEquation===r.blendEquation&&t.blendSrcAlpha===r.blendSrcAlpha&&t.blendDstAlpha===r.blendDstAlpha&&t.blendEquationAlpha===r.blendEquationAlpha&&t.colorWrite===r.colorWrite&&t.depthWrite===r.depthWrite&&t.depthTest===r.depthTest&&t.depthFunc===r.depthFunc&&t.stencilWrite===r.stencilWrite&&t.stencilFunc===r.stencilFunc&&t.stencilFail===r.stencilFail&&t.stencilZFail===r.stencilZFail&&t.stencilZPass===r.stencilZPass&&t.stencilFuncMask===r.stencilFuncMask&&t.stencilWriteMask===r.stencilWriteMask&&t.side===r.side&&t.alphaToCoverage===r.alphaToCoverage&&t.sampleCount===a&&t.colorSpace===o&&t.colorFormat===s&&t.depthStencilFormat===u&&t.primitiveTopology===l&&t.clippingContextCacheKey===e.clippingContextCacheKey||(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=s,t.depthStencilFormat=u,t.primitiveTopology=l,t.clippingContextCacheKey=e.clippingContextCacheKey,c=!0),c}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,i=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,i,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,a)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new gq(this.device,n,2048));const r=this.timestampQueryPool[n],i=r.allocateQueriesForContext(e);t.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new uq(e,t)}createProgram(e){this.get(e).module={module:this.device.createShaderModule({code:e.code,label:e.stage+(""!==e.name?"_".concat(e.name):"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),r=n.currentPass.finish();this.get(t).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=0,s=0,u=0,l=0,c=0,h=0,d=e.image.width,p=e.image.height,f=1;null!==n&&(!0===n.isBox3?(l=n.min.x,c=n.min.y,h=n.min.z,d=n.max.x-n.min.x,p=n.max.y-n.min.y,f=n.max.z-n.min.z):(l=n.min.x,c=n.min.y,d=n.max.x-n.min.x,p=n.max.y-n.min.y,f=1)),null!==r&&(o=r.x,s=r.y,u=r.z||0);const m=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),g=this.get(e).texture,v=this.get(t).texture;m.copyTextureToTexture({texture:g,mipLevel:i,origin:{x:l,y:c,z:h}},{texture:v,mipLevel:a,origin:{x:o,y:s,z:u}},[d,p,f]),this.device.queue.submit([m.finish()]),0===a&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let i=null;i=t.renderTarget?e.isDepthTexture?this.get(t.depthTexture).texture:this.get(t.textures[0]).texture:e.isDepthTexture?this.textureUtils.getDepthBuffer(t.depth,t.stencil):this.context.getCurrentTexture();const a=this.get(e).texture;if(i.format!==a.format)return void console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,a.format);let o;if(r.currentPass?(r.currentPass.end(),o=r.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),r.currentPass){const{descriptor:e}=r;for(let t=0;t<e.colorAttachments.length;t++)e.colorAttachments[t].loadOp=GG;if(t.depth&&(e.depthStencilAttachment.depthLoadOp=GG),t.stencil&&(e.depthStencilAttachment.stencilLoadOp=GG),r.currentPass=o.beginRenderPass(e),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:e,y:n,width:i,height:a}=t.scissorValue;r.currentPass.setScissorRect(e,n,i,a)}}else this.device.queue.submit([o.finish()]);e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}}class Dq extends Mh{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class yq extends Mh{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Eq extends gV{constructor(){super(),this.addMaterial(SL,"MeshPhongMaterial"),this.addMaterial(mk,"MeshStandardMaterial"),this.addMaterial(vk,"MeshPhysicalMaterial"),this.addMaterial(Ak,"MeshToonMaterial"),this.addMaterial(yL,"MeshBasicMaterial"),this.addMaterial(FL,"MeshLambertMaterial"),this.addMaterial(aL,"MeshNormalMaterial"),this.addMaterial(xk,"MeshMatcapMaterial"),this.addMaterial(eL,"LineBasicMaterial"),this.addMaterial(nL,"LineDashedMaterial"),this.addMaterial(Bk,"PointsMaterial"),this.addMaterial(Tk,"SpriteMaterial"),this.addMaterial(Rk,"ShadowMaterial"),this.addLight(iz,Lh),this.addLight(Gz,Oh),this.addLight(qz,zh),this.addLight(Xz,Mh),this.addLight($z,Uh),this.addLight(Qz,bh),this.addLight(Zz,Gh),this.addLight(Kz,Dq),this.addLight(Jz,yq),this.addToneMapping(GO,1),this.addToneMapping(HO,2),this.addToneMapping(jO,3),this.addToneMapping(qO,4),this.addToneMapping(JO,6),this.addToneMapping($O,7)}}class Aq extends kV{constructor(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.forceWebGL?e=wG:(e=vq,t.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new wG(t)));super(new e(t),t),this.library=new Eq,this.isWebGPURenderer=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const Cq={type:"change"},_q={type:"start"},bq={type:"end"},xq=1e-6,Fq=-1,wq=0,Sq=1,Tq=2,Mq=3,Bq=4,Pq=new xs,Nq=new xs,Rq=new ws,Lq=new ws,Iq=new ws,kq=new Fs,Oq=new ws,Uq=new ws,zq=new ws,Vq=new ws;class Gq extends od{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:ji,MIDDLE:Wi,RIGHT:qi},this.target=new ws,this.state=Fq,this.keyState=Fq,this._lastPosition=new ws,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ws,this._movePrev=new xs,this._moveCurr=new xs,this._lastAxis=new ws,this._zoomStart=new xs,this._zoomEnd=new xs,this._panStart=new xs,this._panEnd=new xs,this._pointers=[],this._pointerPositions={},this._onPointerMove=jq.bind(this),this._onPointerDown=Hq.bind(this),this._onPointerUp=Wq.bind(this),this._onPointerCancel=qq.bind(this),this._onContextMenu=Zq.bind(this),this._onMouseWheel=Qq.bind(this),this._onKeyDown=Kq.bind(this),this._onKeyUp=Xq.bind(this),this._onTouchStart=eX.bind(this),this._onTouchMove=tX.bind(this),this._onTouchEnd=nX.bind(this),this._onMouseDown=Yq.bind(this),this._onMouseMove=Jq.bind(this),this._onMouseUp=$q.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,null!==t&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>xq&&(this.dispatchEvent(Cq),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>xq||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(Cq),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Fq,this.keyState=Fq,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(Cq),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Nq.copy(this._panEnd).sub(this._panStart),Nq.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Nq.x*=e,Nq.y*=t}Nq.multiplyScalar(this._eye.length()*this.panSpeed),Lq.copy(this._eye).cross(this.object.up).setLength(Nq.x),Lq.add(Rq.copy(this.object.up).setLength(Nq.y)),this.object.position.add(Lq),this.target.add(Lq),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Nq.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){Vq.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=Vq.length();e?(this._eye.copy(this.object.position).sub(this.target),Oq.copy(this._eye).normalize(),Uq.copy(this.object.up).normalize(),zq.crossVectors(Uq,Oq).normalize(),Uq.setLength(this._moveCurr.y-this._movePrev.y),zq.setLength(this._moveCurr.x-this._movePrev.x),Vq.copy(Uq.add(zq)),Iq.crossVectors(Vq,this._eye).normalize(),e*=this.rotateSpeed,kq.setFromAxisAngle(Iq,e),this._eye.applyQuaternion(kq),this.object.up.applyQuaternion(kq),this._lastAxis.copy(Iq),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),kq.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(kq),this.object.up.applyQuaternion(kq)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Bq?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=bs.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,1!==e&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=bs.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return Pq.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),Pq}_getMouseOnCircle(e,t){return Pq.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),Pq}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId)return void this._pointers.splice(t,1)}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new xs,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function Hq(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e))}function jq(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function Wq(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchEnd(e):this._onMouseUp(),this._removePointer(e),0===this._pointers.length&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function qq(e){this._removePointer(e)}function Xq(){!1!==this.enabled&&(this.keyState=Fq,window.addEventListener("keydown",this._onKeyDown))}function Kq(e){!1!==this.enabled&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Fq&&(e.code!==this.keys[wq]||this.noRotate?e.code!==this.keys[Sq]||this.noZoom?e.code!==this.keys[Tq]||this.noPan||(this.keyState=Tq):this.keyState=Sq:this.keyState=wq))}function Yq(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Wi:this.state=Sq;break;case ji:this.state=wq;break;case qi:this.state=Tq;break;default:this.state=Fq}const n=this.keyState!==Fq?this.keyState:this.state;n!==wq||this.noRotate?n!==Sq||this.noZoom?n!==Tq||this.noPan||(this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.dispatchEvent(_q)}function Jq(e){const t=this.keyState!==Fq?this.keyState:this.state;t!==wq||this.noRotate?t!==Sq||this.noZoom?t!==Tq||this.noPan||this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)))}function $q(){this.state=Fq,this.dispatchEvent(bq)}function Qq(e){if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.dispatchEvent(_q),this.dispatchEvent(bq)}}function Zq(e){!1!==this.enabled&&e.preventDefault()}function eX(e){if(this._trackPointer(e),1===this._pointers.length)this.state=Mq,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=Bq;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart)}this.dispatchEvent(_q)}function tX(e){if(this._trackPointer(e),1===this._pointers.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));else{const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y;this._touchZoomDistanceEnd=Math.sqrt(n*n+r*r);const i=(e.pageX+t.x)/2,a=(e.pageY+t.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,a))}}function nX(e){switch(this._pointers.length){case 0:this.state=Fq;break;case 1:this.state=Mq,this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Bq;for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId!==e.pointerId){const e=this._pointerPositions[this._pointers[t].pointerId];this._moveCurr.copy(this._getMouseOnCircle(e.x,e.y)),this._movePrev.copy(this._moveCurr);break}}this.dispatchEvent(bq)}const rX={type:"change"},iX={type:"start"},aX={type:"end"},oX=new Su,sX=new Nc,uX=Math.cos(70*bs.DEG2RAD),lX=new ws,cX=2*Math.PI,hX=-1,dX=0,pX=1,fX=2,mX=3,gX=4,vX=5,DX=6,yX=1e-6;class EX extends od{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.state=hX,this.target=new ws,this.cursor=new ws,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ji,MIDDLE:Wi,RIGHT:qi},this.touches={ONE:Xi,TWO:Yi},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ws,this._lastQuaternion=new Fs,this._lastTargetPosition=new ws,this._quat=(new Fs).setFromUnitVectors(e.up,new ws(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new id,this._sphericalDelta=new id,this._scale=1,this._panOffset=new ws,this._rotateStart=new xs,this._rotateEnd=new xs,this._rotateDelta=new xs,this._panStart=new xs,this._panEnd=new xs,this._panDelta=new xs,this._dollyStart=new xs,this._dollyEnd=new xs,this._dollyDelta=new xs,this._dollyDirection=new ws,this._mouse=new xs,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=CX.bind(this),this._onPointerDown=AX.bind(this),this._onPointerUp=_X.bind(this),this._onContextMenu=MX.bind(this),this._onMouseWheel=FX.bind(this),this._onKeyDown=wX.bind(this),this._onTouchStart=SX.bind(this),this._onTouchMove=TX.bind(this),this._onMouseDown=bX.bind(this),this._onMouseMove=xX.bind(this),this._interceptControlDown=BX.bind(this),this._interceptControlUp=PX.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(rX),this.update(),this.state=hX}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=this.object.position;lX.copy(t).sub(this.target),lX.applyQuaternion(this._quat),this._spherical.setFromVector3(lX),this.autoRotate&&this.state===hX&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=cX:n>Math.PI&&(n-=cX),r<-Math.PI?r+=cX:r>Math.PI&&(r-=cX),this._spherical.theta=n<=r?Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=e!=this._spherical.radius}if(lX.setFromSpherical(this._spherical),lX.applyQuaternion(this._quatInverse),t.copy(this.target).add(lX),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=lX.length();e=this._clampDistance(t*this._scale);const n=t-e;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),i=!!n}else if(this.object.isOrthographicCamera){const t=new ws(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=n!==this.object.zoom;const r=new ws(this._mouse.x,this._mouse.y,0);r.unproject(this.object),this.object.position.sub(r).add(t),this.object.updateMatrixWorld(),e=lX.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(oX.origin.copy(this.object.position),oX.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(oX.direction))<uX?this.object.lookAt(this.target):(sX.setFromNormalAndCoplanarPoint(this.object.up,this.target),oX.intersectPlane(sX,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,!!(i||this._lastPosition.distanceToSquared(this.object.position)>yX||8*(1-this._lastQuaternion.dot(this.object.quaternion))>yX||this._lastTargetPosition.distanceToSquared(this.target)>yX)&&(this.dispatchEvent(rX),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?cX/60*this.autoRotateSpeed*e:cX/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){lX.setFromMatrixColumn(t,0),lX.multiplyScalar(-e),this._panOffset.add(lX)}_panUp(e,t){!0===this.screenSpacePanning?lX.setFromMatrixColumn(t,1):(lX.setFromMatrixColumn(t,0),lX.crossVectors(this.object.up,lX)),lX.multiplyScalar(e),this._panOffset.add(lX)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;lX.copy(r).sub(this.target);let i=lX.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/n.clientHeight,this.object.matrix),this._panUp(2*t*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,i=t-n.top,a=n.width,o=n.height;this._mouse.x=r/a*2-1,this._mouse.y=-i/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(cX*this._rotateDelta.x/t.clientHeight),this._rotateUp(cX*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(cX*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-cX*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(cX*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-cX*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateEnd.set(n,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(cX*this._rotateDelta.x/t.clientHeight),this._rotateUp(cX*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);this._updateZoomParameters(a,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return void this._pointers.splice(t,1)}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new xs,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function AX(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(e)||(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function CX(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function _X(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(aX),this.state=hX;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y})}}function bX(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Wi:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=pX;break;case ji:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=fX}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=dX}break;case qi:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=dX}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=fX}break;default:this.state=hX}this.state!==hX&&this.dispatchEvent(iX)}function xX(e){switch(this.state){case dX:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case pX:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case fX:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function FX(e){!1!==this.enabled&&!1!==this.enableZoom&&this.state===hX&&(e.preventDefault(),this.dispatchEvent(iX),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(aX))}function wX(e){!1!==this.enabled&&this._handleKeyDown(e)}function SX(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case Xi:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=mX;break;case Ki:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=gX;break;default:this.state=hX}break;case 2:switch(this.touches.TWO){case Yi:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=vX;break;case Ji:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=DX;break;default:this.state=hX}break;default:this.state=hX}this.state!==hX&&this.dispatchEvent(iX)}function TX(e){switch(this._trackPointer(e),this.state){case mX:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case gX:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case vX:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case DX:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=hX}}function MX(e){!1!==this.enabled&&e.preventDefault()}function BX(e){if("Control"===e.key){this._controlActive=!0;this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function PX(e){if("Control"===e.key){this._controlActive=!1;this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}const NX={type:"change"},RX=1e-6,LX=new Fs;class IX extends od{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new ws(0,0,0),this._rotationVector=new ws(0,0,0),this._lastQuaternion=new Fs,this._lastPosition=new ws,this._status=0,this._onKeyDown=kX.bind(this),this._onKeyUp=OX.bind(this),this._onPointerMove=zX.bind(this),this._onPointerDown=UX.bind(this),this._onPointerUp=VX.bind(this),this._onPointerCancel=GX.bind(this),this._onContextMenu=HX.bind(this),null!==t&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(!1===this.enabled)return;const t=this.object,n=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*n),t.translateY(this._moveVector.y*n),t.translateZ(this._moveVector.z*n),LX.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(LX),(this._lastPosition.distanceToSquared(t.position)>RX||8*(1-this._lastQuaternion.dot(t.quaternion))>RX)&&(this.dispatchEvent(NX),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function kX(e){if(!e.altKey&&!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1}this._updateMovementVector(),this._updateRotationVector()}}function OX(e){if(!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0}this._updateMovementVector(),this._updateRotationVector()}}function UX(e){if(!1!==this.enabled)if(this.dragToLook)this._status++;else{switch(e.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1}this._updateMovementVector()}}function zX(e){if(!1!==this.enabled&&(!this.dragToLook||this._status>0)){const t=this._getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this._moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this._moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this._updateRotationVector()}}function VX(e){if(!1!==this.enabled){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(e.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0}this._updateMovementVector()}this._updateRotationVector()}}function GX(){!1!==this.enabled&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function HX(e){!1!==this.enabled&&e.preventDefault()}const jX={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class WX{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const qX=new Ih(-1,1,1,-1,0,1);const XX=new class extends Wl{constructor(){super(),this.setAttribute("position",new kl([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new kl([0,2,0,0,2,0],2))}};class KX{constructor(e){this._mesh=new rc(XX,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,qX)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class YX extends WX{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"tDiffuse";super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof cc?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=lc.clone(e.uniforms),this.material=new cc({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new KX(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class JX extends WX{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),i=e.state;let a,o;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(a=0,o=1):(a=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class $X extends WX{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class QX{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const n=e.getSize(new xs);this._width=n.width,this._height=n.height,(t=new Zs(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ka})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new YX(jX),this.copyPass.material.blending=0,this.clock=new jh}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,i=this.passes.length;r<i;r++){const t=this.passes[r];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==JX&&(t instanceof JX?n=!0:t instanceof $X&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new xs);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class ZX extends WX{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Al}render(e,t,n){const r=e.autoClear;let i,a;e.autoClear=!1,null!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(i),null!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=r}}function eK(){return eK=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},eK.apply(null,arguments)}function tK(e,t){return tK=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tK(e,t)}function nK(e){return nK=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nK(e)}function rK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(rK=function(){return!!e})()}function iK(e){var t="function"==typeof Map?new Map:void 0;return iK=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(YK){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(rK())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&tK(i,n.prototype),i}(e,arguments,nK(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),tK(n,e)},iK(e)}var aK=function(e){function t(t){return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,tK(e,t)}(t,e),t}(iK(Error));function oK(e,t){return e.substr(-t.length)===t}var sK=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function uK(e){return"string"!==typeof e?e:e.match(sK)?parseFloat(e):e}var lK=function(e){return function(t,n){void 0===n&&(n="16px");var r=t,i=n;if("string"===typeof t){if(!oK(t,"px"))throw new aK(69,e,t);r=uK(t)}if("string"===typeof n){if(!oK(n,"px"))throw new aK(70,e,n);i=uK(n)}if("string"===typeof r)throw new aK(71,t,e);if("string"===typeof i)throw new aK(72,n,e);return""+r/i+e}};lK("em");lK("rem");function cK(e){return Math.round(255*e)}function hK(e,t,n){return cK(e)+","+cK(t)+","+cK(n)}function dK(e,t,n,r){if(void 0===r&&(r=hK),0===t)return r(n,n,n);var i=(e%360+360)%360/60,a=(1-Math.abs(2*n-1))*t,o=a*(1-Math.abs(i%2-1)),s=0,u=0,l=0;i>=0&&i<1?(s=a,u=o):i>=1&&i<2?(s=o,u=a):i>=2&&i<3?(u=a,l=o):i>=3&&i<4?(u=o,l=a):i>=4&&i<5?(s=o,l=a):i>=5&&i<6&&(s=a,l=o);var c=n-a/2;return r(s+c,u+c,l+c)}var pK={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var fK=/^#[a-fA-F0-9]{6}$/,mK=/^#[a-fA-F0-9]{8}$/,gK=/^#[a-fA-F0-9]{3}$/,vK=/^#[a-fA-F0-9]{4}$/,DK=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,yK=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,EK=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,AK=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function CK(e){if("string"!==typeof e)throw new aK(3);var t=function(e){if("string"!==typeof e)return e;var t=e.toLowerCase();return pK[t]?"#"+pK[t]:e}(e);if(t.match(fK))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match(mK)){var n=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:n}}if(t.match(gK))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(vK)){var r=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:r}}var i=DK.exec(t);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var a=yK.exec(t.substring(0,50));if(a)return{red:parseInt(""+a[1],10),green:parseInt(""+a[2],10),blue:parseInt(""+a[3],10),alpha:parseFloat(""+a[4])>1?parseFloat(""+a[4])/100:parseFloat(""+a[4])};var o=EK.exec(t);if(o){var s="rgb("+dK(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",u=DK.exec(s);if(!u)throw new aK(4,t,s);return{red:parseInt(""+u[1],10),green:parseInt(""+u[2],10),blue:parseInt(""+u[3],10)}}var l=AK.exec(t.substring(0,50));if(l){var c="rgb("+dK(parseInt(""+l[1],10),parseInt(""+l[2],10)/100,parseInt(""+l[3],10)/100)+")",h=DK.exec(c);if(!h)throw new aK(4,t,c);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10),alpha:parseFloat(""+l[4])>1?parseFloat(""+l[4])/100:parseFloat(""+l[4])}}throw new aK(5)}function _K(e){return function(e){var t,n=e.red/255,r=e.green/255,i=e.blue/255,a=Math.max(n,r,i),o=Math.min(n,r,i),s=(a+o)/2;if(a===o)return void 0!==e.alpha?{hue:0,saturation:0,lightness:s,alpha:e.alpha}:{hue:0,saturation:0,lightness:s};var u=a-o,l=s>.5?u/(2-a-o):u/(a+o);switch(a){case n:t=(r-i)/u+(r<i?6:0);break;case r:t=(i-n)/u+2;break;default:t=(n-r)/u+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:l,lightness:s,alpha:e.alpha}:{hue:t,saturation:l,lightness:s}}(CK(e))}var bK=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function xK(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function FK(e){return xK(Math.round(255*e))}function wK(e,t,n){return bK("#"+FK(e)+FK(t)+FK(n))}function SK(e,t,n){return dK(e,t,n,wK)}function TK(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return SK(e,t,n);if("object"===typeof e&&void 0===t&&void 0===n)return SK(e.hue,e.saturation,e.lightness);throw new aK(1)}function MK(e,t,n,r){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n&&"number"===typeof r)return r>=1?SK(e,t,n):"rgba("+dK(e,t,n)+","+r+")";if("object"===typeof e&&void 0===t&&void 0===n&&void 0===r)return e.alpha>=1?SK(e.hue,e.saturation,e.lightness):"rgba("+dK(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new aK(2)}function BK(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return bK("#"+xK(e)+xK(t)+xK(n));if("object"===typeof e&&void 0===t&&void 0===n)return bK("#"+xK(e.red)+xK(e.green)+xK(e.blue));throw new aK(6)}function PK(e,t,n,r){if("string"===typeof e&&"number"===typeof t){var i=CK(e);return"rgba("+i.red+","+i.green+","+i.blue+","+t+")"}if("number"===typeof e&&"number"===typeof t&&"number"===typeof n&&"number"===typeof r)return r>=1?BK(e,t,n):"rgba("+e+","+t+","+n+","+r+")";if("object"===typeof e&&void 0===t&&void 0===n&&void 0===r)return e.alpha>=1?BK(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new aK(7)}function NK(e){if("object"!==typeof e)throw new aK(8);if(function(e){return"number"===typeof e.red&&"number"===typeof e.green&&"number"===typeof e.blue&&"number"===typeof e.alpha}(e))return PK(e);if(function(e){return"number"===typeof e.red&&"number"===typeof e.green&&"number"===typeof e.blue&&("number"!==typeof e.alpha||"undefined"===typeof e.alpha)}(e))return BK(e);if(function(e){return"number"===typeof e.hue&&"number"===typeof e.saturation&&"number"===typeof e.lightness&&"number"===typeof e.alpha}(e))return MK(e);if(function(e){return"number"===typeof e.hue&&"number"===typeof e.saturation&&"number"===typeof e.lightness&&("number"!==typeof e.alpha||"undefined"===typeof e.alpha)}(e))return TK(e);throw new aK(8)}function RK(e,t,n){return function(){var r=n.concat(Array.prototype.slice.call(arguments));return r.length>=t?e.apply(this,r):RK(e,t,r)}}function LK(e){return RK(e,e.length,[])}LK(function(e,t){if("transparent"===t)return t;var n=_K(t);return NK(eK({},n,{hue:n.hue+parseFloat(e)}))});function IK(e,t,n){return Math.max(e,Math.min(t,n))}LK(function(e,t){if("transparent"===t)return t;var n=_K(t);return NK(eK({},n,{lightness:IK(0,1,n.lightness-parseFloat(e))}))});LK(function(e,t){if("transparent"===t)return t;var n=_K(t);return NK(eK({},n,{saturation:IK(0,1,n.saturation-parseFloat(e))}))});LK(function(e,t){if("transparent"===t)return t;var n=_K(t);return NK(eK({},n,{lightness:IK(0,1,n.lightness+parseFloat(e))}))});var kK=LK(function(e,t,n){if("transparent"===t)return n;if("transparent"===n)return t;if(0===e)return n;var r=CK(t),i=eK({},r,{alpha:"number"===typeof r.alpha?r.alpha:1}),a=CK(n),o=eK({},a,{alpha:"number"===typeof a.alpha?a.alpha:1}),s=i.alpha-o.alpha,u=2*parseFloat(e)-1,l=((u*s===-1?u:u+s)/(1+u*s)+1)/2,c=1-l;return PK({red:Math.floor(i.red*l+o.red*c),green:Math.floor(i.green*l+o.green*c),blue:Math.floor(i.blue*l+o.blue*c),alpha:i.alpha*parseFloat(e)+o.alpha*(1-parseFloat(e))})}),OK=kK;var UK=LK(function(e,t){if("transparent"===t)return t;var n=CK(t);return PK(eK({},n,{alpha:IK(0,1,(100*("number"===typeof n.alpha?n.alpha:1)+100*parseFloat(e))/100)}))}),zK=UK;LK(function(e,t){if("transparent"===t)return t;var n=_K(t);return NK(eK({},n,{saturation:IK(0,1,n.saturation+parseFloat(e))}))});LK(function(e,t){return"transparent"===t?t:NK(eK({},_K(t),{hue:parseFloat(e)}))});LK(function(e,t){return"transparent"===t?t:NK(eK({},_K(t),{lightness:parseFloat(e)}))});LK(function(e,t){return"transparent"===t?t:NK(eK({},_K(t),{saturation:parseFloat(e)}))});LK(function(e,t){return"transparent"===t?t:OK(parseFloat(e),"rgb(0, 0, 0)",t)});LK(function(e,t){return"transparent"===t?t:OK(parseFloat(e),"rgb(255, 255, 255)",t)});LK(function(e,t){if("transparent"===t)return t;var n=CK(t);return PK(eK({},n,{alpha:IK(0,1,+(100*("number"===typeof n.alpha?n.alpha:1)-100*parseFloat(e)).toFixed(2)/100)}))});var VK=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(e){var t=1.70158;return 1===e?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return 0===e?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-VK.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*VK.Bounce.In(2*e):.5*VK.Bounce.Out(2*e-1)+.5}}),generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(2*t,e)/2:(1-Math.pow(2-2*t,e))/2+.5}}}}),GK=function(){return performance.now()},HK=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];null===(e=a._group)||void 0===e||e.remove(a),a._group=this,this._tweens[a.getId()]=a,this._tweensAddedDuringUpdate[a.getId()]=a}},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var i=r[n];i._group=void 0,delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]}},e.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},e.prototype.update=function(e,t){void 0===e&&(e=GK()),void 0===t&&(t=!0);var n=Object.keys(this._tweens);if(0!==n.length)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],a=!t;i&&!1===i.update(e,a)&&!t&&this.remove(i)}n=Object.keys(this._tweensAddedDuringUpdate)}},e}(),jK={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=jK.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=jK.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*a(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=jK.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=jK.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var r=t;r>1;r--)n*=r;return e[t]=n,n}}(),CatmullRom:function(e,t,n,r,i){var a=.5*(n-e),o=.5*(r-t),s=i*i;return(2*t-2*n+a+o)*(i*s)+(-3*t+3*n-2*a-o)*s+a*i+t}}},WK=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),qK=new HK,XK=function(){function e(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=VK.Linear.None,this._interpolationFunction=jK.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=WK.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,"object"===typeof t?(this._group=t,t.add(this)):!0===t&&(this._group=qK,qK.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(e,t){if(void 0===t&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e<0?0:e,this},e.prototype.dynamic=function(e){return void 0===e&&(e=!1),this._isDynamic=e,this},e.prototype.start=function(e,t){if(void 0===e&&(e=GK()),void 0===t&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var i in this._valuesEnd)r[i]=this._valuesEnd[i];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},e.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},e.prototype._setupProperties=function(e,t,n,r,i){for(var a in n){var o=e[a],s=Array.isArray(o),u=s?"array":typeof o,l=!s&&Array.isArray(n[a]);if("undefined"!==u&&"function"!==u){if(l){if(0===(g=n[a]).length)continue;for(var c=[o],h=0,d=g.length;h<d;h+=1){var p=this._handleRelativeValue(o,g[h]);if(isNaN(p)){l=!1,console.warn("Found invalid interpolation list. Skipping.");break}c.push(p)}l&&(n[a]=c)}if("object"!==u&&!s||!o||l)("undefined"===typeof t[a]||i)&&(t[a]=o),s||(t[a]*=1),r[a]=l?n[a].slice().reverse():t[a]||0;else{t[a]=s?[]:{};var f=o;for(var m in f)t[a][m]=f[m];r[a]=s?[]:{};var g=n[a];if(!this._isDynamic){var v={};for(var m in g)v[m]=g[m];n[a]=g=v}this._setupProperties(f,t[a],g,r[a],i)}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(e){return void 0===e&&(e=GK()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e),this},e.prototype.resume=function(e){return void 0===e&&(e=GK()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},e.prototype.remove=function(){var e;return null===(e=this._group)||void 0===e||e.remove(this),this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=VK.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=jK.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(t,n){var r,i,a=this;if(void 0===t&&(t=GK()),void 0===n&&(n=e.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!n)return!1;this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=t-this._startTime,s=this._duration+(null!==(r=this._repeatDelayTime)&&void 0!==r?r:this._delayTime),u=this._duration+this._repeat*s,l=function(){if(0===a._duration)return 1;if(o>u)return 1;var e=Math.trunc(o/s),t=o-e*s,n=Math.min(t/a._duration,1);return 0===n&&o===a._duration?1:n}(),c=this._easingFunction(l);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,c),this._onUpdateCallback&&this._onUpdateCallback(this._object,l),0===this._duration||o>=this._duration){if(this._repeat>0){var h=Math.min(Math.trunc((o-this._duration)/s)+1,this._repeat);for(i in isFinite(this._repeat)&&(this._repeat-=h),this._valuesStartRepeat)this._yoyo||"string"!==typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=s*h,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var d=0,p=this._chainedTweens.length;d<p;d++)this._chainedTweens[d].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,n,r){for(var i in n)if(void 0!==t[i]){var a=t[i]||0,o=n[i],s=Array.isArray(e[i]),u=Array.isArray(o);!s&&u?e[i]=this._interpolationFunction(o,r):"object"===typeof o&&o?this._updateProperties(e[i],a,o,r):"number"===typeof(o=this._handleRelativeValue(a,o))&&(e[i]=a+(o-a)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!==typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];this._valuesStartRepeat[e]="string"===typeof n?this._valuesStartRepeat[e]+parseFloat(n):this._valuesEnd[e],this._valuesEnd[e]=t},e.autoStartOnUpdate=!1,e}(),KK=(WK.nextId,qK);KK.getAll.bind(KK),KK.removeAll.bind(KK),KK.add.bind(KK),KK.remove.bind(KK),KK.update.bind(KK);var YK,JK,$K,QK,ZK,eY,tY,nY,rY,iY,aY,oY,sY={},uY=[],lY=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,cY=Array.isArray;function hY(e,t){for(var n in t)e[n]=t[n];return e}function dY(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function pY(e,t,n,r,i){var a={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==i?++$K:i,__i:-1,__u:0};return null==i&&null!=JK.vnode&&JK.vnode(a),a}function fY(e){return e.children}function mY(e,t){this.props=e,this.context=t}function gY(e,t){if(null==t)return e.__?gY(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?gY(e):null}function vY(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return vY(e)}}function DY(e){(!e.__d&&(e.__d=!0)&&ZK.push(e)&&!yY.__r++||eY!=JK.debounceRendering)&&((eY=JK.debounceRendering)||tY)(yY)}function yY(){for(var e,t,n,r,i,a,o,s=1;ZK.length;)ZK.length>s&&ZK.sort(nY),e=ZK.shift(),s=ZK.length,e.__d&&(n=void 0,i=(r=(t=e).__v).__e,a=[],o=[],t.__P&&((n=hY({},r)).__v=r.__v+1,JK.vnode&&JK.vnode(n),wY(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[i]:null,a,null==i?gY(r):i,!!(32&r.__u),o),n.__v=r.__v,n.__.__k[n.__i]=n,SY(a,n,o),n.__e!=i&&vY(n)));yY.__r=0}function EY(e,t,n,r,i,a,o,s,u,l,c){var h,d,p,f,m,g,v=r&&r.__k||uY,D=t.length;for(u=AY(n,t,v,u,D),h=0;h<D;h++)null!=(p=n.__k[h])&&(d=-1==p.__i?sY:v[p.__i]||sY,p.__i=h,g=wY(e,p,d,i,a,o,s,u,l,c),f=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&BY(d.ref,null,p),c.push(p.ref,p.__c||f,p)),null==m&&null!=f&&(m=f),4&p.__u||d.__k===p.__k?u=CY(p,u,e):"function"==typeof p.type&&void 0!==g?u=g:f&&(u=f.nextSibling),p.__u&=-7);return n.__e=m,u}function AY(e,t,n,r,i){var a,o,s,u,l,c=n.length,h=c,d=0;for(e.__k=new Array(i),a=0;a<i;a++)null!=(o=t[a])&&"boolean"!=typeof o&&"function"!=typeof o?(u=a+d,(o=e.__k[a]="string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?pY(null,o,null,null,null):cY(o)?pY(fY,{children:o},null,null,null):null==o.constructor&&o.__b>0?pY(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=e,o.__b=e.__b+1,s=null,-1!=(l=o.__i=_Y(o,n,u,h))&&(h--,(s=n[l])&&(s.__u|=2)),null==s||null==s.__v?(-1==l&&(i>c?d--:i<c&&d++),"function"!=typeof o.type&&(o.__u|=4)):l!=u&&(l==u-1?d--:l==u+1?d++:(l>u?d--:d++,o.__u|=4))):e.__k[a]=null;if(h)for(a=0;a<c;a++)null!=(s=n[a])&&0==(2&s.__u)&&(s.__e==r&&(r=gY(s)),PY(s,s));return r}function CY(e,t,n){var r,i;if("function"==typeof e.type){for(r=e.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=e,t=CY(r[i],t,n));return t}e.__e!=t&&(t&&e.type&&!n.contains(t)&&(t=gY(e)),n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function _Y(e,t,n,r){var i,a,o=e.key,s=e.type,u=t[n];if(null===u&&null==e.key||u&&o==u.key&&s==u.type&&0==(2&u.__u))return n;if(r>(null!=u&&0==(2&u.__u)?1:0))for(i=n-1,a=n+1;i>=0||a<t.length;){if(i>=0){if((u=t[i])&&0==(2&u.__u)&&o==u.key&&s==u.type)return i;i--}if(a<t.length){if((u=t[a])&&0==(2&u.__u)&&o==u.key&&s==u.type)return a;a++}}return-1}function bY(e,t,n){"-"==t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||lY.test(t)?n:n+"px"}function xY(e,t,n,r,i){var a,o;e:if("style"==t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||bY(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||bY(e.style,t,n[t])}else if("o"==t[0]&&"n"==t[1])a=t!=(t=t.replace(rY,"$1")),o=t.toLowerCase(),t=o in e||"onFocusOut"==t||"onFocusIn"==t?o.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=n,n?r?n.u=r.u:(n.u=iY,e.addEventListener(t,a?oY:aY,a)):e.removeEventListener(t,a?oY:aY,a);else{if("http://www.w3.org/2000/svg"==i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==n?"":n))}}function FY(e){return function(t){if(this.l){var n=this.l[t.type+e];if(null==t.t)t.t=iY++;else if(t.t<n.u)return;return n(JK.event?JK.event(t):t)}}}function wY(e,t,n,r,i,a,o,s,u,l){var c,h,d,p,f,m,g,v,D,y,E,A,C,_,b,x,F,w=t.type;if(null!=t.constructor)return null;128&n.__u&&(u=!!(32&n.__u),a=[s=t.__e=n.__e]),(c=JK.__b)&&c(t);e:if("function"==typeof w)try{if(v=t.props,D="prototype"in w&&w.prototype.render,y=(c=w.contextType)&&r[c.__c],E=c?y?y.props.value:c.__:r,n.__c?g=(h=t.__c=n.__c).__=h.__E:(D?t.__c=h=new w(v,E):(t.__c=h=new mY(v,E),h.constructor=w,h.render=NY),y&&y.sub(h),h.props=v,h.state||(h.state={}),h.context=E,h.__n=r,d=h.__d=!0,h.__h=[],h._sb=[]),D&&null==h.__s&&(h.__s=h.state),D&&null!=w.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=hY({},h.__s)),hY(h.__s,w.getDerivedStateFromProps(v,h.__s))),p=h.props,f=h.state,h.__v=t,d)D&&null==w.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),D&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(D&&null==w.getDerivedStateFromProps&&v!==p&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(v,E),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(v,h.__s,E)||t.__v==n.__v){for(t.__v!=n.__v&&(h.props=v,h.state=h.__s,h.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(e){e&&(e.__=t)}),A=0;A<h._sb.length;A++)h.__h.push(h._sb[A]);h._sb=[],h.__h.length&&o.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(v,h.__s,E),D&&null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(p,f,m)})}if(h.context=E,h.props=v,h.__P=e,h.__e=!1,C=JK.__r,_=0,D){for(h.state=h.__s,h.__d=!1,C&&C(t),c=h.render(h.props,h.state,h.context),b=0;b<h._sb.length;b++)h.__h.push(h._sb[b]);h._sb=[]}else do{h.__d=!1,C&&C(t),c=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++_<25);h.state=h.__s,null!=h.getChildContext&&(r=hY(hY({},r),h.getChildContext())),D&&!d&&null!=h.getSnapshotBeforeUpdate&&(m=h.getSnapshotBeforeUpdate(p,f)),x=c,null!=c&&c.type===fY&&null==c.key&&(x=TY(c.props.children)),s=EY(e,cY(x)?x:[x],t,n,r,i,a,o,s,u,l),h.base=t.__e,t.__u&=-161,h.__h.length&&o.push(h),g&&(h.__E=h.__=null)}catch(e){if(t.__v=null,u||null!=a)if(e.then){for(t.__u|=u?160:128;s&&8==s.nodeType&&s.nextSibling;)s=s.nextSibling;a[a.indexOf(s)]=null,t.__e=s}else for(F=a.length;F--;)dY(a[F]);else t.__e=n.__e,t.__k=n.__k;JK.__e(e,t,n)}else null==a&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):s=t.__e=MY(n.__e,t,n,r,i,a,o,u,l);return(c=JK.diffed)&&c(t),128&t.__u?void 0:s}function SY(e,t,n){for(var r=0;r<n.length;r++)BY(n[r],n[++r],n[++r]);JK.__c&&JK.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){JK.__e(e,t.__v)}})}function TY(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:cY(e)?e.map(TY):hY({},e)}function MY(e,t,n,r,i,a,o,s,u){var l,c,h,d,p,f,m,g=n.props,v=t.props,D=t.type;if("svg"==D?i="http://www.w3.org/2000/svg":"math"==D?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),null!=a)for(l=0;l<a.length;l++)if((p=a[l])&&"setAttribute"in p==!!D&&(D?p.localName==D:3==p.nodeType)){e=p,a[l]=null;break}if(null==e){if(null==D)return document.createTextNode(v);e=document.createElementNS(i,D,v.is&&v),s&&(JK.__m&&JK.__m(t,a),s=!1),a=null}if(null==D)g===v||s&&e.data==v||(e.data=v);else{if(a=a&&YK.call(e.childNodes),g=n.props||sY,!s&&null!=a)for(g={},l=0;l<e.attributes.length;l++)g[(p=e.attributes[l]).name]=p.value;for(l in g)if(p=g[l],"children"==l);else if("dangerouslySetInnerHTML"==l)h=p;else if(!(l in v)){if("value"==l&&"defaultValue"in v||"checked"==l&&"defaultChecked"in v)continue;xY(e,l,null,p,i)}for(l in v)p=v[l],"children"==l?d=p:"dangerouslySetInnerHTML"==l?c=p:"value"==l?f=p:"checked"==l?m=p:s&&"function"!=typeof p||g[l]===p||xY(e,l,p,g[l],i);if(c)s||h&&(c.__html==h.__html||c.__html==e.innerHTML)||(e.innerHTML=c.__html),t.__k=[];else if(h&&(e.innerHTML=""),EY("template"==t.type?e.content:e,cY(d)?d:[d],t,n,r,"foreignObject"==D?"http://www.w3.org/1999/xhtml":i,a,o,a?a[0]:n.__k&&gY(n,0),s,u),null!=a)for(l=a.length;l--;)dY(a[l]);s||(l="value","progress"==D&&null==f?e.removeAttribute("value"):null!=f&&(f!==e[l]||"progress"==D&&!f||"option"==D&&f!=g[l])&&xY(e,l,f,g[l],i),l="checked",null!=m&&m!=e[l]&&xY(e,l,m,g[l],i))}return e}function BY(e,t,n){try{if("function"==typeof e){var r="function"==typeof e.__u;r&&e.__u(),r&&null==t||(e.__u=e(t))}else e.current=t}catch(e){JK.__e(e,n)}}function PY(e,t,n){var r,i;if(JK.unmount&&JK.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||BY(r,null,t)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){JK.__e(e,t)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&PY(r[i],t,n||"function"!=typeof e.type);n||dY(e.__e),e.__c=e.__=e.__e=void 0}function NY(e,t,n){return this.constructor(e,n)}function RY(e,t,n){var r,i,a,o;t==document&&(t=document.documentElement),JK.__&&JK.__(e,t),i=(r="function"==typeof n)?null:n&&n.__k||t.__k,a=[],o=[],wY(t,e=(!r&&n||t).__k=function(e,t,n){var r,i,a,o={};for(a in t)"key"==a?r=t[a]:"ref"==a?i=t[a]:o[a]=t[a];if(arguments.length>2&&(o.children=arguments.length>3?YK.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(a in e.defaultProps)void 0===o[a]&&(o[a]=e.defaultProps[a]);return pY(e,o,r,i,null)}(fY,null,[e]),i||sY,sY,t.namespaceURI,!r&&n?[n]:i?null:t.firstChild?YK.call(t.childNodes):null,a,!r&&n?n:i?i.__e:t.firstChild,r,o),SY(a,e,o)}function LY(e,t,n){var r,i,a,o,s=hY({},e.props);for(a in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),t)"key"==a?r=t[a]:"ref"==a?i=t[a]:s[a]=void 0===t[a]&&null!=o?o[a]:t[a];return arguments.length>2&&(s.children=arguments.length>3?YK.call(arguments,2):n),pY(e.type,s,r||e.key,i||e.ref,null)}function IY(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function kY(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function OY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function UY(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return IY(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?IY(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zY(e){return zY="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zY(e)}YK=uY.slice,JK={__e:function(e,t,n,r){for(var i,a,o;t=t.__;)if((i=t.__c)&&!i.__)try{if((a=i.constructor)&&null!=a.getDerivedStateFromError&&(i.setState(a.getDerivedStateFromError(e)),o=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(e,r||{}),o=i.__d),o)return i.__E=i}catch(t){e=t}throw e}},$K=0,QK=function(e){return null!=e&&null==e.constructor},mY.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=hY({},this.state),"function"==typeof e&&(e=e(hY({},n),this.props)),e&&hY(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),DY(this))},mY.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),DY(this))},mY.prototype.render=fY,ZK=[],tY="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,nY=function(e,t){return e.__v.__b-t.__v.__b},yY.__r=0,rY=/(PointerCapture)$|Capture$/i,iY=0,aY=FY(!1),oY=FY(!0);var VY=function(e){if("object"!==zY(e))return e;var t,n=LY(e);n.props&&(n.props=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OY(Object(n),!0).forEach(function(t){kY(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n.props),null!==n&&void 0!==n&&null!==(t=n.props)&&void 0!==t&&t.children&&(n.props.children=Array.isArray(n.props.children)?n.props.children.map(VY):VY(n.props.children)));return n};!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".float-tooltip-kap {\n  position: absolute;\n  width: max-content; /* prevent shrinking near right edge */\n  max-width: max(50%, 150px);\n  padding: 3px 5px;\n  border-radius: 3px;\n  font: 12px sans-serif;\n  color: #eee;\n  background: rgba(0,0,0,0.6);\n  pointer-events: none;\n}\n");var GY=$A({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).style,r=void 0===n?{}:n,i=Mr(!!e&&"object"===zY(e)&&!!e.node&&"function"===typeof e.node?e.node():e);"static"===i.style("position")&&i.style("position","relative"),t.tooltipEl=i.append("div").attr("class","float-tooltip-kap"),Object.entries(r).forEach(function(e){var n=UY(e,2),r=n[0],i=n[1];return t.tooltipEl.style(r,i)}),t.tooltipEl.style("left","-10000px").style("display","none");var a="tooltip-".concat(Math.round(1e12*Math.random()));t.mouseInside=!1,i.on("mousemove.".concat(a),function(e){t.mouseInside=!0;var n=function(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}(e),r=i.node(),a=r.offsetWidth,o=r.offsetHeight,s=[null===t.offsetX||void 0===t.offsetX?"-".concat(n[0]/a*100,"%"):"number"===typeof t.offsetX?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,null===t.offsetY||void 0===t.offsetY?o>130&&o-n[1]<100?"calc(-100% - 6px)":"21px":"number"===typeof t.offsetY?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",n[0]+"px").style("top",n[1]+"px").style("transform","translate(".concat(s.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),i.on("mouseover.".concat(a),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),i.on("mouseout.".concat(a),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){var t,n;e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):"string"===typeof e.content?e.tooltipEl.html(e.content):!function(e){return QK(LY(e))}(e.content)?(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):(e.tooltipEl.text(""),t=e.content,delete(n=e.tooltipEl.node()).__k,RY(VY(t),n)):e.tooltipEl.text("")}});function HY(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function jY(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WY(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||XY(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qY(e){return function(e){if(Array.isArray(e))return HY(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||XY(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function XY(e,t){if(e){if("string"==typeof e)return HY(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?HY(e,t):void 0}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".scene-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: sans-serif;\n  pointer-events: none;\n  user-select: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var KY=window.THREE?window.THREE:{WebGLRenderer:class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=Rs(),context:n=null,depth:r=!0,stencil:i=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:u=!1,powerPreference:l="default",failIfMajorPerformanceCaveat:c=!1,reverseDepthBuffer:h=!1}=e;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=a;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const v=[],D=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=0,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const y=this;let E=!1;this._outputColorSpace=Yo;let A=0,C=0,_=null,b=-1,x=null;const F=new $s,w=new $s;let S=null;const T=new Al(0);let M=0,B=t.width,P=t.height,N=1,R=null,L=null;const I=new $s(0,0,B,P),k=new $s(0,0,B,P);let O=!1;const U=new Ic;let z=!1,V=!1;const G=new Tu,H=new Tu,j=new ws,W=new $s,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let X=!1;function K(){return null===_?N:1}let Y,J,$,Q,Z,ee,te,ne,re,ie,ae,oe,se,ue,le,ce,he,de,pe,fe,me,ge,ve,De,ye=n;function Ee(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(Hi)),t.addEventListener("webglcontextlost",_e,!1),t.addEventListener("webglcontextrestored",be,!1),t.addEventListener("webglcontextcreationerror",xe,!1),null===ye){const t="webgl2";if(ye=Ee(t,e),null===ye)throw Ee(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(He){throw console.error("THREE.WebGLRenderer: "+He.message),He}function Ae(){Y=new yb(ye),Y.init(),ge=new mF(ye,Y),J=new Q_(ye,Y,e,ge),$=new pF(ye,Y),J.reverseDepthBuffer&&h&&$.buffers.depth.setReversed(!0),Q=new Cb(ye),Z=new eF,ee=new fF(ye,Y,$,Z,J,ge,Q),te=new eb(y),ne=new Db(y),re=new G_(ye),ve=new J_(ye,re),ie=new Eb(ye,re,Q,ve),ae=new bb(ye,ie,re,Q),pe=new _b(ye,J,ee),ce=new Z_(Z),oe=new Zx(y,te,ne,Y,J,ve,ce),se=new EF(y,Z),ue=new iF,le=new cF(Y),de=new Y_(y,te,ne,$,ae,d,s),he=new hF(y,ae,J),De=new AF(ye,Q,J,$),fe=new $_(ye,Y,Q),me=new Ab(ye,Y,Q),Q.programs=oe.programs,y.capabilities=J,y.extensions=Y,y.properties=Z,y.renderLists=ue,y.shadowMap=he,y.state=$,y.info=Q}Ae();const Ce=new vF(y,ye);function _e(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function be(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;const e=Q.autoReset,t=he.enabled,n=he.autoUpdate,r=he.needsUpdate,i=he.type;Ae(),Q.autoReset=e,he.enabled=t,he.autoUpdate=n,he.needsUpdate=r,he.type=i}function xe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Fe(e){const t=e.target;t.removeEventListener("dispose",Fe),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach(function(e){oe.releaseProgram(e)}),e.isShaderMaterial&&oe.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function we(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,ke(e,t,n),e.side=0,e.needsUpdate=!0,ke(e,t,n),e.side=2):ke(e,t,n)}this.xr=Ce,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(e){void 0!==e&&(N=e,this.setSize(B,P,!1))},this.getSize=function(e){return e.set(B,P)},this.setSize=function(e,n){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ce.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(B=e,P=n,t.width=Math.floor(e*N),t.height=Math.floor(n*N),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(B*N,P*N).floor()},this.setDrawingBufferSize=function(e,n,r){B=e,P=n,N=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(F)},this.getViewport=function(e){return e.copy(I)},this.setViewport=function(e,t,n,r){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,n,r),$.viewport(F.copy(I).multiplyScalar(N).round())},this.getScissor=function(e){return e.copy(k)},this.setScissor=function(e,t,n,r){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,n,r),$.scissor(w.copy(k).multiplyScalar(N).round())},this.getScissorTest=function(){return O},this.setScissorTest=function(e){$.setScissorTest(O=e)},this.setOpaqueSort=function(e){R=e},this.setTransparentSort=function(e){L=e},this.getClearColor=function(e){return e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor(...arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha(...arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==_){const t=_.texture.format;e=t===uo||t===so||t===ao}if(e){const e=_.texture.type,t=e===Va||e===qa||e===ja||e===$a||e===Ya||e===Ja,n=de.getClearColor(),r=de.getClearAlpha(),i=n.r,a=n.g,o=n.b;t?(p[0]=i,p[1]=a,p[2]=o,p[3]=r,ye.clearBufferuiv(ye.COLOR,0,p)):(f[0]=i,f[1]=a,f[2]=o,f[3]=r,ye.clearBufferiv(ye.COLOR,0,f))}else n|=ye.COLOR_BUFFER_BIT}e&&(n|=ye.DEPTH_BUFFER_BIT),t&&(n|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",_e,!1),t.removeEventListener("webglcontextrestored",be,!1),t.removeEventListener("webglcontextcreationerror",xe,!1),de.dispose(),ue.dispose(),le.dispose(),Z.dispose(),te.dispose(),ne.dispose(),ae.dispose(),ve.dispose(),De.dispose(),oe.dispose(),Ce.dispose(),Ce.removeEventListener("sessionstart",Te),Ce.removeEventListener("sessionend",Me),Be.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=q);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,n,r,i){!0!==t.isScene&&(t=q);ee.resetTextureUnits();const a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===_?y.outputColorSpace:!0===_.isXRRenderTarget?_.texture.colorSpace:Jo,u=(r.isMeshStandardMaterial?ne:te).get(r.envMap||o),l=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;r.toneMapped&&(null!==_&&!0!==_.isXRRenderTarget||(f=y.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,D=Z.get(r),E=g.state.lights;if(!0===z&&(!0===V||e!==x)){const t=e===x&&r.id===b;ce.setState(r,e,t)}let A=!1;r.version===D.__version?D.needsLights&&D.lightsStateVersion!==E.state.version||D.outputColorSpace!==s||i.isBatchedMesh&&!1===D.batching?A=!0:i.isBatchedMesh||!0!==D.batching?i.isBatchedMesh&&!0===D.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===D.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===D.instancing?A=!0:i.isInstancedMesh||!0!==D.instancing?i.isSkinnedMesh&&!1===D.skinning?A=!0:i.isSkinnedMesh||!0!==D.skinning?i.isInstancedMesh&&!0===D.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===D.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===D.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===D.instancingMorph&&null!==i.morphTexture||D.envMap!==u||!0===r.fog&&D.fog!==a?A=!0:void 0===D.numClippingPlanes||D.numClippingPlanes===ce.numPlanes&&D.numIntersection===ce.numIntersection?(D.vertexAlphas!==l||D.vertexTangents!==c||D.morphTargets!==h||D.morphNormals!==d||D.morphColors!==p||D.toneMapping!==f||D.morphTargetsCount!==v)&&(A=!0):A=!0:A=!0:A=!0:A=!0:(A=!0,D.__version=r.version);let C=D.currentProgram;!0===A&&(C=ke(r,t,i));let F=!1,w=!1,S=!1;const T=C.getUniforms(),M=D.uniforms;$.useProgram(C.program)&&(F=!0,w=!0,S=!0);r.id!==b&&(b=r.id,w=!0);if(F||x!==e){$.buffers.depth.getReversed()?(G.copy(e.projectionMatrix),function(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}(G),function(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}(G),T.setValue(ye,"projectionMatrix",G)):T.setValue(ye,"projectionMatrix",e.projectionMatrix),T.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=T.map.cameraPosition;void 0!==t&&t.setValue(ye,j.setFromMatrixPosition(e.matrixWorld)),J.logarithmicDepthBuffer&&T.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&T.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),x!==e&&(x=e,w=!0,S=!0)}if(i.isSkinnedMesh){T.setOptional(ye,i,"bindMatrix"),T.setOptional(ye,i,"bindMatrixInverse");const e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),T.setValue(ye,"boneTexture",e.boneTexture,ee))}i.isBatchedMesh&&(T.setOptional(ye,i,"batchingTexture"),T.setValue(ye,"batchingTexture",i._matricesTexture,ee),T.setOptional(ye,i,"batchingIdTexture"),T.setValue(ye,"batchingIdTexture",i._indirectTexture,ee),T.setOptional(ye,i,"batchingColorTexture"),null!==i._colorsTexture&&T.setValue(ye,"batchingColorTexture",i._colorsTexture,ee));const B=n.morphAttributes;void 0===B.position&&void 0===B.normal&&void 0===B.color||pe.update(i,n,C);(w||D.receiveShadow!==i.receiveShadow)&&(D.receiveShadow=i.receiveShadow,T.setValue(ye,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(M.envMap.value=u,M.flipEnvMap.value=u.isCubeTexture&&!1===u.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(M.envMapIntensity.value=t.environmentIntensity);w&&(T.setValue(ye,"toneMappingExposure",y.toneMappingExposure),D.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(M,S),a&&!0===r.fog&&se.refreshFogUniforms(M,a),se.refreshMaterialUniforms(M,r,N,P,g.state.transmissionRenderTarget[e.id]),Tx.upload(ye,Oe(D),M,ee));r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Tx.upload(ye,Oe(D),M,ee),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&T.setValue(ye,"center",i.center);if(T.setValue(ye,"modelViewMatrix",i.modelViewMatrix),T.setValue(ye,"normalMatrix",i.normalMatrix),T.setValue(ye,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];De.update(n,C),De.bind(n,C)}}return C}(e,t,n,r,i);$.setMaterial(r,o);let u=n.index,l=1;if(!0===r.wireframe){if(u=ie.getWireframeAttribute(n),void 0===u)return;l=2}const c=n.drawRange,h=n.attributes.position;let d=c.start*l,p=(c.start+c.count)*l;null!==a&&(d=Math.max(d,a.start*l),p=Math.min(p,(a.start+a.count)*l)),null!==u?(d=Math.max(d,0),p=Math.min(p,u.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;ve.setup(i,r,s,n,u);let v=fe;if(null!==u&&(m=re.get(u),v=me,v.setIndex(m)),i.isMesh)!0===r.wireframe?($.setLineWidth(r.wireframeLinewidth*K()),v.setMode(ye.LINES)):v.setMode(ye.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),$.setLineWidth(e*K()),i.isLineSegments?v.setMode(ye.LINES):i.isLineLoop?v.setMode(ye.LINE_LOOP):v.setMode(ye.LINE_STRIP)}else i.isPoints?v.setMode(ye.POINTS):i.isSprite&&v.setMode(ye.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)Is("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))v.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const e=i._multiDrawStarts,t=i._multiDrawCounts,n=i._multiDrawCount,a=u?re.get(u).bytesPerElement:1,o=Z.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)o.setValue(ye,"_gl_DrawID",r),v.render(e[r]/a,t[r])}else if(i.isInstancedMesh)v.renderInstances(d,f,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(d,f,t)}else v.render(d,f)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),g=le.get(n),g.init(t),D.push(g),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))}),g.setupLights();const r=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];we(a,n,e),r.add(a)}else we(t,n,e),r.add(t)}),g=D.pop(),r},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){Z.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Se=null;function Te(){Be.stop()}function Me(){Be.start()}const Be=new V_;function Pe(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){r&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ae.update(e),i=e.material;i.visible&&m.push(e,t,i,n,W.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){const t=ae.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)),W.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(i)){const r=t.groups;for(let a=0,o=r.length;a<o;a++){const o=r[a],s=i[o.materialIndex];s&&s.visible&&m.push(e,t,s,n,W.z,o)}}else i.visible&&m.push(e,t,i,n,W.z,null)}const i=e.children;for(let a=0,o=i.length;a<o;a++)Pe(i[a],t,n,r)}function Ne(e,t,n,r){const i=e.opaque,a=e.transmissive,o=e.transparent;g.setupLightsView(n),!0===z&&ce.setGlobalState(y.clippingPlanes,n),r&&$.viewport(F.copy(r)),i.length>0&&Le(i,t,n),a.length>0&&Le(a,t,n),o.length>0&&Le(o,t,n),$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1)}function Re(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[r.id]&&(g.state.transmissionRenderTarget[r.id]=new Zs(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?Ka:Va,minFilter:za,samples:4,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:zs.workingColorSpace}));const a=g.state.transmissionRenderTarget[r.id],o=r.viewport||F;a.setSize(o.z*y.transmissionResolutionScale,o.w*y.transmissionResolutionScale);const s=y.getRenderTarget();y.setRenderTarget(a),y.getClearColor(T),M=y.getClearAlpha(),M<1&&y.setClearColor(16777215,.5),y.clear(),X&&de.render(n);const u=y.toneMapping;y.toneMapping=0;const l=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),g.setupLightsView(r),!0===z&&ce.setGlobalState(y.clippingPlanes,r),Le(e,n,r),ee.updateMultisampleRenderTarget(a),ee.updateRenderTargetMipmap(a),!1===Y.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,a=t.length;i<a;i++){const a=t[i],o=a.object,s=a.geometry,u=a.material,l=a.group;if(2===u.side&&o.layers.test(r.layers)){const t=u.side;u.side=1,u.needsUpdate=!0,Ie(o,n,r,s,u,l),u.side=t,u.needsUpdate=!0,e=!0}}!0===e&&(ee.updateMultisampleRenderTarget(a),ee.updateRenderTargetMipmap(a))}y.setRenderTarget(s),y.setClearColor(T,M),void 0!==l&&(r.viewport=l),y.toneMapping=u}function Le(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],o=a.object,s=a.geometry,u=a.group;let l=a.material;!0===l.allowOverride&&null!==r&&(l=r),o.layers.test(n.layers)&&Ie(o,t,n,s,l,u)}}function Ie(e,t,n,r,i,a){e.onBeforeRender(y,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(y,t,n,r,e,a),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=2):y.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(y,t,n,r,i,a)}function ke(e,t,n){!0!==t.isScene&&(t=q);const r=Z.get(e),i=g.state.lights,a=g.state.shadowsArray,o=i.state.version,s=oe.getParameters(e,i.state,a,t,n),u=oe.getProgramCacheKey(s);let l=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ne:te).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===l&&(e.addEventListener("dispose",Fe),l=new Map,r.programs=l);let c=l.get(u);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===o)return Ue(e,s),c}else s.uniforms=oe.getUniforms(e),e.onBeforeCompile(s,y),c=oe.acquireProgram(s,u),l.set(u,c),r.uniforms=s.uniforms;const h=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ce.uniform),Ue(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=c,r.uniformsList=null,c}function Oe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Tx.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ue(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Be.setAnimationLoop(function(e){Se&&Se(e)}),"undefined"!==typeof self&&Be.setContext(self),this.setAnimationLoop=function(e){Se=e,Ce.setAnimationLoop(e),null===e?Be.stop():Be.start()},Ce.addEventListener("sessionstart",Te),Ce.addEventListener("sessionend",Me),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===E)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ce.enabled&&!0===Ce.isPresenting&&(!0===Ce.cameraAutoUpdate&&Ce.updateCamera(t),t=Ce.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,_),g=le.get(e,D.length),g.init(t),D.push(g),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(H),V=this.localClippingEnabled,z=ce.init(this.clippingPlanes,V),m=ue.get(e,v.length),m.init(),v.push(m),!0===Ce.enabled&&!0===Ce.isPresenting){const e=y.xr.getDepthSensingMesh();null!==e&&Pe(e,t,-1/0,y.sortObjects)}Pe(e,t,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(R,L),X=!1===Ce.enabled||!1===Ce.isPresenting||!1===Ce.hasDepthSensing(),X&&de.addToRenderList(m,e),this.info.render.frame++,!0===z&&ce.beginShadows();const n=g.state.shadowsArray;he.render(n,e,t),!0===z&&ce.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=m.opaque,i=m.transmissive;if(g.setupLights(),t.isArrayCamera){const n=t.cameras;if(i.length>0)for(let t=0,a=n.length;t<a;t++){Re(r,i,e,n[t])}X&&de.render(e);for(let t=0,r=n.length;t<r;t++){const r=n[t];Ne(m,e,r,r.viewport)}}else i.length>0&&Re(r,i,e,t),X&&de.render(e),Ne(m,e,t);null!==_&&0===C&&(ee.updateMultisampleRenderTarget(_),ee.updateRenderTargetMipmap(_)),!0===e.isScene&&e.onAfterRender(y,e,t),ve.resetDefaultState(),b=-1,x=null,D.pop(),D.length>0?(g=D[D.length-1],!0===z&&ce.setGlobalState(y.clippingPlanes,g.state.camera)):g=null,v.pop(),m=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(e,t,n){const r=Z.get(e);r.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===r.__autoAllocateDepthBuffer&&(r.__useRenderToTexture=!1),Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=r.__autoAllocateDepthBuffer?void 0:n,r.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const ze=ye.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_=e,A=t,C=n;let r=!0,i=null,a=!1,o=!1;if(e){const s=Z.get(e);if(void 0!==s.__useDefaultFramebuffer)$.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1;else if(void 0===s.__webglFramebuffer)ee.setupRenderTarget(e);else if(s.__hasExternalTextures)ee.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(s.__boundDepthTexture!==t){if(null!==t&&Z.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ee.setupDepthRenderbuffer(e)}}const u=e.texture;(u.isData3DTexture||u.isDataArrayTexture||u.isCompressedArrayTexture)&&(o=!0);const l=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(l[t])?l[t][n]:l[t],a=!0):i=e.samples>0&&!1===ee.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(l)?l[n]:l,F.copy(e.viewport),w.copy(e.scissor),S=e.scissorTest}else F.copy(I).multiplyScalar(N).floor(),w.copy(k).multiplyScalar(N).floor(),S=O;0!==n&&(i=ze);if($.bindFramebuffer(ye.FRAMEBUFFER,i)&&r&&$.drawBuffers(e,i),$.viewport(F),$.scissor(w),$.setScissorTest(S),a){const r=Z.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(o){const r=Z.get(e.texture),i=t;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,r.__webglTexture,n,i)}else if(null!==e&&0!==n){const t=Z.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,t.__webglTexture,n)}b=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let u=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(u=u[o]),u){$.bindFramebuffer(ye.FRAMEBUFFER,u);try{const o=e.textures[s],u=o.format,l=o.type;if(!J.textureFormatReadable(u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!J.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&(e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+s),ye.readPixels(t,n,r,i,ge.convert(u),ge.convert(l),a))}finally{const e=null!==_?Z.get(_).__webglFramebuffer:null;$.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,i,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let u=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(u=u[o]),u){if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i){$.bindFramebuffer(ye.FRAMEBUFFER,u);const o=e.textures[s],l=o.format,c=o.type;if(!J.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!J.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,h),ye.bufferData(ye.PIXEL_PACK_BUFFER,a.byteLength,ye.STREAM_READ),e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+s),ye.readPixels(t,n,r,i,ge.convert(l),ge.convert(c),0);const d=null!==_?Z.get(_).__webglFramebuffer:null;$.bindFramebuffer(ye.FRAMEBUFFER,d);const p=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);return ye.flush(),await function(e,t,n){return new Promise(function(r,i){setTimeout(function a(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:i();break;case e.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:r()}},n)})}(ye,p,4),ye.bindBuffer(ye.PIXEL_PACK_BUFFER,h),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,a),ye.deleteBuffer(h),ye.deleteSync(p),a}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),a=Math.floor(e.image.height*r),o=null!==t?t.x:0,s=null!==t?t.y:0;ee.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,o,s,i,a),$.unbindTexture()};const Ve=ye.createFramebuffer(),Ge=ye.createFramebuffer();this.copyTextureToTexture=function(e,t){let n,r,i,a,o,s,u,l,c,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===f&&(0!==p?(Is("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),f=p,p=0):f=0);const m=e.isCompressedTexture?e.mipmaps[f]:e.image;if(null!==h)n=h.max.x-h.min.x,r=h.max.y-h.min.y,i=h.isBox3?h.max.z-h.min.z:1,a=h.min.x,o=h.min.y,s=h.isBox3?h.min.z:0;else{const t=Math.pow(2,-p);n=Math.floor(m.width*t),r=Math.floor(m.height*t),i=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,a=0,o=0,s=0}null!==d?(u=d.x,l=d.y,c=d.z):(u=0,l=0,c=0);const g=ge.convert(t.format),v=ge.convert(t.type);let D;t.isData3DTexture?(ee.setTexture3D(t,0),D=ye.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(ee.setTexture2DArray(t,0),D=ye.TEXTURE_2D_ARRAY):(ee.setTexture2D(t,0),D=ye.TEXTURE_2D),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const y=ye.getParameter(ye.UNPACK_ROW_LENGTH),E=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),A=ye.getParameter(ye.UNPACK_SKIP_PIXELS),C=ye.getParameter(ye.UNPACK_SKIP_ROWS),_=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,m.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,m.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,a),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,o),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,s);const b=e.isDataArrayTexture||e.isData3DTexture,x=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const h=Z.get(e),d=Z.get(t),m=Z.get(h.__renderTarget),g=Z.get(d.__renderTarget);$.bindFramebuffer(ye.READ_FRAMEBUFFER,m.__webglFramebuffer),$.bindFramebuffer(ye.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<i;v++)b&&(ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,Z.get(e).__webglTexture,p,s+v),ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,Z.get(t).__webglTexture,f,c+v)),ye.blitFramebuffer(a,o,n,r,u,l,n,r,ye.DEPTH_BUFFER_BIT,ye.NEAREST);$.bindFramebuffer(ye.READ_FRAMEBUFFER,null),$.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else if(0!==p||e.isRenderTargetTexture||Z.has(e)){const h=Z.get(e),d=Z.get(t);$.bindFramebuffer(ye.READ_FRAMEBUFFER,Ve),$.bindFramebuffer(ye.DRAW_FRAMEBUFFER,Ge);for(let e=0;e<i;e++)b?ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,h.__webglTexture,p,s+e):ye.framebufferTexture2D(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,h.__webglTexture,p),x?ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,d.__webglTexture,f,c+e):ye.framebufferTexture2D(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,d.__webglTexture,f),0!==p?ye.blitFramebuffer(a,o,n,r,u,l,n,r,ye.COLOR_BUFFER_BIT,ye.NEAREST):x?ye.copyTexSubImage3D(D,f,u,l,c+e,a,o,n,r):ye.copyTexSubImage2D(D,f,u,l,a,o,n,r);$.bindFramebuffer(ye.READ_FRAMEBUFFER,null),$.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else x?e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(D,f,u,l,c,n,r,i,g,v,m.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(D,f,u,l,c,n,r,i,g,m.data):ye.texSubImage3D(D,f,u,l,c,n,r,i,g,v,m):e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,f,u,l,n,r,g,v,m.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,f,u,l,m.width,m.height,g,m.data):ye.texSubImage2D(ye.TEXTURE_2D,f,u,l,n,r,g,v,m);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,y),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,E),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,A),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,C),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,_),0===f&&t.generateMipmaps&&ye.generateMipmap(D),$.unbindTexture()},this.copyTextureToTexture3D=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Is('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,r,i)},this.initRenderTarget=function(e){void 0===Z.get(e).__webglFramebuffer&&ee.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?ee.setTextureCube(e,0):e.isData3DTexture?ee.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ee.setTexture2DArray(e,0):ee.setTexture2D(e,0),$.unbindTexture()},this.resetState=function(){A=0,C=0,_=null,$.reset(),ve.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return hs}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=zs._getDrawingBufferColorSpace(e),t.unpackColorSpace=zs._getUnpackColorSpace()}},Scene:_c,PerspectiveCamera:mc,Raycaster:td,SRGBColorSpace:Yo,TextureLoader:class extends Ah{constructor(e){super(e)}load(e,t,n,r){const i=new Js,a=new Ch(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}},Vector2:xs,Vector3:ws,Box3:nu,Color:Al,Mesh:rc,SphereGeometry:qc,MeshBasicMaterial:xl,BackSide:1,Clock:jh},YY=$A({props:{width:{default:window.innerWidth,onChange:function(e,t,n){isNaN(e)&&(t.width=n)}},height:{default:window.innerHeight,onChange:function(e,t,n){isNaN(e)&&(t.height=n)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(t){return t.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var n=null;if(e.hoverDuringDrag||!e.isPointerDragging){var r=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&r.sort(function(t,n){return e.hoverOrderComparator(t.object,n.object)});var i=r.find(function(t){return e.hoverFilter(t.object)})||null;n=i?i.object:null,e.intersection=i||null}n!==e.hoverObj&&(e.onHover(n,e.hoverObj,e.intersection),e.tooltip.content(n&&QA(e.tooltipContent)(n,e.intersection)||null),e.hoverObj=n)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos;return{x:t.x,y:t.y}},cameraPosition:function(e,t,n,r){var i=e.camera;if(t&&e.initialised){var a=t,o=n||{x:0,y:0,z:0};if(r){var s=Object.assign({},i.position),u=h();e.tweenGroup.add(new XK(s).to(a,r).easing(VK.Quadratic.Out).onUpdate(l).start()),e.tweenGroup.add(new XK(u).to(o,r/3).easing(VK.Quadratic.Out).onUpdate(c).start())}else l(a),c(o);return this}return Object.assign({},i.position,{lookAt:h()});function l(e){var t=e.x,n=e.y,r=e.z;void 0!==t&&(i.position.x=t),void 0!==n&&(i.position.y=n),void 0!==r&&(i.position.z=r)}function c(t){var n=new KY.Vector3(t.x,t.y,t.z);e.controls.target?e.controls.target=n:i.lookAt(n)}function h(){return Object.assign(new KY.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];return this.fitToBbox(this.getBbox.apply(this,i),t,n)},fitToBbox:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=e.camera;if(t){var a=new KY.Vector3(0,0,0),o=2*Math.max.apply(Math,qY(Object.entries(t).map(function(e){var t=WY(e,2),n=t[0],r=t[1];return Math.max.apply(Math,qY(r.map(function(e){return Math.abs(a[n]-e)})))}))),s=(1-2*r/e.height)*i.fov,u=o/Math.atan(s*Math.PI/180),l=u/i.aspect,c=Math.max(u,l);if(c>0){var h=a.clone().sub(i.position).normalize().multiplyScalar(-c);this.cameraPosition(h,a,n)}}return this},getBbox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=new KY.Box3(new KY.Vector3(0,0,0),new KY.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(e){return n.expandByObject(e)}),Object.assign.apply(Object,qY(["x","y","z"].map(function(e){return jY({},e,[n.min[e],n.max[e]])})))):null},getScreenCoords:function(e,t,n,r){var i=new KY.Vector3(t,n,r);return i.project(this.camera()),{x:(i.x+1)*e.width/2,y:-(i.y-1)*e.height/2}},getSceneCoords:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new KY.Vector2(t/e.width*2-1,-n/e.height*2+1),a=new KY.Raycaster;return a.setFromCamera(i,e.camera),Object.assign({},a.ray.at(r,new KY.Vector3))},intersectingObjects:function(e,t,n){var r=new KY.Vector2(t/e.width*2-1,-n/e.height*2+1),i=new KY.Raycaster;return i.params.Line.threshold=e.lineHoverPrecision,i.params.Points.threshold=e.pointsHoverPrecision,i.setFromCamera(r,e.camera),i.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new KY.Scene,camera:new KY.PerspectiveCamera,clock:new KY.Clock,tweenGroup:new HK,lastRaycasterCheck:0}},init:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.controlType,i=void 0===r?"trackball":r,a=n.useWebGPU,o=void 0!==a&&a,s=n.rendererConfig,u=void 0===s?{}:s,l=n.extraRenderers,c=void 0===l?[]:l,h=n.waitForLoadComplete,d=void 0===h||h;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new GY(t.container),t.pointerPos=new KY.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(e){return t.container.addEventListener(e,function(n){if("pointerdown"===e&&(t.isPointerPressed=!0),!t.isPointerDragging&&"pointermove"===n.type&&(n.pressure>0||t.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some(function(e){return Math.abs(e)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var r=function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+r,left:t.left+n}}(t.container);t.pointerPos.x=n.pageX-r.left,t.pointerPos.y=n.pageY-r.top}},{passive:!0})}),t.container.addEventListener("pointerup",function(e){t.isPointerPressed&&(t.isPointerPressed=!1,t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag)||requestAnimationFrame(function(){0===e.button&&t.onClick(t.hoverObj||null,e,t.intersection),2===e.button&&t.onRightClick&&t.onRightClick(t.hoverObj||null,e,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(e){t.onRightClick&&e.preventDefault()}),t.renderer=new(o?Aq:KY.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},u)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=c,t.extraRenderers.forEach(function(e){e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.pointerEvents="none",t.container.appendChild(e.domElement)}),t.postProcessingComposer=new QX(t.renderer),t.postProcessingComposer.addPass(new ZX(t.scene,t.camera)),t.controls=new{trackball:Gq,orbit:EX,fly:IX}[i](t.camera,t.renderer.domElement),"fly"===i&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),"trackball"!==i&&"orbit"!==i||(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(qY(t.extraRenderers)).forEach(function(e){return e.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new KY.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!d,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var n,r=e.width,i=e.height;e.container.style.width="".concat(r,"px"),e.container.style.height="".concat(i,"px"),[e.renderer,e.postProcessingComposer].concat(qY(e.extraRenderers)).forEach(function(e){return e.setSize(r,i)}),e.camera.aspect=r/i;var a=e.viewOffset.slice(0,2);a.some(function(e){return e})&&(n=e.camera).setViewOffset.apply(n,[r,i].concat(qY(a),[r,i])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var o,s=e.width,u=e.height,l=e.viewOffset.slice(0,2);l.some(function(e){return e})?(o=e.camera).setViewOffset.apply(o,[s,u].concat(qY(l),[s,u])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=2.5*e.skyRadius,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new KY.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var c=CK(e.backgroundColor).alpha;void 0===c&&(c=1),e.renderer.setClearColor(new KY.Color(zK(1,e.backgroundColor)),c)}function h(){e.loadComplete=e.scene.visible=!0}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?(new KY.TextureLoader).load(e.backgroundImageUrl,function(t){t.colorSpace=KY.SRGBColorSpace,e.skysphere.material=new KY.MeshBasicMaterial({map:t,side:KY.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&h()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&h())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(t){return e.scene.remove(t)}),e.lights.forEach(function(t){return e.scene.add(t)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(t){return e.scene.remove(t)}),e.objects.forEach(function(t){return e.scene.add(t)}))}});function JY(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function $Y(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ZY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QY(Object(n),!0).forEach(function(t){$Y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function eJ(e){return function(e){if(Array.isArray(e))return JY(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return JY(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?JY(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tJ(e,t){var n=new t;return n._destructor&&n._destructor(),{linkProp:function(t){return{default:n[t](),onChange:function(n,r){r[e][t](n)},triggerUpdate:!1}},linkMethod:function(t){return function(n){for(var r=n[e],i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var s=r[t].apply(r,a);return s===r?this:s}}}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".graph-info-msg {\n  top: 50%;\n  width: 100%;\n  text-align: center;\n  color: lavender;\n  opacity: 0.7;\n  font-size: 22px;\n  position: absolute;\n  font-family: Sans-serif;\n}\n\n.scene-container .clickable {\n  cursor: pointer;\n}\n\n.scene-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.scene-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}");var nJ=window.THREE?window.THREE:{AmbientLight:Uh,DirectionalLight:Oh,REVISION:Hi},rJ=tJ("forceGraph",z_),iJ=Object.assign.apply(Object,eJ(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(e){return $Y({},e,rJ.linkProp(e))}))),aJ=Object.assign.apply(Object,eJ(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(e){return $Y({},e,rJ.linkMethod(e))}))),oJ=tJ("renderObjs",YY),sJ=Object.assign.apply(Object,eJ(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(e){return $Y({},e,oJ.linkProp(e))}))),uJ=Object.assign.apply(Object,eJ(["lights","cameraPosition","postProcessingComposer"].map(function(e){return $Y({},e,oJ.linkMethod(e))})).concat([{graph2ScreenCoords:oJ.linkMethod("getScreenCoords"),screen2GraphCoords:oJ.linkMethod("getSceneCoords")}])),lJ=$A({props:ZY(ZY({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var n=t.renderObjs.controls();n&&(n.enabled=e,e&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},iJ),sJ),methods:ZY(ZY({zoomToFit:function(e,t,n){for(var r,i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,a),t,n),this},pauseAnimation:function(e){return null!==e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return null===e.animationFrameRequestId&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},aJ),uJ),stateInit:function(e){var t=e.controlType,n=e.rendererConfig,r=e.extraRenderers,i=new z_;return{forceGraph:i,renderObjs:YY({controlType:t,rendererConfig:n,extraRenderers:r}).objects([i]).lights([new nJ.AmbientLight(13421772,Math.PI),new nJ.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var n=document.createElement("div");t.container.appendChild(n),t.renderObjs(n);var r,i=t.renderObjs.camera(),a=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=i.position.z,t.container.appendChild(r=document.createElement("div")),r.className="graph-info-msg",r.textContent="",t.forceGraph.onLoading(function(){r.textContent="Loading..."}).onFinishLoading(function(){r.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),0===i.position.x&&0===i.position.y&&i.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(i.lookAt(t.forceGraph.position),t.lastSetCameraZ=i.position.z=170*Math.cbrt(t.graphData.nodes.length))}).onFinishUpdate(function(){if(t._dragControls){var e=t.graphData.nodes.find(function(e){return e.__initialFixedPos&&!e.__disposeControlsAfterDrag});e?e.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&"d3"===t.forceEngine){var n=t._dragControls=new bd(t.graphData.nodes.map(function(e){return e.__threeObj}).filter(function(e){return e}),i,a.domElement);n.addEventListener("dragstart",function(e){var t=cJ(e.object);if(t){o.enabled=!1,e.object.__initialPos=e.object.position.clone(),e.object.__prevPos=e.object.position.clone();var n=t.__data;!n.__initialFixedPos&&(n.__initialFixedPos={fx:n.fx,fy:n.fy,fz:n.fz}),!n.__initialPos&&(n.__initialPos={x:n.x,y:n.y,z:n.z}),["x","y","z"].forEach(function(e){return n["f".concat(e)]=n[e]}),a.domElement.classList.add("grabbable")}}),n.addEventListener("drag",function(e){var n=cJ(e.object);if(n){if(!e.object.hasOwnProperty("__graphObjType")){var r=e.object.__initialPos,i=e.object.__prevPos,a=e.object.position;n.position.add(a.clone().sub(i)),i.copy(a),a.copy(r)}var o=n.__data,s=n.position,u={x:s.x-o.x,y:s.y-o.y,z:s.z-o.z};["x","y","z"].forEach(function(e){return o["f".concat(e)]=o[e]=s[e]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),o.__dragged=!0,t.onNodeDrag(o,u)}}),n.addEventListener("dragend",function(e){var r=cJ(e.object);if(r){delete e.object.__initialPos,delete e.object.__prevPos;var i=r.__data;i.__disposeControlsAfterDrag&&(n.dispose(),delete i.__disposeControlsAfterDrag);var s=i.__initialFixedPos,u=i.__initialPos,l={x:u.x-i.x,y:u.y-i.y,z:u.z-i.z};s&&(["x","y","z"].forEach(function(e){var t="f".concat(e);void 0===s[t]&&delete i[t]}),delete i.__initialFixedPos,delete i.__initialPos,i.__dragged&&(delete i.__dragged,t.onNodeDragEnd(i,l))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),a.domElement.classList.remove("grabbable")}})}}),nJ.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(e,t){var n=cJ(e);if(!n)return 1;var r=cJ(t);if(!r)return-1;var i=function(e){return"node"===e.__graphObjType};return i(r)-i(n)}).tooltipContent(function(e){var n=cJ(e);return n&&QA(t["".concat(n.__graphObjType,"Label")])(n.__data)||""}).hoverDuringDrag(!1).onHover(function(e){var n=cJ(e);if(n!==t.hoverObj){var r=t.hoverObj?t.hoverObj.__graphObjType:null,i=t.hoverObj?t.hoverObj.__data:null,o=n?n.__graphObjType:null,s=n?n.__data:null;if(r&&r!==o){var u=t["on".concat("node"===r?"Node":"Link","Hover")];u&&u(null,i)}if(o){var l=t["on".concat("node"===o?"Node":"Link","Hover")];l&&l(s,r===o?i:null)}a.domElement.classList[n&&t["on".concat("node"===o?"Node":"Link","Click")]||!n&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=n}}).clickAfterDrag(!1).onClick(function(e,n){var r=cJ(e);if(r){var i=t["on".concat("node"===r.__graphObjType?"Node":"Link","Click")];i&&i(r.__data,n)}else t.onBackgroundClick&&t.onBackgroundClick(n)}).onRightClick(function(e,n){var r=cJ(e);if(r){var i=t["on".concat("node"===r.__graphObjType?"Node":"Link","RightClick")];i&&i(r.__data,n)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(n)}),this._animationCycle()}});function cJ(e){for(var t=e;t&&!t.hasOwnProperty("__graphObjType");)t=t.parent;return t}var hJ=n(942);const dJ={width:hJ.number,height:hJ.number,graphData:hJ.shape({nodes:hJ.arrayOf(hJ.object).isRequired,links:hJ.arrayOf(hJ.object).isRequired}),backgroundColor:hJ.string,nodeRelSize:hJ.number,nodeId:hJ.string,nodeLabel:hJ.oneOfType([hJ.string,hJ.func]),nodeVal:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),nodeVisibility:hJ.oneOfType([hJ.bool,hJ.string,hJ.func]),nodeColor:hJ.oneOfType([hJ.string,hJ.func]),nodeAutoColorBy:hJ.oneOfType([hJ.string,hJ.func]),onNodeHover:hJ.func,onNodeClick:hJ.func,linkSource:hJ.string,linkTarget:hJ.string,linkLabel:hJ.oneOfType([hJ.string,hJ.func]),linkVisibility:hJ.oneOfType([hJ.bool,hJ.string,hJ.func]),linkColor:hJ.oneOfType([hJ.string,hJ.func]),linkAutoColorBy:hJ.oneOfType([hJ.string,hJ.func]),linkWidth:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkCurvature:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkDirectionalArrowLength:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkDirectionalArrowColor:hJ.oneOfType([hJ.string,hJ.func]),linkDirectionalArrowRelPos:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkDirectionalParticles:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkDirectionalParticleSpeed:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkDirectionalParticleWidth:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkDirectionalParticleColor:hJ.oneOfType([hJ.string,hJ.func]),onLinkHover:hJ.func,onLinkClick:hJ.func,dagMode:hJ.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:hJ.number,dagNodeFilter:hJ.func,onDagError:hJ.func,d3AlphaMin:hJ.number,d3AlphaDecay:hJ.number,d3VelocityDecay:hJ.number,warmupTicks:hJ.number,cooldownTicks:hJ.number,cooldownTime:hJ.number,onEngineTick:hJ.func,onEngineStop:hJ.func,getGraphBbox:hJ.func},pJ={zoomToFit:hJ.func,onNodeRightClick:hJ.func,onNodeDrag:hJ.func,onNodeDragEnd:hJ.func,onLinkRightClick:hJ.func,linkHoverPrecision:hJ.number,onBackgroundClick:hJ.func,onBackgroundRightClick:hJ.func,enablePointerInteraction:hJ.bool,enableNodeDrag:hJ.bool},fJ={showNavInfo:hJ.bool,nodeOpacity:hJ.number,nodeResolution:hJ.number,nodeThreeObject:hJ.oneOfType([hJ.object,hJ.string,hJ.func]),nodeThreeObjectExtend:hJ.oneOfType([hJ.bool,hJ.string,hJ.func]),nodePositionUpdate:hJ.func,linkOpacity:hJ.number,linkResolution:hJ.number,linkCurveRotation:hJ.oneOfType([hJ.number,hJ.string,hJ.func]),linkMaterial:hJ.oneOfType([hJ.object,hJ.string,hJ.func]),linkThreeObject:hJ.oneOfType([hJ.object,hJ.string,hJ.func]),linkThreeObjectExtend:hJ.oneOfType([hJ.bool,hJ.string,hJ.func]),linkPositionUpdate:hJ.func,linkDirectionalArrowResolution:hJ.number,linkDirectionalParticleResolution:hJ.number,forceEngine:hJ.oneOf(["d3","ngraph"]),ngraphPhysics:hJ.object,numDimensions:hJ.oneOf([1,2,3])};Object.assign({},dJ,pJ,{linkLineDash:hJ.oneOfType([hJ.arrayOf(hJ.number),hJ.string,hJ.func]),nodeCanvasObjectMode:hJ.oneOfType([hJ.string,hJ.func]),nodeCanvasObject:hJ.func,nodePointerAreaPaint:hJ.func,linkCanvasObjectMode:hJ.oneOfType([hJ.string,hJ.func]),linkCanvasObject:hJ.func,linkPointerAreaPaint:hJ.func,autoPauseRedraw:hJ.bool,minZoom:hJ.number,maxZoom:hJ.number,enableZoomInteraction:hJ.oneOfType([hJ.bool,hJ.func]),enablePanInteraction:hJ.oneOfType([hJ.bool,hJ.func]),onZoom:hJ.func,onZoomEnd:hJ.func,onRenderFramePre:hJ.func,onRenderFramePost:hJ.func});const mJ=Object.assign({},dJ,pJ,fJ,{enableNavigationControls:hJ.bool,controlType:hJ.oneOf(["trackball","orbit","fly"]),rendererConfig:hJ.object,extraRenderers:hJ.arrayOf(hJ.shape({render:hJ.func.isRequired}))});Object.assign({},dJ,fJ,{nodeDesc:hJ.oneOfType([hJ.string,hJ.func]),linkDesc:hJ.oneOfType([hJ.string,hJ.func])}),Object.assign({},dJ,fJ,{markerAttrs:hJ.object,yOffset:hJ.number,glScale:hJ.number});const gJ=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.wrapperElementType,i=void 0===r?"div":r,a=n.nodeMapper,o=void 0===a?function(e){return e}:a,s=n.methodNames,u=void 0===s?[]:s,l=n.initPropNames,c=void 0===l?[]:l;return(0,e.forwardRef)(function(n,r){var a=(0,e.useRef)(),s=(0,e.useMemo)(function(){var e=Object.fromEntries(c.filter(function(e){return n.hasOwnProperty(e)}).map(function(e){return[e,n[e]]}));return t(e)},[]);Gi(function(){s(o(a.current))},e.useLayoutEffect),Gi(function(){return s._destructor instanceof Function?s._destructor:void 0});var l=(0,e.useCallback)(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s[e]instanceof Function?s[e].apply(s,n):void 0},[s]),h=(0,e.useRef)({});return Object.keys(function(e,t){var n=new Set(t);return Object.assign.apply(Object,[{}].concat(Li(Object.entries(e).filter(function(e){var t=Ri(e,1)[0];return!n.has(t)}).map(function(e){var t=Ri(e,2);return Ni({},t[0],t[1])}))))}(n,[].concat(zi(u),zi(c)))).filter(function(e){return h.current[e]!==n[e]}).forEach(function(e){return l(e,n[e])}),h.current=n,(0,e.useImperativeHandle)(r,function(){return Object.fromEntries(u.map(function(e){return[e,function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return l.apply(void 0,[e].concat(n))}]}))},[l]),e.createElement(i,{ref:a})})}(lJ,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});gJ.displayName="ForceGraph3D",gJ.propTypes=mJ;const vJ=t=>{let{data:n,drugData:r,selectedDrugs:i=new Set,isDarkMode:a=!1,selectedPathway:o="immune_response",animationSpeed:u=1,particleCount:l=6e3,visibleLayers:c,onNodeClick:h,onLayerToggle:d}=t;const[p,f]=(0,e.useState)(null),[m,g]=(0,e.useState)(null),[v,D]=(0,e.useState)(new Set),[y,E]=(0,e.useState)(new Set),[A,C]=(0,e.useState)("organic"),[_]=(0,e.useState)(new Set(["systems","organs","tissues","cellular","molecular"])),b=c||_,x=(0,e.useRef)(null),[F,w]=(0,e.useState)("trackball"),[S,T]=(0,e.useState)({}),M=(0,e.useRef)(null),B=(0,e.useRef)(!1),[P,N]=(0,e.useState)(!1);(0,e.useEffect)(()=>{if(x.current){x.current.cameraPosition({x:0,y:0,z:1500});const e=()=>{var e;const t=null===(e=x.current)||void 0===e?void 0:e.camera();if(t){const e=t.position.distanceTo({x:0,y:0,z:0});e<200?t.position.setLength(200):e>4e3&&t.position.setLength(4e3)}},t=setInterval(e,100);return()=>clearInterval(t)}},[]);const R=(0,e.useMemo)(()=>{const e=[],t=[],n=i.size>0?Fi.find(e=>i.has(e.id)):null,r=(()=>{const e=n?{ketamine:{systemLabels:["Hypertension","Hypothermia","Unconsciousness","Analgesia"],organCount:10,tissueCount:35,cellularCount:120,molecularCount:150,connectionDensity:.8,organLabels:["Heart","Brain","Spinal Cord","Liver","Kidney","Lung","Adrenals","Thyroid","Blood Vessels","Nervous System"]},aspirin:{systemLabels:["Hypertension","Hypothermia","Unconsciousness","Analgesia"],organCount:8,tissueCount:25,cellularCount:80,molecularCount:100,connectionDensity:.6,organLabels:["Heart","Brain","Liver","Kidney","Stomach","Blood","Platelets","Vessels"]},morphine:{systemLabels:["Hypertension","Hypothermia","Unconsciousness","Analgesia"],organCount:12,tissueCount:40,cellularCount:150,molecularCount:200,connectionDensity:.9,organLabels:["Brain","Spinal Cord","Heart","Lung","Liver","Kidney","GI Tract","CNS","PNS","Receptors","Synapses","Neurons"]}}[n.id]||{systemLabels:["Hypertension","Hypothermia","Unconsciousness","Analgesia"],organCount:8,tissueCount:30,cellularCount:100,molecularCount:120,connectionDensity:.7,organLabels:["Heart","Brain","Liver","Kidney","Lung","Spleen","Thyroid","Blood"]}:null;return n&&e?[{name:"systems",count:4,modules:1,y:400,size:22,color:"#E86659",opacity:.95,spread:800,showLabels:!0,labels:e.systemLabels},{name:"organs",count:e.organCount,modules:Math.ceil(e.organCount/4),y:280,size:12,color:"#CCCCFF",opacity:.9,spread:300,showLabels:!0,labels:e.organLabels},{name:"tissues",count:e.tissueCount,modules:Math.ceil(e.tissueCount/8),y:160,size:8,color:"#FF7F50",opacity:.85,spread:250,showLabels:!1,labels:[]},{name:"cellular",count:e.cellularCount,modules:Math.ceil(e.cellularCount/12),y:40,size:6,color:"#9FE2BF",opacity:.8,spread:200,showLabels:!1,labels:[]},{name:"molecular",count:e.molecularCount,modules:Math.ceil(e.molecularCount/15),y:-80,size:4,color:"#DFFF00",opacity:.8,spread:150,showLabels:!1,labels:[]}]:[{name:"systems",count:4,modules:1,y:350,size:22,color:"#E86659",opacity:.95,spread:800,showLabels:!0,labels:["Hypertension","Hypothermia","Unconsciousness","Analgesia"]},{name:"organs",count:6,modules:2,y:250,size:12,color:"#CCCCFF",opacity:.9,spread:280,showLabels:!0,labels:["Heart","Brain","Liver","Kidney","Lung","Blood"]},{name:"tissues",count:20,modules:4,y:150,size:6,color:"#FF7F50",opacity:.85,spread:220,showLabels:!1,labels:[]},{name:"cellular",count:50,modules:8,y:50,size:6,color:"#9FE2BF",opacity:.8,spread:180,showLabels:!1,labels:[]},{name:"molecular",count:80,modules:10,y:-50,size:4,color:"#DFFF00",opacity:.7,spread:140,showLabels:!1,labels:[]}]})(),o=n?{ketamine:{connectionDensity:.8},aspirin:{connectionDensity:.6},morphine:{connectionDensity:.9}}[n.id]||{connectionDensity:.7}:null,u={},l={};r.forEach((t,r)=>{if(b.has(t.name)){u[t.name]=[],l[t.name]={};for(let e=0;e<t.modules;e++)l[t.name][e]=[];for(let i=0;i<t.count;i++){const a=i%t.modules;let o,c,h;if("grid"===A){const e=Math.ceil(Math.sqrt(t.count)),n=Math.floor(i/e),r=i%e,a=800,s=Math.min(a/e,60);o=r*s-(e-1)*s/2,h=n*s-(e-1)*s/2,c=t.y,o+=5*(Math.random()-.5),h+=5*(Math.random()-.5)}else if("systems"===t.name||"organs"===t.name){const e=i/t.count*2*Math.PI,n=.4*t.spread;if(o=Math.cos(e)*n,h=Math.sin(e)*n,"systems"===t.name){const e=[-60,-20,20,60];c=t.y+(e[i]||0)}else c=t.y+20*(Math.random()-.5)}else if("tissues"===t.name){const e=a/t.modules*2*Math.PI,n=.5*t.spread,r=Math.cos(e)*n,i=Math.sin(e)*n,s=2*Math.random()*Math.PI,u=30*Math.sqrt(Math.random());o=r+Math.cos(s)*u,h=i+Math.sin(s)*u,c=t.y+30*(Math.random()-.5)}else{const e=Math.acos(1-2*Math.random()),n=2*Math.PI*Math.random(),r=t.spread*(.3+.7*Math.random())*Math.pow(Math.random(),.3);o=r*Math.sin(e)*Math.cos(n),h=r*Math.sin(e)*Math.sin(n),c=t.y+r*Math.cos(e)*.3+20*(Math.random()-.5)}let d,p="";if(t.showLabels&&t.labels.length>0?"systems"===t.name||"organs"===t.name?p=t.labels[i%t.labels.length]:"tissues"===t.name&&(p=t.labels[i%t.labels.length]+" ".concat(Math.floor(i/t.labels.length)+1)):p=t.showLabels?"".concat(t.name.charAt(0).toUpperCase()+t.name.slice(1)," ").concat(i+1):"",n&&"molecular"===t.name){const e=i%n.targetPathways.length;d=n.targetPathways[e]}let f=.5;"systems"===t.name?f=.8+.2*Math.random():"organs"===t.name?f=.6+.2*Math.random():"tissues"===t.name?f=.4+.2*Math.random():"cellular"===t.name?f=.2+.2*Math.random():"molecular"===t.name&&(f=.1+.1*Math.random());const m=t.size*(.7+.8*f),g="".concat(t.name,"_").concat(i),v=s({id:g,name:p,val:m,color:t.color,level:r,levelName:t.name,module:a,drugAffinity:d,importance:f,x:o,y:c,z:h},"grid"===A&&{fx:o,fy:c,fz:h});e.push(v),u[t.name].push(g),l[t.name][a].push(g)}}});const c=n&&o?o.connectionDensity:.5;if(r.forEach((e,i)=>{if(!b.has(e.name))return;let o=null;for(let t=i+1;t<r.length;t++)if(b.has(r[t].name)){o=r[t];break}if(!o)return;const s=o,h=u[e.name],d=u[s.name];if(h&&d&&0!==h.length&&0!==d.length)if("grid"===A)h.forEach(e=>{const n=Math.min(4,Math.max(2,Math.floor(d.length/h.length)));for(let r=0;r<n;r++){const n=d[Math.floor(Math.random()*d.length)];t.push({source:e,target:n,color:a?"rgba(100, 150, 255, 0.6)":"rgba(25, 118, 210, 0.8)",width:1.5})}});else if("systems"===e.name)h.forEach(e=>{(u.organs||[]).forEach(n=>{Math.random()<c&&t.push({source:e,target:n,color:a?"rgba(255, 107, 53, 0.7)":"rgba(229, 81, 0, 0.9)",width:3})});const r=u.tissues||[],i=n?Math.floor(.4*r.length):Math.floor(.2*r.length);for(let n=0;n<i;n++){const n=r[Math.floor(Math.random()*r.length)];n&&t.push({source:e,target:n,color:a?"rgba(247, 147, 30, 0.5)":"rgba(245, 124, 0, 0.7)",width:2})}});else if("organs"===e.name)h.forEach(e=>{const n=u.tissues||[];let r=Math.floor(n.length*c*.3);for(let o=0;o<r;o++){const r=n[Math.floor(Math.random()*n.length)];r&&t.push({source:e,target:r,color:a?"rgba(79, 179, 217, 0.6)":"rgba(25, 118, 210, 0.8)",width:1.5})}const i=u.cellular||[];r=Math.floor(i.length*c*.2);for(let o=0;o<r;o++){const n=i[Math.floor(Math.random()*i.length)];n&&t.push({source:e,target:n,color:a?"rgba(146, 208, 80, 0.5)":"rgba(56, 142, 60, 0.7)",width:1,bundled:!0,bundleStrength:.6})}});else for(let n=0;n<e.modules;n++){const r=l[e.name][n],i=Math.min(3,s.modules);for(let o=0;o<i;o++){const u=(n*i+o)%s.modules,h=l[s.name][u];r&&h&&r.forEach(n=>{const i="molecular"===s.name?Math.max(2,Math.floor(h.length/r.length)):Math.max(1,Math.floor(h.length/r.length/2)),o=Math.floor(i*c);for(let r=0;r<o;r++){const r=h[Math.floor(Math.random()*h.length)];if(r){const i="cellular"===e.name||"molecular"===s.name;t.push({source:n,target:r,color:i?a?"rgba(255, 192, 0, 0.4)":"rgba(249, 168, 37, 0.6)":a?"rgba(255, 192, 0, 0.3)":"rgba(249, 168, 37, 0.5)",width:i?.4:.5,bundled:i,bundleStrength:i?.8:0})}}})}}}),"grid"===A)r.forEach(e=>{if(!b.has(e.name))return;const n=u[e.name];if(!n||0===n.length)return;const r=Math.ceil(Math.sqrt(e.count));n.forEach((e,i)=>{const o=Math.floor(i/r),s=i%r;if(s<r-1){const i=o*r+(s+1);i<n.length&&t.push({source:e,target:n[i],color:a?"rgba(120, 120, 150, 0.3)":"rgba(100, 100, 100, 0.4)",width:.8})}if(o<r-1){const i=(o+1)*r+s;i<n.length&&t.push({source:e,target:n[i],color:a?"rgba(120, 120, 150, 0.3)":"rgba(100, 100, 100, 0.4)",width:.8})}})});else{r.forEach(e=>{if(b.has(e.name))for(let r=0;r<e.modules;r++){const i=l[e.name][r];if(!i||i.length<2)continue;const o=Math.min(i.length*(n?.25:.2),15);for(let e=0;e<o;e++){const e=i[Math.floor(Math.random()*i.length)],n=i[Math.floor(Math.random()*i.length)];e!==n&&t.push({source:e,target:n,color:a?"rgba(120, 120, 150, 0.2)":"rgba(100, 100, 100, 0.3)",width:.4})}}});const e=n?100:60;for(let n=0;n<e;n++){const e=Math.floor(Math.random()*r.length),n=Math.floor(Math.random()*r.length);if(Math.abs(e-n)>=2&&Math.abs(e-n)<=4){const i=u[r[e].name],o=u[r[n].name];if(i&&o&&i.length>0&&o.length>0){const s=i[Math.floor(Math.random()*i.length)],u=o[Math.floor(Math.random()*o.length)],l="molecular"===r[e].name||"molecular"===r[n].name;t.push({source:s,target:u,color:l?a?"rgba(120, 180, 255, 0.15)":"rgba(63, 81, 181, 0.25)":a?"rgba(80, 80, 110, 0.08)":"rgba(117, 117, 117, 0.15)",width:l?.2:.3,bundled:l,bundleStrength:l?.9:0})}}}}const h=u.systems||[];h.length>1&&h.forEach((e,n)=>{const r=Math.min(2,h.length-1);for(let i=0;i<r;i++){const r=(n+i+1)%h.length,o=h[r];t.push({source:e,target:o,color:a?"rgba(255, 107, 53, 0.8)":"rgba(229, 81, 0, 0.9)",width:2.5})}});const d=new Set;return t.forEach(e=>{var t,n;const r="string"===typeof e.source?e.source:(null===(t=e.source)||void 0===t?void 0:t.id)||e.source,i="string"===typeof e.target?e.target:(null===(n=e.target)||void 0===n?void 0:n.id)||e.target;d.add(r),d.add(i)}),e.forEach(n=>{if(!d.has(n.id)){const r=e.filter(e=>e.levelName===n.levelName&&e.id!==n.id),i=e.filter(e=>1===Math.abs(e.level-n.level)&&b.has(e.levelName)),o=r.length>0?r:i;if(o.length>0){let e=o[0],r=Math.sqrt(Math.pow((n.x||0)-(e.x||0),2)+Math.pow((n.y||0)-(e.y||0),2)+Math.pow((n.z||0)-(e.z||0),2));o.forEach(t=>{const i=Math.sqrt(Math.pow((n.x||0)-(t.x||0),2)+Math.pow((n.y||0)-(t.y||0),2)+Math.pow((n.z||0)-(t.z||0),2));i<r&&(r=i,e=t)}),t.push({source:n.id,target:e.id,color:a?"rgba(150, 150, 150, 0.3)":"rgba(100, 100, 100, 0.4)",width:.5})}}}),{nodes:e,links:t}},[b,i,a,A]),L=(0,e.useCallback)(e=>{const t=new Set,n=new Set;t.add(e.id),R.links.forEach(r=>{const i="object"===typeof r.source?r.source.id:r.source,a="object"===typeof r.target?r.target.id:r.target;i!==e.id&&a!==e.id||(t.add(i),t.add(a),n.add("".concat(i,"-").concat(a)))}),D(t),E(n)},[R.links]),I=(0,e.useCallback)(()=>{D(new Set),E(new Set)},[]),k=(0,e.useCallback)(e=>{g(e.id),h&&h(e.id)},[h]),O=(0,e.useCallback)(e=>{e?(f(e.id),L(e)):(f(null),I())},[L,I]),U=(0,e.useCallback)(e=>v.has(e.id)?"#ffffff":m&&m===e.id?"#ffff00":e.color,[v,m]),z=(0,e.useCallback)(e=>{const t="object"===typeof e.source?e.source.id:e.source,n="object"===typeof e.target?e.target.id:e.target,r="".concat(t,"-").concat(n);if(y.has(r))return e.bundled?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.8)";if(e.bundled&&e.bundleStrength>.7){return(e.color||"rgba(100, 100, 100, 0.3)").replace(/[\d.]+\)$/,"".concat(.4+.3*e.bundleStrength,")"))}return e.color},[y]),V=(0,e.useCallback)(e=>{const t="object"===typeof e.source?e.source.id:e.source,n="object"===typeof e.target?e.target.id:e.target,r="".concat(t,"-").concat(n);return y.has(r)?e.bundled?3:2:e.bundled?1.2*(e.width||.3):e.width||.3},[y]),G=(0,e.useCallback)(e=>{if(!e.bundled)return 0;return.3*(e.bundleStrength||.5)+.2*((Math.sin(e.source.id.length+e.target.id.length)+1)/2)},[]),H=(0,e.useCallback)(e=>{if("grid"!==A)return null;const t=[{name:"systems",count:4,modules:1,y:400,spread:800,size:35,color:"#E86659",showLabels:!0,labels:["Hypertension","Hypothermia","Unconsciousness","Analgesia"]},{name:"organs",count:8,modules:2,y:280,spread:400,size:18,color:"#CCCCFF",showLabels:!0,labels:["Heart","Brain","Liver","Kidney","Lung","Skin","Muscle","Bone"]},{name:"tissues",count:20,modules:4,y:160,spread:500,size:12,color:"#FF7F50",showLabels:!1,labels:[]},{name:"cellular",count:50,modules:8,y:40,spread:600,size:12,color:"#9FE2BF",showLabels:!1,labels:[]},{name:"molecular",count:l,modules:30,y:-80,spread:800,size:6,color:"#DFFF00",showLabels:!1,labels:[]}].find(t=>t.name===e);if(!t)return null;const n=new oy;n.name="grid-".concat(e);const r=Math.ceil(Math.sqrt(t.count)),i=(r-1)*Math.min(800/r,60)+100,o=new Og(i,i,r,r),s=new zm({color:a?3355494:6710937,wireframe:!0,transparent:!0,opacity:.3}),u=new mg(o,s);u.position.set(0,t.y,0),u.rotation.x=-Math.PI/2;const c=document.createElement("canvas"),h=c.getContext("2d");if(h){const e=40,r=20,o=t.name.toUpperCase();h.font="bold ".concat(e,"px Arial");const s=h.measureText(o).width;c.width=s+2*r,c.height=e+2*r,h.font="bold ".concat(e,"px Arial"),h.textAlign="center",h.textBaseline="middle",h.fillStyle=a?"rgba(255, 255, 255, 0.9)":"rgba(0, 0, 0, 0.9)",h.fillText(o,c.width/2,c.height/2);const u=new zy(c),l=new vy({map:u,transparent:!0,alphaTest:.1}),d=new By(l),p=.4;d.scale.set(c.width*p,c.height*p,1),d.position.set(i/2+80,t.y+30,0),n.add(d)}return n.add(u),n},[A,a,l]),j=(0,e.useCallback)(()=>{if(!x.current||"grid"!==A)return;const e=x.current.scene();["systems","organs","tissues","cellular","molecular"].forEach(t=>{const n=e.getObjectByName("grid-".concat(t)),r=b.has(t);if(r&&!n){const n=H(t);n&&e.add(n)}else!r&&n&&e.remove(n)})},[b,H,A]),W=(0,e.useCallback)(e=>{if(!(("systems"===e.levelName||"organs"===e.levelName)&&e.name&&e.name.length>0)){const t=e.val||2,n=new oE(t,16,16),r=new zm({color:e.color,transparent:!0,opacity:.9});return new mg(n,r)}const t=new oy,n=e.val||10,r=new oE(n,32,32),i=new zm({color:e.color,transparent:!0,opacity:.9}),o=new mg(r,i);t.add(o);const s=document.createElement("canvas"),u=s.getContext("2d");if(u){const n=48,r=20;u.font="bold ".concat(n,"px Arial");const i=u.measureText(e.name).width;s.width=i+2*r,s.height=n+2*r,u.font="bold ".concat(n,"px Arial"),u.textAlign="center",u.textBaseline="middle",u.fillStyle=a?"white":"black",u.fillText(e.name,s.width/2,s.height/2);const o=new zy(s),l=new vy({map:o,transparent:!0,alphaTest:.1}),c=new By(l),h=.5;c.scale.set(s.width*h,s.height*h,1);const d=e.val||10;c.position.set(0,d+30,0),t.add(c)}return t},[a]),q=(0,e.useCallback)(e=>b.has(e.levelName),[b]),X=(0,e.useCallback)(e=>{const t=R.nodes.find(t=>t.id===("object"===typeof e.source?e.source.id:e.source)),n=R.nodes.find(t=>t.id===("object"===typeof e.target?e.target.id:e.target));return!(!t||!n)&&(b.has(t.levelName)&&b.has(n.levelName))},[b,R.nodes]),K=(0,e.useMemo)(()=>{const e=new Map;return[{key:"systems",label:"Systems",color:"#E86659"},{key:"organs",label:"Organs",color:"#CCCCFF"},{key:"tissues",label:"Tissues",color:"#FF7F50"},{key:"cellular",label:"Cellular",color:"#9FE2BF"},{key:"molecular",label:"Molecular",color:"#DFFF00"}].forEach(t=>{e.set(t.key,{label:t.label,color:t.color,nodeCount:0,edgeCount:0,visible:b.has(t.key)})}),R.nodes.forEach(t=>{const n=t.levelName;if(e.has(n)){e.get(n).nodeCount++}}),R.links.forEach(t=>{const n=R.nodes.find(e=>{var n;return e.id===("string"===typeof t.source?t.source:(null===(n=t.source)||void 0===n?void 0:n.id)||t.source)}),r=R.nodes.find(e=>{var n;return e.id===("string"===typeof t.target?t.target:(null===(n=t.target)||void 0===n?void 0:n.id)||t.target)});n&&r&&(e.has(n.levelName)&&e.get(n.levelName).edgeCount++,r.levelName!==n.levelName&&e.has(r.levelName)&&e.get(r.levelName).edgeCount++)}),Array.from(e.values())},[R.nodes,R.links,b]),[Y,J]=(0,e.useState)({x:20,y:20}),[$,Q]=(0,e.useState)(!1),[Z,ee]=(0,e.useState)(!0),te=(0,e.useRef)({x:0,y:0}),ne=(0,e.useCallback)(e=>{if(!$)return;const t=e.clientX-te.current.x,n=e.clientY-te.current.y,r=window.innerWidth-320,i=window.innerHeight-400;J({x:Math.max(0,Math.min(t,r)),y:Math.max(0,Math.min(n,i))})},[$]),re=(0,e.useCallback)(()=>{Q(!1)},[]),ie=(0,e.useCallback)(e=>{e.stopPropagation(),Q(!0),te.current={x:e.clientX-Y.x,y:e.clientY-Y.y}},[Y]);(0,e.useEffect)(()=>(document.addEventListener("mousemove",ne),document.addEventListener("mouseup",re),()=>{document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",re)}),[ne,re]),(0,e.useEffect)(()=>{if(x.current){const e=x.current.scene();if("grid"===A)j();else{["systems","organs","tissues","cellular","molecular"].forEach(t=>{const n=e.getObjectByName("grid-".concat(t));n&&e.remove(n)})}}},[A,j,b]),(0,e.useEffect)(()=>{if(x.current&&"grid"!==A){const e=x.current.d3Force();e&&(e.stop(),e.nodes().forEach(e=>{void 0!==e.vx&&(e.vx=0),void 0!==e.vy&&(e.vy=0),void 0!==e.vz&&(e.vz=0),void 0===e.fx||e.fx||(e.fx=void 0),void 0===e.fy||e.fy||(e.fy=void 0),void 0===e.fz||e.fz||(e.fz=void 0)}),e.alpha(.3).alphaDecay(.01).velocityDecay(.3).restart())}},[b,A]),(0,e.useEffect)(()=>{const e=e=>{"s"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),ee(e=>!e)),"Escape"===e.key&&Z&&ee(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[Z]);const ae=(0,e.useCallback)(()=>{x.current&&x.current.cameraPosition({x:0,y:600,z:1200},void 0,1e3)},[]),oe=(0,e.useCallback)(()=>{const e=!P;if(N(e),x.current){x.current.renderer().domElement.style.cursor=e?"grab":"default";const t=x.current.controls();t&&(t.enabled=!e)}},[P]),se=(0,e.useCallback)(e=>{if(P&&x.current){e.preventDefault(),B.current=!0,M.current={x:e.clientX,y:e.clientY};x.current.renderer().domElement.style.cursor="grabbing"}},[P]),ue=(0,e.useCallback)(e=>{if(B.current&&M.current&&x.current){e.preventDefault();const t=e.clientX-M.current.x,n=e.clientY-M.current.y,r=x.current.camera();if(r){const e=2,i=new ef(1,0,0);i.applyQuaternion(r.quaternion);const a=new ef(0,1,0);a.applyQuaternion(r.quaternion),i.multiplyScalar(-t*e*.1),a.multiplyScalar(n*e*.1),r.position.add(i),r.position.add(a);const o=x.current.controls();o&&o.target&&(o.target.add(i),o.target.add(a))}M.current={x:e.clientX,y:e.clientY}}},[]),le=(0,e.useCallback)(()=>{if(B.current&&x.current){B.current=!1,M.current=null;if(x.current.renderer().domElement.style.cursor=P?"grab":"default",!P){const e=x.current.controls();e&&(e.enabled=!0)}}},[P]);return(0,e.useEffect)(()=>{const e=()=>{le()},t=e=>{B.current&&ue(e)};return document.addEventListener("mouseup",e),document.addEventListener("mousemove",t),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",t)}},[le,ue]),(0,Bi.jsxs)("div",{className:"hierarchical-network",onMouseDown:se,onMouseUp:le,children:[(0,Bi.jsxs)("div",{className:"view-controls-container",children:[(0,Bi.jsx)("button",{className:"view-control-btn ".concat("organic"===A?"active":""),onClick:()=>C("organic"),title:"Organic cloud-like layout",children:(0,Bi.jsx)("span",{role:"img","aria-label":"Organic Layout",children:"\u25ef"})}),(0,Bi.jsx)("button",{className:"view-control-btn ".concat("grid"===A?"active":""),onClick:()=>C("grid"),title:"3D grid hierarchical layout",children:(0,Bi.jsx)("span",{role:"img","aria-label":"Grid Layout",style:{fontSize:"28px"},children:"\u229e"})}),(0,Bi.jsx)("button",{className:"view-control-btn",onClick:ae,title:"Reset camera position",children:(0,Bi.jsx)("span",{role:"img","aria-label":"Reset Position",style:{fontSize:"26px"},children:"\u27f2"})}),(0,Bi.jsx)("button",{className:"view-control-btn ".concat(P?"active":""),onClick:oe,title:P?"Switch to rotation mode":"Switch to pan mode",children:(0,Bi.jsx)("span",{role:"img","aria-label":"Pan Mode",children:"P"})})]}),!Z&&(0,Bi.jsx)("button",{className:"panel-toggle-btn",onClick:()=>ee(!0),title:"Show Network Statistics - Nodes & Edges (Ctrl/Cmd + S)",children:"\ud83d\udcca"}),Z&&(0,Bi.jsxs)("div",{className:"network-stats-panel ".concat($?"dragging":""),style:{left:Y.x,top:Y.y,transform:$?"scale(1.02)":"scale(1)",transition:$?"none":"transform 0.2s ease",cursor:$?"grabbing":"grab",background:a?"rgba(30, 30, 40, 0.95)":"rgba(232, 227, 207, 0.95)",border:"1px solid ".concat(a?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.1)"),padding:"16px",boxSizing:"border-box"},onMouseDown:ie,title:"Drag to move panel",children:[(0,Bi.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",zIndex:10},children:(0,Bi.jsx)("button",{className:"panel-close-btn",onClick:()=>ee(!1),onMouseDown:e=>e.stopPropagation(),title:"Close panel (Esc)",style:{background:"none",border:"none",color:a?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",fontSize:"18px",cursor:"pointer",padding:"4px",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"},children:"\xd7"})}),(0,Bi.jsxs)("div",{style:{width:"100%",overflowY:"auto",maxHeight:"450px",paddingTop:"20px"},children:[(0,Bi.jsxs)("div",{className:"stats-overview",style:{padding:"0 0 12px 0",borderBottom:"1px solid ".concat(a?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"),marginBottom:"12px",paddingRight:"36px"},children:[(0,Bi.jsxs)("div",{className:"stat-item total",children:[(0,Bi.jsx)("span",{className:"stat-label",children:"Total Nodes:"}),(0,Bi.jsx)("span",{className:"stat-value",style:{color:a?"#ffffff":"#000000",fontWeight:"600"},children:R.nodes.length.toLocaleString()})]}),(0,Bi.jsxs)("div",{className:"stat-item total",children:[(0,Bi.jsx)("span",{className:"stat-label",children:"Total Edges:"}),(0,Bi.jsx)("span",{className:"stat-value",style:{color:a?"#ffffff":"#000000",fontWeight:"600"},children:R.links.length.toLocaleString()})]})]}),(0,Bi.jsxs)("div",{className:"layer-stats",children:[(0,Bi.jsx)("h5",{style:{margin:"0 0 12px 0",fontSize:"14px",color:a?"var(--accent-primary)":"#364FA1",fontWeight:"500"},children:"Layer Statistics"}),Array.from(K.values()).map(e=>(0,Bi.jsxs)("div",{className:"layer-stat-item ".concat(e.visible?"":"hidden"),style:{background:a?"rgba(30, 30, 40, 0.5)":"rgba(255, 255, 255, 0.2)",borderLeft:"3px solid ".concat(e.color),borderRadius:"6px",padding:"10px",marginBottom:"10px"},children:[(0,Bi.jsxs)("div",{className:"layer-stat-header",children:[(0,Bi.jsx)("div",{className:"layer-color-indicator",style:{backgroundColor:e.color}}),(0,Bi.jsx)("div",{className:"layer-name",style:{color:a?"#ffffff":"#333333",flex:1,fontWeight:"500"},children:e.label}),(0,Bi.jsx)("div",{className:"layer-status ".concat(e.visible?"visible":"hidden"),style:{color:e.visible?"#364FA1":a?"rgba(255, 255, 255, 0.4)":"rgba(0, 0, 0, 0.4)"},children:e.visible?"Visible":"Hidden"})]}),(0,Bi.jsxs)("div",{className:"layer-stat-counts",style:{display:"flex",gap:"12px"},children:[(0,Bi.jsxs)("div",{className:"stat-count",children:[(0,Bi.jsx)("div",{className:"count-label",style:{fontSize:"11px",color:a?"rgba(255, 255, 255, 0.6)":"rgba(0, 0, 0, 0.6)"},children:"Nodes"}),(0,Bi.jsx)("div",{className:"count-value",style:{fontWeight:"600",fontSize:"13px",color:a?"#ffffff":"#333333"},children:e.nodeCount.toLocaleString()})]}),(0,Bi.jsxs)("div",{className:"stat-count",children:[(0,Bi.jsx)("div",{className:"count-label",style:{fontSize:"11px",color:a?"rgba(255, 255, 255, 0.6)":"rgba(0, 0, 0, 0.6)"},children:"Edges"}),(0,Bi.jsx)("div",{className:"count-value",style:{fontWeight:"600",fontSize:"13px",color:a?"#ffffff":"#333333"},children:e.edgeCount.toLocaleString()})]})]})]},e.label))]}),(p||m)&&(0,Bi.jsxs)("div",{className:"interaction-info",style:{marginTop:"12px",padding:"12px 0 0",borderTop:"1px solid ".concat(a?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)")},children:[(0,Bi.jsx)("h5",{style:{margin:"0 0 8px 0",fontSize:"14px",color:a?"var(--accent-primary)":"#364FA1",fontWeight:"500"},children:"Current Selection"}),p&&(0,Bi.jsxs)("div",{className:"interaction-item",style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[(0,Bi.jsx)("span",{className:"interaction-label",style:{fontSize:"12px",color:a?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",fontWeight:"500"},children:"Focused:"}),(0,Bi.jsx)("span",{className:"interaction-value",style:{fontSize:"12px",color:a?"#ffffff":"#333333",fontWeight:"600"},children:p})]}),m&&(0,Bi.jsxs)("div",{className:"interaction-item",style:{display:"flex",justifyContent:"space-between"},children:[(0,Bi.jsx)("span",{className:"interaction-label",style:{fontSize:"12px",color:a?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",fontWeight:"500"},children:"Selected:"}),(0,Bi.jsx)("span",{className:"interaction-value",style:{fontSize:"12px",color:a?"#ffffff":"#333333",fontWeight:"600"},children:m})]})]})]})]}),(0,Bi.jsx)(gJ,{graphData:R,backgroundColor:"rgba(0,0,0,0)",showNavInfo:!1,enableNodeDrag:!0,enableNavigationControls:!0,enablePointerInteraction:!0,controlType:F,nodeThreeObject:W,nodeVal:e=>e.val,nodeColor:U,nodeVisibility:q,nodeOpacity:.9,nodeResolution:32,nodeRelSize:1,nodeAutoColorBy:"levelName",linkColor:z,linkWidth:V,linkVisibility:X,linkOpacity:.7,linkCurvature:G,linkDirectionalParticles:0,d3AlphaDecay:"grid"===A?1:.01,d3VelocityDecay:"grid"===A?1:.3,cooldownTicks:"grid"===A?0:500,onNodeClick:k,onNodeHover:O,onLinkHover:()=>{},onEngineStop:()=>{x.current&&"grid"===A&&j()},ref:x})]})},DJ=t=>{let{data:n,drugData:r,isDarkMode:i=!1,selectedDrugs:a,onDrugToggle:o,treatmentMode:s}=t;const u=(0,e.useRef)(null),l=(0,e.useRef)(null),c=(0,e.useRef)(null),[h,d]=(0,e.useState)(new Set(["all"])),[p,f]=(0,e.useState)(!1),[m,g]=(0,e.useState)(new Set(["all"])),[v,D]=(0,e.useState)(new Set(["all"])),[y,E]=(0,e.useState)(new Set(["all"])),[A,C]=(0,e.useState)(new Set(["all"])),[_,b]=(0,e.useState)(new Set(["all"])),[x,F]=(0,e.useState)(new Set(["all"])),[w,S]=(0,e.useState)(!0),T=((0,e.useMemo)(()=>Fi.map(e=>e.id),[]),e=>({ketamine:"#FF6B6B",etomidate:"#4ECDC4",propofol:"#45B7D1",novel1:"#96CEB4",novel2:"#FFEAA7"}[e]||"#888888")),M=e=>{const t=Object.keys(e);if(0===t.length)return"#888888";if(1===t.length)return T(t[0]);const n=t.map(e=>T(e)),r=t.map(t=>e[t]),i=r.reduce((e,t)=>e+t,0);let a=0,o=0,s=0;return n.forEach((e,t)=>{const n=r[t]/i,u=Tt(e);a+=u.r*n,o+=u.g*n,s+=u.b*n}),Tt(Math.round(a),Math.round(o),Math.round(s)).toString()},B=((0,e.useMemo)(()=>{const e=new Set;return n.nodes.forEach(t=>{e.add(t.pathway)}),["all",...Array.from(e).sort()]},[n]),(0,e.useMemo)(()=>{const e=new Set;return n.nodes.forEach(t=>{t.type!==Ai.PROTEIN&&t.type!==Ai.mRNA&&t.type!==Ai.METABOLITE&&t.type!==Ai.LIPID||e.add(t.pathway)}),["all",...Array.from(e).sort()]},[n])),P=((0,e.useMemo)(()=>{const e=new Set;return n.nodes.forEach(t=>{t.broadCategory&&(Array.isArray(t.broadCategory)?t.broadCategory.includes("cellular"):"cellular"===t.broadCategory)&&e.add(t.name)}),["all",...Array.from(e).sort()]},[n]),(0,e.useMemo)(()=>{const e=new Set;return n.nodes.forEach(t=>{t.broadCategory&&(Array.isArray(t.broadCategory)?t.broadCategory.includes("tissue"):"tissue"===t.broadCategory)&&e.add(t.name)}),["all",...Array.from(e).sort()]},[n]),(0,e.useMemo)(()=>{const e=new Set;return n.nodes.forEach(t=>{t.broadCategory&&(Array.isArray(t.broadCategory)?t.broadCategory.includes("organ"):"organ"===t.broadCategory)&&e.add(t.name)}),["all",...Array.from(e).sort()]},[n]),(0,e.useMemo)(()=>{const e=new Set;return n.nodes.forEach(t=>{t.broadCategory&&(Array.isArray(t.broadCategory)?t.broadCategory.includes("system"):"system"===t.broadCategory)&&e.add(t.name)}),["all",...Array.from(e).sort()]},[n]),(0,e.useMemo)(()=>{const e=new Set;return n.nodes.forEach(t=>{t.broadCategory&&(Array.isArray(t.broadCategory)?t.broadCategory.includes("behavior"):"behavior"===t.broadCategory)&&e.add(t.name)}),["all",...Array.from(e).sort()]},[n]),(e,t,n)=>r=>{if(n){const n=new Set(e);"all"===r?(n.clear(),n.add("all")):(n.delete("all"),n.has(r)?(n.delete(r),0===n.size&&n.add("all")):n.add(r)),t(n)}else t(new Set([r]))}),N=P(m,g,p),R=P(v,D,p),L=P(y,E,p),I=P(A,C,p),k=P(_,b,p),O=P(x,F,p),U=(0,e.useMemo)(()=>{function e(e,t,n){return!(n&&!m.has("all")&&!m.has(n))&&(!("cellular"===t&&!v.has("all")&&!v.has(e))&&(!("tissue"===t&&!y.has("all")&&!y.has(e))&&(!("organ"===t&&!A.has("all")&&!A.has(e))&&(!("system"===t&&!_.has("all")&&!_.has(e))&&!("behavior"===t&&!x.has("all")&&!x.has(e))))))}function t(e){return{[Ai.PROTEIN]:"#CCCCFF",[Ai.METABOLITE]:"#FF7F50",[Ai.LIPID]:"#DFFF00",[Ai.mRNA]:"#9FE2BF"}[e]||"#888888"}function i(e){return{"Energy Production":"#FF6B6B","Protein Synthesis":"#4ECDC4","Signal Transduction":"#45B7D1","Membrane Function":"#96CEB4"}[e]||"#888888"}function o(e){return{"Epithelial Tissue":"#FFD166","Connective Tissue":"#06D6A0","Muscle Tissue":"#118AB2","Nervous Tissue":"#EF476F"}[e]||"#888888"}function u(e){return{Heart:"#FF9F1C",Lungs:"#FFBF69",Brain:"#FFFFFF",Liver:"#2EC4B6",Kidneys:"#20A4F3",Stomach:"#E71D36"}[e]||"#888888"}function l(e){return{"Cardiovascular System":"#FECA57","Respiratory System":"#FF9FF3","Nervous System":"#54A0FF","Digestive System":"#57CC99","Excretory System":"#80ED99"}[e]||"#888888"}function c(e){return{Hypertension:"#D9534F",Analgesia:"#5CB85C",Hypothermia:"#5BC0DE",Unconsciousness:"#337AB7",Hypotonia:"#F0AD4E"}[e]||"#888888"}const d=h.has("all")?n.nodes:n.nodes.filter(e=>h.has(e.pathway)),p=new Map;d.forEach(e=>{p.has(e.type)||p.set(e.type,new Map);const t=p.get(e.type),n=t.get(e.pathway)||0;t.set(e.pathway,n+(e.expression||.5))});const f=[];p.forEach((e,n)=>{const i=Array.from(e.values()).reduce((e,t)=>e+t,0);f.push({id:"mol_".concat(n),name:n,category:"molecular",level:0,value:i,color:t(n),drugEffects:{},children:Array.from(e.entries()).map(e=>{let[i,o]=e;const u=function(e,t){if(!r||0===a.size||"drug"!==s)return{};const n={};return a.forEach(i=>{var a;const o=null===(a=r[i])||void 0===a?void 0:a.nodes.filter(n=>n.pathway===e&&n.type===t);if(o&&o.length>0){const e=o.reduce((e,t)=>e+Math.abs((t.foldChange||1)-1),0)/o.length;n[i]=e}}),n}(i,n),l=Object.values(u).reduce((e,t)=>e+t,0)/Object.keys(u).length||0;return{id:"mol_".concat(n,"_").concat(i),name:i,category:"molecular",level:1,value:o,color:t(n),drugEffect:l,drugEffects:u,pathway:i}})})});const g=["Energy Production","Protein Synthesis","Signal Transduction","Membrane Function"],D=["Epithelial Tissue","Connective Tissue","Muscle Tissue","Nervous Tissue"],E=["Heart","Lungs","Brain","Liver","Kidneys","Stomach"],C=["Cardiovascular System","Respiratory System","Nervous System","Digestive System","Excretory System"],b=["Hypertension","Analgesia","Hypothermia","Unconsciousness","Hypotonia"];f.forEach(t=>{t.children&&t.children.forEach(t=>{const n=g.filter(n=>(t.name.toLowerCase().includes(n.toLowerCase())||"Energy Production"===n&&t.name.toLowerCase().includes("metabolism")||"Protein Synthesis"===n&&t.name.toLowerCase().includes("protein")||"Signal Transduction"===n&&t.name.toLowerCase().includes("signal")||"Membrane Function"===n&&t.name.toLowerCase().includes("lipid"))&&e(n,"cellular"));n.length>0&&(t.children=n.map(n=>{const r={id:"".concat(t.id,"_cell_").concat(n.replace(/\s/g,"")),name:n,category:"cellular",level:2,value:.7*t.value,color:i(n),drugEffect:.8*(t.drugEffect||0),drugEffects:t.drugEffects?Object.fromEntries(Object.entries(t.drugEffects).map(e=>{let[t,n]=e;return[t,.8*n]})):{}},s=D.filter(t=>("Epithelial Tissue"===t&&("Protein Synthesis"===n||"Signal Transduction"===n||"Membrane Function"===n)||"Connective Tissue"===t&&("Protein Synthesis"===n||"Membrane Function"===n)||"Muscle Tissue"===t&&"Energy Production"===n||"Nervous Tissue"===t&&("Energy Production"===n||"Signal Transduction"===n))&&e(t,"tissue"));return s.length>0&&(r.children=s.map(t=>{const n={id:"".concat(r.id,"_tissue_").concat(t.replace(/\s/g,"")),name:t,category:"tissue",level:3,value:.7*r.value,color:o(t),drugEffect:.8*(r.drugEffect||0),drugEffects:r.drugEffects?Object.fromEntries(Object.entries(r.drugEffects).map(e=>{let[t,n]=e;return[t,.8*n]})):{}},i=E.filter(n=>("Heart"===n&&("Connective Tissue"===t||"Muscle Tissue"===t)||"Lungs"===n&&"Epithelial Tissue"===t||"Brain"===n&&"Nervous Tissue"===t||"Liver"===n&&("Epithelial Tissue"===t||"Connective Tissue"===t)||"Kidneys"===n&&("Epithelial Tissue"===t||"Connective Tissue"===t)||"Stomach"===n&&"Epithelial Tissue"===t)&&e(n,"organ"));return i.length>0&&(n.children=i.map(t=>{const r={id:"".concat(n.id,"_organ_").concat(t.replace(/\s/g,"")),name:t,category:"organ",level:4,value:.5*n.value,color:u(t),drugEffect:.6*(n.drugEffect||0),drugEffects:n.drugEffects?Object.fromEntries(Object.entries(n.drugEffects).map(e=>{let[t,n]=e;return[t,.6*n]})):{}},i=C.filter(n=>("Cardiovascular System"===n&&"Heart"===t||"Respiratory System"===n&&"Lungs"===t||"Nervous System"===n&&"Brain"===t||"Digestive System"===n&&("Liver"===t||"Stomach"===t)||"Excretory System"===n&&"Kidneys"===t)&&e(n,"system"));return i.length>0&&(r.children=i.map(t=>{const n={id:"".concat(r.id,"_sys_").concat(t.replace(/\s/g,"")),name:t,category:"system",level:5,value:.5*r.value,color:l(t),drugEffect:.6*(r.drugEffect||0),drugEffects:r.drugEffects?Object.fromEntries(Object.entries(r.drugEffects).map(e=>{let[t,n]=e;return[t,.6*n]})):{}};if(a&&a.size>0){const r=b.filter(n=>("Hypertension"===n&&"Cardiovascular System"===t||"Analgesia"===n&&"Nervous System"===t||"Hypothermia"===n&&"Nervous System"===t||"Unconsciousness"===n&&"Nervous System"===t||"Hypotonia"===n&&"Nervous System"===t)&&e(n,"behavior"));r.length>0&&(n.children=r.map(e=>({id:"".concat(n.id,"_behav_").concat(e.replace(/\s/g,"")),name:e,category:"behavior",level:6,value:.5*n.value,color:c(e),drugEffect:.6*(n.drugEffect||0),drugEffects:n.drugEffects?Object.fromEntries(Object.entries(n.drugEffects).map(e=>{let[t,n]=e;return[t,.6*n]})):{}})))}return n})),r})),n})),r}))})});return{id:"root",name:"Biological Flow",category:"molecular",level:-1,value:0,color:"#888888",children:f}},[n,r,a,h,m,v,y,A,_,x]);return(0,e.useEffect)(()=>{if(!u.current||!U)return;const e=Mr(u.current);e.selectAll("*").remove();const t=2e3,n=wn(U),r=1680/(1+n.height),o=Un().nodeSize([22,r]),c=fi(hi).x(e=>e.y).y(e=>e.x);e.attr("width",t).attr("height",22).attr("viewBox",[-300,-20,t,22]).attr("style","max-width: 100%; height: auto; font: 12px sans-serif; user-select: none; background: transparent;");const h=e.append("g").attr("fill","none").attr("stroke",i?"#ffffff":"#555").attr("stroke-opacity",.4).attr("stroke-width",1.5),d=e.append("g").attr("cursor","pointer").attr("pointer-events","all");n.x0=r/2,n.y0=0,n.descendants().forEach((e,t)=>{e.id=t,e._children=e.children,e.depth>6&&(e.children=null)}),function r(u,l){const p=null!==u&&void 0!==u&&u.altKey?2500:250,f=n.descendants().reverse(),m=n.links();o(n);let g=n,v=n;n.eachBefore(e=>{e.x<g.x&&(g=e),e.x>v.x&&(v=e)});const D=v.x-g.x+20+20,y=e.transition().duration(p).attr("height",D).attr("viewBox","".concat(-300," ").concat(g.x-20," ").concat(t," ").concat(D)),E=d.selectAll("g").data(f,e=>e.id),A=E.enter().append("g").attr("transform",e=>"translate(".concat(l.y0,",").concat(l.x0,")")).attr("fill-opacity",0).attr("stroke-opacity",0).on("click",(e,t)=>{t.children=t.children?null:t._children,r(e,t)});A.append("circle").attr("r",e=>-1===e.data.level?0:4).attr("fill",e=>{if(-1===e.data.level)return"transparent";let t=e.data.color;if(a&&a.size>0&&"drug"===s&&e.data.drugEffects){const n=Object.keys(e.data.drugEffects);if(1===n.length){const r=n[0],i=e.data.drugEffects[r];if(i>.01){const e=T(r),n=Math.min(3*i,.7);return Xt(t,e)(n)}}else if(n.length>1){const n=Math.max(...Object.values(e.data.drugEffects).map(e=>e));if(n>.01){const r=Math.min(3*n,.7),i=M(e.data.drugEffects);return Xt(t,i)(r)}}}return t}).attr("stroke",e=>{if(-1===e.data.level)return"transparent";if(a&&a.size>0&&"drug"===s&&e.data.drugEffects){const t=Object.keys(e.data.drugEffects),n=Math.max(...Object.values(e.data.drugEffects).map(e=>e));if(n>.01){if(1===t.length)return T(t[0]);if(t.length>1)return M(e.data.drugEffects)}}return i?"#ffffff":"#000000"}).attr("stroke-width",e=>{if(-1===e.data.level)return 0;if(a&&a.size>0&&"drug"===s&&e.data.drugEffects){const t=Math.max(...Object.values(e.data.drugEffects).map(e=>e));if(t>.01){return Object.keys(e.data.drugEffects).length>1?4:3}}return 2}),A.append("text").attr("dy","0.31em").attr("x",e=>e._children?-8:8).attr("text-anchor",e=>e._children?"end":"start").text(e=>e.data.name).attr("stroke-linejoin","round").attr("stroke-width",3).attr("stroke",i?"#000000":"#ffffff").attr("fill",i?"#ffffff":"#000000").attr("paint-order","stroke").style("font-size","12px").style("font-weight","bold"),E.merge(A).transition(y).attr("transform",e=>"translate(".concat(e.y,",").concat(e.x,")")).attr("fill-opacity",1).attr("stroke-opacity",1).attr("fill",e=>{if(-1===e.data.level)return"transparent";let t=e.data.color;if(a&&a.size>0&&"drug"===s&&e.data.drugEffects){const n=Object.keys(e.data.drugEffects);if(1===n.length){const r=n[0],i=e.data.drugEffects[r];if(i>.01){const e=T(r),n=Math.min(3*i,.7);return Xt(t,e)(n)}}else if(n.length>1){const n=Math.max(...Object.values(e.data.drugEffects).map(e=>e));if(n>.01){const r=Math.min(3*n,.7),i=M(e.data.drugEffects);return Xt(t,i)(r)}}}return t}).attr("stroke",e=>{if(-1===e.data.level)return"transparent";if(a&&a.size>0&&"drug"===s&&e.data.drugEffects){const t=Object.keys(e.data.drugEffects),n=Math.max(...Object.values(e.data.drugEffects).map(e=>e));if(n>.01){if(1===t.length)return T(t[0]);if(t.length>1)return M(e.data.drugEffects)}}return i?"#ffffff":"#000000"}).attr("stroke-width",e=>{if(-1===e.data.level)return 0;if(a&&a.size>0&&"drug"===s&&e.data.drugEffects){const t=Math.max(...Object.values(e.data.drugEffects).map(e=>e));if(t>.01){return Object.keys(e.data.drugEffects).length>1?4:3}}return 2}),E.exit().transition(y).remove().attr("transform",e=>"translate(".concat(l.y,",").concat(l.x,")")).attr("fill-opacity",0).attr("stroke-opacity",0);const C=h.selectAll("path").data(m,e=>e.target.id),_=C.enter().append("path").attr("d",e=>{const t={x:l.x0,y:l.y0};return c({source:t,target:t})});C.merge(_).transition(y).attr("d",c),C.exit().transition(y).remove().attr("d",e=>{const t={x:l.x,y:l.y};return c({source:t,target:t})}),n.eachBefore(e=>{e.x0=e.x,e.y0=e.y})}(null,n),d.selectAll("g").on("mouseover",function(e,t){if(-1!==t.data.level&&(Mr(this).select("circle").attr("r",6).attr("stroke-width",3),l.current)){const n=Mr(l.current);let r="";if(a&&a.size>0&&t.data.drugEffects){const e=Object.keys(t.data.drugEffects);if(1===e.length){const n=e[0],i=t.data.drugEffects[n];r='<br/><span style="color: '.concat(T(n),'">\u25cf ').concat(n,": ").concat((100*i).toFixed(1),"%</span>")}else e.length>1&&(r="<br/><strong>Drug Effects:</strong>",e.forEach(e=>{const n=t.data.drugEffects[e];r+='<br/><span style="color: '.concat(T(e),'">\u25cf ').concat(e,": ").concat((100*n).toFixed(1),"%</span>")}))}n.style("opacity",1).style("left",e.pageX+10+"px").style("top",e.pageY-10+"px").html("\n            <strong>".concat(t.data.name,"</strong><br/>\n            Category: ").concat(t.data.category,"<br/>\n            Level: ").concat(t.data.level,"<br/>\n            Value: ").concat(t.data.value.toFixed(2),"\n            ").concat(t.data.pathway?"<br/>Pathway: ".concat(t.data.pathway):"","\n            ").concat(r,"\n            "))}}).on("mousemove",function(e){l.current&&Mr(l.current).style("left",e.pageX+10+"px").style("top",e.pageY-10+"px")}).on("mouseout",function(){Mr(this).select("circle").attr("r",4).attr("stroke-width",2),l.current&&Mr(l.current).style("opacity",0)})},[U,i,a,s,e=>{const t=Object.keys(e);return 0===t.length?"#888888":1===t.length?T(t[0]):"#FF8C42"},M]),(0,Bi.jsxs)("div",{className:"sankey-flow-container",children:[(0,Bi.jsxs)("div",{className:"sankey-controls",style:{position:"relative",marginTop:"-20px"},children:[(0,Bi.jsx)("button",{type:"button",onClick:()=>S(!w),style:{position:"absolute",top:"2px",right:"8px",zIndex:10,background:"none",border:"none",fontSize:"18px",cursor:"pointer",color:i?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",padding:"4px",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",transition:"all 0.2s ease"},title:w?"Hide filters":"Show filters",children:w?"\xd7":"+"}),a.size>0&&"drug"===s&&(0,Bi.jsxs)("div",{className:"drug-legend",children:[(0,Bi.jsx)("label",{children:"Drug Effect Legend:"}),(0,Bi.jsxs)("div",{className:"legend-items",children:[Array.from(a).map(e=>(0,Bi.jsxs)("div",{className:"legend-item",children:[(0,Bi.jsx)("span",{className:"legend-color",style:{backgroundColor:T(e)}}),(0,Bi.jsxs)("span",{className:"legend-text",children:[e," (overlay)"]})]},e)),a.size>1&&(0,Bi.jsxs)("div",{className:"legend-item",children:[(0,Bi.jsx)("span",{className:"legend-color",style:{background:"linear-gradient(45deg, ".concat(Array.from(a).map(e=>T(e)).join(", "),")")}}),(0,Bi.jsx)("span",{className:"legend-text",children:"Multiple Drugs (blended)"})]}),(0,Bi.jsx)("div",{className:"legend-note",children:(0,Bi.jsx)("small",{children:"Drug colors appear as overlays on affected nodes. Multiple drugs create blended colors."})})]})]}),(0,Bi.jsx)("div",{className:"biological-filters",style:{marginTop:"8px"},children:w&&(0,Bi.jsxs)(Bi.Fragment,{children:[(0,Bi.jsx)("div",{className:"filter-header",children:(0,Bi.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,Bi.jsx)("h4",{children:"Filter by Biological Level:"}),(0,Bi.jsxs)("div",{className:"toggle-group",children:[(0,Bi.jsx)("button",{type:"button",className:"toggle-button ".concat(p?"":"active"),onClick:()=>{f(!1),d(new Set(["all"])),g(new Set(["all"])),D(new Set(["all"])),E(new Set(["all"])),C(new Set(["all"])),b(new Set(["all"])),F(new Set(["all"]))},children:"Single Select"}),(0,Bi.jsx)("button",{type:"button",className:"toggle-button ".concat(p?"active":""),onClick:()=>f(!0),children:"Multi Select"})]})]})}),(0,Bi.jsxs)("div",{className:"filter-grid",children:[(0,Bi.jsxs)("div",{className:"filter-section",children:[(0,Bi.jsx)("label",{children:"Molecular Pathways:"}),(0,Bi.jsx)("div",{className:"filter-options",children:p?(0,Bi.jsx)("div",{className:"checkbox-group",children:B.map(e=>(0,Bi.jsxs)("label",{className:"checkbox-label",children:[(0,Bi.jsx)("input",{type:"checkbox",checked:m.has(e),onChange:()=>N(e),className:"filter-checkbox"}),(0,Bi.jsx)("span",{className:"checkbox-text",children:"all"===e?"All Pathways":e})]},e))}):(0,Bi.jsx)("select",{value:Array.from(m)[0]||"all",onChange:e=>N(e.target.value),className:"filter-select",children:B.map(e=>(0,Bi.jsx)("option",{value:e,children:"all"===e?"All Pathways":e},e))})})]}),(0,Bi.jsxs)("div",{className:"filter-section",children:[(0,Bi.jsx)("label",{children:"Cellular Functions:"}),(0,Bi.jsx)("div",{className:"filter-options",children:p?(0,Bi.jsx)("div",{className:"checkbox-group",children:["Energy Production","Protein Synthesis","Signal Transduction","Membrane Function"].map(e=>(0,Bi.jsxs)("label",{className:"checkbox-label",children:[(0,Bi.jsx)("input",{type:"checkbox",checked:v.has(e),onChange:()=>R(e),className:"filter-checkbox"}),(0,Bi.jsx)("span",{className:"checkbox-text",children:"all"===e?"All Functions":e})]},e))}):(0,Bi.jsxs)("select",{value:Array.from(v)[0]||"all",onChange:e=>R(e.target.value),className:"filter-select",children:[(0,Bi.jsx)("option",{value:"all",children:"All Functions"}),(0,Bi.jsx)("option",{value:"Energy Production",children:"Energy Production"}),(0,Bi.jsx)("option",{value:"Protein Synthesis",children:"Protein Synthesis"}),(0,Bi.jsx)("option",{value:"Signal Transduction",children:"Signal Transduction"}),(0,Bi.jsx)("option",{value:"Membrane Function",children:"Membrane Function"})]})})]}),(0,Bi.jsxs)("div",{className:"filter-section",children:[(0,Bi.jsx)("label",{children:"Tissue Types:"}),(0,Bi.jsx)("div",{className:"filter-options",children:p?(0,Bi.jsx)("div",{className:"checkbox-group",children:["Epithelial Tissue","Connective Tissue","Muscle Tissue","Nervous Tissue"].map(e=>(0,Bi.jsxs)("label",{className:"checkbox-label",children:[(0,Bi.jsx)("input",{type:"checkbox",checked:y.has(e),onChange:()=>L(e),className:"filter-checkbox"}),(0,Bi.jsx)("span",{className:"checkbox-text",children:"all"===e?"All Tissues":e})]},e))}):(0,Bi.jsxs)("select",{value:Array.from(y)[0]||"all",onChange:e=>L(e.target.value),className:"filter-select",children:[(0,Bi.jsx)("option",{value:"all",children:"All Tissues"}),(0,Bi.jsx)("option",{value:"Epithelial Tissue",children:"Epithelial Tissue"}),(0,Bi.jsx)("option",{value:"Connective Tissue",children:"Connective Tissue"}),(0,Bi.jsx)("option",{value:"Muscle Tissue",children:"Muscle Tissue"}),(0,Bi.jsx)("option",{value:"Nervous Tissue",children:"Nervous Tissue"})]})})]}),(0,Bi.jsxs)("div",{className:"filter-section",children:[(0,Bi.jsx)("label",{children:"Organs:"}),(0,Bi.jsx)("div",{className:"filter-options",children:p?(0,Bi.jsx)("div",{className:"checkbox-group",children:["Heart","Lungs","Brain","Liver","Kidneys","Stomach"].map(e=>(0,Bi.jsxs)("label",{className:"checkbox-label",children:[(0,Bi.jsx)("input",{type:"checkbox",checked:A.has(e),onChange:()=>I(e),className:"filter-checkbox"}),(0,Bi.jsx)("span",{className:"checkbox-text",children:"all"===e?"All Organs":e})]},e))}):(0,Bi.jsxs)("select",{value:Array.from(A)[0]||"all",onChange:e=>I(e.target.value),className:"filter-select",children:[(0,Bi.jsx)("option",{value:"all",children:"All Organs"}),(0,Bi.jsx)("option",{value:"Heart",children:"Heart"}),(0,Bi.jsx)("option",{value:"Lungs",children:"Lungs"}),(0,Bi.jsx)("option",{value:"Brain",children:"Brain"}),(0,Bi.jsx)("option",{value:"Liver",children:"Liver"}),(0,Bi.jsx)("option",{value:"Kidneys",children:"Kidneys"}),(0,Bi.jsx)("option",{value:"Stomach",children:"Stomach"})]})})]}),(0,Bi.jsxs)("div",{className:"filter-section",children:[(0,Bi.jsx)("label",{children:"Systems:"}),(0,Bi.jsx)("div",{className:"filter-options",children:p?(0,Bi.jsx)("div",{className:"checkbox-group",children:["Cardiovascular System","Respiratory System","Nervous System","Digestive System","Excretory System"].map(e=>(0,Bi.jsxs)("label",{className:"checkbox-label",children:[(0,Bi.jsx)("input",{type:"checkbox",checked:_.has(e),onChange:()=>k(e),className:"filter-checkbox"}),(0,Bi.jsx)("span",{className:"checkbox-text",children:"all"===e?"All Systems":e})]},e))}):(0,Bi.jsxs)("select",{value:Array.from(_)[0]||"all",onChange:e=>k(e.target.value),className:"filter-select",children:[(0,Bi.jsx)("option",{value:"all",children:"All Systems"}),(0,Bi.jsx)("option",{value:"Cardiovascular System",children:"Cardiovascular System"}),(0,Bi.jsx)("option",{value:"Respiratory System",children:"Respiratory System"}),(0,Bi.jsx)("option",{value:"Nervous System",children:"Nervous System"}),(0,Bi.jsx)("option",{value:"Digestive System",children:"Digestive System"}),(0,Bi.jsx)("option",{value:"Excretory System",children:"Excretory System"})]})})]}),(0,Bi.jsxs)("div",{className:"filter-section",children:[(0,Bi.jsx)("label",{children:"Outcomes:"}),(0,Bi.jsx)("div",{className:"filter-options",children:p?(0,Bi.jsx)("div",{className:"checkbox-group",children:["Hypertension","Analgesia","Hypothermia","Unconsciousness","Hypotonia"].map(e=>(0,Bi.jsxs)("label",{className:"checkbox-label",children:[(0,Bi.jsx)("input",{type:"checkbox",checked:x.has(e),onChange:()=>O(e),className:"filter-checkbox"}),(0,Bi.jsx)("span",{className:"checkbox-text",children:"all"===e?"All Outcomes":e})]},e))}):(0,Bi.jsxs)("select",{value:Array.from(x)[0]||"all",onChange:e=>O(e.target.value),className:"filter-select",children:[(0,Bi.jsx)("option",{value:"all",children:"All Outcomes"}),(0,Bi.jsx)("option",{value:"Hypertension",children:"Hypertension"}),(0,Bi.jsx)("option",{value:"Analgesia",children:"Analgesia"}),(0,Bi.jsx)("option",{value:"Hypothermia",children:"Hypothermia"}),(0,Bi.jsx)("option",{value:"Unconsciousness",children:"Unconsciousness"}),(0,Bi.jsx)("option",{value:"Hypotonia",children:"Hypotonia"})]})})]})]})]})})]}),(0,Bi.jsxs)("div",{className:"sankey-wrapper",ref:c,children:[(0,Bi.jsx)("svg",{ref:u,className:"sankey-flow-diagram"}),(0,Bi.jsx)("div",{ref:l,className:"sankey-tooltip",style:{position:"absolute",opacity:0,pointerEvents:"none",background:i?"rgba(0, 0, 0, 0.9)":"rgba(255, 255, 255, 0.9)",color:i?"#ffffff":"#000000",border:"1px solid ".concat(i?"#ffffff":"#000000"),borderRadius:"4px",padding:"8px",fontSize:"12px",zIndex:1e3}})]})]})},yJ=t=>{let{data:n,drugData:r,selectedDrugs:i=new Set,isDarkMode:a=!1}=t;const o=(0,e.useRef)(null),s=(0,e.useRef)(null),u=(0,e.useMemo)(()=>{const e=["Energy Metabolism","Immune Response","Oxidative Stress","Circadian Rhythm","Blood Pressure","Heart Rate","Temperature Regulation"],t={};return Object.entries({ketamine:{"Energy Metabolism":.8,"Immune Response":1.2,"Oxidative Stress":1.4,"Circadian Rhythm":.6,"Blood Pressure":1.1,"Heart Rate":1.3,"Temperature Regulation":.9},propofol:{"Energy Metabolism":.7,"Immune Response":.4,"Oxidative Stress":.3,"Circadian Rhythm":1.1,"Blood Pressure":.8,"Heart Rate":.6,"Temperature Regulation":1.2},etomidate:{"Energy Metabolism":1.1,"Immune Response":.9,"Oxidative Stress":.8,"Circadian Rhythm":1.3,"Blood Pressure":.5,"Heart Rate":.7,"Temperature Regulation":.4},novel1:{"Energy Metabolism":.9,"Immune Response":1,"Oxidative Stress":.7,"Circadian Rhythm":.8,"Blood Pressure":1.2,"Heart Rate":.9,"Temperature Regulation":1.1},novel2:{"Energy Metabolism":1.3,"Immune Response":.6,"Oxidative Stress":1.1,"Circadian Rhythm":.5,"Blood Pressure":.9,"Heart Rate":1,"Temperature Regulation":.7}}).forEach(n=>{let[r,i]=n;const a=[];e.forEach(e=>{const t=i[e]||.5;a.push({axis:e,value:t,maxValue:1.5,drug:r})}),t[r]=a}),t},[n,r,i]);return(0,e.useEffect)(()=>{if(!o.current||0===Object.keys(u).length)return;const e=Mr(o.current);e.selectAll("*").remove();const t=o.current.clientWidth,n=o.current.clientHeight,r=60,i=170,s=60,l=60,c=Math.min(t-l-i,n-r-s)/2-80,h=e.append("g").attr("class","main-radar").attr("transform","translate(".concat(t/2-50,", ").concat(n/2,")")),d=Object.keys(u)[0],p=d?u[d].map(e=>e.axis):[],f=2*Math.PI/p.length,m=Tr().domain([0,1.5]).range([0,c]);p.forEach((e,t)=>{const n=f*t-Math.PI/2,r=1.3*c,i=Math.cos(n)*r,o=Math.sin(n)*r;h.append("line").attr("x1",0).attr("y1",0).attr("x2",i).attr("y2",o).attr("stroke",a?"#ffffff25":"#00000025").attr("stroke-width",1).attr("stroke-dasharray","3,3"),h.append("circle").attr("cx",i).attr("cy",o).attr("r",3).attr("fill",a?"#ffffff":"#000000").attr("stroke","none");const s=1.15*r,u=Math.cos(n)*s,l=Math.sin(n)*s;h.append("text").attr("x",u).attr("y",l).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill",a?"#ffffff":"#000000").attr("font-size","12px").attr("font-weight","500").text(e)});const g={ketamine:"#FFBF00",etomidate:"#40E0D0",propofol:"#DE3163",novel1:"#6495ED",novel2:"#77B254"};Object.entries(u).forEach((e,t)=>{let[n,r]=e;const i=g[n]||"#888888",o=li().angle((e,t)=>f*t).radius(e=>m(e.value)).curve(yi);h.append("path").datum(r).attr("class","radar-area radar-area-".concat(n)).attr("d",o).attr("fill",i).attr("fill-opacity",a?.25:.15).attr("stroke","none").attr("filter",a?"drop-shadow(0 0 8px ".concat(i,")"):"none")});const v=t/2+400,D=80;Object.entries(u).forEach((t,n)=>{let[r,i]=t;const o=g[r]||"#888888",s=60+100*n,u=e.append("g").attr("class","mini-radar-".concat(r)).attr("transform","translate(".concat(v+40,", ").concat(s+40,")"));p.forEach((e,t)=>{const n=f*t-Math.PI/2,r=Math.cos(n)*D/2,i=Math.sin(n)*D/2;u.append("line").attr("x1",0).attr("y1",0).attr("x2",r).attr("y2",i).attr("stroke",a?"#ffffff20":"#00000020").attr("stroke-width",.5).attr("stroke-dasharray","2,2"),u.append("circle").attr("cx",r).attr("cy",i).attr("r",1.5).attr("fill",a?"#ffffff":"#000000").attr("stroke","none")});const l=li().angle((e,t)=>f*t).radius(e=>e.value/1.5*40).curve(yi);u.append("path").datum(i).attr("class","mini-radar-area mini-radar-area-".concat(r)).attr("d",l).attr("fill",o).attr("fill-opacity",a?.5:.3).attr("stroke","none").attr("filter",a?"drop-shadow(0 0 6px ".concat(o,")"):"none"),e.append("text").attr("x",v+D+10).attr("y",s+40).attr("text-anchor","start").attr("dominant-baseline","middle").attr("fill",a?"#ffffff":"#000000").attr("font-size","12px").attr("font-weight","500").text(r.toUpperCase())}),e.selectAll(".radar-area").on("mouseover",function(t,n){const r=this.getAttribute("class"),i=null===r||void 0===r?void 0:r.split("-").pop();i&&(e.selectAll(".radar-area").attr("fill-opacity",a?.1:.05),Mr(this).attr("fill-opacity",a?.6:.4),e.selectAll(".mini-radar-area").attr("fill-opacity",a?.2:.1),e.select(".mini-radar-area-".concat(i)).attr("fill-opacity",a?.8:.6))}).on("mouseout",function(){e.selectAll(".radar-area").attr("fill-opacity",a?.25:.15),e.selectAll(".mini-radar-area").attr("fill-opacity",a?.5:.3)})},[u,a]),(0,Bi.jsx)("div",{className:"radar-chart-container",children:(0,Bi.jsxs)("div",{className:"radar-wrapper",children:[(0,Bi.jsx)("svg",{ref:o,className:"radar-chart",width:"100%",height:"500"}),(0,Bi.jsx)("div",{ref:s,className:"radar-tooltip",style:{position:"absolute",opacity:0,pointerEvents:"none",zIndex:1e3}})]})})};const EJ={methods:{one:{},two:{},three:{},four:{}},model:{one:{},two:{},three:{}},compute:{},hooks:[]},AJ={compute:function(e){const{world:t}=this,n=t.compute;return"string"===typeof e&&n.hasOwnProperty(e)?n[e](this):(e=>"[object Array]"===Object.prototype.toString.call(e))(e)?e.forEach(r=>{t.compute.hasOwnProperty(r)?n[r](this):console.warn("no compute:",e)}):"function"===typeof e?e(this):console.warn("no compute:",e),this}},CJ=AJ,_J={forEach:function(e){return this.fullPointer.forEach((t,n)=>{let r=this.update([t]);e(r,n)}),this},map:function(e,t){let n=this.fullPointer.map((t,n)=>{let r=this.update([t]),i=e(r,n);return void 0===i?this.none():i});if(0===n.length)return t||this.update([]);if(void 0!==n[0]){if("string"===typeof n[0])return n;if("object"===typeof n[0]&&(null===n[0]||!n[0].isView))return n}let r=[];return n.forEach(e=>{r=r.concat(e.fullPointer)}),this.toView(r)},filter:function(e){let t=this.fullPointer;return t=t.filter((t,n)=>{let r=this.update([t]);return e(r,n)}),this.update(t)},find:function(e){let t=this.fullPointer.find((t,n)=>{let r=this.update([t]);return e(r,n)});return this.update([t])},some:function(e){return this.fullPointer.some((t,n)=>{let r=this.update([t]);return e(r,n)})},random:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.fullPointer,n=Math.floor(Math.random()*t.length);return n+e>this.length&&(n=this.length-e,n=n<0?0:n),t=t.slice(n,n+e),this.update(t)}},bJ={termList:function(){return this.methods.one.termList(this.docs)},terms:function(e){let t=this.match(".");return"number"===typeof e?t.eq(e):t},groups:function(e){if(e||0===e)return this.update(this._groups[e]||[]);let t={};return Object.keys(this._groups).forEach(e=>{t[e]=this.update(this._groups[e])}),t},eq:function(e){let t=this.pointer;return t||(t=this.docs.map((e,t)=>[t])),t[e]?this.update([t[e]]):this.none()},first:function(){return this.eq(0)},last:function(){let e=this.fullPointer.length-1;return this.eq(e)},firstTerms:function(){return this.match("^.")},lastTerms:function(){return this.match(".$")},slice:function(e,t){let n=this.pointer||this.docs.map((e,t)=>[t]);return n=n.slice(e,t),this.update(n)},all:function(){return this.update().toView()},fullSentences:function(){let e=this.fullPointer.map(e=>[e[0]]);return this.update(e).toView()},none:function(){return this.update([])},isDoc:function(e){if(!e||!e.isView)return!1;let t=this.fullPointer,n=e.fullPointer;return!t.length!==n.length&&t.every((e,t)=>!!n[t]&&(e[0]===n[t][0]&&e[1]===n[t][1]&&e[2]===n[t][2]))},wordCount:function(){return this.docs.reduce((e,t)=>(e+=t.filter(e=>""!==e.text).length,e),0)},isFull:function(){let e=this.pointer;if(!e)return!0;if(0===e.length||0!==e[0][0])return!1;let t=0,n=0;return this.document.forEach(e=>t+=e.length),this.docs.forEach(e=>n+=e.length),t===n},getNth:function(e){return"number"===typeof e?this.eq(e):"string"===typeof e?this.if(e):this}};bJ.group=bJ.groups,bJ.fullSentence=bJ.fullSentences,bJ.sentence=bJ.fullSentences,bJ.lastTerm=bJ.lastTerms,bJ.firstTerm=bJ.firstTerms;const xJ=bJ,FJ=Object.assign({},xJ,CJ,_J);FJ.get=FJ.eq;const wJ=FJ;class SJ{constructor(e,t){[["document",e],["world",EJ],["_groups",arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}],["_cache",null],["viewType","View"]].forEach(e=>{Object.defineProperty(this,e[0],{value:e[1],writable:!0})}),this.ptrs=t}get docs(){let e=this.document;return this.ptrs&&(e=EJ.methods.one.getDoc(this.ptrs,this.document)),e}get pointer(){return this.ptrs}get methods(){return this.world.methods}get model(){return this.world.model}get hooks(){return this.world.hooks}get isView(){return!0}get found(){return this.docs.length>0}get length(){return this.docs.length}get fullPointer(){let{docs:e,ptrs:t,document:n}=this,r=t||e.map((e,t)=>[t]);return r.map(e=>{let[t,r,i,a,o]=e;return r=r||0,i=i||(n[t]||[]).length,n[t]&&n[t][r]&&(a=a||n[t][r].id,n[t][i-1]&&(o=o||n[t][i-1].id)),[t,r,i,a,o]})}update(e){let t=new SJ(this.document,e);if(this._cache&&e&&e.length>0){let n=[];e.forEach((e,t)=>{let[r,i,a]=e;(1===e.length||0===i&&this.document[r].length===a)&&(n[t]=this._cache[r])}),n.length>0&&(t._cache=n)}return t.world=this.world,t}toView(e){return new SJ(this.document,e||this.pointer)}fromText(e){const{methods:t}=this;let n=t.one.tokenize.fromString(e,this.world),r=new SJ(n);return r.world=this.world,r.compute(["normal","freeze","lexicon"]),this.world.compute.preTagger&&r.compute("preTagger"),r.compute("unfreeze"),r}clone(){let e=this.document.slice(0);e=e.map(e=>e.map(e=>((e=Object.assign({},e)).tags=new Set(e.tags),e)));let t=this.update(this.pointer);return t.document=e,t._cache=this._cache,t}}Object.assign(SJ.prototype,wJ);const TJ=SJ,MJ=function(e){return e&&"object"===typeof e&&!Array.isArray(e)};function BJ(e,t){if(MJ(t))for(const n in t)MJ(t[n])?(e[n]||Object.assign(e,{[n]:{}}),BJ(e[n],t[n])):Object.assign(e,{[n]:t[n]});return e}const PJ=function(e,t,n,r){const{methods:i,model:a,compute:o,hooks:s}=t;e.methods&&function(e,t){for(const n in t)e[n]=e[n]||{},Object.assign(e[n],t[n])}(i,e.methods),e.model&&BJ(a,e.model),e.irregulars&&function(e,t){let n=e.two.models||{};Object.keys(t).forEach(e=>{t[e].pastTense&&(n.toPast&&(n.toPast.ex[e]=t[e].pastTense),n.fromPast&&(n.fromPast.ex[t[e].pastTense]=e)),t[e].presentTense&&(n.toPresent&&(n.toPresent.ex[e]=t[e].presentTense),n.fromPresent&&(n.fromPresent.ex[t[e].presentTense]=e)),t[e].gerund&&(n.toGerund&&(n.toGerund.ex[e]=t[e].gerund),n.fromGerund&&(n.fromGerund.ex[t[e].gerund]=e)),t[e].comparative&&(n.toComparative&&(n.toComparative.ex[e]=t[e].comparative),n.fromComparative&&(n.fromComparative.ex[t[e].comparative]=e)),t[e].superlative&&(n.toSuperlative&&(n.toSuperlative.ex[e]=t[e].superlative),n.fromSuperlative&&(n.fromSuperlative.ex[t[e].superlative]=e))})}(a,e.irregulars),e.compute&&Object.assign(o,e.compute),s&&(t.hooks=s.concat(e.hooks||[])),e.api&&e.api(n),e.lib&&Object.keys(e.lib).forEach(t=>r[t]=e.lib[t]),e.tags&&r.addTags(e.tags),e.words&&r.addWords(e.words),e.frozen&&r.addWords(e.frozen,!0),e.mutate&&e.mutate(t,r)},NJ=function(e){return"[object Array]"===Object.prototype.toString.call(e)},RJ=function(e,t,n){const{methods:r}=n;let i=new t([]);if(i.world=n,"number"===typeof e&&(e=String(e)),!e)return i;if("string"===typeof e){return new t(r.one.tokenize.fromString(e,n))}if(a=e,"[object Object]"===Object.prototype.toString.call(a)&&e.isView)return new t(e.document,e.ptrs);var a;if(NJ(e)){if(NJ(e[0])){let n=e.map(e=>e.map(e=>({text:e,normal:e,pre:"",post:" ",tags:new Set})));return new t(n)}let n=function(e){return e.map(e=>e.terms.map(e=>(NJ(e.tags)&&(e.tags=new Set(e.tags)),e)))}(e);return new t(n)}return i};let LJ=Object.assign({},EJ);const IJ=function(e,t){t&&IJ.addWords(t);let n=RJ(e,TJ,LJ);return e&&n.compute(LJ.hooks),n};Object.defineProperty(IJ,"_world",{value:LJ,writable:!0}),IJ.tokenize=function(e,t){const{compute:n}=this._world;t&&IJ.addWords(t);let r=RJ(e,TJ,LJ);return n.contractions&&r.compute(["alias","normal","machine","contractions"]),r},IJ.plugin=function(e){return PJ(e,this._world,TJ,this),this},IJ.extend=IJ.plugin,IJ.world=function(){return this._world},IJ.model=function(){return this._world.model},IJ.methods=function(){return this._world.methods},IJ.hooks=function(){return this._world.hooks},IJ.verbose=function(e){const t="undefined"===typeof process?self.env||{}:{NODE_ENV:"production",PUBLIC_URL:"/gaia_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0};return t.DEBUG_TAGS="tagger"===e||!0===e||"",t.DEBUG_MATCH="match"===e||!0===e||"",t.DEBUG_CHUNKS="chunker"===e||!0===e||"",this},IJ.version="14.14.4";const kJ=IJ,OJ=function(e){let t=e.map(e=>{let t=new Set;return e.forEach(e=>{""!==e.normal&&t.add(e.normal),e.switch&&t.add("%".concat(e.switch,"%")),e.implicit&&t.add(e.implicit),e.machine&&t.add(e.machine),e.root&&t.add(e.root),e.alias&&e.alias.forEach(e=>t.add(e));let n=Array.from(e.tags);for(let r=0;r<n.length;r+=1)t.add("#"+n[r])}),t});return t},UJ={cache:function(){return this._cache=this.methods.one.cacheDoc(this.document),this},uncache:function(){return this._cache=null,this}},zJ=function(e){Object.assign(e.prototype,UJ)},VJ={api:zJ,compute:{cache:function(e){e._cache=e.methods.one.cacheDoc(e.document)}},methods:{one:{cacheDoc:OJ}}},GJ=e=>/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])(?:['a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u2019\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/.test(e)||/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])$/.test(e),HJ=(e,t,n)=>{if(n.forEach(e=>e.dirty=!0),e){let r=[t,0].concat(n);Array.prototype.splice.apply(e,r)}return e},jJ=function(e){let t=e[e.length-1];!t||/ $/.test(t.post)||/[-\u2013\u2014]/.test(t.post)||(t.post+=" ")},WJ=(e,t,n)=>{const r=/[-.?!,;:)\u2013\u2014'"]/g;let i=e[t-1];if(!i)return;let a=i.post;if(r.test(a)){let e=a.match(r).join(""),t=n[n.length-1];t.post=e+t.post,i.post=i.post.replace(r,"")}},qJ=function(e,t,n,r){let[i,a,o]=t;0===a||o===r[i].length?jJ(n):(jJ(n),jJ([e[t[1]]])),function(e,t,n){let r=e[t];if(0!==t||!GJ(r.text))return;n[0].text=n[0].text.replace(/^(?:[a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/,e=>e.toUpperCase());let i=e[t];i.tags.has("ProperNoun")||i.tags.has("Acronym")||GJ(i.text)&&i.text.length>1&&(i.text=(a=i.text,a.replace(/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])/,e=>e.toLowerCase())));var a}(e,a,n),HJ(e,a,n)};let XJ=0;const KJ=e=>(e=e.length<3?"0"+e:e).length<3?"0"+e:e,YJ=function(e){let[t,n]=e.index||[0,0];XJ+=1,XJ=XJ>46655?0:XJ,t=t>46655?0:t,n=n>1294?0:n;let r=KJ(XJ.toString(36));r+=KJ(t.toString(36));let i=n.toString(36);return i=i.length<2?"0"+i:i,r+=i,r+=parseInt(36*Math.random(),10).toString(36),e.normal+"|"+r.toUpperCase()},JJ=function(e){if(e.has("@hasContraction")&&"function"===typeof e.contractions){e.grow("@hasContraction").contractions().expand()}},$J=e=>"[object Array]"===Object.prototype.toString.call(e),QJ=function(e,t,n){const{document:r,world:i}=t;t.uncache();let a=t.fullPointer,o=t.fullPointer;t.forEach((s,u)=>{let l=s.fullPointer[0],[c]=l,h=r[c],d=function(e,t){const{methods:n}=t;return"string"===typeof e?n.one.tokenize.fromString(e,t)[0]:"object"===typeof e&&e.isView?e.clone().docs[0]||[]:$J(e)?$J(e[0])?e[0]:e:[]}(e,i);0!==d.length&&(d=function(e){return e.map(e=>(e.id=YJ(e),e))}(d),n?(JJ(t.update([l]).firstTerm()),qJ(h,l,d,r)):(JJ(t.update([l]).lastTerm()),function(e,t,n,r){let[i,,a]=t,o=(r[i]||[]).length;a<o?(WJ(e,a,n),jJ(n)):o===a&&(jJ(e),WJ(e,a,n),r[i+1]&&(n[n.length-1].post+=" ")),HJ(e,t[2],n),t[4]=n[n.length-1].id}(h,l,d,r)),r[c]&&r[c][l[1]]&&(l[3]=r[c][l[1]].id),o[u]=l,l[2]+=d.length,a[u]=l)});let s=t.toView(a);return t.ptrs=o,s.compute(["id","index","freeze","lexicon"]),s.world.compute.preTagger&&s.compute("preTagger"),s.compute("unfreeze"),s},ZJ={insertAfter:function(e){return QJ(e,this,!1)},insertBefore:function(e){return QJ(e,this,!0)}};ZJ.append=ZJ.insertAfter,ZJ.prepend=ZJ.insertBefore,ZJ.insert=ZJ.insertAfter;const e$=ZJ,t$=/\$[0-9a-z]+/g,n$={},r$=e=>e.replace(/^(?:[a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/,e=>e.toUpperCase()),i$=e=>e.replace(/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])/,e=>e.toLowerCase());n$.replaceWith=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.fullPointer,r=this;if(this.uncache(),"function"===typeof e)return function(e,t,n){return e.forEach(e=>{let r=t(e);e.replaceWith(r,n)}),e}(r,e,t);let i=r.docs[0];if(!i)return r;let a=t.possessives&&i[i.length-1].tags.has("Possessive"),o=t.case&&(s=i[0].text,/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])(?:['a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u2019\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/.test(s)||/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])$/.test(s));var s;e=function(e,t){if("string"!==typeof e)return e;let n=t.groups();return e=e.replace(t$,e=>{let t=e.replace(/\$/,"");return n.hasOwnProperty(t)?n[t].text():e}),e}(e,r);let u=this.update(n);n=n.map(e=>e.slice(0,3));let l=(u.docs[0]||[]).map(e=>Array.from(e.tags)),c=u.docs[0][0].pre,h=u.docs[0][u.docs[0].length-1].post;if("string"===typeof e&&(e=this.fromText(e).compute("id")),r.insertAfter(e),u.has("@hasContraction")&&r.contractions){r.grow("@hasContraction+").contractions().expand()}if(r.delete(u),a){let e=r.docs[0],t=e[e.length-1];t.tags.has("Possessive")||(t.text+="'s",t.normal+="'s",t.tags.add("Possessive"))}if(c&&r.docs[0]&&(r.docs[0][0].pre=c),h&&r.docs[0]){let e=r.docs[0][r.docs[0].length-1];e.post.trim()||(e.post=h)}let d=r.toView(n).compute(["index","freeze","lexicon"]);if(d.world.compute.preTagger&&d.compute("preTagger"),d.compute("unfreeze"),t.tags&&d.terms().forEach((e,t)=>{e.tagSafe(l[t])}),!d.docs[0]||!d.docs[0][0])return d;if(t.case){let e=o?r$:i$;d.docs[0][0].text=e(d.docs[0][0].text)}return d},n$.replace=function(e,t,n){if(e&&!t)return this.replaceWith(e,n);let r=this.match(e);return r.found?(this.soften(),r.replaceWith(t,n)):this};const a$=n$,o$=function(e,t){t.forEach(t=>{let[n,r,i]=t,a=i-r;e[n]&&(i===e[n].length&&i>1&&function(e,t){let n=e.length-1,r=e[n],i=e[n-t];i&&r&&(i.post+=r.post,i.post=i.post.replace(/ +([.?!,;:])/,"$1"),i.post=i.post.replace(/[,;:]+([.?!])/,"$1"))}(e[n],a),e[n].splice(r,a))});for(let n=e.length-1;n>=0;n-=1)if(0===e[n].length&&(e.splice(n,1),n===e.length&&e[n-1])){let t=e[n-1],r=t[t.length-1];r&&(r.post=r.post.trimEnd())}return e},s$={remove:function(e){const{indexN:t}=this.methods.one.pointer;this.uncache();let n=this.all(),r=this;e&&(n=this,r=this.match(e));let i=!n.ptrs;if(r.has("@hasContraction")&&r.contractions){r.grow("@hasContraction").contractions().expand()}let a=n.fullPointer,o=r.fullPointer.reverse(),s=o$(this.document,o);return a=function(e,t){return e=e.map(e=>{let[n]=e;return t[n]?(t[n].forEach(t=>{let n=t[2]-t[1];e[1]<=t[1]&&e[2]>=t[2]&&(e[2]-=n)}),e):e}),e.forEach((t,n)=>{if(0===t[1]&&0==t[2])for(let r=n+1;r<e.length;r+=1)e[r][0]-=1,e[r][0]<0&&(e[r][0]=0)}),e=(e=e.filter(e=>e[2]-e[1]>0)).map(e=>(e[3]=null,e[4]=null,e))}(a,t(o)),n.ptrs=a,n.document=s,n.compute("index"),i&&(n.ptrs=void 0),e?n.toView(a):(this.ptrs=[],n.none())}};s$.delete=s$.remove;const u$=s$,l$={pre:function(e,t){return void 0===e&&this.found?this.docs[0][0].pre:(this.docs.forEach(n=>{let r=n[0];!0===t?r.pre+=e:r.pre=e}),this)},post:function(e,t){if(void 0===e){let e=this.docs[this.docs.length-1];return e[e.length-1].post}return this.docs.forEach(n=>{let r=n[n.length-1];!0===t?r.post+=e:r.post=e}),this},trim:function(){if(!this.found)return this;let e=this.docs,t=e[0][0];t.pre=t.pre.trimStart();let n=e[e.length-1],r=n[n.length-1];return r.post=r.post.trimEnd(),this},hyphenate:function(){return this.docs.forEach(e=>{e.forEach((t,n)=>{0!==n&&(t.pre=""),e[n+1]&&(t.post="-")})}),this},dehyphenate:function(){const e=/[-\u2013\u2014]/;return this.docs.forEach(t=>{t.forEach(t=>{e.test(t.post)&&(t.post=" ")})}),this},toQuotations:function(e,t){return e=e||'"',t=t||'"',this.docs.forEach(n=>{n[0].pre=e+n[0].pre;let r=n[n.length-1];r.post=t+r.post}),this},toParentheses:function(e,t){return e=e||"(",t=t||")",this.docs.forEach(n=>{n[0].pre=e+n[0].pre;let r=n[n.length-1];r.post=t+r.post}),this}};l$.deHyphenate=l$.dehyphenate,l$.toQuotation=l$.toQuotations;const c$=l$,h$={alpha:(e,t)=>e.normal<t.normal?-1:e.normal>t.normal?1:0,length:(e,t)=>{let n=e.normal.trim().length,r=t.normal.trim().length;return n<r?1:n>r?-1:0},wordCount:(e,t)=>e.words<t.words?1:e.words>t.words?-1:0,sequential:(e,t)=>e[0]<t[0]?1:e[0]>t[0]?-1:e[1]>t[1]?1:-1,byFreq:function(e){let t={};return e.forEach(e=>{t[e.normal]=t[e.normal]||0,t[e.normal]+=1}),e.sort((e,n)=>{let r=t[e.normal],i=t[n.normal];return r<i?1:r>i?-1:0}),e}},d$=new Set(["index","sequence","seq","sequential","chron","chronological"]),p$=new Set(["freq","frequency","topk","repeats"]),f$=new Set(["alpha","alphabetical"]),m$={unique:function(){let e=new Set,t=this.filter(t=>{let n=t.text("machine");return!e.has(n)&&(e.add(n),!0)});return t},reverse:function(){let e=this.pointer||this.docs.map((e,t)=>[t]);return e=[].concat(e),e=e.reverse(),this._cache&&(this._cache=this._cache.reverse()),this.update(e)},sort:function(e){let{docs:t,pointer:n}=this;if(this.uncache(),"function"===typeof e)return function(e,t){let n=e.fullPointer;return n=n.sort((n,r)=>(n=e.update([n]),r=e.update([r]),t(n,r))),e.ptrs=n,e}(this,e);e=e||"alpha";let r=n||t.map((e,t)=>[t]),i=t.map((e,t)=>({index:t,words:e.length,normal:e.map(e=>e.machine||e.normal||"").join(" "),pointer:r[t]}));return d$.has(e)&&(e="sequential"),f$.has(e)&&(e="alpha"),p$.has(e)?(i=h$.byFreq(i),this.update(i.map(e=>e.pointer))):"function"===typeof h$[e]?(i=i.sort(h$[e]),this.update(i.map(e=>e.pointer))):this}},g$=function(e,t){if(e.length>0){let t=e[e.length-1],n=t[t.length-1];!1===/ /.test(n.post)&&(n.post+=" ")}return e=e.concat(t)},v$={concat:function(e){if("string"===typeof e){let t=this.fromText(e);if(this.found&&this.ptrs){let e=this.fullPointer,n=e[e.length-1][0];this.document.splice(n,0,...t.document)}else this.document=this.document.concat(t.document);return this.all().compute("index")}if("object"===typeof e&&e.isView)return function(e,t){if(e.document===t.document){let n=e.fullPointer.concat(t.fullPointer);return e.toView(n).compute("index")}return t.fullPointer.forEach(t=>{t[0]+=e.document.length}),e.document=g$(e.document,t.docs),e.all()}(this,e);if(t=e,"[object Array]"===Object.prototype.toString.call(t)){let t=g$(this.document,e);return this.document=t,this.all()}var t;return this}},D$={harden:function(){return this.ptrs=this.fullPointer,this},soften:function(){let e=this.ptrs;return!e||e.length<1||(e=e.map(e=>e.slice(0,3)),this.ptrs=e),this}},y$=Object.assign({},{toLowerCase:function(){return this.termList().forEach(e=>{e.text=e.text.toLowerCase()}),this},toUpperCase:function(){return this.termList().forEach(e=>{e.text=e.text.toUpperCase()}),this},toTitleCase:function(){return this.termList().forEach(e=>{e.text=e.text.replace(/^ *[a-z\u00C0-\u00FF]/,e=>e.toUpperCase())}),this},toCamelCase:function(){return this.docs.forEach(e=>{e.forEach((t,n)=>{0!==n&&(t.text=t.text.replace(/^ *[a-z\u00C0-\u00FF]/,e=>e.toUpperCase())),n!==e.length-1&&(t.post="")})}),this}},e$,a$,u$,c$,m$,v$,D$),E$=function(e){Object.assign(e.prototype,y$)},A$={id:function(e){let t=e.docs;for(let n=0;n<t.length;n+=1)for(let e=0;e<t[n].length;e+=1){let r=t[n][e];r.id=r.id||YJ(r)}}},C$={api:E$,compute:A$},_$=!0,b$={one:{contractions:[{word:"@",out:["at"]},{word:"arent",out:["are","not"]},{word:"alot",out:["a","lot"]},{word:"brb",out:["be","right","back"]},{word:"cannot",out:["can","not"]},{word:"dun",out:["do","not"]},{word:"can't",out:["can","not"]},{word:"shan't",out:["should","not"]},{word:"won't",out:["will","not"]},{word:"that's",out:["that","is"]},{word:"what's",out:["what","is"]},{word:"let's",out:["let","us"]},{word:"dunno",out:["do","not","know"]},{word:"gonna",out:["going","to"]},{word:"gotta",out:["have","got","to"]},{word:"gimme",out:["give","me"]},{word:"outta",out:["out","of"]},{word:"tryna",out:["trying","to"]},{word:"gtg",out:["got","to","go"]},{word:"im",out:["i","am"]},{word:"imma",out:["I","will"]},{word:"imo",out:["in","my","opinion"]},{word:"irl",out:["in","real","life"]},{word:"ive",out:["i","have"]},{word:"rn",out:["right","now"]},{word:"tbh",out:["to","be","honest"]},{word:"wanna",out:["want","to"]},{word:"c'mere",out:["come","here"]},{word:"c'mon",out:["come","on"]},{word:"shoulda",out:["should","have"]},{word:"coulda",out:["coulda","have"]},{word:"woulda",out:["woulda","have"]},{word:"musta",out:["must","have"]},{word:"tis",out:["it","is"]},{word:"twas",out:["it","was"]},{word:"y'know",out:["you","know"]},{word:"ne'er",out:["never"]},{word:"o'er",out:["over"]},{after:"ll",out:["will"]},{after:"ve",out:["have"]},{after:"re",out:["are"]},{after:"m",out:["am"]},{before:"c",out:["ce"]},{before:"m",out:["me"]},{before:"n",out:["ne"]},{before:"qu",out:["que"]},{before:"s",out:["se"]},{before:"t",out:["tu"]},{word:"shouldnt",out:["should","not"]},{word:"couldnt",out:["could","not"]},{word:"wouldnt",out:["would","not"]},{word:"hasnt",out:["has","not"]},{word:"wasnt",out:["was","not"]},{word:"isnt",out:["is","not"]},{word:"cant",out:["can","not"]},{word:"dont",out:["do","not"]},{word:"wont",out:["will","not"]},{word:"howd",out:["how","did"]},{word:"whatd",out:["what","did"]},{word:"whend",out:["when","did"]},{word:"whered",out:["where","did"]}],numberSuffixes:{st:_$,nd:_$,rd:_$,th:_$,am:_$,pm:_$,max:_$,"\xb0":_$,s:_$,e:_$,er:_$,"\xe8re":_$,"\xe8me":_$}}},x$=function(e,t,n){let[r,i]=t;n&&0!==n.length&&(n=n.map((e,t)=>(e.implicit=e.text,e.machine=e.text,e.pre="",e.post="",e.text="",e.normal="",e.index=[r,i+t],e)),n[0]&&(n[0].pre=e[r][i].pre,n[n.length-1].post=e[r][i].post,n[0].text=e[r][i].text,n[0].normal=e[r][i].normal),e[r].splice(i,1,...n))},F$=/'/,w$=new Set(["what","how","when","where","why"]),S$=new Set(["be","go","start","think","need"]),T$=new Set(["been","gone"]),M$=function(e,t){let n=e[t].normal.split(F$)[0];if(w$.has(n))return[n,"did"];if(e[t+1]){if(T$.has(e[t+1].normal))return[n,"had"];if(S$.has(e[t+1].normal))return[n,"would"]}return null},B$=function(e,t){if("ain't"===e[t].normal||"aint"===e[t].normal)return null;return[e[t].normal.replace(/n't/,""),"not"]},P$=/'/,N$=/(e|\xe9|aison|sion|tion)$/,R$=/(age|isme|acle|ege|oire)$/,L$=(e,t)=>["je",e[t].normal.split(P$)[1]],I$=(e,t)=>{let n=e[t].normal.split(P$)[1];return n&&n.endsWith("e")?["la",n]:["le",n]},k$=(e,t)=>{let n=e[t].normal.split(P$)[1];return n&&N$.test(n)&&!R$.test(n)?["du",n]:n&&n.endsWith("s")?["des",n]:["de",n]},O$=/^([0-9.]{1,4}[a-z]{0,2}) ?[-\u2013\u2014] ?([0-9]{1,4}[a-z]{0,2})$/i,U$=/^([0-9]{1,2}(:[0-9][0-9])?(am|pm)?) ?[-\u2013\u2014] ?([0-9]{1,2}(:[0-9][0-9])?(am|pm)?)$/i,z$=/^[0-9]{3}-[0-9]{4}$/,V$=function(e,t){let n=e[t],r=n.text.match(O$);return null!==r?!0===n.tags.has("PhoneNumber")||z$.test(n.text)?null:[r[1],"to",r[2]]:(r=n.text.match(U$),null!==r?[r[1],"to",r[4]]:null)},G$=/^([+-]?[0-9][.,0-9]*)([a-z\xb0\xb2\xb3\xb5/]+)$/,H$=function(e,t,n){const r=n.model.one.numberSuffixes||{};let i=e[t].text.match(G$);if(null!==i){let e=i[2].toLowerCase().trim();return r.hasOwnProperty(e)?null:[i[1],e]}return null},j$=/'/,W$=/^[0-9][^-\u2013\u2014]*[-\u2013\u2014].*?[0-9]/,q$=function(e,t,n,r){let i=t.update();i.document=[e];let a=n+r;n>0&&(n-=1),e[a]&&(a+=1),i.ptrs=[[0,n,a]]},X$={t:(e,t)=>B$(e,t),d:(e,t)=>M$(e,t)},K$={j:(e,t)=>L$(e,t),l:(e,t)=>I$(e,t),d:(e,t)=>k$(e,t)},Y$=function(e,t,n,r){for(let i=0;i<e.length;i+=1){let a=e[i];if(a.word===t.normal)return a.out;if(null!==r&&r===a.after)return[n].concat(a.out);if(null!==n&&n===a.before&&r&&r.length>2)return a.out.concat(r)}return null},J$=function(e,t){let n=t.fromText(e.join(" "));return n.compute(["id","alias"]),n.docs[0]},$$=function(e,t){for(let n=t+1;n<5&&e[n];n+=1)if("been"===e[n].normal)return["there","has"];return["there","is"]},Q$=e=>{let{world:t,document:n}=e;const{model:r,methods:i}=t;let a=r.one.contractions||[];n.forEach((r,o)=>{for(let s=r.length-1;s>=0;s-=1){let u=null,l=null;if(!0===j$.test(r[s].normal)){let e=r[s].normal.split(j$);u=e[0],l=e[1]}let c=Y$(a,r[s],u,l);!c&&X$.hasOwnProperty(l)&&(c=X$[l](r,s,t)),!c&&K$.hasOwnProperty(u)&&(c=K$[u](r,s)),"there"===u&&"s"===l&&(c=$$(r,s)),c?(c=J$(c,e),x$(n,[o,s],c),q$(n[o],e,s,c.length)):W$.test(r[s].normal)?(c=V$(r,s),c&&(c=J$(c,e),x$(n,[o,s],c),i.one.setTag(c,"NumberRange",t),c[2]&&c[2].tags.has("Time")&&i.one.setTag([c[0]],"Time",t,null,"time-range"),q$(n[o],e,s,c.length))):(c=H$(r,s,t),c&&(c=J$(c,e),x$(n,[o,s],c),i.one.setTag([c[1]],"Unit",t,null,"contraction-unit")))}})},Z$={model:b$,compute:{contractions:Q$},hooks:["contractions"]},eQ=function(e){const t=e.world,{model:n,methods:r}=e.world,i=r.one.setTag,{frozenLex:a}=n.one,o=n.one._multiCache||{};e.docs.forEach(e=>{for(let n=0;n<e.length;n+=1){let r=e[n],s=r.machine||r.normal;if(void 0!==o[s]&&e[n+1]){for(let r=n+o[s]-1;r>n;r-=1){let o=e.slice(n,r+1),s=o.map(e=>e.machine||e.normal).join(" ");!0!==a.hasOwnProperty(s)||(i(o,a[s],t,!1,"1-frozen-multi-lexicon"),o.forEach(e=>e.frozen=!0))}}void 0!==a[s]&&a.hasOwnProperty(s)&&(i([r],a[s],t,!1,"1-freeze-lexicon"),r.frozen=!0)}})},tQ=e=>"\x1b[34m"+e+"\x1b[0m",nQ=e=>"\x1b[3m\x1b[2m"+e+"\x1b[0m",rQ=function(e){e.docs.forEach(e=>{console.log(tQ("\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")),e.forEach(e=>{let t="  ".concat(nQ("\u2502"),"  "),n=e.implicit||e.text||"-";!0===e.frozen?t+="".concat(tQ(n)," \u2744\ufe0f"):t+=nQ(n),console.log(t)})})},iQ={compute:{frozen:eQ,freeze:eQ,unfreeze:function(e){return e.docs.forEach(e=>{e.forEach(e=>{delete e.frozen})}),e}},mutate:e=>{const t=e.methods.one;t.termMethods.isFrozen=e=>!0===e.frozen,t.debug.freeze=rQ,t.debug.frozen=rQ},api:function(e){e.prototype.freeze=function(){return this.docs.forEach(e=>{e.forEach(e=>{e.frozen=!0})}),this},e.prototype.unfreeze=function(){this.compute("unfreeze")},e.prototype.isFrozen=function(){return this.match("@isFrozen+")}},hooks:["freeze"]},aQ=function(e,t,n){const{model:r,methods:i}=n,a=i.one.setTag,o=r.one._multiCache||{},{lexicon:s}=r.one||{};let u=e[t],l=u.machine||u.normal;if(void 0!==o[l]&&e[t+1]){for(let r=t+o[l]-1;r>t;r-=1){let i=e.slice(t,r+1);if(i.length<=1)return!1;let o=i.map(e=>e.machine||e.normal).join(" ");if(!0===s.hasOwnProperty(o)){let e=s[o];return a(i,e,n,!1,"1-multi-lexicon"),!e||2!==e.length||"PhrasalVerb"!==e[0]&&"PhrasalVerb"!==e[1]||a([i[1]],"Particle",n,!1,"1-phrasal-particle"),!0}}return!1}return null},oQ=/^(under|over|mis|re|un|dis|semi|pre|post)-?/,sQ=new Set(["Verb","Infinitive","PastTense","Gerund","PresentTense","Adjective","Participle"]),uQ=function(e,t,n){const{model:r,methods:i}=n,a=i.one.setTag,{lexicon:o}=r.one;let s=e[t],u=s.machine||s.normal;if(void 0!==o[u]&&o.hasOwnProperty(u))return a([s],o[u],n,!1,"1-lexicon"),!0;if(s.alias){let e=s.alias.find(e=>o.hasOwnProperty(e));if(e)return a([s],o[e],n,!1,"1-lexicon-alias"),!0}if(!0===oQ.test(u)){let e=u.replace(oQ,"");if(o.hasOwnProperty(e)&&e.length>3&&sQ.has(o[e]))return a([s],o[e],n,!1,"1-lexicon-prefix"),!0}return null},lQ={lexicon:function(e){const t=e.world;e.docs.forEach(e=>{for(let n=0;n<e.length;n+=1)if(0===e[n].tags.size){let r=null;r=r||aQ(e,n,t),r=r||uQ(e,n,t)}})}},cQ=function(e){let t={},n={};return Object.keys(e).forEach(r=>{let i=e[r],a=(r=(r=r.toLowerCase().trim()).replace(/'s\b/,"")).split(/ /);a.length>1&&(void 0===n[a[0]]||a.length>n[a[0]])&&(n[a[0]]=a.length),t[r]=t[r]||i}),delete t[""],delete t.null,delete t[" "],{lex:t,_multi:n}},hQ={addWords:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.world(),{methods:r,model:i}=n;if(!e)return;if(Object.keys(e).forEach(t=>{"string"===typeof e[t]&&e[t].startsWith("#")&&(e[t]=e[t].replace(/^#/,""))}),!0===t){let{lex:t,_multi:a}=r.one.expandLexicon(e,n);return Object.assign(i.one._multiCache,a),void Object.assign(i.one.frozenLex,t)}if(r.two.expandLexicon){let{lex:t,_multi:a}=r.two.expandLexicon(e,n);Object.assign(i.one.lexicon,t),Object.assign(i.one._multiCache,a)}let{lex:a,_multi:o}=r.one.expandLexicon(e,n);Object.assign(i.one.lexicon,a),Object.assign(i.one._multiCache,o)}},dQ={model:{one:{lexicon:{},_multiCache:{},frozenLex:{}}},methods:{one:{expandLexicon:cQ}},compute:lQ,lib:hQ,hooks:["lexicon"]},pQ=function(e,t){let n=[{}],r=[null],i=[0],a=[],o=0;e.forEach(function(e){let i=0,a=function(e,t){const{methods:n,model:r}=t;let i=n.one.tokenize.splitTerms(e,r).map(e=>n.one.tokenize.splitWhitespace(e,r));return i.map(e=>e.text.toLowerCase())}(e,t);for(let t=0;t<a.length;t++){let e=a[t];n[i]&&n[i].hasOwnProperty(e)?i=n[i][e]:(o++,n[i][e]=o,n[o]={},i=o,r[o]=null)}r[i]=[a.length]});for(let s in n[0])o=n[0][s],i[o]=0,a.push(o);for(;a.length;){let e=a.shift(),t=Object.keys(n[e]);for(let s=0;s<t.length;s+=1){let u=t[s],l=n[e][u];for(a.push(l),o=i[e];o>0&&!n[o].hasOwnProperty(u);)o=i[o];if(n.hasOwnProperty(o)){let e=n[o][u];i[l]=e,r[e]&&(r[l]=r[l]||[],r[l]=r[l].concat(r[e]))}else i[l]=0}}return{goNext:n,endAs:r,failTo:i}},fQ=function(e,t,n){let r=0,i=[];for(let a=0;a<e.length;a++){let o=e[a][n.form]||e[a].normal;for(;r>0&&(void 0===t.goNext[r]||!t.goNext[r].hasOwnProperty(o));)r=t.failTo[r]||0;if(t.goNext[r].hasOwnProperty(o)&&(r=t.goNext[r][o],t.endAs[r])){let n=t.endAs[r];for(let t=0;t<n.length;t++){let r=n[t],o=e[a-r+1],[s,u]=o.index;i.push([s,u,u+r,o.id])}}}return i},mQ=function(e,t){for(let n=0;n<e.length;n+=1)if(!0===t.has(e[n]))return!1;return!0},gQ=function(e,t,n){let r=[];n.form=n.form||"normal";let i=e.docs;if(!t.goNext||!t.goNext[0])return console.error("Compromise invalid lookup trie"),e.none();let a=Object.keys(t.goNext[0]);for(let o=0;o<i.length;o++){if(e._cache&&e._cache[o]&&!0===mQ(a,e._cache[o]))continue;let s=i[o],u=fQ(s,t,n);u.length>0&&(r=r.concat(u))}return e.update(r)};const vQ=(e,t)=>{for(let n=e.length-1;n>=0;n-=1)if(e[n]!==t)return e=e.slice(0,n+1);return e},DQ=function(e){return e.goNext=e.goNext.map(e=>{if(0!==Object.keys(e).length)return e}),e.goNext=vQ(e.goNext,void 0),e.failTo=vQ(e.failTo,0),e.endAs=vQ(e.endAs,null),e},yQ={buildTrie:function(e){const t=pQ(e,this.world());return DQ(t)}};yQ.compile=yQ.buildTrie;const EQ={api:function(e){e.prototype.lookup=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return this.none();"string"===typeof e&&(e=[e]);let n=(r=e,"[object Object]"===Object.prototype.toString.call(r)?e:pQ(e,this.world));var r;let i=gQ(this,n,t);return i=i.settle(),i}},lib:yQ},AQ=function(e,t){return t?(e.forEach(e=>{let n=e[0];t[n]&&(e[0]=t[n][0],e[1]+=t[n][1],e[2]+=t[n][1])}),e):e},CQ=function(e,t){let{ptrs:n,byGroup:r}=e;return n=AQ(n,t),Object.keys(r).forEach(e=>{r[e]=AQ(r[e],t)}),{ptrs:n,byGroup:r}},_Q=function(e,t,n){const r=n.methods.one;return"number"===typeof e&&(e=String(e)),"string"===typeof e&&(e=r.killUnicode(e,n),e=r.parseMatch(e,t,n)),e},bQ=e=>"[object Object]"===Object.prototype.toString.call(e),xQ=e=>e&&bQ(e)&&!0===e.isView,FQ=e=>e&&bQ(e)&&!0===e.isNet,wQ={matchOne:function(e,t,n){const r=this.methods.one;if(xQ(e))return this.intersection(e).eq(0);if(FQ(e))return this.sweep(e,{tagger:!1,matchOne:!0}).view;let i={regs:e=_Q(e,n,this.world),group:t,justOne:!0},a=r.match(this.docs,i,this._cache),{ptrs:o,byGroup:s}=CQ(a,this.fullPointer),u=this.toView(o);return u._groups=s,u},match:function(e,t,n){const r=this.methods.one;if(xQ(e))return this.intersection(e);if(FQ(e))return this.sweep(e,{tagger:!1}).view.settle();let i={regs:e=_Q(e,n,this.world),group:t},a=r.match(this.docs,i,this._cache),{ptrs:o,byGroup:s}=CQ(a,this.fullPointer),u=this.toView(o);return u._groups=s,u},has:function(e,t,n){const r=this.methods.one;if(xQ(e)){return this.intersection(e).fullPointer.length>0}if(FQ(e))return this.sweep(e,{tagger:!1}).view.found;let i={regs:e=_Q(e,n,this.world),group:t,justOne:!0};return r.match(this.docs,i,this._cache).ptrs.length>0},if:function(e,t,n){const r=this.methods.one;if(xQ(e))return this.filter(t=>t.intersection(e).found);if(FQ(e)){let t=this.sweep(e,{tagger:!1}).view.settle();return this.if(t)}let i={regs:e=_Q(e,n,this.world),group:t,justOne:!0},a=this.fullPointer,o=this._cache||[];a=a.filter((e,t)=>{let n=this.update([e]);return r.match(n.docs,i,o[t]).ptrs.length>0});let s=this.update(a);return this._cache&&(s._cache=a.map(e=>o[e[0]])),s},ifNo:function(e,t,n){const{methods:r}=this,i=r.one;if(xQ(e))return this.filter(t=>!t.intersection(e).found);if(FQ(e)){let t=this.sweep(e,{tagger:!1}).view.settle();return this.ifNo(t)}e=_Q(e,n,this.world);let a=this._cache||[],o=this.filter((n,r)=>{let o={regs:e,group:t,justOne:!0};return 0===i.match(n.docs,o,a[r]).ptrs.length});return this._cache&&(o._cache=o.ptrs.map(e=>a[e[0]])),o}},SQ={before:function(e,t,n){const{indexN:r}=this.methods.one.pointer;let i=[],a=r(this.fullPointer);Object.keys(a).forEach(e=>{let t=a[e].sort((e,t)=>e[1]>t[1]?1:-1)[0];t[1]>0&&i.push([t[0],0,t[1]])});let o=this.toView(i);return e?o.match(e,t,n):o},after:function(e,t,n){const{indexN:r}=this.methods.one.pointer;let i=[],a=r(this.fullPointer),o=this.document;Object.keys(a).forEach(e=>{let t=a[e].sort((e,t)=>e[1]>t[1]?-1:1)[0],[n,,r]=t;r<o[n].length&&i.push([n,r,o[n].length])});let s=this.toView(i);return e?s.match(e,t,n):s},growLeft:function(e,t,n){"string"===typeof e&&(e=this.world.methods.one.parseMatch(e,n,this.world)),e[e.length-1].end=!0;let r=this.fullPointer;return this.forEach((n,i)=>{let a=n.before(e,t);if(a.found){let e=a.terms();r[i][1]-=e.length,r[i][3]=e.docs[0][0].id}}),this.update(r)},growRight:function(e,t,n){"string"===typeof e&&(e=this.world.methods.one.parseMatch(e,n,this.world)),e[0].start=!0;let r=this.fullPointer;return this.forEach((n,i)=>{let a=n.after(e,t);if(a.found){let e=a.terms();r[i][2]+=e.length,r[i][4]=null}}),this.update(r)},grow:function(e,t,n){return this.growRight(e,t,n).growLeft(e,t,n)}},TQ=function(e,t){return[e[0],e[1],t[2]]},MQ=(e,t,n)=>{return"string"===typeof e||(r=e,"[object Array]"===Object.prototype.toString.call(r))?t.match(e,n):e||t.none();var r},BQ=function(e,t){let[n,r,i]=e;return t.document[n]&&t.document[n][r]&&(e[3]=e[3]||t.document[n][r].id,t.document[n][i-1]&&(e[4]=e[4]||t.document[n][i-1].id)),e},PQ={splitOn:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=MQ(e,this,t).fullPointer,i=n(this.fullPointer,r),a=[];return i.forEach(e=>{a.push(e.passthrough),a.push(e.before),a.push(e.match),a.push(e.after)}),a=a.filter(e=>e),a=a.map(e=>BQ(e,this)),this.update(a)},splitBefore:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=MQ(e,this,t).fullPointer,i=n(this.fullPointer,r);for(let o=0;o<i.length;o+=1)!i[o].after&&i[o+1]&&i[o+1].before&&i[o].match&&i[o].match[0]===i[o+1].before[0]&&(i[o].after=i[o+1].before,delete i[o+1].before);let a=[];return i.forEach(e=>{a.push(e.passthrough),a.push(e.before),e.match&&e.after?a.push(TQ(e.match,e.after)):a.push(e.match)}),a=a.filter(e=>e),a=a.map(e=>BQ(e,this)),this.update(a)},splitAfter:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=MQ(e,this,t).fullPointer,i=n(this.fullPointer,r),a=[];return i.forEach(e=>{a.push(e.passthrough),e.before&&e.match?a.push(TQ(e.before,e.match)):(a.push(e.before),a.push(e.match)),a.push(e.after)}),a=a.filter(e=>e),a=a.map(e=>BQ(e,this)),this.update(a)}};PQ.split=PQ.splitAfter;const NQ=PQ,RQ=function(e,t){return!(!e||!t)&&(e[0]===t[0]&&e[2]===t[1])},LQ=function(e,t,n){const r=e.world,i=r.methods.one.parseMatch;n=n||"^.";let a=i(t=t||".$",{},r),o=i(n,{},r);a[a.length-1].end=!0,o[0].start=!0;let s=e.fullPointer,u=[s[0]];for(let l=1;l<s.length;l+=1){let t=u[u.length-1],n=s[l],r=e.update([t]),i=e.update([n]);RQ(t,n)&&r.has(a)&&i.has(o)?u[u.length-1]=[t[0],t[1],n[2],t[3],n[4]]:u.push(n)}return e.update(u)},IQ={joinIf:function(e,t){return LQ(this,e,t)},join:function(){return LQ(this)}},kQ=Object.assign({},wQ,SQ,NQ,IQ);kQ.lookBehind=kQ.before,kQ.lookBefore=kQ.before,kQ.lookAhead=kQ.after,kQ.lookAfter=kQ.after,kQ.notIf=kQ.ifNo;const OQ=function(e){Object.assign(e.prototype,kQ)},UQ=/(?:^|\s)([![^]*(?:<[^<]*>)?\/.*?[^\\/]\/[?\]+*$~]*)(?:\s|$)/,zQ=/([!~[^]*(?:<[^<]*>)?\([^)]+[^\\)]\)[?\]+*$~]*)(?:\s|$)/,VQ=/ /g,GQ=e=>/^[![^]*(<[^<]*>)?\//.test(e)&&/\/[?\]+*$~]*$/.test(e),HQ=function(e){return e=(e=e.map(e=>e.trim())).filter(e=>e)},jQ=function(e){let t=e.split(UQ),n=[];t.forEach(e=>{GQ(e)?n.push(e):n=n.concat(e.split(zQ))}),n=HQ(n);let r=[];return n.forEach(e=>{(e=>/^[![^]*(<[^<]*>)?\(/.test(e)&&/\)[?\]+*$~]*$/.test(e))(e)||GQ(e)?r.push(e):r=r.concat(e.split(VQ))}),r=HQ(r),r},WQ=/\{([0-9]+)?(, *[0-9]*)?\}/,qQ=/&&/,XQ=new RegExp(/^<\s*(\S+)\s*>/),KQ=e=>e.charAt(0).toUpperCase()+e.substring(1),YQ=e=>e.charAt(e.length-1),JQ=e=>e.charAt(0),$Q=e=>e.substring(1),QQ=e=>e.substring(0,e.length-1),ZQ=function(e){return e=$Q(e),e=QQ(e)},eZ=function(e,t){let n={};for(let r=0;r<2;r+=1){if("$"===YQ(e)&&(n.end=!0,e=QQ(e)),"^"===JQ(e)&&(n.start=!0,e=$Q(e)),"?"===YQ(e)&&(n.optional=!0,e=QQ(e)),("["===JQ(e)||"]"===YQ(e))&&(n.group=null,"["===JQ(e)&&(n.groupStart=!0),"]"===YQ(e)&&(n.groupEnd=!0),e=(e=e.replace(/^\[/,"")).replace(/\]$/,""),"<"===JQ(e))){const t=XQ.exec(e);t.length>=2&&(n.group=t[1],e=e.replace(t[0],""))}if("+"===YQ(e)&&(n.greedy=!0,e=QQ(e)),"*"!==e&&"*"===YQ(e)&&"\\*"!==e&&(n.greedy=!0,e=QQ(e)),"!"===JQ(e)&&(n.negative=!0,e=$Q(e)),"~"===JQ(e)&&"~"===YQ(e)&&e.length>2&&(e=ZQ(e),n.fuzzy=!0,n.min=t.fuzzy||.85,!1===/\(/.test(e)))return n.word=e,n;if("/"===JQ(e)&&"/"===YQ(e))return e=ZQ(e),t.caseSensitive&&(n.use="text"),n.regex=new RegExp(e),n;if(!0===WQ.test(e)&&(e=e.replace(WQ,(e,t,r)=>(void 0===r?(n.min=Number(t),n.max=Number(t)):(r=r.replace(/, */,""),void 0===t?(n.min=0,n.max=Number(r)):(n.min=Number(t),n.max=Number(r||999))),n.greedy=!0,n.min||(n.optional=!0),""))),"("===JQ(e)&&")"===YQ(e)){qQ.test(e)?(n.choices=e.split(qQ),n.operator="and"):(n.choices=e.split("|"),n.operator="or"),n.choices[0]=$Q(n.choices[0]);let r=n.choices.length-1;n.choices[r]=QQ(n.choices[r]),n.choices=n.choices.map(e=>e.trim()),n.choices=n.choices.filter(e=>e),n.choices=n.choices.map(e=>e.split(/ /g).map(e=>eZ(e,t))),e=""}if("{"===JQ(e)&&"}"===YQ(e)){if(e=ZQ(e),n.root=e,/\//.test(e)){let e=n.root.split(/\//);n.root=e[0],n.pos=e[1],"adj"===n.pos&&(n.pos="Adjective"),n.pos=n.pos.charAt(0).toUpperCase()+n.pos.substr(1).toLowerCase(),void 0!==e[2]&&(n.sense=e[2])}return n}if("<"===JQ(e)&&">"===YQ(e))return e=ZQ(e),n.chunk=KQ(e),n.greedy=!0,n;if("%"===JQ(e)&&"%"===YQ(e))return e=ZQ(e),n.switch=e,n}return"#"===JQ(e)?(n.tag=$Q(e),n.tag=KQ(n.tag),n):"@"===JQ(e)?(n.method=$Q(e),n):"."===e?(n.anything=!0,n):"*"===e?(n.anything=!0,n.greedy=!0,n.optional=!0,n):(e&&(e=(e=e.replace("\\*","*")).replace("\\.","."),t.caseSensitive?n.use="text":e=e.toLowerCase(),n.word=e),n)},tZ=eZ,nZ=/[a-z0-9][-\u2013\u2014][a-z]/i,rZ=function(e,t){let n=t.model.one.prefixes;for(let r=e.length-1;r>=0;r-=1){let t=e[r];if(t.word&&nZ.test(t.word)){let i=t.word.split(/[-\u2013\u2014]/g);if(n.hasOwnProperty(i[0]))continue;i=i.filter(e=>e).reverse(),e.splice(r,1),i.forEach(n=>{let i=Object.assign({},t);i.word=n,e.splice(r,0,i)})}}return e},iZ=function(e,t){let{all:n}=t.methods.two.transform.verb||{},r=e.root;return n?n(r,t.model):[]},aZ=function(e,t){let{all:n}=t.methods.two.transform.noun||{};return n?n(e.root,t.model):[e.root]},oZ=function(e,t){let{all:n}=t.methods.two.transform.adjective||{};return n?n(e.root,t.model):[e.root]},sZ=function(e,t){return e=e.map(e=>{if(e.root)if(t.methods.two&&t.methods.two.transform){let n=[];e.pos?"Verb"===e.pos?n=n.concat(iZ(e,t)):"Noun"===e.pos?n=n.concat(aZ(e,t)):"Adjective"===e.pos&&(n=n.concat(oZ(e,t))):(n=n.concat(iZ(e,t)),n=n.concat(aZ(e,t)),n=n.concat(oZ(e,t))),n=n.filter(e=>e),n.length>0&&(e.operator="or",e.fastOr=new Set(n))}else e.machine=e.root,delete e.id,delete e.root;return e})},uZ=function(e){return e=function(e){let t=0,n=null;for(let r=0;r<e.length;r++){const i=e[r];!0===i.groupStart&&(n=i.group,null===n&&(n=String(t),t+=1)),null!==n&&(i.group=n),!0===i.groupEnd&&(n=null)}return e}(e),e=function(e){return e.map(e=>(e.fuzzy&&e.choices&&e.choices.forEach(t=>{1===t.length&&t[0].word&&(t[0].fuzzy=!0,t[0].min=e.min)}),e))}(e=e.map(e=>{if(void 0!==e.choices){if("or"!==e.operator)return e;if(!0===e.fuzzy)return e;!0===e.choices.every(e=>{if(1!==e.length)return!1;let t=e[0];return!0!==t.fuzzy&&!t.start&&!t.end&&void 0!==t.word&&!0!==t.negative&&!0!==t.optional&&!0!==t.method})&&(e.fastOr=new Set,e.choices.forEach(t=>{e.fastOr.add(t[0].word)}),delete e.choices)}return e})),e},lZ=function(e,t,n){if(null===e||void 0===e||""===e)return[];t=t||{},"number"===typeof e&&(e=String(e));let r=jQ(e);return r=r.map(e=>tZ(e,t)),r=rZ(r,n),r=sZ(r,n),r=uZ(r,t),r},cZ=function(e,t){for(let n of t)if(e.has(n))return!0;return!1},hZ=function(e,t){for(let n=0;n<e.length;n+=1){let r=e[n];if(!0!==r.optional&&!0!==r.negative&&!0!==r.fuzzy){if(void 0!==r.word&&!1===t.has(r.word))return!0;if(void 0!==r.tag&&!1===t.has("#"+r.tag))return!0;if(r.fastOr&&!1===cZ(r.fastOr,t))return!1}}return!1},dZ=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(e===t)return 1;if(e.length<n||t.length<n)return 0;const r=function(e,t){let n=e.length,r=t.length;if(0===n)return r;if(0===r)return n;let i=(r>n?r:n)+1;if(Math.abs(n-r)>(i||100))return i||100;let a,o,s,u,l,c,h=[];for(let d=0;d<i;d++)h[d]=[d],h[d].length=i;for(let d=0;d<i;d++)h[0][d]=d;for(let d=1;d<=n;++d)for(o=e[d-1],a=1;a<=r;++a){if(d===a&&h[d][a]>4)return n;s=t[a-1],u=o===s?0:1,l=h[d-1][a]+1,(c=h[d][a-1]+1)<l&&(l=c),(c=h[d-1][a-1]+u)<l&&(l=c);let r=d>1&&a>1&&o===t[a-2]&&e[d-2]===s&&(c=h[d-2][a-2]+u)<l;h[d][a]=r?c:l}return h[n][r]}(e,t);let i=Math.max(e.length,t.length);return 1-(0===i?0:r/i)},pZ=/([\u0022\uFF02\u0027\u201C\u2018\u201F\u201B\u201E\u2E42\u201A\u00AB\u2039\u2035\u2036\u2037\u301D\u0060\u301F])/,fZ=/([\u0022\uFF02\u0027\u201D\u2019\u00BB\u203A\u2032\u2033\u2034\u301E\u00B4])/,mZ=/^[-\u2013\u2014]$/,gZ=/ [-\u2013\u2014]{1,3} /,vZ=(e,t)=>-1!==e.post.indexOf(t),DZ={hasQuote:e=>pZ.test(e.pre)||fZ.test(e.post),hasComma:e=>vZ(e,","),hasPeriod:e=>!0===vZ(e,".")&&!1===vZ(e,"..."),hasExclamation:e=>vZ(e,"!"),hasQuestionMark:e=>vZ(e,"?")||vZ(e,"\xbf"),hasEllipses:e=>vZ(e,"..")||vZ(e,"\u2026"),hasSemicolon:e=>vZ(e,";"),hasColon:e=>vZ(e,":"),hasSlash:e=>/\//.test(e.text),hasHyphen:e=>mZ.test(e.post)||mZ.test(e.pre),hasDash:e=>gZ.test(e.post)||gZ.test(e.pre),hasContraction:e=>Boolean(e.implicit),isAcronym:e=>e.tags.has("Acronym"),isKnown:e=>e.tags.size>0,isTitleCase:e=>/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])['a-z\xC0-\xFF]/.test(e.text),isUpperCase:e=>/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])+$/.test(e.text)};DZ.hasQuotation=DZ.hasQuote;const yZ=DZ;let EZ=function(){};EZ=function(e,t,n,r){let i=function(e,t,n,r){if(!0===t.anything)return!0;if(!0===t.start&&0!==n)return!1;if(!0===t.end&&n!==r-1)return!1;if(void 0!==t.id&&t.id===e.id)return!0;if(void 0!==t.word){if(t.use)return t.word===e[t.use];if(null!==e.machine&&e.machine===t.word)return!0;if(void 0!==e.alias&&e.alias.hasOwnProperty(t.word))return!0;if(!0===t.fuzzy){if(t.word===e.root)return!0;if(dZ(t.word,e.normal)>=t.min)return!0}return!(!e.alias||!e.alias.some(e=>e===t.word))||t.word===e.text||t.word===e.normal}if(void 0!==t.tag)return!0===e.tags.has(t.tag);if(void 0!==t.method)return"function"===typeof yZ[t.method]&&!0===yZ[t.method](e);if(void 0!==t.pre)return e.pre&&e.pre.includes(t.pre);if(void 0!==t.post)return e.post&&e.post.includes(t.post);if(void 0!==t.regex){let n=e.normal;return t.use&&(n=e[t.use]),t.regex.test(n)}if(void 0!==t.chunk)return e.chunk===t.chunk;if(void 0!==t.switch)return e.switch===t.switch;if(void 0!==t.machine)return e.normal===t.machine||e.machine===t.machine||e.root===t.machine;if(void 0!==t.sense)return e.sense===t.sense;if(void 0!==t.fastOr){if(t.pos&&!e.tags.has(t.pos))return null;let n=e.root||e.implicit||e.machine||e.normal;return t.fastOr.has(n)||t.fastOr.has(e.text)}return void 0!==t.choices&&("and"===t.operator?t.choices.every(t=>EZ(e,t,n,r)):t.choices.some(t=>EZ(e,t,n,r)))}(e,t,n,r);return!0===t.negative?!i:i};const AZ=EZ,CZ=function(e,t){if(!0===e.end&&!0===e.greedy&&t.start_i+t.t<t.phrase_length-1){let n=Object.assign({},e,{end:!1});if(!0===AZ(t.terms[t.t],n,t.start_i+t.t,t.phrase_length))return!0}return!1},_Z=function(e,t){return e.groups[e.inGroup]||(e.groups[e.inGroup]={start:t,length:0}),e.groups[e.inGroup]},bZ=function(e){let{regs:t}=e,n=t[e.r],r=function(e,t){let n=e.t;if(!t)return e.terms.length;for(;n<e.terms.length;n+=1)if(!0===AZ(e.terms[n],t,e.start_i+n,e.phrase_length))return n;return null}(e,t[e.r+1]);if(null===r||0===r)return null;if(void 0!==n.min&&r-e.t<n.min)return null;if(void 0!==n.max&&r-e.t>n.max)return e.t=e.t+n.max,!0;if(!0===e.hasGroup){_Z(e,e.t).length=r-e.t}return e.t=r,!0},xZ=function(e){return"[object Array]"===Object.prototype.toString.call(e)},FZ=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.regs[e.r],r=!1;for(let i=0;i<n.choices.length;i+=1){let a=n.choices[i];if(!xZ(a))return!1;if(r=a.every((n,r)=>{let i=0,a=e.t+r+t+i;if(void 0===e.terms[a])return!1;let o=AZ(e.terms[a],n,a+e.start_i,e.phrase_length);if(!0===o&&!0===n.greedy)for(let t=1;t<e.terms.length;t+=1){let r=e.terms[a+t];if(r){if(!0!==AZ(r,n,e.start_i+t,e.phrase_length))break;i+=1}}return t+=i,o}),r){t+=a.length;break}}return r&&!0===n.greedy?FZ(e,t):t},wZ=function(e){const{regs:t}=e;let n=t[e.r],r=FZ(e);if(r){if(!0===n.negative)return null;if(!0===e.hasGroup){_Z(e,e.t).length+=r}if(!0===n.end){let t=e.phrase_length;if(e.t+e.start_i+r!==t)return null}return e.t+=r,!0}return!!n.optional||null},SZ=function(e){const{regs:t}=e;let n=t[e.r],r=function(e){let t=0;return!0===e.regs[e.r].choices.every(n=>{let r=n.every((t,n)=>{let r=e.t+n;return void 0!==e.terms[r]&&AZ(e.terms[r],t,r,e.phrase_length)});return!0===r&&n.length>t&&(t=n.length),r})&&t}(e);if(r){if(!0===n.negative)return null;if(!0===e.hasGroup){_Z(e,e.t).length+=r}if(!0===n.end){let t=e.phrase_length-1;if(e.t+e.start_i!==t)return null}return e.t+=r,!0}return!!n.optional||null},TZ=function(e,t,n){let r=0;for(let i=e.t;i<e.terms.length;i+=1){let a=AZ(e.terms[i],t,e.start_i+e.t,e.phrase_length);if(a)break;if(n&&(a=AZ(e.terms[i],n,e.start_i+e.t,e.phrase_length),a))break;if(r+=1,void 0!==t.max&&r===t.max)break}return 0!==r&&(!(t.min&&t.min>r)&&(e.t+=r,!0))},MZ=function(e){const{regs:t}=e;let n=t[e.r],r=Object.assign({},n);if(r.negative=!1,AZ(e.terms[e.t],r,e.start_i+e.t,e.phrase_length))return!1;if(n.optional){let n=t[e.r+1];if(n){if(AZ(e.terms[e.t],n,e.start_i+e.t,e.phrase_length))e.r+=1;else if(n.optional&&t[e.r+2]){AZ(e.terms[e.t],t[e.r+2],e.start_i+e.t,e.phrase_length)&&(e.r+=2)}}}return n.greedy?TZ(e,r,t[e.r+1]):(e.t+=1,!0)},BZ=function(e){const{regs:t}=e;let n=t[e.r],r=e.terms[e.t],i=AZ(r,t[e.r+1],e.start_i+e.t,e.phrase_length);if(n.negative||i){let n=e.terms[e.t+1];n&&AZ(n,t[e.r+1],e.start_i+e.t,e.phrase_length)||(e.r+=1)}},PZ=function(e){const{regs:t,phrase_length:n}=e;let r=t[e.r];return e.t=function(e,t){let n=Object.assign({},e.regs[e.r],{start:!1,end:!1}),r=e.t;for(;e.t<e.terms.length;e.t+=1){if(t&&AZ(e.terms[e.t],t,e.start_i+e.t,e.phrase_length))return e.t;let i=e.t-r+1;if(void 0!==n.max&&i===n.max)return e.t;if(!1===AZ(e.terms[e.t],n,e.start_i+e.t,e.phrase_length))return void 0!==n.min&&i<n.min?null:e.t}return e.t}(e,t[e.r+1]),null===e.t||r.min&&r.min>e.t?null:!0!==r.end||e.start_i+e.t===n||null},NZ=function(e){let t=e.terms[e.t],n=e.regs[e.r];if(t.implicit&&e.terms[e.t+1]){if(!e.terms[e.t+1].implicit)return;n.word===t.normal&&(e.t+=1),"hasContraction"===n.method&&(e.t+=1)}},RZ=function(e){const{regs:t}=e;let n=t[e.r],r=e.terms[e.t],i=e.t;if(n.optional&&t[e.r+1]&&n.negative)return!0;if(n.optional&&t[e.r+1]&&BZ(e),r.implicit&&e.terms[e.t+1]&&NZ(e),e.t+=1,!0===n.end&&e.t!==e.terms.length&&!0!==n.greedy)return null;if(!0===n.greedy){if(!PZ(e))return null}return!0===e.hasGroup&&function(e,t){let n=e.regs[e.r];const r=_Z(e,t);e.t>1&&n.greedy?r.length+=e.t-t:r.length++}(e,i),!0},LZ=function(e,t,n,r){if(0===e.length||0===t.length)return null;let i={t:0,terms:e,r:0,regs:t,groups:{},start_i:n,phrase_length:r,inGroup:null};for(;i.r<t.length;i.r+=1){let e=t[i.r];if(i.hasGroup=Boolean(e.group),!0===i.hasGroup?i.inGroup=e.group:i.inGroup=null,!i.terms[i.t]){if(!1===t.slice(i.r).some(e=>!e.optional))break;return null}if(!0!==e.anything||!0!==e.greedy)if(void 0===e.choices||"or"!==e.operator)if(void 0===e.choices||"and"!==e.operator)if(!0!==e.anything)if(!0!==CZ(e,i))if(e.negative){if(!MZ(i))return null}else if(!0!==AZ(i.terms[i.t],e,i.start_i+i.t,i.phrase_length)){if(!0!==e.optional)return null}else{if(!RZ(i))return null}else{if(!RZ(i))return null}else{if(e.negative&&e.anything)return null;if(!RZ(i))return null}else{if(!SZ(i))return null}else{if(!wZ(i))return null}else{if(!bZ(i))return null}}let a=[null,n,i.t+n];if(a[1]===a[2])return null;let o={};return Object.keys(i.groups).forEach(e=>{let t=i.groups[e],r=n+t.start;o[e]=[null,r,r+t.length]}),{pointer:a,groups:o}},IZ=function(e,t){let n=[],r={};return 0===e.length||("number"===typeof t&&(t=String(t)),t?e.forEach(e=>{e.groups[t]&&n.push(e.groups[t])}):e.forEach(e=>{n.push(e.pointer),Object.keys(e.groups).forEach(t=>{r[t]=r[t]||[],r[t].push(e.groups[t])})})),{ptrs:n,byGroup:r}},kZ=function(e,t,n){return e=e.filter(e=>{let[r,i,a]=e.pointer,o=n[r].slice(i,a);for(let n=0;n<o.length;n+=1){let e=o.slice(n);if(null!==LZ(e,t,n,o.length))return!1}return!0}),e},OZ=function(e,t){return e.pointer[0]=t,Object.keys(e.groups).forEach(n=>{e.groups[n][0]=t}),e},UZ=function(e,t,n){let r=LZ(e,t,0,e.length);return r?(r=OZ(r,n),r):null},zZ=function(e,t,n){n=n||[];let{regs:r,group:i,justOne:a}=t,o=[];if(!r||0===r.length)return{ptrs:[],byGroup:{}};const s=r.filter(e=>!0!==e.optional&&!0!==e.negative).length;e:for(let u=0;u<e.length;u+=1){let t=e[u];if(!n[u]||!hZ(r,n[u]))if(!0!==r[0].start)for(let e=0;e<t.length;e+=1){let n=t.slice(e);if(n.length<s)break;let i=LZ(n,r,e,t.length);if(i){if(i=OZ(i,u),o.push(i),!0===a)break e;let t=i.pointer[2];Math.abs(t-1)>e&&(e=Math.abs(t-1))}}else{let e=UZ(t,r,u);e&&o.push(e)}}return!0===r[r.length-1].end&&(o=o.filter(t=>{let n=t.pointer[0];return e[n].length===t.pointer[2]})),t.notIf&&(o=kZ(o,t.notIf,e)),o=IZ(o,i),o.ptrs.forEach(t=>{let[n,r,i]=t;t[3]=e[n][r].id,t[4]=e[n][i-1].id}),o},VZ={api:OQ,methods:{one:{termMethods:yZ,parseMatch:lZ,match:zZ}},lib:{parseMatch:function(e,t){const n=this.world();let r=n.methods.one.killUnicode;return r&&(e=r(e,n)),n.methods.one.parseMatch(e,t,n)}}},GZ=/^\../,HZ=/^#./,jZ=function(e,t){let n={},r={};return Object.keys(t).forEach(i=>{let a=t[i],o=function(e){let t="",n="</span>";return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),GZ.test(e)?t='<span class="'.concat(e.replace(/^\./,""),'"'):HZ.test(e)?t='<span id="'.concat(e.replace(/^#/,""),'"'):(t="<".concat(e),n="</".concat(e,">")),t+=">",{start:t,end:n}}(i);"string"===typeof a&&(a=e.match(a)),a.docs.forEach(e=>{if(e.every(e=>e.implicit))return;let t=e[0].id;n[t]=n[t]||[],n[t].push(o.start);let i=e[e.length-1].id;r[i]=r[i]||[],r[i].push(o.end)})}),{starts:n,ends:r}},WZ={html:function(e){let{starts:t,ends:n}=jZ(this,e),r="";return this.docs.forEach(e=>{for(let i=0;i<e.length;i+=1){let a=e[i];t.hasOwnProperty(a.id)&&(r+=t[a.id].join("")),r+=a.pre||"",r+=a.text||"",n.hasOwnProperty(a.id)&&(r+=n[a.id].join("")),r+=a.post||""}}),r}},qZ=/[,:;)\]*.?~!\u0022\uFF02\u201D\u2019\u00BB\u203A\u2032\u2033\u2034\u301E\u00B4\u2014-]+$/,XZ=/^[(['"*~\uFF02\u201C\u2018\u201F\u201B\u201E\u2E42\u201A\u00AB\u2039\u2035\u2036\u2037\u301D\u0060\u301F]+/,KZ=/[,:;)('"\u201D\]]/,YZ=/^[-\u2013\u2014]$/,JZ=/ /,$Z=function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r="";return e.forEach(e=>{let n=e.pre||"",i=e.post||"";"some"===t.punctuation&&(n=n.replace(XZ,""),YZ.test(i)&&(i=" "),i=i.replace(KZ,""),i=i.replace(/\?!+/,"?"),i=i.replace(/!+/,"!"),i=i.replace(/\?+/,"?"),i=i.replace(/\.{2,}/,""),e.tags.has("Abbreviation")&&(i=i.replace(/\./,""))),"some"===t.whitespace&&(n=n.replace(/\s/,""),i=i.replace(/\s+/," ")),t.keepPunct||(n=n.replace(XZ,""),i="-"===i?" ":i.replace(qZ,""));let a=e[t.form||"text"]||e.normal||"";"implicit"===t.form&&(a=e.implicit||e.text),"root"===t.form&&e.implicit&&(a=e.root||e.implicit||e.normal),"machine"!==t.form&&"implicit"!==t.form&&"root"!==t.form||!e.implicit||i&&JZ.test(i)||(i+=" "),r+=n+a+i}),!1===n&&(r=r.trim()),!0===t.lowerCase&&(r=r.toLowerCase()),r},QZ={text:{form:"text"},normal:{whitespace:"some",punctuation:"some",case:"some",unicode:"some",form:"normal"},machine:{keepSpace:!1,whitespace:"some",punctuation:"some",case:"none",unicode:"some",form:"machine"},root:{keepSpace:!1,whitespace:"some",punctuation:"some",case:"some",unicode:"some",form:"root"},implicit:{form:"implicit"}};QZ.clean=QZ.normal,QZ.reduced=QZ.root;const ZZ=QZ;let e0=[],t0=0;for(;t0<64;)e0[t0]=0|4294967296*Math.sin(++t0%Math.PI);const n0=function(e){let t,n,r,i=[t=1732584193,n=4023233417,~t,~n],a=[],o=decodeURI(encodeURI(e))+"\x80",s=o.length;for(e=--s/4+2|15,a[--e]=8*s;~s;)a[s>>2]|=o.charCodeAt(s)<<8*s--;for(t0=o=0;t0<e;t0+=16){for(s=i;o<64;s=[r=s[3],t+((r=s[0]+[t&n|~t&r,r&t|~r&n,t^n^r,n^(t|~r)][s=o>>4]+e0[o]+~~a[t0|15&[o,5*o+1,3*o+5,7*o][s]])<<(s=[7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][4*s+o++%4])|r>>>-s),t,n])t=0|s[1],n=s[2];for(o=4;o;)i[--o]+=s[o]}for(e="";o<32;)e+=(i[o>>3]>>4*(1^o++)&15).toString(16);return e},r0={text:!0,terms:!0};let i0={case:"none",unicode:"some",form:"machine",punctuation:"some"};const a0=function(e,t){return Object.assign({},e,t)},o0={text:e=>$Z(e,{keepPunct:!0},!1),normal:e=>$Z(e,a0(ZZ.normal,{keepPunct:!0}),!1),implicit:e=>$Z(e,a0(ZZ.implicit,{keepPunct:!0}),!1),machine:e=>$Z(e,i0,!1),root:e=>$Z(e,a0(i0,{form:"root"}),!1),hash:e=>n0($Z(e,{keepPunct:!0},!1)),offset:e=>{let t=o0.text(e).length;return{index:e[0].offset.index,start:e[0].offset.start,length:t}},terms:e=>e.map(e=>{let t=Object.assign({},e);return t.tags=Array.from(e.tags),t}),confidence:(e,t,n)=>t.eq(n).confidence(),syllables:(e,t,n)=>t.eq(n).syllables(),sentence:(e,t,n)=>t.eq(n).fullSentence().text(),dirty:e=>e.some(e=>!0===e.dirty)};o0.sentences=o0.sentence,o0.clean=o0.normal,o0.reduced=o0.root;const s0={json:function(e){let t=(n=this,"string"===typeof(r=(r=e)||{})&&(r={}),(r=Object.assign({},r0,r)).offset&&n.compute("offset"),n.docs.map((e,t)=>{let i={};return Object.keys(r).forEach(a=>{r[a]&&o0[a]&&(i[a]=o0[a](e,n,t))}),i}));var n,r;return"number"===typeof e?t[e]:t}};s0.data=s0.json;const u0=s0,l0=function(e){let t=this.methods.one.debug||{};return e&&t.hasOwnProperty(e)?(t[e](this),this):"undefined"!==typeof window&&window.document?(t.clientSide(this),this):(t.tags(this),this)},c0=function(e){let t=e.pre||"",n=e.post||"";return t+e.text+n},h0=function(e,t){let n=function(e,t){let n={};return Object.keys(t).forEach(r=>{e.match(r).fullPointer.forEach(e=>{n[e[3]]={fn:t[r],end:e[2]}})}),n}(e,t),r="";return e.docs.forEach((t,i)=>{for(let a=0;a<t.length;a+=1){let o=t[a];if(n.hasOwnProperty(o.id)){let{fn:s,end:u}=n[o.id],l=e.update([[i,a,u]]);r+=t[a].pre||"",r+=s(l),a=u-1,r+=t[a].post||""}else r+=c0(o)}}),r},d0={debug:l0,out:function(e){if(t=e,"[object Object]"===Object.prototype.toString.call(t))return h0(this,e);var t;if("text"===e)return this.text();if("normal"===e)return this.text("normal");if("root"===e)return this.text("root");if("machine"===e||"reduced"===e)return this.text("machine");if("hash"===e||"md5"===e)return n0(this.text());if("json"===e)return this.json();if("offset"===e||"offsets"===e)return this.compute("offset"),this.json({offset:!0});if("array"===e){let e=this.docs.map(e=>e.reduce((e,t)=>e+t.pre+t.text+t.post,"").trim());return e.filter(e=>e)}if("freq"===e||"frequency"===e||"topk"===e)return function(e){let t={};e.forEach(e=>{t[e]=t[e]||0,t[e]+=1});let n=Object.keys(t).map(e=>({normal:e,count:t[e]}));return n.sort((e,t)=>e.count>t.count?-1:0)}(this.json({normal:!0}).map(e=>e.normal));if("terms"===e){let e=[];return this.docs.forEach(t=>{let n=t.map(e=>e.text);n=n.filter(e=>e),e=e.concat(n)}),e}return"tags"===e?this.docs.map(e=>e.reduce((e,t)=>(e[t.implicit||t.normal]=Array.from(t.tags),e),{})):"debug"===e?this.debug():this.text()},wrap:function(e){return h0(this,e)}},p0=d0,f0={text:function(e){let t={};var n;if(e&&"string"===typeof e&&ZZ.hasOwnProperty(e)?t=Object.assign({},ZZ[e]):e&&(n=e,"[object Object]"===Object.prototype.toString.call(n))&&(t=Object.assign({},e)),void 0!==t.keepSpace||this.isFull()||(t.keepSpace=!1),void 0===t.keepEndPunct&&this.pointer){let e=this.pointer[0];e&&e[1]?t.keepEndPunct=!1:t.keepEndPunct=!0}return void 0===t.keepPunct&&(t.keepPunct=!0),void 0===t.keepSpace&&(t.keepSpace=!0),function(e,t){let n="";if(!e||!e[0]||!e[0][0])return n;for(let r=0;r<e.length;r+=1)n+=$Z(e[r],t,!0);if(t.keepSpace||(n=n.trim()),!1===t.keepEndPunct){e[0][0].tags.has("Emoticon")||(n=n.replace(XZ,""));let t=e[e.length-1];t[t.length-1].tags.has("Emoticon")||(n=n.replace(qZ,"")),n.endsWith("'")&&!n.endsWith("s'")&&(n=n.replace(/'/,""))}return!0===t.cleanWhitespace&&(n=n.trim()),n}(this.docs,t)}},m0=Object.assign({},p0,f0,u0,WZ),g0=function(e){Object.assign(e.prototype,m0)},v0=function(e){console.log("%c -=-=- ","background-color:#6699cc;"),e.forEach(e=>{console.groupCollapsed(e.text());let t=e.docs[0].map(e=>{let t=e.text||"-";return e.implicit&&(t="["+e.implicit+"]"),{text:t,tags:"["+Array.from(e.tags).join(", ")+"]"}});console.table(t,["text","tags"]),console.groupEnd()})},D0="\x1b[0m",y0={green:e=>"\x1b[32m"+e+D0,red:e=>"\x1b[31m"+e+D0,blue:e=>"\x1b[34m"+e+D0,magenta:e=>"\x1b[35m"+e+D0,cyan:e=>"\x1b[36m"+e+D0,yellow:e=>"\x1b[33m"+e+D0,black:e=>"\x1b[30m"+e+D0,dim:e=>"\x1b[2m"+e+D0,i:e=>"\x1b[3m"+e+D0},E0=function(e){let{docs:t,model:n}=e;0===t.length&&console.log(y0.blue("\n     \u2500\u2500\u2500\u2500\u2500\u2500")),t.forEach(t=>{console.log(y0.blue("\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")),t.forEach(t=>{let r=[...t.tags||[]],i=t.text||"-";t.sense&&(i="{".concat(t.normal,"/").concat(t.sense,"}")),t.implicit&&(i="["+t.implicit+"]"),i=y0.yellow(i);let a="'"+i+"'";if(t.reference){let n=e.update([t.reference]).text("normal");a+=" - ".concat(y0.dim(y0.i("["+n+"]")))}a=a.padEnd(18);let o=y0.blue("  \u2502 ")+y0.i(a)+"  - "+function(e,t){return t.one.tagSet&&(e=e.map(e=>{if(!t.one.tagSet.hasOwnProperty(e))return e;const n=t.one.tagSet[e].color||"blue";return y0[n](e)})),e.join(", ")}(r,n);console.log(o)})}),console.log("\n")},A0=function(e){let{docs:t}=e;console.log(""),t.forEach(e=>{let t=[];e.forEach(e=>{"Noun"===e.chunk?t.push(y0.blue(e.implicit||e.normal)):"Verb"===e.chunk?t.push(y0.green(e.implicit||e.normal)):"Adjective"===e.chunk?t.push(y0.yellow(e.implicit||e.normal)):"Pivot"===e.chunk?t.push(y0.red(e.implicit||e.normal)):t.push(e.implicit||e.normal)}),console.log(t.join(" "),"\n")}),console.log("\n")},C0=function(e){if(!e.found)return;let t={};e.fullPointer.forEach(e=>{t[e[0]]=t[e[0]]||[],t[e[0]].push(e)}),Object.keys(t).forEach(n=>{let r=e.update([[Number(n)]]).text();e.update(t[n]).json({offset:!0}).forEach((e,t)=>{r=function(e,t,n){let r=((e,t,n)=>{let r=9*n,i=t.start+r,a=i+t.length;return[e.substring(0,i),e.substring(i,a),e.substring(a,e.length)]})(e,t,n);return"".concat(r[0]).concat(y0.blue(r[1])).concat(r[2])}(r,e.offset,t)}),console.log(r)}),console.log("\n")},_0={api:g0,methods:{one:{hash:n0,debug:{tags:E0,clientSide:v0,chunks:A0,highlight:C0}}}},b0=function(e,t){if(e[0]!==t[0])return!1;let[,n,r]=e,[,i,a]=t;return n<=i&&r>i||i<=n&&a>n},x0=function(e){let t={};return e.forEach(e=>{t[e[0]]=t[e[0]]||[],t[e[0]].push(e)}),t},F0=function(e,t){let n=x0(t),r=[];return e.forEach(e=>{let[t]=e,i=n[t]||[];if(i=i.filter(t=>function(e,t){return e[1]<=t[1]&&t[2]<=e[2]}(e,t)),0===i.length)return void r.push({passthrough:e});i=i.sort((e,t)=>e[1]-t[1]);let a=e;i.forEach((e,t)=>{let n=function(e,t){let[n,r]=e,i=t[1],a=t[2],o={};if(r<i){let t=i<e[2]?i:e[2];o.before=[n,r,t]}return o.match=t,e[2]>a&&(o.after=[n,a,e[2]]),o}(a,e);i[t+1]?(r.push({before:n.before,match:n.match}),n.after&&(a=n.after)):r.push(n)})}),r},w0=function(e,t){let n=[];return e.forEach((r,i)=>{if(!r)return;let[a,o,s,u,l]=r,c=t[a]||[];if(void 0===o&&(o=0),void 0===s&&(s=c.length),!u||c[o]&&c[o].id===u)c=c.slice(o,s);else{let n=function(e,t,n){for(let r=0;r<20;r+=1){if(t[n-r]){let i=t[n-r].findIndex(t=>t.id===e);if(-1!==i)return[n-r,i]}if(t[n+r]){let i=t[n+r].findIndex(t=>t.id===e);if(-1!==i)return[n+r,i]}}return null}(u,t,a);if(null!==n){let r=s-o;c=t[n[0]].slice(n[1],n[1]+r);let a=c[0]?c[0].id:null;e[i]=[n[0],n[1],n[1]+r,a]}}0!==c.length&&o!==s&&(l&&c[c.length-1].id!==l&&(c=function(e,t){let[n,r,,,i]=e,a=t[n],o=a.findIndex(e=>e.id===i);return-1===o?(e[2]=t[n].length,e[4]=a.length?a[a.length-1].id:null):e[2]=o,t[n].slice(r,e[2]+1)}(r,t)),n.push(c))}),n=n.filter(e=>e.length>0),n},S0={one:{termList:function(e){let t=[];for(let n=0;n<e.length;n+=1)for(let r=0;r<e[n].length;r+=1)t.push(e[n][r]);return t},getDoc:w0,pointer:{indexN:x0,splitAll:F0}}},T0=function(e,t){let n=e.concat(t),r=x0(n),i=[];return n.forEach(e=>{let[t]=e;if(1===r[t].length)return void i.push(e);let n=r[t].filter(t=>b0(e,t));n.push(e);let a=function(e){let t=e[0][1],n=e[0][2];return e.forEach(e=>{e[1]<t&&(t=e[1]),e[2]>n&&(n=e[2])}),[e[0][0],t,n]}(n);i.push(a)}),i=function(e){let t={};for(let n=0;n<e.length;n+=1)t[e[n].join(",")]=e[n];return Object.values(t)}(i),i},M0=function(e,t){let n=[];return F0(e,t).forEach(e=>{e.passthrough&&n.push(e.passthrough),e.before&&n.push(e.before),e.after&&n.push(e.after)}),n},B0=function(e,t){let n=x0(t),r=[];return e.forEach(e=>{let t=n[e[0]]||[];t=t.filter(t=>b0(e,t)),0!==t.length&&t.forEach(t=>{let n=function(e,t){let n=e[1]<t[1]?t[1]:e[1],r=e[2]>t[2]?t[2]:e[2];return n<r?[e[0],n,r]:null}(e,t);n&&r.push(n)})}),r},P0=(e,t)=>{return"string"===typeof e||(n=e,"[object Array]"===Object.prototype.toString.call(n))?t.match(e):e||t.none();var n},N0=function(e,t){return e.map(e=>{let[n,r]=e;return t[n]&&t[n][r]&&(e[3]=t[n][r].id),e})},R0={union:function(e){e=P0(e,this);let t=T0(this.fullPointer,e.fullPointer);return t=N0(t,this.document),this.toView(t)}};R0.and=R0.union,R0.intersection=function(e){e=P0(e,this);let t=B0(this.fullPointer,e.fullPointer);return t=N0(t,this.document),this.toView(t)},R0.not=function(e){e=P0(e,this);let t=M0(this.fullPointer,e.fullPointer);return t=N0(t,this.document),this.toView(t)},R0.difference=R0.not,R0.complement=function(){let e=this.all(),t=M0(e.fullPointer,this.fullPointer);return t=N0(t,this.document),this.toView(t)},R0.settle=function(){let e=this.fullPointer;return e.forEach(t=>{e=T0(e,[t])}),e=N0(e,this.document),this.update(e)};const L0=function(e){Object.assign(e.prototype,R0)},I0={methods:S0,api:L0},k0=function(e){e.prototype.sweep=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{world:n,docs:r}=this,{methods:i}=n;let a=i.one.bulkMatch(r,e,this.methods,t);!1!==t.tagger&&i.one.bulkTagger(a,r,this.world),a=a.map(e=>{let t=e.pointer,n=r[t[0]][t[1]],i=t[2]-t[1];return n.index&&(e.pointer=[n.index[0],n.index[1],t[1]+i]),e});let o=a.map(e=>e.pointer);return a=a.map(e=>(e.view=this.update([e.pointer]),delete e.regs,delete e.needs,delete e.pointer,delete e._expanded,e)),{view:this.update(o),found:a}}},O0=function(e){return!0===e.optional||!0===e.negative?null:e.tag?"#"+e.tag:e.word?e.word:e.switch?"%".concat(e.switch,"%"):null},U0=function(e,t){const n=t.methods.one.parseMatch;return e.forEach(e=>{e.regs=n(e.match,{},t),"string"===typeof e.ifNo&&(e.ifNo=[e.ifNo]),e.notIf&&(e.notIf=n(e.notIf,{},t)),e.needs=function(e){let t=[];return e.forEach(e=>{t.push(O0(e)),"and"===e.operator&&e.choices&&e.choices.forEach(e=>{e.forEach(e=>{t.push(O0(e))})})}),t.filter(e=>e)}(e.regs);let{wants:r,count:i}=function(e){let t=[],n=0;return e.forEach(e=>{"or"!==e.operator||e.optional||e.negative||(e.fastOr&&Array.from(e.fastOr).forEach(e=>{t.push(e)}),e.choices&&e.choices.forEach(e=>{e.forEach(e=>{let n=O0(e);n&&t.push(n)})}),n+=1)}),{wants:t,count:n}}(e.regs);e.wants=r,e.minWant=i,e.minWords=e.regs.filter(e=>!e.optional).length}),e},z0=function(e,t){e=U0(e,t);let n={};e.forEach(e=>{e.needs.forEach(t=>{n[t]=Array.isArray(n[t])?n[t]:[],n[t].push(e)}),e.wants.forEach(t=>{n[t]=Array.isArray(n[t])?n[t]:[],n[t].push(e)})}),Object.keys(n).forEach(e=>{let t={};n[e]=n[e].filter(e=>"boolean"!==typeof t[e.match]&&(t[e.match]=!0,!0))});let r=e.filter(e=>0===e.needs.length&&0===e.wants.length);return{hooks:n,always:r}},V0=function(e,t){return e.map((n,r)=>{let i=[];Object.keys(t).forEach(n=>{e[r].has(n)&&(i=i.concat(t[n]))});let a={};return i=i.filter(e=>"boolean"!==typeof a[e.match]&&(a[e.match]=!0,!0)),i})},G0=function(e,t){return e.map((e,n)=>{let r=t[n];return e=(e=(e=e.filter(e=>e.needs.every(e=>r.has(e)))).filter(e=>void 0===e.ifNo||!0!==e.ifNo.some(e=>r.has(e)))).filter(e=>{if(0===e.wants.length)return!0;return e.wants.filter(e=>r.has(e)).length>=e.minWant})})},H0=function(e,t,n,r,i){let a=[];for(let o=0;o<e.length;o+=1)for(let n=0;n<e[o].length;n+=1){let s=e[o][n],u=r.one.match([t[o]],s);if(u.ptrs.length>0&&(u.ptrs.forEach(e=>{e[0]=o;let t=Object.assign({},s,{pointer:e});void 0!==s.unTag&&(t.unTag=s.unTag),a.push(t)}),!0===i.matchOne))return[a[0]]}return a},j0=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.one.cacheDoc(e),a=V0(i,t.hooks);return a=G0(a,i,e),t.always.length>0&&(a=a.map(e=>e.concat(t.always))),a=function(e,t){return e.map((e,n)=>{let r=t[n].length;return e=e.filter(e=>r>=e.minWords),e})}(a,e),H0(a,e,i,n,r)},W0=function(e,t,n){let r=n.one.tagSet;if(!r.hasOwnProperty(t))return!0;let i=r[t].not||[];for(let a=0;a<e.length;a+=1){let t=e[a];for(let e=0;e<i.length;e+=1)if(!0===t.tags.has(i[e]))return!1}return!0},q0=function(e,t,n){const{model:r,methods:i}=n,{getDoc:a,setTag:o,unTag:s}=i.one,u=i.two.looksPlural;if(0===e.length)return e;return("undefined"===typeof process?self.env||{}:{NODE_ENV:"production",PUBLIC_URL:"/gaia_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).DEBUG_TAGS&&console.log("\n\n  \x1b[32m\u2192 ".concat(e.length," post-tagger:\x1b[0m")),e.map(e=>{if(!e.tag&&!e.chunk&&!e.unTag)return;let i=e.reason||e.match,l=a([e.pointer],t)[0];if(!0===e.safe){if(!1===W0(l,e.tag,r))return;if("-"===l[l.length-1].post)return}if(void 0!==e.tag){if(o(l,e.tag,n,e.safe,"[post] '".concat(i,"'")),"Noun"===e.tag&&u){let t=l[l.length-1];u(t.text)?o([t],"Plural",n,e.safe,"quick-plural"):o([t],"Singular",n,e.safe,"quick-singular")}!0===e.freeze&&l.forEach(e=>e.frozen=!0)}void 0!==e.unTag&&s(l,e.unTag,n,e.safe,i),e.chunk&&l.forEach(t=>t.chunk=e.chunk)})},X0={lib:{buildNet:function(e){let t=this.methods().one.buildNet(e,this.world());return t.isNet=!0,t}},api:k0,methods:{one:{buildNet:z0,bulkMatch:j0,bulkTagger:q0}}},K0=/ /,Y0=function(e,t){"Noun"===t&&(e.chunk=t),"Verb"===t&&(e.chunk=t)},J0=function(e,t,n,r){if(!0===e.tags.has(t))return null;if("."===t)return null;!0===e.frozen&&(r=!0);let i=n[t];if(i){if(i.not&&i.not.length>0)for(let t=0;t<i.not.length;t+=1){if(!0===r&&e.tags.has(i.not[t]))return null;e.tags.delete(i.not[t])}if(i.parents&&i.parents.length>0)for(let t=0;t<i.parents.length;t+=1)e.tags.add(i.parents[t]),Y0(e,i.parents[t])}return e.tags.add(t),e.dirty=!0,Y0(e,t),!0},$0=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;const a=n.model.one.tagSet||{};if(!t)return;const o="undefined"===typeof process?self.env||{}:{NODE_ENV:"production",PUBLIC_URL:"/gaia_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0};var s;if(o&&o.DEBUG_TAGS&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=e.map(e=>e.text||"["+e.implicit+"]").join(" ");var i;"string"!==typeof t&&t.length>2&&(t=t.slice(0,2).join(", #")+" +"),t="string"!==typeof t?t.join(", #"):t,console.log(" ".concat((i=r,"\x1b[33m\x1b[3m"+i+"\x1b[0m").padEnd(24)," \x1b[32m\u2192\x1b[0m #").concat(t.padEnd(22),"  ").concat((e=>"\x1b[3m"+e+"\x1b[0m")(n)))}(e,t,i),!0!==(s=t,"[object Array]"===Object.prototype.toString.call(s)))if("string"===typeof t)if(t=t.trim(),K0.test(t))!function(e,t,n,r){let i=t.split(K0);e.forEach((e,t)=>{let a=i[t];a&&(a=a.replace(/^#/,""),J0(e,a,n,r))})}(e,t,a,r);else{t=t.replace(/^#/,"");for(let n=0;n<e.length;n+=1)J0(e[n],t,a,r)}else console.warn("compromise: Invalid tag '".concat(t,"'"));else t.forEach(t=>$0(e,t,n,r))},Q0=$0,Z0=function(e,t,n){t=t.trim().replace(/^#/,"");for(let r=0;r<e.length;r+=1){let i=e[r];if(!0===i.frozen)continue;if("*"===t){i.tags.clear();continue}let a=n[t];if(a&&a.children.length>0)for(let e=0;e<a.children.length;e+=1)i.tags.delete(a.children[e]);i.tags.delete(t)}},e1=function(e,t,n){if(!n.hasOwnProperty(t))return!0;let r=n[t].not||[];for(let i=0;i<r.length;i+=1)if(e.tags.has(r[i]))return!1;return!0},t1=function(e){return e.children=e.children||[],e._cache=e._cache||{},e.props=e.props||{},e._cache.parents=e._cache.parents||[],e._cache.children=e._cache.children||[],e},n1=/^ *(#|\/\/)/,r1=function(e){let t=e.trim().split(/->/),n=[];t.forEach(e=>{n=n.concat(function(e){if(!(e=e.trim()))return null;if(/^\[/.test(e)&&/\]$/.test(e)){let t=(e=(e=e.replace(/^\[/,"")).replace(/\]$/,"")).split(/,/);return t=t.map(e=>e.trim()).filter(e=>e),t=t.map(e=>t1({id:e})),t}return[t1({id:e})]}(e))}),n=n.filter(e=>e);let r=n[0];for(let i=1;i<n.length;i+=1)r.children.push(n[i]),r=n[i];return n[0]},i1=(e,t)=>{let n=[],r=[e];for(;r.length>0;){let e=r.pop();n.push(e),e.children&&e.children.forEach(n=>{t&&t(e,n),r.push(n)})}return n},a1=e=>"[object Array]"===Object.prototype.toString.call(e),o1=e=>(e=e||"").trim(),s1=function(e,t){let n="-> ";t&&(n=(e=>"\x1b[2m"+e+"\x1b[0m")("\u2192 "));let r="";return i1(e).forEach((e,i)=>{let a=e.id||"";if(t&&(a=(e=>"\x1b[31m"+e+"\x1b[0m")(a)),0===i&&!e.id)return;let o=e._cache.parents.length;r+="    ".repeat(o)+n+a+"\n"}),r},u1=function(e){let t=i1(e);t.forEach(e=>{delete(e=Object.assign({},e)).children});let n=t[0];return n&&!n.id&&0===Object.keys(n.props).length&&t.shift(),t},l1={text:s1,txt:s1,array:u1,flat:u1},c1=function(e,t){return"nested"===t||"json"===t?e:"debug"===t?(console.log(s1(e,!0)),null):l1.hasOwnProperty(t)?l1[t](e):e},h1=e=>{i1(e,(e,t)=>{e.id&&(e._cache.parents=e._cache.parents||[],t._cache.parents=e._cache.parents.concat([e.id]))})},d1=/\//;class p1{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.defineProperty(this,"json",{enumerable:!1,value:e,writable:!0})}get children(){return this.json.children}get id(){return this.json.id}get found(){return this.json.id||this.json.children.length>0}props(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.json.props||{};return"string"==typeof e&&(t[e]=!0),this.json.props=Object.assign(t,e),this}get(e){if(e=o1(e),!d1.test(e)){let t=this.json.children.find(t=>t.id===e);return new p1(t)}let t=((e,t)=>{let n=(e=>"string"!=typeof e?e:(e=e.replace(/^\//,"")).split(/\//))(t=t||"");for(let r=0;r<n.length;r+=1){let t=e.children.find(e=>e.id===n[r]);if(!t)return null;e=t}return e})(this.json,e)||t1({});return new p1(t)}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a1(e))return e.forEach(e=>this.add(o1(e),t)),this;e=o1(e);let n=t1({id:e,props:t});return this.json.children.push(n),new p1(n)}remove(e){return e=o1(e),this.json.children=this.json.children.filter(t=>t.id!==e),this}nodes(){return i1(this.json).map(e=>(delete(e=Object.assign({},e)).children,e))}cache(){return(e=>{let t=i1(e,(e,t)=>{e.id&&(e._cache.parents=e._cache.parents||[],e._cache.children=e._cache.children||[],t._cache.parents=e._cache.parents.concat([e.id]))}),n={};t.forEach(e=>{e.id&&(n[e.id]=e)}),t.forEach(e=>{e._cache.parents.forEach(t=>{n.hasOwnProperty(t)&&n[t]._cache.children.push(e.id)})}),e._cache.children=Object.keys(n)})(this.json),this}list(){return i1(this.json)}fillDown(){var e;return e=this.json,i1(e,(e,t)=>{t.props=((e,t)=>(Object.keys(t).forEach(n=>{if(t[n]instanceof Set){let r=e[n]||new Set;e[n]=new Set([...r,...t[n]])}else if((e=>e&&"object"==typeof e&&!Array.isArray(e))(t[n])){let r=e[n]||{};e[n]=Object.assign({},t[n],r)}else a1(t[n])?e[n]=t[n].concat(e[n]||[]):void 0===e[n]&&(e[n]=t[n])}),e))(t.props,e.props)}),this}depth(){h1(this.json);let e=i1(this.json),t=e.length>1?1:0;return e.forEach(e=>{if(0===e._cache.parents.length)return;let n=e._cache.parents.length+1;n>t&&(t=n)}),t}out(e){return h1(this.json),c1(this.json,e)}debug(){return h1(this.json),c1(this.json,"debug"),this}}const f1=function(e){let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return"string"==typeof e?function(e){let t=e.split(/\r?\n/),n=[];t.forEach(e=>{if(!e.trim()||n1.test(e))return;let t=(e=>{const t=/^( {2}|\t)/;let n=0;for(;t.test(e);)e=e.replace(t,""),n+=1;return n})(e);n.push({indent:t,node:r1(e)})});let r=function(e){let t={children:[]};return e.forEach((n,r)=>{0===n.indent?t.children=t.children.concat(n.node):e[r-1]&&function(e,t){let n=e[t].indent;for(;t>=0;t-=1)if(e[t].indent<n)return e[t];return e[0]}(e,r).node.children.push(n.node)}),t}(n);return r=t1(r),r}(e):a1(e)?function(e){let t={};e.forEach(e=>{t[e.id]=e});let n=t1({});return e.forEach(e=>{if((e=t1(e)).parent)if(t.hasOwnProperty(e.parent)){let n=t[e.parent];delete e.parent,n.children.push(e)}else console.warn("[Grad] - missing node '".concat(e.parent,"'"));else n.children.push(e)}),n}(e):(i1(t=e).forEach(t1),t);var t}(e);return new p1(t)};f1.prototype.plugin=function(e){e(this)};const m1={Noun:"blue",Verb:"green",Negative:"green",Date:"red",Value:"red",Adjective:"magenta",Preposition:"cyan",Conjunction:"cyan",Determiner:"cyan",Hyphenated:"cyan",Adverb:"cyan"},g1=function(e){if(m1.hasOwnProperty(e.id))return m1[e.id];if(m1.hasOwnProperty(e.is))return m1[e.is];let t=e._cache.parents.find(e=>m1[e]);return m1[t]},v1=function(e){const t={};return e.forEach(e=>{let{not:n,also:r,is:i,novel:a}=e.props,o=e._cache.parents;r&&(o=o.concat(r)),t[e.id]={is:i,not:n,novel:a,also:r,parents:o,children:e._cache.children,color:g1(e)}}),Object.keys(t).forEach(e=>{let n=new Set(t[e].not);t[e].not.forEach(e=>{t[e]&&t[e].children.forEach(e=>n.add(e))}),t[e].not=Array.from(n)}),t},D1=function(e){return e?"string"===typeof e?[e]:e:[]},y1=function(e,t){return e=function(e,t){return Object.keys(e).forEach(n=>{e[n].isA&&(e[n].is=e[n].isA),e[n].notA&&(e[n].not=e[n].notA),e[n].is&&"string"===typeof e[n].is&&(t.hasOwnProperty(e[n].is)||e.hasOwnProperty(e[n].is)||(e[e[n].is]={})),e[n].not&&"string"===typeof e[n].not&&!e.hasOwnProperty(e[n].not)&&(t.hasOwnProperty(e[n].not)||e.hasOwnProperty(e[n].not)||(e[e[n].not]={}))}),e}(e,t),Object.keys(e).forEach(t=>{e[t].children=D1(e[t].children),e[t].not=D1(e[t].not)}),Object.keys(e).forEach(t=>{(e[t].not||[]).forEach(n=>{e[n]&&e[n].not&&e[n].not.push(t)})}),e},E1=function(e,t){Object.keys(t).length>0&&(e=function(e){return Object.keys(e).forEach(t=>{e[t]=Object.assign({},e[t]),e[t].novel=!0}),e}(e)),e=y1(e,t);const n=function(e){const t=Object.keys(e).map(t=>{let n=e[t];const r={not:new Set(n.not),also:n.also,is:n.is,novel:n.novel};return{id:t,parent:n.is,props:r,children:[]}});return f1(t).cache().fillDown().out("array")}(Object.assign({},t,e));return v1(n)},A1={one:{setTag:Q0,unTag:Z0,addTags:E1,canBe:e1}},C1=function(e){return"[object Array]"===Object.prototype.toString.call(e)},_1={tag:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;if(!this.found||!e)return this;let r=this.termList();if(0===r.length)return this;const{methods:i,verbose:a,world:o}=this;return!0===a&&console.log(" +  ",e,t||""),C1(e)?e.forEach(e=>i.one.setTag(r,e,o,n,t)):i.one.setTag(r,e,o,n,t),this.uncache(),this},tagSafe:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.tag(e,t,!0)},unTag:function(e,t){if(!this.found||!e)return this;let n=this.termList();if(0===n.length)return this;const{methods:r,verbose:i,model:a}=this;!0===i&&console.log(" -  ",e,t||"");let o=a.one.tagSet;return C1(e)?e.forEach(e=>r.one.unTag(n,e,o)):r.one.unTag(n,e,o),this.uncache(),this},canBe:function(e){e=e.replace(/^#/,"");let t=this.model.one.tagSet,n=this.methods.one.canBe,r=[];this.document.forEach((i,a)=>{i.forEach((i,o)=>{n(i,e,t)||r.push([a,o,o+1])})});let i=this.update(r);return this.difference(i)}},b1=_1,x1=function(e){Object.assign(e.prototype,b1)},F1={addTags:function(e){const{model:t,methods:n}=this.world(),r=t.one.tagSet;let i=(0,n.one.addTags)(e,r);return t.one.tagSet=i,this}},w1=new Set(["Auxiliary","Possessive"]),S1=function(e){const{document:t,world:n}=e,r=n.model.one.tagSet;t.forEach(e=>{e.forEach(e=>{let t=Array.from(e.tags);e.tagRank=function(e,t){return e=e.sort((e,n)=>{if(w1.has(e)||!t.hasOwnProperty(n))return 1;if(w1.has(n)||!t.hasOwnProperty(e))return-1;let r=t[e].children||[],i=r.length;return r=t[n].children||[],i-r.length}),e}(t,r)})})},T1={model:{one:{tagSet:{}}},compute:{tagRank:S1},methods:A1,api:x1,lib:F1},M1=/([.!?\u203D\u2E18\u203C\u2047-\u2049\u3002]+\s)/g,B1=/^[.!?\u203D\u2E18\u203C\u2047-\u2049\u3002]+\s$/,P1=/((?:\r?\n|\r)+)/,N1=function(e){let t=[],n=e.split(P1);for(let r=0;r<n.length;r++){let e=n[r].split(M1);for(let n=0;n<e.length;n++)e[n+1]&&!0===B1.test(e[n+1])&&(e[n]+=e[n+1],e[n+1]=""),""!==e[n]&&t.push(e[n])}return t},R1=/[a-z0-9\u00C0-\u00FF\u00a9\u00ae\u2000-\u3300\ud000-\udfff]/i,L1=/\S/,I1=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(void 0!==r&&""!==r){if(!1===L1.test(r)||!1===R1.test(r)){if(t[t.length-1]){t[t.length-1]+=r;continue}if(e[n+1]){e[n+1]=r+e[n+1];continue}}t.push(r)}}return t},k1=function(e,t){const n=t.methods.one.tokenize.isSentence,r=t.model.one.abbreviations||new Set;let i=[];for(let a=0;a<e.length;a++){let t=e[a];e[a+1]&&!1===n(t,r)?e[a+1]=t+(e[a+1]||""):t&&t.length>0&&(i.push(t),e[a]="")}return i},O1={'"':'"',"\uff02":"\uff02","\u201c":"\u201d","\u201f":"\u201d","\u201e":"\u201d","\u2e42":"\u201d","\u201a":"\u2019","\xab":"\xbb","\u2039":"\u203a","\u2035":"\u2032","\u2036":"\u2033","\u2037":"\u2034","\u301d":"\u301e","\u301f":"\u301e"},U1=RegExp("["+Object.keys(O1).join("")+"]","g"),z1=RegExp("["+Object.values(O1).join("")+"]","g"),V1=function(e){if(!e)return!1;let t=e.match(z1);return null!==t&&1===t.length},G1=function(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n].match(U1);if(null!==r&&1===r.length){if(V1(e[n+1])&&e[n+1].length<280){e[n]+=e[n+1],t.push(e[n]),e[n+1]="",n+=1;continue}if(V1(e[n+2])){let r=e[n+1]+e[n+2];if(r.length<280){e[n]+=r,t.push(e[n]),e[n+1]="",e[n+2]="",n+=2;continue}}}t.push(e[n])}return t},H1=/\(/g,j1=/\)/g,W1=function(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n].match(H1);if(null!==r&&1===r.length&&e[n+1]&&e[n+1].length<250){if(null!==e[n+1].match(j1)&&1===r.length&&!H1.test(e[n+1])){e[n]+=e[n+1],t.push(e[n]),e[n+1]="",n+=1;continue}}t.push(e[n])}return t},q1=/\S/,X1=/^\s+/,K1=function(e,t){if(e=e||"",!(e=String(e))||"string"!==typeof e||!1===q1.test(e))return[];e=e.replace("\xa0"," ");let n=N1(e),r=I1(n);if(r=k1(r,t),r=G1(r),r=W1(r),0===r.length)return[e];for(let i=1;i<r.length;i+=1){let e=r[i].match(X1);null!==e&&(r[i-1]+=e[0],r[i]=r[i].replace(X1,""))}return r},Y1=function(e,t){let n=e.split(/[-\u2013\u2014]/);if(n.length<=1)return!1;const{prefixes:r,suffixes:i}=t.one;if(1===n[0].length&&/[a-z]/i.test(n[0]))return!1;if(r.hasOwnProperty(n[0]))return!1;if(n[1]=n[1].trim().replace(/[.?!]$/,""),i.hasOwnProperty(n[1]))return!1;if(!0===/^([a-z\u00C0-\u00FF`"'/]+)[-\u2013\u2014]([a-z0-9\u00C0-\u00FF].*)/i.test(e))return!0;return!0===/^[('"]?([0-9]{1,4})[-\u2013\u2014]([a-z\u00C0-\u00FF`"'/-]+[)'"]?$)/i.test(e)},J1=function(e){let t=[];const n=e.split(/[-\u2013\u2014]/);let r="-",i=e.match(/[-\u2013\u2014]/);i&&i[0]&&(r=i);for(let a=0;a<n.length;a++)a===n.length-1?t.push(n[a]):t.push(n[a]+r);return t},$1=function(e){const t=/^[0-9]{1,4}(:[0-9][0-9])?([a-z]{1,2})? ?[-\u2013\u2014] ?$/,n=/^[0-9]{1,4}([a-z]{1,2})? ?$/;for(let r=0;r<e.length-1;r+=1)e[r+1]&&t.test(e[r])&&n.test(e[r+1])&&(e[r]=e[r]+e[r+1],e[r+1]=null);return e},Q1=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF]) ?\/ ?(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])+$/,Z1=function(e){for(let t=1;t<e.length-1;t++)Q1.test(e[t])&&(e[t-1]+=e[t]+e[t+1],e[t]=null,e[t+1]=null);return e},e2=/\S/,t2=/^[!?.]+$/,n2=/(\S+)/;let r2=[".","?","!",":",";","-","\u2013","\u2014","--","...","(",")","[","]",'"',"'","`","\xab","\xbb","*","\u2022"];r2=r2.reduce((e,t)=>(e[t]=!0,e),{});const i2=function(e,t){let n=[],r=[];if("number"===typeof(e=e||"")&&(e=String(e)),function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e))return e;const i=e.split(n2);for(let o=0;o<i.length;o++)!0!==Y1(i[o],t)?r.push(i[o]):r=r.concat(J1(i[o]));let a="";for(let o=0;o<r.length;o++){let e=r[o];!0===e2.test(e)&&!1===r2.hasOwnProperty(e)&&!1===t2.test(e)?(n.length>0?(n[n.length-1]+=a,n.push(e)):n.push(a+e),a=""):a+=e}return a&&(0===n.length&&(n[0]=""),n[n.length-1]+=a),n=Z1(n),n=$1(n),n=n.filter(e=>e),n},a2=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])/,o2=/(?:[\$0-9\xA2-\xA5\xB2\xB3\xB9\xBC-\xBE\u058F\u060B\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u07FE\u07FF\u0966-\u096F\u09E6-\u09EF\u09F2-\u09F9\u09FB\u0A66-\u0A6F\u0AE6-\u0AEF\u0AF1\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0BF9\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E3F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17DB\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u20A0-\u20C0\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA838\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFDFC\uFE69\uFF04\uFF10-\uFF19\uFFE0\uFFE1\uFFE5\uFFE6]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDD40-\uDD49\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDED0-\uDEE3\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59\uDFF0-\uDFF9]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDF50-\uDF59\uDFC0-\uDFD4\uDFDD-\uDFE0]|\uD809[\uDC00-\uDC6E]|\uD818[\uDD30-\uDD39]|\uD81A[\uDE60-\uDE69\uDEC0-\uDEC9\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDD70-\uDD79\uDE80-\uDE96]|\uD833[\uDCF0-\uDCF9]|\uD834[\uDEC0-\uDED3\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9\uDEFF]|\uD839[\uDCF0-\uDCF9\uDDF1-\uDDFA]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9])/,s2=/^[a-z]\.([a-z]\.)+/i,u2=/[sn]['\u2019]$/,l2=function(e,t){let{prePunctuation:n,postPunctuation:r,emoticons:i}=t.one,a=e,o="",s="",u=Array.from(e);if(i.hasOwnProperty(e.trim()))return{str:e.trim(),pre:o,post:" "};let l=u.length;for(let c=0;c<l;c+=1){let e=u[0];if(!0!==n[e]){if(("+"===e||"-"===e)&&o2.test(u[1]))break;if("'"===e&&3===e.length&&o2.test(u[1]))break;if(a2.test(e)||o2.test(e))break;o+=u.shift()}}l=u.length;for(let c=0;c<l;c+=1){let e=u[u.length-1];if(!0!==r[e]){if(a2.test(e)||o2.test(e))break;"."===e&&!0===s2.test(a)||"'"===e&&!0===u2.test(a)||(s=u.pop()+s)}}return""===(e=u.join(""))&&(a=a.replace(/ *$/,e=>(s=e||"","")),e=a,o=""),{str:e,pre:o,post:s}},c2=(e,t)=>{let{str:n,pre:r,post:i}=l2(e,t);return{text:n,pre:r,post:i,tags:new Set}},h2=function(e,t){const n=t.model.one.unicode||{};let r=(e=e||"").split("");return r.forEach((e,t)=>{n[e]&&(r[t]=n[e])}),r.join("")},d2=function(e){let t=e=(e=(e=e||"").toLowerCase()).trim();return e=(e=(e=e.replace(/[,;.!?]+$/,"")).replace(/\u2026/g,"...")).replace(/\u2013/g,"-"),!1===/^[:;]/.test(e)&&(e=(e=(e=e.replace(/\.{3,}$/g,"")).replace(/[",.!:;?)]+$/g,"")).replace(/^['"(]+/g,"")),""===(e=(e=e.replace(/[\u200B-\u200D\uFEFF]/g,"")).trim())&&(e=t),e=e.replace(/([0-9]),([0-9])/g,"$1$2")},p2=/([A-Z]\.)+[A-Z]?,?$/,f2=/^[A-Z]\.,?$/,m2=/[A-Z]{2,}('s|,)?$/,g2=/([a-z]\.)+[a-z]\.?$/,v2=function(e){return function(e){return!0===p2.test(e)||!0===g2.test(e)||!0===f2.test(e)||!0===m2.test(e)}(e)&&(e=e.replace(/\./g,"")),e},D2=function(e,t){const n=t.methods.one.killUnicode;let r=e.text||"";r=d2(r),r=n(r,t),r=v2(r),e.normal=r},y2=function(e,t){const{methods:n,model:r}=t,{splitSentences:i,splitTerms:a,splitWhitespace:o}=n.one.tokenize;return e=i(e=e||"",t).map(e=>{let n=a(e,r);return n=n.map(e=>o(e,r)),n.forEach(e=>{D2(e,t)}),n}),e},E2=/[ .][A-Z]\.? *$/i,A2=/(?:\u2026|\.{2,}) *$/,C2=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])/,_2=/\. *$/,b2=/^[A-Z]\. $/,x2={one:{killUnicode:h2,tokenize:{splitSentences:K1,isSentence:function(e,t){if(!1===C2.test(e))return!1;if(!0===E2.test(e))return!1;if(3===e.length&&b2.test(e))return!1;if(!0===A2.test(e))return!1;let n=e.replace(/[.!?\u203D\u2E18\u203C\u2047-\u2049] *$/,"").split(" "),r=n[n.length-1].toLowerCase();return!0!==t.hasOwnProperty(r)||!0!==_2.test(e)},splitTerms:i2,splitWhitespace:c2,fromString:y2}}},F2={"&":"and","@":"at","%":"percent",plz:"please",bein:"being"};let w2={},S2={};[[["approx","apt","bc","cyn","eg","esp","est","etc","ex","exp","prob","pron","gal","min","pseud","fig","jd","lat","lng","vol","fm","def","misc","plz","ea","ps","sec","pt","pref","pl","pp","qt","fr","sq","nee","ss","tel","temp","vet","ver","fem","masc","eng","adj","vb","rb","inf","situ","vivo","vitro","wr"]],[["dl","ml","gal","qt","pt","tbl","tsp","tbsp","km","dm","cm","mm","mi","td","hr","hrs","kg","hg","dg","cg","mg","\xb5g","lb","oz","sq ft","hz","mps","mph","kmph","kb","mb","tb","lx","lm","fl oz","yb"],"Unit"],[["ad","al","arc","ba","bl","ca","cca","col","corp","ft","fy","ie","lit","ma","md","pd","tce"],"Noun"],[["adj","adm","adv","asst","atty","bldg","brig","capt","cmdr","comdr","cpl","det","dr","esq","gen","gov","hon","jr","llb","lt","maj","messrs","mlle","mme","mr","mrs","ms","mstr","phd","prof","pvt","rep","reps","res","rev","sen","sens","sfc","sgt","sir","sr","supt","surg"],"Honorific"],[["jan","feb","mar","apr","jun","jul","aug","sep","sept","oct","nov","dec"],"Month"],[["dept","univ","assn","bros","inc","ltd","co"],"Organization"],[["rd","st","dist","mt","ave","blvd","cl","cres","hwy","ariz","cal","calif","colo","conn","fla","fl","ga","ida","ia","kan","kans","minn","neb","nebr","okla","penna","penn","pa","dak","tenn","tex","ut","vt","va","wis","wisc","wy","wyo","usafa","alta","ont","que","sask"],"Place"]].forEach(e=>{e[0].forEach(t=>{w2[t]=!0,S2[t]="Abbreviation",void 0!==e[1]&&(S2[t]=[S2[t],e[1]])})});const T2=["anti","bi","co","contra","de","extra","infra","inter","intra","macro","micro","mis","mono","multi","peri","pre","pro","proto","pseudo","re","sub","supra","trans","tri","un","out","ex"].reduce((e,t)=>(e[t]=!0,e),{});let M2={"!":"\xa1","?":"\xbf\u0241",'"':'\u201c\u201d"\u275d\u275e',"'":"\u2018\u201b\u275b\u275c\u2019","-":"\u2014\u2013",a:"\xaa\xc0\xc1\xc2\xc3\xc4\xc5\xe0\xe1\xe2\xe3\xe4\xe5\u0100\u0101\u0102\u0103\u0104\u0105\u01cd\u01ce\u01de\u01df\u01e0\u01e1\u01fa\u01fb\u0200\u0201\u0202\u0203\u0226\u0227\u023a\u0386\u0391\u0394\u039b\u03ac\u03b1\u03bb\u0410\u0430\u0466\u0467\u04d0\u04d1\u04d2\u04d3\u019b\xe6",b:"\xdf\xfe\u0180\u0181\u0182\u0183\u0184\u0185\u0243\u0392\u03b2\u03d0\u03e6\u0411\u0412\u042a\u042c\u0432\u044a\u044c\u0462\u0463\u048c\u048d",c:"\xa2\xa9\xc7\xe7\u0106\u0107\u0108\u0109\u010a\u010b\u010c\u010d\u0186\u0187\u0188\u023b\u023c\u037b\u037c\u03f2\u03f9\u03fd\u03fe\u0421\u0441\u0454\u0480\u0481\u04aa\u04ab",d:"\xd0\u010e\u010f\u0110\u0111\u0189\u018a\u0221\u018b\u018c",e:"\xc8\xc9\xca\xcb\xe8\xe9\xea\xeb\u0112\u0113\u0114\u0115\u0116\u0117\u0118\u0119\u011a\u011b\u0190\u0204\u0205\u0206\u0207\u0228\u0229\u0246\u0247\u0388\u0395\u039e\u03a3\u03ad\u03b5\u03be\u03f5\u0400\u0401\u0415\u0435\u0450\u0451\u04bc\u04bd\u04be\u04bf\u04d6\u04d7\u1ec5",f:"\u0191\u0192\u03dc\u03dd\u04fa\u04fb\u0492\u0493\u017f",g:"\u011c\u011d\u011e\u011f\u0120\u0121\u0122\u0123\u0193\u01e4\u01e5\u01e6\u01e7\u01f4\u01f5",h:"\u0124\u0125\u0126\u0127\u0195\u01f6\u021e\u021f\u0389\u0397\u0402\u040a\u040b\u041d\u043d\u0452\u045b\u04a2\u04a3\u04a4\u04a5\u04ba\u04bb\u04c9\u04ca",I:"\xcc\xcd\xce\xcf",i:"\xec\xed\xee\xef\u0128\u0129\u012a\u012b\u012c\u012d\u012e\u012f\u0130\u0131\u0196\u0197\u0208\u0209\u020a\u020b\u038a\u0390\u03aa\u03af\u03b9\u03ca\u0406\u0407\u0456\u0457i\u0307",j:"\u0134\u0135\u01f0\u0237\u0248\u0249\u03f3\u0408\u0458",k:"\u0136\u0137\u0138\u0198\u0199\u01e8\u01e9\u039a\u03ba\u040c\u0416\u041a\u0436\u043a\u045c\u049a\u049b\u049c\u049d\u049e\u049f\u04a0\u04a1",l:"\u0139\u013a\u013b\u013c\u013d\u013e\u013f\u0140\u0141\u0142\u019a\u01aa\u01c0\u01cf\u01d0\u0234\u023d\u0399\u04c0\u04cf",m:"\u039c\u03fa\u03fb\u041c\u043c\u04cd\u04ce",n:"\xd1\xf1\u0143\u0144\u0145\u0146\u0147\u0148\u0149\u014a\u014b\u019d\u019e\u01f8\u01f9\u0220\u0235\u039d\u03a0\u03ae\u03b7\u03de\u040d\u0418\u0419\u041b\u041f\u0438\u0439\u043b\u043f\u045d\u048a\u048b\u04c5\u04c6\u04e2\u04e3\u04e4\u04e5\u03c0",o:"\xd2\xd3\xd4\xd5\xd6\xd8\xf0\xf2\xf3\xf4\xf5\xf6\xf8\u014c\u014d\u014e\u014f\u0150\u0151\u019f\u01a0\u01a1\u01d1\u01d2\u01ea\u01eb\u01ec\u01ed\u01fe\u01ff\u020c\u020d\u020e\u020f\u022a\u022b\u022c\u022d\u022e\u022f\u0230\u0231\u038c\u0398\u039f\u03b8\u03bf\u03c3\u03cc\u03d5\u03d8\u03d9\u03ec\u03f4\u041e\u0424\u043e\u0472\u0473\u04e6\u04e7\u04e8\u04e9\u04ea\u04eb",p:"\u01a4\u03a1\u03c1\u03f7\u03f8\u03fc\u0420\u0440\u048e\u048f\xde",q:"\u024a\u024b",r:"\u0154\u0155\u0156\u0157\u0158\u0159\u01a6\u0210\u0211\u0212\u0213\u024c\u024d\u0403\u0413\u042f\u0433\u044f\u0453\u0490\u0491",s:"\u015a\u015b\u015c\u015d\u015e\u015f\u0160\u0161\u01a7\u01a8\u0218\u0219\u023f\u0405\u0455",t:"\u0162\u0163\u0164\u0165\u0166\u0167\u01ab\u01ac\u01ad\u01ae\u021a\u021b\u0236\u023e\u0393\u03a4\u03c4\u03ee\u0422\u0442",u:"\xd9\xda\xdb\xdc\xf9\xfa\xfb\xfc\u0168\u0169\u016a\u016b\u016c\u016d\u016e\u016f\u0170\u0171\u0172\u0173\u01af\u01b0\u01b1\u01b2\u01d3\u01d4\u01d5\u01d6\u01d7\u01d8\u01d9\u01da\u01db\u01dc\u0214\u0215\u0216\u0217\u0244\u03b0\u03c5\u03cb\u03cd",v:"\u03bd\u0474\u0475\u0476\u0477",w:"\u0174\u0175\u019c\u03c9\u03ce\u03d6\u03e2\u03e3\u0428\u0429\u0448\u0449\u0461\u047f",x:"\xd7\u03a7\u03c7\u03d7\u03f0\u0425\u0445\u04b2\u04b3\u04fc\u04fd\u04fe\u04ff",y:"\xdd\xfd\xff\u0176\u0177\u0178\u01b3\u01b4\u0232\u0233\u024e\u024f\u038e\u03a5\u03ab\u03b3\u03c8\u03d2\u03d3\u03d4\u040e\u0423\u0443\u0447\u045e\u0470\u0471\u04ae\u04af\u04b0\u04b1\u04ee\u04ef\u04f0\u04f1\u04f2\u04f3",z:"\u0179\u017a\u017b\u017c\u017d\u017e\u01b5\u01b6\u0224\u0225\u0240\u0396"},B2={};Object.keys(M2).forEach(function(e){M2[e].split("").forEach(function(t){B2[t]=e})});const P2=/\//,N2=/[a-z]\.[a-z]/i,R2=/[0-9]/,L2=function(e,t){let n=e.normal||e.text||e.machine;const r=t.model.one.aliases;if(r.hasOwnProperty(n)&&(e.alias=e.alias||[],e.alias.push(r[n])),P2.test(n)&&!N2.test(n)&&!R2.test(n)){let t=n.split(P2);t.length<=3&&t.forEach(t=>{""!==(t=t.trim())&&(e.alias=e.alias||[],e.alias.push(t))})}return e},I2=/^(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])+-(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])+$/,k2=function(e){let t=e.implicit||e.normal||e.text;t=t.replace(/['\u2019]s$/,""),t=t.replace(/s['\u2019]$/,"s"),t=t.replace(/([aeiou][ktrp])in'$/,"$1ing"),I2.test(t)&&(t=t.replace(/-/g,"")),t=t.replace(/^[#@]/,""),t!==e.normal&&(e.machine=t)},O2=function(e){let t=e.docs,n={};for(let r=0;r<t.length;r+=1)for(let e=0;e<t[r].length;e+=1){let i=t[r][e],a=i.machine||i.normal;n[a]=n[a]||0,n[a]+=1}for(let r=0;r<t.length;r+=1)for(let e=0;e<t[r].length;e+=1){let i=t[r][e],a=i.machine||i.normal;i.freq=n[a]}},U2=function(e){let t=0,n=0,r=e.document;for(let i=0;i<r.length;i+=1)for(let e=0;e<r[i].length;e+=1){let a=r[i][e];a.offset={index:n,start:t+a.pre.length,length:a.text.length},t+=a.pre.length+a.text.length+a.post.length,n+=1}},z2=function(e){let t=e.document;for(let n=0;n<t.length;n+=1)for(let e=0;e<t[n].length;e+=1)t[n][e].index=[n,e]},V2=function(e){let t=0,n=e.docs;for(let r=0;r<n.length;r+=1)for(let e=0;e<n[r].length;e+=1)""!==n[r][e].normal&&(t+=1,n[r][e].wordCount=t)},G2=function(e,t){let n=e.docs;for(let r=0;r<n.length;r+=1)for(let i=0;i<n[r].length;i+=1)t(n[r][i],e.world)},H2={compute:{alias:e=>G2(e,L2),machine:e=>G2(e,k2),normal:e=>G2(e,D2),freq:O2,offset:U2,index:z2,wordCount:V2},methods:x2,model:{one:{aliases:F2,abbreviations:w2,prefixes:T2,suffixes:{like:!0,ish:!0,less:!0,able:!0,elect:!0,type:!0,designate:!0},prePunctuation:{"#":!0,"@":!0,_:!0,"\xb0":!0,"\u200b":!0,"\u200c":!0,"\u200d":!0,"\ufeff":!0},postPunctuation:{"%":!0,_:!0,"\xb0":!0,"\u200b":!0,"\u200c":!0,"\u200d":!0,"\ufeff":!0},lexicon:S2,unicode:B2,emoticons:{"<3":!0,"</3":!0,"<\\3":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0}}},hooks:["alias","machine","index","id"]},j2={typeahead:function(e){const t=e.model.one.typeahead,n=e.docs;if(0===n.length||0===Object.keys(t).length)return;let r=n[n.length-1]||[],i=r[r.length-1];if(!i.post&&t.hasOwnProperty(i.normal)){let n=t[i.normal];i.implicit=n,i.machine=n,i.typeahead=!0,e.compute.preTagger&&e.last().unTag("*").compute(["lexicon","preTagger"])}}},W2=function(){const e=this.docs;if(0===e.length)return this;let t=e[e.length-1]||[],n=t[t.length-1];return!0===n.typeahead&&n.machine&&(n.text=n.machine,n.normal=n.machine),this},q2=function(e){e.prototype.autoFill=W2},X2=function(e,t,n){let r={},i=[],a=n.prefixes||{};return e.forEach(e=>{let o=(e=e.toLowerCase().trim()).length;t.max&&o>t.max&&(o=t.max);for(let s=t.min;s<o;s+=1){let o=e.substring(0,s);t.safe&&n.model.one.lexicon.hasOwnProperty(o)||(!0!==a.hasOwnProperty(o)&&!0!==r.hasOwnProperty(o)?r[o]=e:i.push(o))}}),r=Object.assign({},a,r),i.forEach(e=>{delete r[e]}),r},K2={safe:!0,min:3},Y2={typeahead:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.model();var r;t=Object.assign({},K2,t),r=e,"[object Object]"===Object.prototype.toString.call(r)&&(Object.assign(n.one.lexicon,e),e=Object.keys(e));let i=X2(e,t,this.world());return Object.keys(i).forEach(e=>{n.one.typeahead.hasOwnProperty(e)?delete n.one.typeahead[e]:n.one.typeahead[e]=i[e]}),this}},J2={model:{one:{typeahead:{}}},api:q2,lib:Y2,compute:j2,hooks:["typeahead"]};kJ.extend(C$),kJ.extend(_0),kJ.extend(VZ),kJ.extend(I0),kJ.extend(T1),kJ.plugin(Z$),kJ.extend(H2),kJ.extend(iQ),kJ.plugin(VJ),kJ.extend(EQ),kJ.extend(J2),kJ.extend(dQ),kJ.extend(X0);const $2=kJ,Q2={addendum:"addenda",corpus:"corpora",criterion:"criteria",curriculum:"curricula",genus:"genera",memorandum:"memoranda",opus:"opera",ovum:"ova",phenomenon:"phenomena",referendum:"referenda",alga:"algae",alumna:"alumnae",antenna:"antennae",formula:"formulae",larva:"larvae",nebula:"nebulae",vertebra:"vertebrae",analysis:"analyses",axis:"axes",diagnosis:"diagnoses",parenthesis:"parentheses",prognosis:"prognoses",synopsis:"synopses",thesis:"theses",neurosis:"neuroses",appendix:"appendices",index:"indices",matrix:"matrices",ox:"oxen",sex:"sexes",alumnus:"alumni",bacillus:"bacilli",cactus:"cacti",fungus:"fungi",hippopotamus:"hippopotami",libretto:"libretti",modulus:"moduli",nucleus:"nuclei",octopus:"octopi",radius:"radii",stimulus:"stimuli",syllabus:"syllabi",cookie:"cookies",calorie:"calories",auntie:"aunties",movie:"movies",pie:"pies",rookie:"rookies",tie:"ties",zombie:"zombies",leaf:"leaves",loaf:"loaves",thief:"thieves",foot:"feet",goose:"geese",tooth:"teeth",beau:"beaux",chateau:"chateaux",tableau:"tableaux",bus:"buses",gas:"gases",circus:"circuses",crisis:"crises",virus:"viruses",database:"databases",excuse:"excuses",abuse:"abuses",avocado:"avocados",barracks:"barracks",child:"children",clothes:"clothes",echo:"echoes",embargo:"embargoes",epoch:"epochs",deer:"deer",halo:"halos",man:"men",woman:"women",mosquito:"mosquitoes",mouse:"mice",person:"people",quiz:"quizzes",rodeo:"rodeos",shoe:"shoes",sombrero:"sombreros",stomach:"stomachs",tornado:"tornados",tuxedo:"tuxedos",volcano:"volcanoes"},Z2={Comparative:"true\xa6bett1f0;arth0ew0in0;er",Superlative:"true\xa6earlier",PresentTense:"true\xa6bests,sounds",Condition:"true\xa6lest,unless",PastTense:"true\xa6began,came,d4had,kneel3l2m0sa4we1;ea0sg2;nt;eap0i0;ed;id",Participle:"true\xa60:09;a06b01cZdXeat0fSgQhPoJprov0rHs7t6u4w1;ak0ithdra02o2r1;i02uY;k0v0;nd1pr04;ergoJoJ;ak0hHo3;e9h7lain,o6p5t4un3w1;o1um;rn;g,k;ol0reS;iQok0;ught,wn;ak0o1runk;ne,wn;en,wn;ewriNi1uJ;dd0s0;ut3ver1;do4se0t1;ak0h2;do2g1;roG;ne;ast0i7;iv0o1;ne,tt0;all0loBor1;bi3g2s1;ak0e0;iv0o9;dd0;ove,r1;a5eamt,iv0;hos0lu1;ng;e4i3lo2ui1;lt;wn;tt0;at0en,gun;r2w1;ak0ok0;is0;en",Gerund:"true\xa6accord0be0doin,go0result0stain0;ing",Expression:"true\xa6a0Yb0Uc0Sd0Oe0Mfarew0Lg0FhZjeez,lWmVnToOpLsJtIuFvEw7y0;a5e3i1u0;ck,p;k04p0;ee,pee;a0p,s;!h;!a,h,y;a5h2o1t0;af,f;rd up,w;atsoever,e1o0;a,ops;e,w;hoo,t;ery w06oi0L;gh,h0;! 0h,m;huh,oh;here nPsk,ut tut;h0ic;eesh,hh,it,oo;ff,h1l0ow,sst;ease,s,z;ew,ooey;h1i,mg,o0uch,w,y;h,o,ps;! 0h;hTmy go0wT;d,sh;a7evertheless,o0;!pe;eh,mm;ah,eh,m1ol0;!s;ao,fao;aCeBi9o2u0;h,mph,rra0zzC;h,y;l1o0;r6y9;la,y0;! 0;c1moCsmok0;es;ow;!p hip hoor0;ay;ck,e,llo,y;ha1i,lleluj0;ah;!ha;ah,ee4o1r0;eat scott,r;l1od0sh; grief,bye;ly;! whiz;ell;e0h,t cetera,ureka,ww,xcuse me;k,p;'oh,a0rat,uh;m0ng;mit,n0;!it;mon,o0;ngratulations,wabunga;a2oo1r0tw,ye;avo,r;!ya;h,m; 1h0ka,las,men,rgh,ye;!a,em,h,oy;la",Negative:"true\xa6n0;ever,o0;n,t",QuestionWord:"true\xa6how3wh0;at,e1ich,o0y;!m,se;n,re; come,'s",Reflexive:"true\xa6h4it5my5o1the0your2;ir1m1;ne3ur0;sel0;f,ves;er0im0;self",Plural:"true\xa6dick0gre0ones,records;ens","Unit|Noun":"true\xa6cEfDgChBinchAk9lb,m6newt5oz,p4qt,t1y0;ardEd;able1b0ea1sp;!l,sp;spo1;a,t,x;on9;!b,g,i1l,m,p0;h,s;!les;!b,elvin,g,m;!es;g,z;al,b;eet,oot,t;m,up0;!s",Value:"true\xa6a few",Imperative:"true\xa6bewa0come he0;re","Plural|Verb":"true\xa6leaves",Demonym:"true\xa60:15;1:12;a0Vb0Oc0Dd0Ce08f07g04h02iYjVkTlPmLnIomHpEqatari,rCs7t5u4v3welAz2;am0Gimbabwe0;enezuel0ietnam0I;gAkrai1;aiwTex0hai,rinida0Ju2;ni0Prkmen;a5cotti4e3ingapoOlovak,oma0Spaniard,udRw2y0W;ede,iss;negal0Cr09;sh;mo0uT;o5us0Jw2;and0;a2eru0Fhilippi0Nortugu07uerto r0S;kist3lesti1na2raguay0;ma1;ani;ami00i2orweP;caragu0geri2;an,en;a3ex0Lo2;ngo0Drocc0;cedo1la2;gasy,y07;a4eb9i2;b2thua1;e0Cy0;o,t01;azakh,eny0o2uwaiI;re0;a2orda1;ma0Ap2;anO;celandic,nd4r2sraeli,ta01vo05;a2iB;ni0qi;i0oneU;aiAin2ondur0unO;di;amEe2hanai0reek,uatemal0;or2rm0;gi0;ilipino,ren8;cuadoVgyp4mira3ngli2sto1thiopi0urope0;shm0;ti;ti0;aPominUut3;a9h6o4roat3ub0ze2;ch;!i0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el6o4r3ul2;gaE;azi9it;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;genti2me1;ne;ba1ge2;ri0;ni0;gh0r2;ic0;an",Organization:"true\xa60:4Q;a3Tb3Bc2Od2He2Df27g1Zh1Ti1Pj1Nk1Ll1Gm12n0Po0Mp0Cqu0Br02sTtHuCv9w3xiaomi,y1;amaha,m1Bou1w1B;gov,tu3C;a4e2iki1orld trade organizati33;leaRped0O;lls fargo,st1;fie2Hinghou2R;l1rner br3U;gree3Jl street journ2Im1E;an halOeriz2Xisa,o1;dafo2Yl1;kswagMvo;b4kip,n2ps,s1;a tod3Aps;es3Mi1;lev3Fted natio3C;er,s; mobi32aco beRd bOe9gi frida3Lh3im horto3Amz,o1witt3D;shi49y1;ota,s r 05;e 1in lizzy;b3carpen3Jdaily ma3Dguess w2holli0s1w2;mashing pumpki35uprem0;ho;ea1lack eyed pe3Xyr0Q;ch bo3Dtl0;l2n3Qs1xas instrumen1U;co,la m1F;efoni0Kus;a8cientology,e5ieme2Ymirnoff,np,o3pice gir6quare0Ata1ubaru;rbuc1to34;ks;ny,undgard1;en;a2x pisto1;ls;g1Wrs;few2Minsbur31lesfor03msu2E;adiohead,b8e4o1yana3C;man empi1Xyal 1;b1dutch she4;ank;a3d 1max,vl20;bu1c2Ahot chili peppe2Ylobst2N;ll;ders dige1Ll madrid;c,s;ant3Aizn2Q;a8bs,e5fiz2Ihilip4i3r1;emier 1udenti1D;leagTo2K;nk floyd,zza hut; morrBs;psi2tro1uge0E;br33chi0Tn33;!co;lant2Un1yp16; 2ason27da2P;ld navy,pec,range juli2xf1;am;us;aAb9e6fl,h5i4o1sa,vid3wa;k2tre dame,vart1;is;ia;ke,ntendo,ss0QvZ;l,s;c,st1Otflix,w1; 1sweek;kids on the block,york0D;a,c;nd22s2t1;ional aca2Po,we0U;a,c02d0S;aDcdonalCe9i6lb,o3tv,y1;spa1;ce;b1Tnsanto,ody blu0t1;ley cr1or0T;ue;c2t1;as,subisO;helin,rosoft;dica2rcedes benz,talli1;ca;id,re;ds;cs milk,tt19z24;a3e1g,ittle caesa1P; ore09novo,x1;is,mark,us; 1bour party;pres0Dz boy;atv,fc,kk,lm,m1od1O;art;iffy lu0Roy divisi0Jpmorgan1sa;! cha09;bm,hop,k3n1tv;g,te1;l,rpol;ea;a5ewlett pack1Vi3o1sbc,yundai;me dep1n1P;ot;tac1zbollah;hi;lliburt08sbro;eneral 6hq,ithub,l5mb,o2reen d0Ou1;cci,ns n ros0;ldman sachs,o1;dye1g0H;ar;axo smith kli04encoW;electr0Nm1;oto0Z;a5bi,c barcelo4da,edex,i2leetwood m03o1rito l0G;rd,xcY;at,fa,nancial1restoZ; tim0;na;cebook,nnie mae;b0Asa,u3xxon1; m1m1;ob0J;!rosceptics;aiml0De5isney,o4u1;nkin donu2po0Zran dur1;an;ts;j,w jon0;a,f lepp12ll,peche mode,r spieg02stiny's chi1;ld;aJbc,hFiDloudflaCnn,o3r1;aigsli5eedence clearwater reviv1ossra09;al;c7inba6l4m1o0Est09;ca2p1;aq;st;dplSg1;ate;se;a c1o chanQ;ola;re;a,sco1tigroup;! systems;ev2i1;ck fil a,na daily;r1y;on;d2pital o1rls jr;ne;bury,ill1;ac;aEbc,eBf9l5mw,ni,o1p,rexiteeU;ei3mbardiIston 1;glo1pizza;be;ng;o2ue c1;roV;ckbuster video,omingda1;le; g1g1;oodriL;cht2e ge0rkshire hathaw1;ay;el;cardi,idu,nana republ3s1xt5y5;f,kin robbi1;ns;ic;bYcTdidSerosmith,iRlKmEnheuser busDol,ppleAr6s4u3v2y1;er;is,on;di,todesk;hland o1sociated E;il;b3g2m1;co;os;ys; compu1be0;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 5catel2ta1;ir;! lu1;ce1;nt;jazeera,qae1;da;g,rbnb;as;/dc,a3er,tivision1;! blizz1;ard;demy of scienc0;es;ba",Possessive:"true\xa6its,my,our0thy;!s","Noun|Verb":"true\xa60:9W;1:AA;2:96;3:A3;4:9R;5:A2;6:9K;7:8N;8:7L;9:A8;A:93;B:8D;C:8X;a9Ob8Qc7Id6Re6Gf5Sg5Hh55i4Xj4Uk4Rl4Em40n3Vo3Sp2Squ2Rr21s0Jt02u00vVwGyFzD;ip,oD;ne,om;awn,e6Fie68;aOeMhJiHoErD;ap,e9Oink2;nd0rDuC;kDry,sh5Hth;!shop;ck,nDpe,re,sh;!d,g;e86iD;p,sD;k,p0t2;aDed,lco8W;r,th0;it,lk,rEsDt4ve,x;h,te;!ehou1ra9;aGen5FiFoD;iDmAte,w;ce,d;be,ew,sA;cuum,l4B;pDr7;da5gra6Elo6A;aReQhrPiOoMrGuEwiDy5Z;n,st;nDrn;e,n7O;aGeFiEoDu6;t,ub2;bu5ck4Jgg0m,p;at,k,nd;ck,de,in,nsDp,v7J;f0i8R;ll,ne,p,r4Yss,t94uD;ch,r;ck,de,e,le,me,p,re;e5Wow,u6;ar,e,ll,mp0st,xt;g,lDng2rg7Ps5x;k,ly;a0Sc0Ne0Kh0Fi0Dk0Cl0Am08n06o05pXquaBtKuFwD;ea88iD;ng,pe,t4;bGit,m,ppErD;fa3ge,pri1v2U;lDo6S;e6Py;!je8;aMeLiKoHrEuDy2;dy,ff,mb2;a85eEiDo5Pugg2;ke,ng;am,ss,t4;ckEop,p,rD;e,m;ing,pi2;ck,nk,t4;er,m,p;ck,ff,ge,in,ke,lEmp,nd,p2rDte,y;!e,t;k,l;aJeIiHlGoFrDur,y;ay,e56inDu3;g,k2;ns8Bt;a5Qit;ll,n,r87te;ed,ll;m,n,rk;b,uC;aDee1Tow;ke,p;a5Je4FiDo53;le,rk;eep,iDou4;ce,p,t;ateboa7Ii;de,gnDl2Vnk,p,ze;!al;aGeFiEoDuff2;ck,p,re,w;ft,p,v0;d,i3Ylt0;ck,de,pe,re,ve;aEed,nDrv1It;se,t2N;l,r4t;aGhedu2oBrD;aEeDibb2o3Z;en,w;pe,t4;le,n,r2M;cDfegua72il,mp2;k,rifi3;aZeHhy6LiGoEuD;b,in,le,n,s5X;a6ck,ll,oDpe,u5;f,t;de,ng,ot,p,s1W;aTcSdo,el,fQgPje8lOmMnLo17pJque6sFturn,vDwa6V;eDi27;al,r1;er74oFpe8tEuD;lt,me;!a55;l71rt;air,eaDly,o53;l,t;dezvo2Zt;aDedy;ke,rk;ea1i4G;a6Iist0r5N;act6Yer1Vo71uD;nd,se;a38o6F;ch,s6G;c1Dge,iEke,lly,nDp1Wt1W;ge,k,t;n,se;es6Biv0;a04e00hYiXlToNrEsy4uD;mp,n4rcha1sh;aKeIiHoDu4O;be,ceFdu3fi2grDje8mi1p,te6;amDe6W;!me;ed,ss;ce,de,nt;sDy;er6Cs;cti3i1;iHlFoEp,re,sDuCw0;e,i5Yt;l,p;iDl;ce,sh;nt,s5V;aEce,e32uD;g,mp,n7;ce,nDy;!t;ck,le,n17pe,tNvot;a1oD;ne,tograph;ak,eFnErDt;fu55mA;!c32;!l,r;ckJiInHrFsEtDu1y;ch,e9;s,te;k,tD;!y;!ic;nt,r,se;!a7;bje8ff0il,oErDutli3Qver4B;bAd0ie9;ze;a4ReFoDur1;d,tD;e,i3;ed,gle8tD;!work;aMeKiIoEuD;rd0;ck,d3Rld,nEp,uDve;nt,th;it5EkD;ey;lk,n4Brr5CsDx;s,ta2B;asuBn4UrDss;ge,it;il,nFp,rk3WsEtD;ch,t0;h,k,t0;da5n0oeuvB;aLeJiHoEuD;mp,st;aEbby,ck,g,oDve;k,t;d,n;cDe,ft,mAnIst;en1k;aDc0Pe4vK;ch,d,k,p,se;bFcEnd,p,t4uD;gh,n4;e,k;el,o2U;eEiDno4E;ck,d,ll,ss;el,y;aEo1OuD;i3mp;m,zz;mpJnEr46ssD;ue;c1Rdex,fluGha2k,se2HteDvoi3;nt,rD;e6fa3viD;ew;en3;a8le2A;aJeHiGoEuD;g,nt;l3Ano2Dok,pDr1u1;!e;ghli1Fke,nt,re,t;aDd7lp;d,t;ck,mGndFrEsh,tDu9;ch,e;bo3Xm,ne4Eve6;!le;!m0;aMear,ift,lKossJrFuD;arDe4Alp,n;antee,d;aFiEoDumb2;uCwth;ll,nd,p;de,sp;ip;aBoDue;ss,w;g,in,me,ng,s,te,ze;aZeWiRlNoJrFuD;ck,el,nDss,zz;c38d;aEoDy;st,wn;cDgme,me,nchi1;tuB;cFg,il,ld,rD;ce,e29mDwa31;!at;us;aFe0Vip,oDy;at,ck,od,wD;!er;g,ke,me,re,sh,vo1E;eGgFlEnDre,sh,t,x;an3i0Q;e,m,t0;ht,uB;ld;aEeDn3;d,l;r,tuB;ce,il,ll,rm,vo2W;cho,d7ffe8nMsKxFyeD;!baD;ll;cGerci1hFpDtra8;eriDo0W;en3me9;au6ibA;el,han7u1;caDtima5;pe;count0d,vy;a01eSiMoJrEuDye;b,el,mp,pli2X;aGeFiEoD;ne,p;ft,ll,nk,p,ve;am,ss;ft,g,in;cEd7ubt,wnloD;ad;k,u0E;ge6p,sFt4vD;e,iDor3;de;char7gui1h,liEpD;at4lay,u5;ke;al,bKcJfeIlGmaCposAsEtaD;il;e07iD;gn,re;ay,ega5iD;ght;at,ct;li04rea1;a5ut;b,ma7n3rDte;e,t;a0Eent0Dh06irc2l03oKrFuD;be,e,rDt;b,e,l,ve;aGeFoEuDy;sh;p,ss,wd;dAep;ck,ft,sh;at,de,in,lTmMnFordina5py,re,st,uDv0;gh,nDp2rt;s01t;ceHdu8fli8glomeIsFtDveN;a8rD;a6ol;e9tru8;ct;ntDrn;ra5;bHfoGmFpD;leDouCromi1;me9;aCe9it,u5;rt;at,iD;ne;lap1oD;r,ur;aEiDoud,ub;ck,p;im,w;aEeDip;at,ck,er;iGllen7nErD;ge,m,t;ge,nD;el;n,r;er,re;ke,ll,mp,noe,pGrXsFtEuDve;se,ti0I;alog,ch;h,t;!tuB;re;a03eZiXlToPrHuEyD;pa11;bb2ck2dgEff0mp,rDst,zz;den,n;et;anJeHiFoadEuD;i1sh;ca6;be,d7;ge;aDed;ch,k;ch,d;aFg,mb,nEoDrd0tt2x,ycott;k,st,t;d,e;rd,st;aFeCiDoYur;nk,tz;nd;me;as,d,ke,nd,opsy,tD;!ch,e;aFef,lt,nDt;d,efA;it;r,t;ck,il,lan3nIrFsEtt2;le;e,h;!gDk;aDe;in;!d,g,k;bu1c05dZge,iYlVnTppQrLsIttGucEwaD;rd;tiD;on;aDempt;ck;k,sD;i6ocia5;st;chFmD;!oD;ur;!iD;ve;eEroa4;ch;al;chDg0sw0;or;aEt0;er;rm;d,m,r;dreHvD;an3oD;ca5;te;ce;ss;cDe,he,t;eFoD;rd,u9;nt;nt,ss;se",Actor:"true\xa60:7B;1:7G;2:6A;3:7F;4:7O;5:7K;a6Nb62c4Ud4Be41f3Sg3Bh30i2Uj2Qkin2Pl2Km26n1Zo1Sp0Vqu0Tr0JsQtJuHvEw8yo6;gi,ut6;h,ub0;aAe9i8o7r6;estl0it0;m2rk0;fe,nn0t2Bza2H;atherm2ld0;ge earn0it0nder0rri1;eter7i6oyF;ll5Qp,s3Z;an,ina2U;n6s0;c6Uder03;aoisea23e9herapi5iktok0o8r6ut1yco6S;a6endseLo43;d0mp,nscri0Bvel0;ddl0u1G;a0Qchn7en6na4st0;ag0;i3Oo0D;aiXcUeRhPiMki0mu26oJpGquaFtBu7wee6;p0theart;lt2per7r6;f0ge6Iviv1;h6inten0Ist5Ivis1;ero,um2;a8ep7r6;ang0eam0;bro2Nc2Ofa2Nmo2Nsi20;ff0tesm2;tt0;ec7ir2Do6;kesp59u0M;ia5Jt3;l7me6An,rcere6ul;r,ss;di0oi5;n7s6;sy,t0;g0n0;am2ephe1Iow6;girl,m2r2Q;cretInior cit3Fr6;gea4v6;a4it1;hol4Xi7reen6ulpt1;wr2C;e01on;l1nt;aEe9o8u6;l0nn6;er up,ingE;g40le mod3Zof0;a4Zc8fug2Ppo32searQv6;ere4Uolution6;ary;e6luYru22;ptio3T;bbi,dic5Vpp0;arter6e2Z;back;aYeWhSiRlOoKr8sycho7u6;nk,p31;logi5;aGeDiBo6;d9fess1g7ph47s6;pe2Ktitu51;en6ramm0;it1y;igy,uc0;est4Nme mini0Unce6s3E;!ss;a7si6;de4;ch0;ctiti39nk0P;dca0Oet,li6pula50rnst42;c2Itic6;al scie6i2;nti5;a6umb0;nn0y6;er,ma4Lwright;lgrim,one0;a8iloso7otogra7ra6ysi1V;se;ph0;ntom,rmaci5;r6ssi1T;form0s4O;i3El,nel3Yr8st1tr6wn;i6on;arWot;ent4Wi42tn0;ccupa4ffBp8r7ut6;ca5l0B;ac4Iganiz0ig2Fph2;er3t6;i1Jomet6;ri5;ic0spring;aBe9ie4Xo7u6;n,rser3J;b6mad,vi4V;le2Vo4D;i6mesis,phew;ce,ghb1;nny,rr3t1X;aEeDiAo7u6yst1Y;m8si16;der3gul,m7n6th0;arDk;!my;ni7s6;f02s0Jt0;on,st0;chan1Qnt1rcha4;gi9k0n8rtyr,t6y1;e,riar6;ch;ag0iac;ci2stra3I;a7e2Aieutena4o6;rd,s0v0;bor0d7ndlo6ss,urea3Fwy0ym2;rd;!y;!s28;e8o7u6;ggl0;gg0urna2U;st0;c3Hdol,llu3Ummigra4n6; l9c1Qfa4habi42nov3s7ve6;nt1stig3;pe0Nt6;a1Fig3ru0M;aw;airFeBistoAo8u6ygie1K;man6sba2H;!ita8;bo,st6usekN;age,e3P;ri2;ir,r6;m7o6;!ine;it;dress0sty2C;aLeIhostGirl26ladi3oCrand7u6;e5ru;c9daug0Jfa8m7pa6s2Y;!re4;a,o6;th0;hi1B;al7d6lf0;!de3A;ie,k6te26;eep0;!wr6;it0;isha,n6;i6tl04;us;mbl0rden0;aDella,iAo7r6;eela2Nie1P;e,re6ster pare4;be1Hm2r6st0;unn0;an2ZgZlmm17nanci0r6tt0;e6st la2H; marsh2OfigXm2;rm0th0;conoEdDlectriCm8n7x6;amin0cellency,i2A;emy,trepreneur,vironmenta1J;c8p6;er1loye6;e,r;ee;ci2;it1;mi5;aKeBi8ork,ri7u6we02;de,tche2H;ft0v0;ct3eti7plom2Hre6va;ct1;ci2ti2;aDcor3fencCi0InAput9s7tectLvel6;op0;ce1Ge6ign0;rt0;ee,y;iz6;en;em2;c1Ml0;d8nc0redev7ug6;ht0;il;!dy;a06e04fo,hXitizenWlToBr9u6;r3stomer6;! representat6;ive;e3it6;ic;lJmGnAord9rpor1Nu7w6;boy,ork0;n6ri0;ciTte1Q;in3;fidantAgressSs9t6;e0Kr6;ibut1o6;ll0;tab13ul1O;!e;edi2m6pos0rade;a0EeQissi6;on0;leag8on7um6;ni5;el;ue;e6own;an0r6;ic,k;!s;a9e7i6um;ld;erle6f;ad0;ir7nce6plFract0;ll1;m2wI;lebri6o;ty;dBptAr6shi0;e7pe6;nt0;r,t6;ak0;ain;et;aMeLiJlogg0oErBu6;dd0Fild0rgl9siness6;m2p7w6;om2;ers05;ar;i7o6;!k0th0;cklay0de,gadi0;hemi2oge8y6;!frie6;nd;ym2;an;cyc6sR;li5;atbox0ings;by,nk0r6;b0on7te6;nd0;!e07;c04dWge4nQpLrHsFtAu7yatull6;ah;nt7t6;h1oG;!ie;h8t6;e6orney;nda4;ie5le6;te;sis00tron6;aut,om0;chbis8isto7tis6;an,t;crU;hop;ost9p6;ari6rentiS;ti6;on;le;a9cest1im3nou8y6;bo6;dy;nc0;ly5rc6;hi5;mi8v6;entur0is1;er;ni7r6;al;str3;at1;or;counBquaintanArob9t6;ivi5or,re6;ss;st;at;ce;ta4;nt","Adj|Noun":"true\xa60:16;a1Db17c0Ud0Re0Mf0Dg0Ah08i06ju05l02mWnUoSpNrIsBt7u4v1watershed;a1ision0Z;gabo4nilla,ria1;b0Vnt;ndergr1pstairs;adua14ou1;nd;a3e1oken,ri0;en,r1;min0rori13;boo,n;age,e5ilv0Flack,o3quat,ta2u1well;bordina0Xper5;b0Lndard;ciali0Yl1vereign;e,ve16;cret,n1ri0;ior;a4e2ou1ubbiL;nd,tiY;ar,bBl0Wnt0p1side11;resent0Vublican;ci0Qsh;a4eriodic0last0Zotenti0r1;emi2incip0o1;!fession0;er,um;rall4st,tie0U;ff1pposi0Hv0;ens0Oi0C;agg01ov1uts;el;a5e3iniatJo1;bi01der07r1;al,t0;di1tr0N;an,um;le,riG;attOi2u1;sh;ber0ght,qC;stice,veniT;de0mpressioYn1;cumbe0Edividu0no0Dsta0Eterim;alf,o1umdrum;bby,melF;en2old,ra1;ph0Bve;er0ious;a7e5i4l3u1;git03t1;ure;uid;ne;llow,m1;aFiL;ir,t,vo1;riOuriO;l3p00x1;c1ecutUpeV;ess;d1iK;er;ar2e1;mographUrivO;k,l2;hiGlassSo2rude,unn1;ing;m5n1operK;creCstitueOte2vertab1;le;mpor1nt;ary;ic,m2p1;anion,lex;er2u1;ni8;ci0;al;e5lank,o4r1;i2u1;te;ef;ttom,urgeois;st;cadem9d6l2ntarct9r1;ab,ct8;e3tern1;at1;ive;rt;oles1ult;ce1;nt;ic","Adj|Past":"true\xa60:4Q;1:4C;2:4H;3:4E;a44b3Tc36d2Je29f20g1Wh1Si1Jj1Gkno1Fl1Am15n12o0Xp0Mqu0Kr08sLtEuAv9w4yellow0;a7ea6o4rinkl0;r4u3Y;n,ri0;k31th3;rp0sh0tZ;ari0e1O;n5p4s0;d1li1Rset;cov3derstood,i4;fi0t0;a8e3Rhr7i6ouTr4urn0wi4C;a4imm0ou2G;ck0in0pp0;ed,r0;eat2Qi37;m0nn0r4;get0ni2T;aOcKeIhGimFm0Hoak0pDt7u4;bsid3Ogge44s4;pe4ta2Y;ct0nd0;a8e7i2Eok0r5u4;ff0mp0nn0;ength2Hip4;ed,p0;am0reotyp0;in0t0;eci4ik0oH;al3Efi0;pRul1;a4ock0ut;d0r0;a4c1Jle2t31;l0s3Ut0;a6or5r4;at4e25;ch0;r0tt3;t4ut0;is2Mur1;aEe5o4;tt0;cAdJf2Bg9je2l8m0Knew0p7qu6s4;eTpe2t4;or0ri2;e3Dir0;e1lac0;at0e2Q;i0Rul1;eiv0o4ycl0;mme2Lrd0v3;in0lli0ti2A;a4ot0;li28;aCer30iBlAo9r5u4;mp0zzl0;e6i2Oo4;ce2Fd4lo1Anou30pos0te2v0;uc0;fe1CocCp0Iss0;i2Kli1L;ann0e2CuS;ck0erc0ss0;ck0i2Hr4st0;allLk0;bse7c6pp13rgan2Dver4;lo4whelm0;ok0;cupi0;rv0;aJe5o4;t0uri1A;ed0gle2;a6e5ix0o4ut0ys1N;di1Nt15u26;as0Clt0;n4rk0;ag0ufact0A;e6i5o4;ad0ck0st,v0;cens0m04st0;ft,v4;el0;tt0wn;a5o15u4;dg0s1B;gg0;llumSmpAn4sol1;br0cre1Ldebt0f8jZspir0t5v4;it0olv0;e4ox0Y;gr1n4re23;d0si15;e2l1o1Wuri1;li0o01r4;ov0;a6e1o4um03;ok0r4;ri0Z;mm3rm0;i6r5u4;a1Bid0;a0Ui0Rown;ft0;aAe9i8l6oc0Ir4;a4i0oz0Y;ctHg19m0;avo0Ju4;st3;ni08tt0x0;ar0;d0il0sc4;in1;dCl1mBn9quipp0s8x4;agger1c6p4te0T;a0Se4os0;ct0rie1D;it0;cap0tabliZ;cha0XgFha1As4;ur0;a0Zbarra0N;i0Buc1;aMeDi5r4;a01i0;gni08miniSre2s4;a9c6grun0Ft4;o4re0Hu17;rt0;iplWou4;nt0r4;ag0;bl0;cBdRf9l8p7ra6t5v4;elop0ot0;ail0ermQ;ng0;re07;ay0ight0;e4in0o0M;rr0;ay0enTor1;m5t0z4;ed,zl0;ag0p4;en0;aPeLhIlHo9r6u4;lt4r0stom03;iv1;a5owd0u4;sh0;ck0mp0;d0loAm7n4ok0v3;centr1f5s4troC;id3olid1;us0;b5pl4;ic1;in0;r0ur0;assi9os0utt3;ar5i4;ll0;g0m0;lebr1n6r4;ti4;fi0;tralJ;g0lcul1;aDewild3iCl9o7r5urn4;ed,t;ok4uis0;en;il0r0t4und;tl0;e5i4;nd0;ss0;as0;ffl0k0laMs0tt3;bPcNdKfIg0lFmaz0nDppBrm0ss9u5wa4;rd0;g5thor4;iz0;me4;nt0;o6u4;m0r0;li0re4;ci1;im1ticip1;at0;a5leg0t3;er0;rm0;fe2;ct0;ju5o7va4;nc0;st0;ce4knowledg0;pt0;and5so4;rb0;on0;ed",Singular:"true\xa60:5J;1:5H;2:4W;3:4S;4:52;5:57;6:5L;7:56;8:5B;a52b4Lc3Nd35e2Xf2Og2Jh28in24j23k22l1Um1Ln1Ho1Bp0Rqu0Qr0FsZtMuHvCw9x r58yo yo;a9ha3Po3Q;f3i4Rt0Gy9;! arou39;arCeAideo ga2Qo9;cabu4Jl5C;gOr9t;di4Zt1Y;iety,ni4P;nBp30rAs 9;do43s5E;bani1in0;coordinat3Ader9;estima1to24we41; rex,aKeJhHiFoErBuAv9;! show;m2On2rntLto1D;agedy,ib9o4E;e,u9;n0ta46;ni1p2rq3L;c,er,m9;etF;ing9ree26;!y;am,mp3F;ct2le6x return;aNcMeKhor4QiJkHoGpin off,tDuBy9;ll9ner7st4T;ab2X;b9i1n28per bowl,rro1X;st3Ltot0;atAipe2Go1Lrate7udent9;! lo0I;i39u1;ft ser4Lmeo1I;elet5i9;ll,r3V;b38gn2Tte;ab2Jc9min3B;t,urity gua2N;e6ho2Y;bbatic0la3Jndwi0Qpi5;av5eDhetor2iAo9;de6om,w;tAv9;erb2C;e,u0;bDcBf9publ2r10spi1;er9orm3;e6r0;i9ord label;p2Ht0;a1u46;estion mark,ot2F;aPeMhoLiIlGoErAu9yram1F;ddi3HpErpo1Js3J;eBo9;bl3Zs9;pe3Jta1;dic1Rmi1Fp1Qroga8ss relea1F;p9rt0;py;a9ebisci1;q2Dte;cn2eAg9;!gy;!r;ne call,tocoK;anut,dAr9t0yo1;cen3Jsp3K;al,est0;nop4rAt9;e,hog5;adi11i2V;atme0bj3FcBpia1rde0thers,utspok5ve9wn3;n,r9;ti0Pview;cuAe9;an;pi3;arBitAot9umb3;a2Fhi2R;e,ra1;cot2ra8;aFeCiAo9ur0;nopo4p18rni2Nsq1Rti36uld;c,li11n0As9tt5;chief,si34;dAnu,t9;al,i3;al,ic;gna1mm0nd15rsupi0te9yf4;ri0;aDegCiBu9;ddi1n9;ch;me,p09; Be0M;bor14y9; 9er;up;eyno1itt5;el4ourn0;cBdices,itia8ni25sAtel0Lvert9;eb1J;e28titu1;en8i2T;aIeEighDoAu9;man right,s22;me9rmoFsp1Ftb0K;! r9;un; scho0YriY;a9i1N;d9v5; start,pho9;ne;ndful,sh brown,v5ze;aBelat0Ilaci3r9ul4yp1S;an9enadi3id;a1Cd slam,ny;df4r9;l2ni1I;aGeti1HiFlu1oCrAun9;er0;ee market,i9onti3;ga1;l4ur9;so9;me;ePref4;br2mi4;conoFffi7gg,lecto0Rmbas1EnCpidem2s1Zth2venBxAyel9;id;ampZempl0Nte6;i19t;er7terp9;ri9;se;my;eLiEoBr9ump tru0U;agonf4i9;er,ve thru;cAg7i4or,ssi3wn9;side;to0EumenE;aEgniDnn3sAvide9;nd;conte6incen8p9tri11;osi9;ti0C;ta0H;le0X;athBcAf9ni0terre6;ault 05err0;al,im0;!b9;ed;aWeThMiLlJoDr9;edit caBuc9;ib9;le;rd;efficDke,lCmmuniqLnsApi3rr0t0Xus9yo1;in;erv9uI;ato02;ic,lQ;ie6;er7i9oth;e6n2;ty,vil wM;aDeqCick5ocoBr9;istmas car9ysanthemum;ol;la1;ue;ndeli3racteri9;st2;iAllEr9;e0tifica1;liZ;hi3nFpErCt9ucus;erpi9hedr0;ll9;ar;!bohyd9ri3;ra1;it0;aAe,nib0t9;on;l,ry;aMeLiop2leJoHrDu9;nny,r9tterf4;g9i0;la9;ry;eakAi9;ck;fa9throB;st;dy,ro9wl;ugh;mi9;sh;an,l4;nkiArri3;er;ng;cSdMlInFppeti1rDsBtt2utop9;sy;ic;ce6pe9;ct;r9sen0;ay;ecAoma4tiA;ly;do1;i5l9;er7y;gy;en; hominDjAvan9;tage;ec8;ti9;ve;em;cCeAqui9;tt0;ta1;te;iAru0;al;de6;nt","Person|Noun":"true\xa6a0Eb07c03dWeUfQgOhLjHkiGlFmCnBolive,p7r4s3trini06v1wa0;ng,rd,tts;an,enus,iol0;a,et;ky,onPumm09;ay,e1o0uby;bin,d,se;ed,x;a2e1o0;l,tt04;aLnJ;dYge,tR;at,orm;a0eloW;t0x,ya;!s;a9eo,iH;ng,tP;a2e1o0;lGy;an,w3;de,smi4y;a0erb,iOolBuntR;ll,z0;el;ail,e0iLuy;ne;a1ern,i0lo;elds,nn;ith,n0;ny;a0dEmir,ula,ve;rl;a4e3i1j,ol0;ly;ck,x0;ie;an,ja;i0wn;sy;am,h0liff,rystal;a0in,ristian;mbers,ri0;ty;a4e3i2o,r0ud;an0ook;dy;ll;nedict,rg;k0nks;er;l0rt;fredo,ma","Actor|Verb":"true\xa6aCb8c5doctor,engineAfool,g3host,judge,m2nerd,p1recruit,scout,ushAvolunteAwi0;mp,tneA;arent,ilot;an,ime;eek,oof,r0uide;adu8oom;ha1o0;ach,nscript,ok;mpion,uffeur;o2u0;lly,tch0;er;ss;ddi1ffili0rchite1;ate;ct",MaleName:"true\xa60:H6;1:FZ;2:DS;3:GQ;4:CZ;5:FV;6:GM;7:FP;8:GW;9:ET;A:C2;B:GD;aF8bE1cCQdBMeASfA1g8Yh88i7Uj6Sk6Bl5Mm48n3So3Ip33qu31r26s1Et0Ru0Ov0CwTxSyHzC;aCor0;cChC1karia,nAT;!hDkC;!aF6;!ar7CeF5;aJevgenBSoEuC;en,rFVsCu3FvEF;if,uf;nDs6OusC;ouf,s6N;aCg;s,tC;an,h0;hli,nCrosE1ss09;is,nC;!iBU;avi2ho5;aPeNiDoCyaEL;jcieBJlfgang,odrFutR;lFnC;f8TsC;lCt1;ow;bGey,frEhe4QlC;aE5iCy;am,e,s;ed8iC;d,ed;eAur;i,ndeD2rn2sC;!l9t1;lDyC;l1ne;lDtC;!er;aCHy;aKernDAiFladDoC;jteB0lodymyr;!iC;mFQsDB;cFha0ktBZnceDrgCOvC;a0ek;!nC;t,zo;!e4StBV;lCnC7sily;!entC;in9J;ghE2lCm70nax,ri,sm0;riCyss87;ch,k;aWeRhNiLoGrEuDyC;!l2roEDs1;n6r6E;avD0eCist0oy,um0;ntCRvBKy;bFdAWmCny;!asDmCoharu;aFFie,y;!z;iA6y;mCt4;!my,othy;adEeoDia0SomC;!as;!dor91;!de4;dFrC;enBKrC;anBJeCy;ll,nBI;!dy;dgh,ha,iCnn2req,tsu5V;cDAka;aYcotWeThPiMlobod0oKpenc2tEurDvenAEyCzym1;ed,lvest2;aj,e9V;anFeDuC;!aA;fan17phEQvCwaA;e77ie;!islaCl9;v,w;lom1rBuC;leymaDHta;dDgmu9UlCm1yabonga;as,v8B;!dhart8Yn9;aEeClo75;lCrm0;d1t1;h9Jne,qu1Jun,wn,yne;aDbastiEDk2Yl5Mpp,rgCth,ymoCU;e1Dio;m4n;!tC;!ie,y;eDPlFmEnCq67tosCMul;dCj2UtiA5;e01ro;!iATkeB6mC4u5;!ik,vato9K;aZeUheC8iRoGuDyC;an,ou;b99dDf4peAssC;!elEG;ol00y;an,bLc7MdJel,geIh0lHmGnEry,sDyC;!ce;ar7Ocoe,s;!aCnBU;ld,n;an,eo;a7Ef;l7Jr;e3Eg2n9olfo,riC;go;bBNeDH;cCl9;ar87c86h54kCo;!ey,ie,y;cFeA3gDid,ubByCza;an8Ln06;g85iC;naC6s;ep;ch8Kfa5hHin2je8HlGmFndEoHpha5sDul,wi36yC;an,mo8O;h9Im4;alDSol3O;iD0on;f,ph;ul;e9CinC;cy,t1;aOeLhilJiFrCyoG;aDeC;m,st1;ka85v2O;eDoC;tr;r8GtC;er,ro;!ipCl6H;!p6U;dCLrcy,tC;ar,e9JrC;!o7;b9Udra8So9UscAHtri62ulCv8I;!ie,o7;ctav6Ji2lImHndrBRrGsDtCum6wB;is,to;aDc6k6m0vCwaBE;al79;ma;i,vR;ar,er;aDeksandr,ivC;er,i2;f,v;aNeLguyBiFoCu3O;aDel,j4l0ma0rC;beAm0;h,m;cFels,g5i9EkDlC;es,s;!au,h96l78olaC;!i,y;hCkCol76;ol75;al,d,il,ls1vC;ilAF;hom,tC;e,hC;anCy;!a5i5;aYeViLoGuDyC;l4Nr1;hamDr84staC;fa,p6E;ed,mG;di10e,hamEis4JntDritz,sCussa;es,he;e,y;ad,ed,mC;ad,ed;cGgu5hai,kFlEnDtchC;!e8O;a9Pik;house,o7t1;ae73eC3ha8Iolaj;ah,hDkC;!ey,y;aDeC;al,l;el,l;hDlv3rC;le,ri8Ev4T;di,met;ay0c00gn4hWjd,ks2NlTmadZnSrKsXtDuric7VxC;imilBKwe8B;eHhEi69tCus,y69;!eo,hCia7;ew,i67;eDiC;as,eu,s;us,w;j,o;cHiGkFlEqu8Qsha83tCv3;iCy;!m,n;in,on;el,o7us;a6Yo7us;!elCin,o7us;!l8o;frAEi5Zny,u5;achDcoCik;lm;ai,y;amDdi,e5VmC;oud;adCm6W;ou;aulCi9P;ay;aWeOiMloyd,oJuDyC;le,nd1;cFdEiDkCth2uk;a7e;gi,s,z;ov7Cv6Hw6H;!as,iC;a6Een;g0nn52renDuCvA4we7D;!iS;!zo;am,n4oC;n5r;a9Yevi,la5KnHoFst2thaEvC;eCi;nte;bo;nCpo8V;!a82el,id;!nC;aAy;mEnd1rDsz73urenCwr6K;ce,t;ry,s;ar,beAont;aOeIhalHiFla4onr63rDu5SylC;e,s;istCzysztof;i0oph2;er0ngsl9p,rC;ilA9k,ollos;ed,id;en0iGnDrmCv4Z;it;!dDnCt1;e2Ny;ri4Z;r,th;cp2j4mEna8BrDsp6them,uC;ri;im,l;al,il;a03eXiVoFuC;an,lCst3;en,iC;an,en,o,us;aQeOhKkub4AnIrGsDzC;ef;eDhCi9Wue;!ua;!f,ph;dCge;i,on;!aCny;h,s,th6J;anDnC;!ath6Hie,n72;!nC;!es;!l,sCy;ph;o,qu3;an,mC;!i,m6V;d,ffFns,rCs4;a7JemDmai7QoCry;me,ni1H;i9Dy;!e73rC;ey,y;cKdBkImHrEsDvi2yC;dBs1;on,p2;ed,oDrCv67;e6Qod;d,s61;al,es5Wis1;a,e,oCub;b,v;ob,qu13;aTbNchiMgLke53lija,nuKonut,rIsEtCv0;ai,suC;ki;aDha0i8XmaCsac;el,il;ac,iaC;h,s;a,vinCw3;!g;k,nngu6X;nac1Xor;ka;ai,rahC;im;aReLoIuCyd6;beAgGmFsC;eyDsC;a3e3;in,n;ber5W;h,o;m2raDsse3wC;a5Pie;c49t1K;a0Qct3XiGnDrC;beAman08;dr7VrC;iCy2N;!k,q1R;n0Tt3S;bKlJmza,nIo,rEsDyC;a5KdB;an,s0;lEo67r2IuCv9;hi5Hki,tC;a,o;an,ey;k,s;!im;ib;a08e00iUlenToQrMuCyorgy;iHnFsC;!taC;f,vC;!e,o;n6tC;er,h2;do,lC;herDlC;auCerQ;me;aEegCov2;!g,orC;!io,y;dy,h7C;dfr9nza3XrDttfC;ri6C;an,d47;!n;acoGlEno,oCuseppe;rgiCvan6O;!o,s;be6Ies,lC;es;mo;oFrC;aDha4HrC;it,y;ld,rd8;ffErgC;!e7iCy;!os;!r9;bElBrCv3;eCla1Nr4Hth,y;th;e,rC;e3YielC;!i4;aXeSiQlOorrest,rCyod2E;aHedFiC;edDtC;s,z;ri18;!d42eri11riC;ck,k;nCs2;cEkC;ie,lC;in,yn;esLisC;!co,z3M;etch2oC;ri0yd;d5lConn;ip;deriFliEng,rC;dinaCg4nan0B;nd8;pe,x;co;bCdi,hd;iEriC;ce,zC;io;an,en,o;benez2dZfrYit0lTmMnJo3rFsteb0th0ugenEvCymBzra;an,eCge4D;ns,re3K;!e;gi,iDnCrol,v3w3;est8ie,st;cCk;!h,k;o0DriCzo;co,qC;ue;aHerGiDmC;aGe3A;lCrh0;!iC;a10o,s;s1y;nu5;beAd1iEliDm2t1viCwood;n,s;ot28s;!as,j5Hot,sC;ha;a3en;!dGg6mFoDua2QwC;a2Pin;arC;do;oZuZ;ie;a04eTiOmitrNoFrag0uEwDylC;an,l0;ay3Hig4D;a3Gdl9nc0st3;minFnDri0ugCvydGy2S;!lF;!a36nCov0;e1Eie,y;go,iDykC;as;cCk;!k;i,y;armuFetDll1mitri7neCon,rk;sh;er,m6riC;ch;id;andLepak,j0lbeAmetri4nIon,rGsEvDwCxt2;ay30ey;en,in;hawn,moC;nd;ek,riC;ck;is,nC;is,y;rt;re;an,le,mKnIrEvC;e,iC;!d;en,iEne0PrCyl;eCin,yl;l45n;n,o,us;!iCny;el,lo;iCon;an,en,on;a0Fe0Ch03iar0lRoJrFuDyrC;il,us;rtC;!is;aEistC;iaCob12;no;ig;dy,lInErC;ey,neliCy;s,us;nEor,rDstaC;nt3;ad;or;by,e,in,l3t1;aHeEiCyde;fCnt,ve;fo0Xt1;menDt4;us;s,t;rFuDyC;!t1;dCs;e,io;enC;ce;aHeGrisC;!toC;phCs;!eC;!r;st2t;d,rCs;b5leC;s,y;cDdrCs6;ic;il;lHmFrC;ey,lDroCy;ll;!o7t1;er1iC;lo;!eb,v3;a09eZiVjorn,laUoSrEuCyr1;ddy,rtKst2;er;aKeFiEuDyC;an,ce,on;ce,no;an,ce;nDtC;!t;dDtC;!on;an,on;dFnC;dDisC;lav;en,on;!foOl9y;bby,gd0rCyd;is;i0Lke;bElDshC;al;al,lL;ek;nIrCshoi;at,nEtC;!raC;m,nd;aDhaCie;rd;rd8;!iDjam3nCs1;ie,y;to;kaMlazs,nHrC;n9rDtC;!holomew;eCy;tt;ey;dCeD;ar,iC;le;ar1Nb1Dd16fon15gust3hm12i0Zja0Yl0Bm07nTputsiSrGsaFugustEveDyCziz;a0kh0;ry;o,us;hi;aMchiKiJjun,mHnEon,tCy0;em,hCie,ur8;ur;aDoC;!ld;ud,v;aCin;an,nd8;!el,ki;baCe;ld;ta;aq;aMdHgel8tCw6;hoFoC;iDnC;!i8y;ne;ny;er7rCy;eDzC;ej;!as,i,j,s,w;!s;s,tolC;iCy;!y;ar,iEmaCos;nu5r;el;ne,r,t;aVbSdBeJfHiGl01onFphonsEt1vC;aPin;on;e,o;so,zo;!sR;!onZrC;ed;c,jaHksFssaHxC;!andC;er,rC;e,os,u;andCei;ar,er,r;ndC;ro;en;eDrecC;ht;rt8;dd3in,n,sC;taC;ir;ni;dDm6;ar;an,en;ad,eC;d,t;in;so;aGi,olErDvC;ik;ian8;f8ph;!o;mCn;!a;dGeFraDuC;!bakr,lfazl;hCm;am;!l;allFel,oulaye,ulC;!lDrahm0;an;ah,o;ah;av,on",Uncountable:"true\xa60:2E;1:2L;2:33;a2Ub2Lc29d22e1Rf1Ng1Eh16i11j0Yk0Wl0Rm0Hn0Do0Cp03rZsLt9uran2Jv7w3you gu0E;a5his17i4oo3;d,l;ldlife,ne;rm8t1;apor,ernacul29i3;neg28ol1Otae;eDhBiAo8r4un3yranny;a,gst1B;aff2Oea1Ko4ue nor3;th;o08u3;bleshoot2Ose1Tt;night,othpas1Vwn3;foEsfoE;me off,n;er3und1;e,mod2S;a,nnis;aDcCeBhAi9ki8o7p6t4u3weepstak0;g1Unshi2Hshi;ati08e3;am,el;ace2Keci0;ap,cc1meth2C;n,ttl0;lk;eep,ingl0or1C;lf,na1Gri0;ene1Kisso1C;d0Wfe2l4nd,t3;i0Iurn;m1Ut;abi0e4ic3;e,ke15;c3i01laxa11search;ogni10rea10;a9e8hys7luto,o5re3ut2;amble,mis0s3ten20;en1Zs0L;l3rk;i28l0EyH; 16i28;a24tr0F;nt3ti0M;i0s;bstetri24vercrowd1Qxyg09;a5e4owada3utella;ys;ptu1Ows;il poliZtional securi2;aAe8o5u3;m3s1H;ps;n3o1K;ey,o3;gamy;a3cha0Elancholy,rchandi1Htallurgy;sl0t;chine3g1Aj1Hrs,thema1Q; learn1Cry;aught1e6i5ogi4u3;ck,g12;c,s1M;ce,ghtn18nguis1LteratWv1;ath1isVss;ara0EindergartPn3;icke0Aowled0Y;e3upit1;a3llyfiGwel0G;ns;ce,gnor6mp5n3;forma00ter3;net,sta07;atiSort3rov;an18;a7e6isto09o3ung1;ckey,mework,ne4o3rseradi8spitali2use arrest;ky;s2y;adquarteXre;ir,libut,ppiHs3;hi3te;sh;ene8l6o5r3um,ymnas11;a3eZ;niUss;lf,re;ut3yce0F;en; 3ti0W;edit0Hpo3;ol;aNicFlour,o4urnit3;ure;od,rgive3uri1wl;ness;arCcono0LducaBlectr9n7quip8thi0Pvery6x3;ist4per3;ti0B;en0J;body,o08th07;joy3tertain3;ment;ici2o3;ni0H;tiS;nings,th;emi02i6o4raugh3ynas2;ts;pe,wnstai3;rs;abet0ce,s3;honZrepu3;te;aDelciChAivi07l8o3urrency;al,ld w6mmenta5n3ral,ttIuscoB;fusiHt 3;ed;ry;ar;assi01oth0;es;aos,e3;eMwK;us;d,rO;a8i6lood,owlHread5u3;ntGtt1;er;!th;lliarJs3;on;g3ss;ga3;ge;cKdviJeroGirFmBn6ppeal court,r4spi3thleL;rin;ithmet3sen3;ic;i6y3;o4th3;ing;ne;se;en5n3;es2;ty;ds;craft;bi8d3nau7;yna3;mi6;ce;id,ous3;ti3;cs",Infinitive:"true\xa60:9G;1:9T;2:AD;3:90;4:9Z;5:84;6:AH;7:A9;8:92;9:A0;A:AG;B:AI;C:9V;D:8R;E:8O;F:97;G:6H;H:7D;a94b8Hc7Jd68e4Zf4Mg4Gh4Ai3Qj3Nk3Kl3Bm34nou48o2Vp2Equ2Dr1Es0CtZuTvRwI;aOeNiLors5rI;eJiI;ng,te;ak,st3;d5e8TthI;draw,er;a2d,ep;i2ke,nIrn;d1t;aIie;liADniAry;nJpI;ho8Llift;cov1dJear8Hfound8DlIplug,rav82tie,ve94;eaAo3X;erIo;cut,go,staAFvalA3w2G;aSeQhNoMrIu73;aIe72;ffi3Smp3nsI;aBfo7CpI;i8oD;pp3ugh5;aJiJrIwaD;eat5i2;nk;aImA0;ch,se;ck3ilor,keImp1r8L;! paD;a0Ic0He0Fh0Bi0Al08mugg3n07o05p02qu01tUuLwI;aJeeIim;p,t5;ll7Wy;bNccMffLggeCmmKppJrI;mouFpa6Zvi2;o0re6Y;ari0on;er,i4;e7Numb;li9KmJsiIveD;de,st;er9it;aMe8MiKrI;ang3eIi2;ng27w;fIng;f5le;b,gg1rI;t3ve;a4AiA;a4UeJit,l7DoI;il,of;ak,nd;lIot7Kw;icEve;atGeak,i0O;aIi6;m,y;ft,ng,t;aKi6CoJriIun;nk,v6Q;ot,rt5;ke,rp5tt1;eIll,nd,que8Gv1w;!k,m;aven9ul8W;dd5tis1Iy;a0FeKiJoI;am,t,ut;d,p5;a0Ab08c06d05f01group,hea00iZjoi4lXmWnVpTq3MsOtMup,vI;amp,eJiIo3B;sEve;l,rI;e,t;i8rI;ie2ofE;eLiKpo8PtIurfa4;o24rI;aHiBuctu8;de,gn,st;mb3nt;el,hra0lIreseF;a4e71;d1ew,o07;aHe3Fo2;a7eFiIo6Jy;e2nq41ve;mbur0nf38;r0t;inKleBocus,rJuI;el,rbiA;aBeA;an4e;aBu4;ei2k8Bla43oIyc3;gni39nci3up,v1;oot,uI;ff;ct,d,liIp;se,ze;tt3viA;aAenGit,o7;aWerUinpoiFlumm1LoTrLuI;b47ke,niArIt;poDsuI;aFe;eMoI;cKd,fe4XhibEmo7noJpo0sp1tru6vI;e,i6o5L;un4;la3Nu8;aGclu6dJf1occupy,sup0JvI;a6BeF;etermi4TiB;aGllu7rtr5Ksse4Q;cei2fo4NiAmea7plex,sIva6;eve8iCua6;mp1rItrol,ve;a6It6E;bOccuNmEpMutLverIwe;l07sJtu6Yu0wI;helm;ee,h1F;gr5Cnu2Cpa4;era7i4Ipo0;py,r;ey,seItaH;r2ss;aMe0ViJoIultiply;leCu6Pw;micJnIspla4;ce,g3us;!k;iIke,na9;m,ntaH;aPeLiIo0u3N;ke,ng1quIv5;eIi6S;fy;aKnIss5;d,gI;th5;rn,ve;ng2Gu1N;eep,idnJnI;e4Cow;ap;oHuI;gg3xtaI;po0;gno8mVnIrk;cTdRfQgeChPitia7ju8q1CsNtKun6EvI;a6eIo11;nt,rt,st;erJimi6BoxiPrI;odu4u6;aBn,pr03ru6C;iCpi8tIu8;all,il,ruB;abEibE;eCo3Eu0;iIul9;ca7;i7lu6;b5Xmer0pI;aLer4Uin9ly,oJrI;e3Ais6Bo2;rt,se,veI;riA;le,rt;aLeKiIoiCuD;de,jaInd1;ck;ar,iT;mp1ng,pp5raIve;ng5Mss;ath1et,iMle27oLrI;aJeIow;et;b,pp3ze;!ve5A;gg3ve;aTer45i5RlSorMrJuI;lf4Cndrai0r48;eJiIolic;ght5;e0Qsh5;b3XeLfeEgJsI;a3Dee;eIi2;!t;clo0go,shIwa4Z;ad3F;att1ee,i36;lt1st5;a0OdEl0Mm0FnXquip,rWsVtGvTxI;aRcPeDhOiNpJtIu6;ing0Yol;eKi8lIo0un9;aHoI;it,re;ct,di7l;st,t;a3oDu3B;e30lI;a10u6;lt,mi28;alua7oI;ke,l2;chew,pou0tab19;a0u4U;aYcVdTfSgQhan4joy,lPqOrNsuMtKvI;e0YisI;a9i50;er,i4rI;aHenGuC;e,re;iGol0F;ui8;ar9iC;a9eIra2ulf;nd1;or4;ang1oIu8;r0w;irc3lo0ou0ErJuI;mb1;oaGy4D;b3ct;bKer9pI;hasiIow1;ze;aKody,rI;a4oiI;d1l;lm,rk;ap0eBuI;ci40de;rIt;ma0Rn;a0Re04iKo,rIwind3;aw,ed9oI;wn;agno0e,ff1g,mi2Kne,sLvI;eIul9;rIst;ge,t;aWbVcQlod9mant3pNru3TsMtI;iIoDu37;lJngI;uiA;!l;ol2ua6;eJlIo0ro2;a4ea0;n0r0;a2Xe36lKoIu0S;uIv1;ra9;aIo0;im;a3Kur0;b3rm;af5b01cVduBep5fUliTmQnOpMrLsiCtaGvI;eIol2;lop;ch;a20i2;aDiBloIoD;re,y;oIy;te,un4;eJoI;liA;an;mEv1;a4i0Ao06raud,y;ei2iMla8oKrI;ee,yI;!pt;de,mIup3;missi34po0;de,ma7ph1;aJrief,uI;g,nk;rk;mp5rk5uF;a0Dea0h0Ai09l08oKrIurta1G;a2ea7ipp3uI;mb3;ales4e04habEinci6ll03m00nIrro6;cXdUfQju8no7qu1sLtKvI;eIin4;ne,r9y;aHin2Bribu7;er2iLoli2Epi8tJuI;lt,me;itu7raH;in;d1st;eKiJoIroFu0;rm;de,gu8rm;ss;eJoI;ne;mn,n0;eIlu6ur;al,i2;buCe,men4pI;eIi3ly;l,te;eBi6u6;r4xiC;ean0iT;rcumveFte;eJirp,oI;o0p;riAw;ncIre5t1ulk;el;a02eSi6lQoPrKuI;iXrIy;st,y;aLeaKiJoad5;en;ng;stfeLtX;ke;il,l11mba0WrrMth1;eIow;ed;!coQfrie1LgPhMliLqueaKstJtrIwild1;ay;ow;th;e2tt3;a2eJoI;ld;ad;!in,ui3;me;bysEckfi8ff3tI;he;b15c0Rd0Iff0Ggree,l0Cm09n03ppZrXsQttOuMvJwaE;it;eDoI;id;rt;gIto0X;meF;aIeCraB;ch,in;pi8sJtoI;niA;aKeIi04u8;mb3rt,ss;le;il;re;g0Hi0ou0rI;an9i2;eaKly,oiFrI;ai0o2;nt;r,se;aMi0GnJtI;icipa7;eJoIul;un4y;al;ly0;aJu0;se;lga08ze;iKlI;e9oIu6;t,w;gn;ix,oI;rd;a03jNmiKoJsoI;rb;pt,rn;niIt;st1;er;ouJuC;st;rn;cLhie2knowled9quiItiva7;es4re;ce;ge;eQliOoKrJusI;e,tom;ue;mIst;moJpI;any,liA;da7;ma7;te;pt;andPduBet,i6oKsI;coKol2;ve;liArt,uI;nd;sh;de;ct;on",Person:"true\xa60:1Q;a29b1Zc1Md1Ee18f15g13h0Ri0Qj0Nk0Jl0Gm09n06o05p00rPsItCusain bolt,v9w4xzibit,y1;anni,oko on2uji,v1;an,es;en,o;a3ednesday adams,i2o1;lfram,o0Q;ll ferrell,z khalifa;lt disn1Qr1;hol,r0G;a2i1oltai06;n dies0Zrginia wo17;lentino rossi,n goG;a4h3i2ripp,u1yra banks;lZpac shakur;ger woods,mba07;eresa may,or;kashi,t1ylor;um,ya1B;a5carlett johanss0h4i3lobodan milosevic,no2ocr1Lpider1uperm0Fwami; m0Em0E;op dogg,w whi1H;egfried,nbad;akespeaTerlock holm1Sia labeouf;ddam hussa16nt1;a cla11ig9;aAe6i5o3u1za;mi,n dmc,paul,sh limbau1;gh;bin hood,d stew16nald1thko;in0Mo;han0Yngo starr,valdo;ese witherspo0i1mbrandt;ll2nh1;old;ey,y;chmaninoff,ffi,iJshid,y roma1H;a4e3i2la16o1uff daddy;cahont0Ie;lar,p19;le,rZ;lm17ris hilt0;leg,prah winfr0Sra;a2e1iles cra1Bostradam0J; yo,l5tt06wmQ;pole0s;a5e4i2o1ubar03;by,lie5net,rriss0N;randa ju1tt romn0M;ly;rl0GssiaB;cklemo1rkov,s0ta hari,ya angelou;re;ady gaga,e1ibera0Pu;bron jam0Xch wale1e;sa;anye west,e3i1obe bryant;d cudi,efer suther1;la0P;ats,sha;a2effers0fk,k rowling,rr tolki1;en;ck the ripp0Mwaharlal nehru,y z;liTnez,ron m7;a7e5i3u1;lk hog5mphrey1sa01;! bog05;l1tl0H;de; m1dwig,nry 4;an;ile selassFlle ber4m3rrison1;! 1;ford;id,mo09;ry;ast0iannis,o1;odwPtye;ergus0lorence nightinga08r1;an1ederic chopN;s,z;ff5m2nya,ustaXzeki1;el;eril lagasse,i1;le zatop1nem;ek;ie;a6e4i2octor w1rake;ho;ck w1ego maradoC;olf;g1mi lovaOnzel washingt0;as;l1nHrth vadR;ai lNt0;a8h5lint0o1thulhu;n1olio;an,fuci1;us;on;aucKop2ristian baMy1;na;in;millo,ptain beefhe4r1;dinal wols2son1;! palmF;ey;art;a8e5hatt,i3oHro1;ck,n1;te;ll g1ng crosby;atB;ck,nazir bhut2rtil,yon1;ce;to;nksy,rack ob1;ama;l 6r3shton kutch2vril lavig8yn ra1;nd;er;chimed2istot1;le;es;capo2paci1;no;ne",Adjective:"true\xa60:AI;1:BS;2:BI;3:BA;4:A8;5:84;6:AV;7:AN;8:AF;9:7H;A:BQ;B:AY;C:BC;D:BH;E:9Y;aA2b9Ec8Fd7We79f6Ng6Eh61i4Xj4Wk4Tl4Im41n3Po36p2Oquart7Pr2Ds1Dt14uSvOwFye29;aMeKhIiHoF;man5oFrth7G;dADzy;despreB1n w97s86;acked1UoleF;!sa6;ather1PeFll o70ste1D;!k5;nt1Ist6Ate4;aHeGiFola5T;bBUce versa,gi3Lle;ng67rsa5R;ca1gBSluAV;lt0PnLpHrGsFttermoBL;ef9Ku3;b96ge1; Hb32pGsFtiAH;ca6ide d4R;er,i85;f52to da2;a0Fbeco0Hc0Bd04e02f01gu1XheaBGiXkn4OmUnTopp06pRrNsJtHus0wF;aFiel3K;nt0rra0P;app0eXoF;ld,uS;eHi37o5ApGuF;perv06spec39;e1ok9O;en,ttl0;eFu5;cogn06gul2RlGqu84sF;erv0olv0;at0en33;aFrecede0E;id,rallel0;am0otic0;aFet;rri0tF;ch0;nFq26vers3;sur0terFv7U;eFrupt0;st0;air,inish0orese98;mploy0n7Ov97xpF;ect0lain0;eHisFocume01ue;clFput0;os0;cid0rF;!a8Scov9ha8Jlyi8nea8Gprivileg0sMwF;aFei9I;t9y;hGircumcFonvin2U;is0;aFeck0;lleng0rt0;b20ppea85ssuGttend0uthorF;iz0;mi8;i4Ara;aLeIhoHip 25oGrF;anspare1encha1i2;geth9leADp notch,rpB;rny,ugh6H;ena8DmpGrFs6U;r49tia4;eCo8P;leFst4M;nt0;a0Dc09e07h06i04ki03l01mug,nobbi4XoVpRqueami4XtKuFymb94;bHccinAi generis,pFr5;erFre7N;! dup9b,vi70;du0li7Lp6IsFurb7J;eq9Atanda9X;aKeJi16o2QrGubboFy4Q;rn;aightFin5GungS; fFfF;or7V;adfa9Pri6;lwa6Ftu82;arHeGir6NlendBot Fry;on;c3Qe1S;k5se; call0lImb9phistic16rHuFviV;ndFth1B;proof;dBry;dFub6; o2A;e60ipF;pe4shod;ll0n d7R;g2HnF;ceEg6ist9;am3Se9;co1Zem5lfFn6Are7; suf4Xi43;aGholFient3A;ar5;rlFt4A;et;cr0me,tisfac7F;aOeIheumatoBiGoF;bu8Ztt7Gy3;ghtFv3; 1Sf6X;cJdu8PlInown0pro69sGtF;ard0;is47oF;lu2na1;e1Suc45;alcit8Xe1ondi2;bBci3mpa1;aSePicayu7laOoNrGuF;bl7Tnjabi;eKiIoF;b7VfGmi49pFxi2M;er,ort81;a7uD;maFor,sti7va2;!ry;ciDexis0Ima2CpaB;in55puli8G;cBid;ac2Ynt 3IrFti2;ma40tFv7W;!i3Z;i2YrFss7R;anoBtF; 5XiF;al,s5V;bSffQkPld OnMrLth9utKverF;!aIbMdHhGni75seas,t,wF;ei74rou74;a63e7A;ue;ll;do1Ger,si6A;d3Qg2Aotu5Z; bFbFe on o7g3Uli7;oa80;fashion0school;!ay; gua7XbFha5Uli7;eat;eHligGsF;ce7er0So1C;at0;diFse;a1e1;aOeNiMoGuF;anc0de; moEnHrthFt6V;!eFwe7L;a7Krn;chaGdescri7Iprof30sF;top;la1;ght5;arby,cessa4ighbor5wlyw0xt;k0usiaFv3;ti8;aQeNiLoHuF;dIltiF;facet0p6;deHlGnFot,rbBst;ochro4Xth5;dy;rn,st;ddle ag0nF;dbloZi,or;ag9diocEga,naGrFtropolit4Q;e,ry;ci8;cIgenta,inHj0Fkeshift,mmGnFri4Oscu61ver18;da5Dy;ali4Lo4U;!stream;abEho;aOeLiIoFumberi8;ngFuti1R;stan3RtF;erm,i4H;ghtGteraF;l,ry,te;heart0wei5O;ft JgFss9th3;al,eFi0M;nda4;nguBps0te5;apGind5noF;wi8;ut;ad0itte4uniW;ce co0Hgno6Mll0Cm04nHpso 2UrF;a2releF;va1; ZaYcoWdReQfOgrNhibi4Ri05nMoLsHtFvalu5M;aAeF;nDrdepe2K;a7iGolFuboI;ub6ve1;de,gF;nifica1;rdi5N;a2er;own;eriIiLluenVrF;ar0eq5H;pt,rt;eHiGoFul1O;or;e,reA;fiFpe26termi5E;ni2;mpFnsideCrreA;le2;ccuCdeq5Ene,ppr4J;fFsitu,vitro;ro1;mJpF;arHeGl15oFrop9;li2r11;n2LrfeA;ti3;aGeFi18;d4BnD;tuE;egGiF;c0YteC;al,iF;tiF;ma2;ld;aOelNiLoFuma7;a4meInHrrGsFur5;ti6;if4E;e58o3U; ma3GsF;ick;ghfalut2HspF;an49;li00pf33;i4llow0ndGrdFtM; 05coEworki8;sy,y;aLener44iga3Blob3oKrGuF;il1Nng ho;aFea1Fizzl0;cGtF;ef2Vis;ef2U;ld3Aod;iFuc2D;nf2R;aVeSiQlOoJrF;aGeFil5ug3;q43tf2O;gFnt3S;i6ra1;lk13oHrF; keeps,eFge0Vm9tu41;g0Ei2Ds3R;liF;sh;ag4Mowe4uF;e1or45;e4nF;al,i2;d Gmini7rF;ti6ve1;up;bl0lDmIr Fst pac0ux;oGreacF;hi8;ff;ed,ili0R;aXfVlTmQnOqu3rMthere3veryday,xF;aApIquisi2traHuF;be48lF;ta1;!va2L;edRlF;icF;it;eAstF;whi6; Famor0ough,tiE;rou2sui2;erGiF;ne1;ge1;dFe2Aoq34;er5;ficF;ie1;g9sF;t,ygF;oi8;er;aWeMiHoGrFue;ea4owY;ci6mina1ne,r31ti8ubQ;dact2Jfficult,m,sGverF;ge1se;creGePjoi1paCtF;a1inA;et,te; Nadp0WceMfiLgeneCliJmuEpeIreliAsGvoF;id,ut;pFtitu2ul1L;eCoF;nde1;ca2ghF;tf13;a1ni2;as0;facto;i5ngero0I;ar0Ce09h07i06l05oOrIuF;rmudgeon5stoma4teF;sy;ly;aIeHu1EystalF; cleFli7;ar;epy;fFv17z0;ty;erUgTloSmPnGrpoCunterclVveFy;rt;cLdJgr21jIsHtrF;aFi2;dic0Yry;eq1Yta1;oi1ug3;escenFuN;di8;a1QeFiD;it0;atoDmensuCpF;ass1SulF;so4;ni3ss3;e1niza1;ci1J;ockwiD;rcumspeAvil;eFintzy;e4wy;leGrtaF;in;ba2;diac,ef00;a00ePiLliJoGrFuck nak0;and new,isk,on22;gGldface,naF; fi05fi05;us;nd,tF;he;gGpartisFzarE;an;tiF;me;autifOhiNlLnHsFyoN;iWtselF;li8;eGiFt;gn;aFfi03;th;at0oF;v0w;nd;ul;ckwards,rF;e,rT; priori,b13c0Zd0Tf0Ng0Ihe0Hl09mp6nt06pZrTsQttracti0MuLvIwF;aGkF;wa1B;ke,re;ant garGeraF;ge;de;diIsteEtF;heFoimmu7;nt07;re;to4;hGlFtu2;eep;en;bitIchiv3roHtF;ifiFsy;ci3;ga1;ra4;ry;pFt;aHetizi8rF;oprF;ia2;llFre1;ed,i8;ng;iquFsy;at0e;ed;cohKiJkaHl,oGriFterX;ght;ne,of;li7;ne;ke,ve;olF;ic;ad;ain07gressiIi6rF;eeF;ab6;le;ve;fGraB;id;ectGlF;ue1;ioF;na2; JaIeGvF;erD;pt,qF;ua2;ma1;hoc,infinitum;cuCquiGtu3u2;al;esce1;ra2;erSjeAlPoNrKsGuF;nda1;e1olu2trF;aAuD;se;te;eaGuF;pt;st;aFve;rd;aFe;ze;ct;ra1;nt",Pronoun:"true\xa6elle,h3i2me,she,th0us,we,you;e0ou;e,m,y;!l,t;e,im",Preposition:"true\xa6aPbMcLdKexcept,fIinGmid,notwithstandiWoDpXqua,sCt7u4v2w0;/o,hereSith0;! whHin,oW;ersus,i0;a,s a vis;n1p0;!on;like,til;h1ill,oward0;!s;an,ereby,r0;ough0u;!oM;ans,ince,o that,uch G;f1n0ut;!to;!f;! 0to;effect,part;or,r0;om;espite,own,u3;hez,irca;ar1e0oBy;sides,tween;ri7;bo8cross,ft7lo6m4propos,round,s1t0;!op;! 0;a whole,long 0;as;id0ong0;!st;ng;er;ut",SportsTeam:"true\xa60:18;1:1E;2:1D;3:14;a1Db15c0Sd0Kfc dallas,g0Ihouston 0Hindiana0Gjacksonville jagua0k0El0Am01new UoRpKqueens parkJreal salt lake,sBt6utah jazz,vancouver whitecaps,w4yW;ashington 4h10;natio1Mredski2wizar0W;ampa bay 7e6o4;ronto 4ttenham hotspur;blue ja0Mrapto0;nnessee tita2xasD;buccanee0ra0K;a8eattle 6porting kansas0Wt4; louis 4oke0V;c1Drams;marine0s4;eah13ounH;cramento Rn 4;antonio spu0diego 4francisco gJjose earthquak1;char08paB; ran07;a9h6ittsburgh 5ortland t4;imbe0rail blaze0;pirat1steele0;il4oenix su2;adelphia 4li1;eagl1philNunE;dr1;akland 4klahoma city thunder,rlando magic;athle0Lrai4;de0;england 8orleans 7york 4;g5je3knYme3red bul0Xy4;anke1;ian3;pelica2sain3;patrio3revolut4;ion;anchEeAi4ontreal impact;ami 8lwaukee b7nnesota 4;t5vi4;kings;imberwolv1wi2;rewe0uc0J;dolphi2heat,marli2;mphis grizz4ts;li1;a6eic5os angeles 4;clippe0dodFlaB;esterV; galaxy,ke0;ansas city 4nF;chiefs,roya0D; pace0polis col3;astr05dynamo,rocke3texa2;olden state warrio0reen bay pac4;ke0;allas 8e4i04od6;nver 6troit 4;lio2pisto2ti4;ge0;broncYnugge3;cowbo5maver4;icZ;ys;arEelLhAincinnati 8leveland 6ol4;orado r4umbus crew sc;api7ocki1;brow2cavalie0guar4in4;dia2;bengaVre4;ds;arlotte horAicago 4;b5cubs,fire,wh4;iteB;ea0ulQ;diff4olina panthe0; city;altimore Alackburn rove0oston 6rooklyn 4uffalo bilN;ne3;ts;cel5red4; sox;tics;rs;oriol1rave2;rizona Ast8tlanta 4;brav1falco2h4;awA;ns;es;on villa,r4;os;c6di4;amondbac4;ks;ardi4;na4;ls",Unit:"true\xa6a07b04cXdWexVfTgRhePinYjoule0BkMlJmDnan08oCp9quart0Bsq ft,t7volts,w6y2ze3\xb01\xb50;g,s;c,f,n;dVear1o0;ttR; 0s 0;old;att,b;erNon0;!ne02;ascals,e1i0;cXnt00;rcent,tJ;hms,unceY;/s,e4i0m\xb2,\xb2,\xb3;/h,cro2l0;e0liK;!\xb2;grLsR;gCtJ;it1u0;menQx;erPreP;b5elvins,ilo1m0notO;/h,ph,\xb2;!byGgrEmCs;ct0rtzL;aJogrC;allonJb0ig3rB;ps;a0emtEl oz,t4;hrenheit,radG;aby9;eci3m1;aratDe1m0oulombD;\xb2,\xb3;lsius,nti0;gr2lit1m0;et0;er8;am7;b1y0;te5;l,ps;c2tt0;os0;econd1;re0;!s","Noun|Gerund":"true\xa60:3O;1:3M;2:3N;3:3D;4:32;5:2V;6:3E;7:3K;8:36;9:3J;A:3B;a3Pb37c2Jd27e23f1Vg1Sh1Mi1Ij1Gk1Dl18m13n11o0Wp0Pques0Sr0EsTtNunderMvKwFyDzB;eroi0oB;ni0o3P;aw2eB;ar2l3;aEed4hispe5i5oCrB;ap8est3i1;n0ErB;ki0r31;i1r2s9tc9;isualizi0oB;lunt1Vti0;stan4ta6;aFeDhin6iCraBy8;c6di0i2vel1M;mi0p8;aBs1;c9si0;l6n2s1;aUcReQhOiMkatKl2Wmo6nowJpeItFuCwB;ea5im37;b35f0FrB;fi0vB;e2Mi2J;aAoryt1KrCuB;d2KfS;etc9ugg3;l3n4;bCi0;ebBi0;oar4;gnBnAt1;a3i0;ip8oB;p8rte2u1;a1r27t1;hCo5reBulp1;a2Qe2;edu3oo3;i3yi0;aKeEi4oCuB;li0n2;oBwi0;fi0;aFcEhear7laxi0nDpor1sB;pon4tructB;r2Iu5;de5;or4yc3;di0so2;p8ti0;aFeacek20laEoCrBublis9;a1Teten4in1oces7;iso2siB;tio2;n2yi0;ckaAin1rB;ki0t1O;fEpeDrganiCvB;erco24ula1;si0zi0;ni0ra1;fe5;avi0QeBur7;gotia1twor6;aDeCi2oB;de3nito5;a2dita1e1ssaA;int0XnBrke1;ifUufactu5;aEeaDiBodAyi0;cen7f1mi1stB;e2i0;r2si0;n4ug9;iCnB;ea4it1;c6l3;ogAuB;dAgg3stif12;ci0llust0VmDnBro2;nova1sp0NterBven1;ac1vie02;agi2plo4;aDea1iCoBun1;l4w3;ki0ri0;nd3rB;roWvB;es1;aCene0Lli4rBui4;ee1ie0N;rde2the5;aHeGiDlCorBros1un4;e0Pmat1;ir1oo4;gh1lCnBs9;anZdi0;i0li0;e3nX;r0Zscina1;a1du01nCxB;erci7plo5;chan1di0ginB;ee5;aLeHiGoub1rCum8wB;el3;aDeCiB;bb3n6vi0;a0Qs7;wi0;rTscoDvi0;ba1coZlBvelo8;eCiB;ve5;ga1;nGti0;aVelebUhSlPoDrBur3yc3;aBos7yi0;f1w3;aLdi0lJmFnBo6pi0ve5;dDsCvinB;ci0;trBul1;uc1;muniDpB;lBo7;ai2;ca1;lBo5;ec1;c9ti0;ap8eaCimToBubT;ni0t9;ni0ri0;aBee5;n1t1;ra1;m8rCs1te5;ri0;vi0;aPeNitMlLoGrDuB;dge1il4llBr8;yi0;an4eat9oadB;cas1;di0;a1mEokB;i0kB;ee8;pi0;bi0;es7oa1;c9i0;gin2lonAt1;gi0;bysit1c6ki0tt3;li0;ki0;bando2cGdverti7gi0pproac9rgDssuCtB;trac1;mi0;ui0;hi0;si0;coun1ti0;ti0;ni0;ng",PhrasalVerb:"true\xa60:92;1:96;2:8H;3:8V;4:8A;5:83;6:85;7:98;8:90;9:8G;A:8X;B:8R;C:8U;D:8S;E:70;F:97;G:8Y;H:81;I:7H;J:79;a9Fb7Uc6Rd6Le6Jf5Ig50h4Biron0j47k40l3Em31n2Yo2Wp2Cquiet Hr1Xs0KtZuXvacuu6QwNyammerBzK;ero Dip LonK;e0k0;by,ov9up;aQeMhLiKor0Mrit19;mp0n3Fpe0r5s5;ackAeel Di0S;aLiKn33;gh 3Wrd0;n Dr K;do1in,oJ;it 79k5lk Lrm 69sh Kt83v60;aw3do1o7up;aw3in,oC;rgeBsK;e 2herE;a00eYhViRoQrMuKypP;ckErn K;do1in,oJup;aLiKot0y 30;ckl7Zp F;ck HdK;e 5Y;n7Wp 3Es5K;ck MdLe Kghten 6me0p o0Rre0;aw3ba4do1in,up;e Iy 2;by,oG;ink Lrow K;aw3ba4in,up;ba4ov9up;aKe 77ll62;m 2r 5M;ckBke Llk K;ov9shit,u47;aKba4do1in,leave,o4Dup;ba4ft9pa69w3;a0Vc0Te0Mh0Ii0Fl09m08n07o06p01quar5GtQuOwK;earMiK;ngLtch K;aw3ba4o8K; by;cKi6Bm 2ss0;k 64;aReQiPoNrKud35;aigh2Det75iK;ke 7Sng K;al6Yup;p Krm2F;by,in,oG;c3Ln3Lr 2tc4O;p F;c3Jmp0nd LrKveAy 2O;e Ht 2L;ba4do1up;ar3GeNiMlLrKurB;ead0ingBuc5;a49it 6H;c5ll o3Cn 2;ak Fe1Xll0;a3Bber 2rt0und like;ap 5Vow Duggl5;ash 6Noke0;eep NiKow 6;cLp K;o6Dup;e 68;in,oK;ff,v9;de19gn 4NnKt 6Gz5;gKkE; al6Ale0;aMoKu5W;ot Kut0w 7M;aw3ba4f48oC;c2WdeEk6EveA;e Pll1Nnd Orv5tK; Ktl5J;do1foLin,o7upK;!on;ot,r5Z;aw3ba4do1in,o33up;oCto;al66out0rK;ap65ew 6J;ilAv5;aXeUiSoOuK;b 5Yle0n Kstl5;aLba4do1inKo2Ith4Nu5P;!to;c2Xr8w3;ll Mot LpeAuK;g3Ind17;a2Wf3Po7;ar8in,o7up;ng 68p oKs5;ff,p18;aKelAinEnt0;c6Hd K;o4Dup;c27t0;aZeYiWlToQrOsyc35uK;ll Mn5Kt K;aKba4do1in,oJto47up;pa4Dw3;a3Jdo1in,o21to45up;attleBess KiNop 2;ah2Fon;iLp Kr4Zu1Gwer 6N;do1in,o6Nup;nt0;aLuK;gEmp 6;ce u20y 6D;ck Kg0le 4An 6p5B;oJup;el 5NncilE;c53ir 39n0ss MtLy K;ba4oG; Hc2R;aw3ba4in,oJ;pKw4Y;e4Xt D;aLerd0oK;dAt53;il Hrrow H;aTeQiPoLuK;ddl5ll I;c1FnkeyMp 6uthAve K;aKdo1in,o4Lup;l4Nw3; wi4K;ss0x 2;asur5e3SlLss K;a21up;t 6;ke Ln 6rKs2Ax0;k 6ryA;do,fun,oCsure,up;a02eViQoLuK;ck0st I;aNc4Fg MoKse0;k Kse4D;aft9ba4do1forw37in56o0Zu46;in,oJ;d 6;e NghtMnLsKve 00;ten F;e 2k 2; 2e46;ar8do1in;aMt LvelK; oC;do1go,in,o7up;nEve K;in,oK;pKut;en;c5p 2sh LtchBughAy K;do1o59;in4Po7;eMick Lnock K;do1oCup;oCup;eLy K;in,up;l Ip K;aw3ba4do1f04in,oJto,up;aMoLuK;ic5mpE;ke3St H;c43zz 2;a01eWiToPuK;nLrrKsh 6;y 2;keLt K;ar8do1;r H;lKneErse3K;d Ke 2;ba4dKfast,o0Cup;ear,o1;de Lt K;ba4on,up;aw3o7;aKlp0;d Ml Ir Kt 2;fKof;rom;f11in,o03uW;cPm 2nLsh0ve Kz2P;at,it,to;d Lg KkerP;do1in,o2Tup;do1in,oK;ut,v9;k 2;aZeTive Rloss IoMrLunK; f0S;ab hold,in43ow 2U; Kof 2I;aMb1Mit,oLr8th1IuK;nd9;ff,n,v9;bo7ft9hQw3;aw3bKdo1in,oJrise,up,w3;a4ir2H;ar 6ek0t K;aLb1Fdo1in,oKr8up;ff,n,ut,v9;cLhKl2Fr8t,w3;ead;ross;d aKng 2;bo7;a0Ee07iYlUoQrMuK;ck Ke2N;ar8up;eLighten KownBy 2;aw3oG;eKshe27; 2z5;g 2lMol Krk I;aKwi20;bo7r8;d 6low 2;aLeKip0;sh0;g 6ke0mKrKtten H;e F;gRlPnNrLsKzzle0;h F;e Km 2;aw3ba4up;d0isK;h 2;e Kl 1T;aw3fPin,o7;ht ba4ure0;ePnLsK;s 2;cMd K;fKoG;or;e D;d04l 2;cNll Krm0t1G;aLbKdo1in,o09sho0Eth08victim;a4ehi2O;pa0C;e K;do1oGup;at Kdge0nd 12y5;in,o7up;aOi1HoNrK;aLess 6op KuN;aw3b03in,oC;gBwB; Ile0ubl1B;m 2;a0Ah05l02oOrLut K;aw3ba4do1oCup;ackBeep LoKy0;ss Dwd0;by,do1in,o0Uup;me NoLuntK; o2A;k 6l K;do1oG;aRbQforOin,oNtKu0O;hLoKrue;geth9;rough;ff,ut,v9;th,wK;ard;a4y;paKr8w3;rt;eaLose K;in,oCup;n 6r F;aNeLiK;ll0pE;ck Der Kw F;on,up;t 2;lRncel0rOsMtch LveE; in;o1Nup;h Dt K;doubt,oG;ry LvK;e 08;aw3oJ;l Km H;aLba4do1oJup;ff,n,ut;r8w3;a0Ve0MiteAl0Fo04rQuK;bblNckl05il0Dlk 6ndl05rLsKtMy FzzA;t 00;n 0HsK;t D;e I;ov9;anWeaUiLush K;oGup;ghQng K;aNba4do1forMin,oLuK;nd9p;n,ut;th;bo7lKr8w3;ong;teK;n 2;k K;do1in,o7up;ch0;arTg 6iRn5oPrNssMttlLunce Kx D;aw3ba4;e 6; ar8;e H;do1;k Dt 2;e 2;l 6;do1up;d 2;aPeed0oKurt0;cMw K;aw3ba4do1o7up;ck;k K;in,oC;ck0nk0stA; oQaNef 2lt0nd K;do1ov9up;er;up;r Lt K;do1in,oCup;do1o7;ff,nK;to;ck Pil0nMrgLsK;h D;ainBe D;g DkB; on;in,o7;aw3do1in,oCup;ff,ut;ay;ct FdQir0sk MuctionA; oG;ff;ar8o7;ouK;nd; o7;d K;do1oKup;ff,n;wn;o7up;ut",ProperNoun:"true\xa6aIbDc8dalhousHe7f5gosford,h4iron maiden,kirby,landsdowne,m2nis,r1s0wembF;herwood,paldiB;iel,othwe1;cgi0ercedes,issy;ll;intBudsB;airview,lorence,ra0;mpt9nco;lmo,uro;a1h0;arlt6es5risti;rl0talina;et4i0;ng;arb3e0;et1nt0rke0;ley;on;ie;bid,jax","Person|Place":"true\xa6a8d6h4jordan,k3orlando,s1vi0;ctor9rgin9;a0ydney;lvador,mara,ntia4;ent,obe;amil0ous0;ton;arw2ie0;go;lexandr1ust0;in;ia",LastName:"true\xa60:BR;1:BF;2:B5;3:BH;4:AX;5:9Y;6:B6;7:BK;8:B0;9:AV;A:AL;B:8Q;C:8G;D:7K;E:BM;F:AH;aBDb9Zc8Wd88e81f7Kg6Wh64i60j5Lk4Vl4Dm39n2Wo2Op25quispe,r1Ls0Pt0Ev03wTxSyKzG;aIhGimmerm6A;aGou,u;ng,o;khar5ytsE;aKeun9BiHoGun;koya32shiBU;!lG;diGmaz;rim,z;maGng;da,g52mo83sGzaC;aChiBV;iao,u;aLeJiHoGright,u;jcA5lff,ng;lGmm0nkl0sniewsC;kiB1liams33s3;bGiss,lt0;b,er,st0;a6Vgn0lHtG;anabe,s3;k0sh,tG;e2Non;aLeKiHoGukD;gt,lk5roby5;dHllalGnogr3Kr1Css0val3S;ba,ob1W;al,ov4;lasHsel8W;lJn dIrgBEsHzG;qu7;ilyEqu7siljE;en b6Aijk,yk;enzueAIverde;aPeix1VhKi2j8ka43oJrIsui,uG;om5UrG;c2n0un1;an,emblA7ynisC;dorAMlst3Km4rrAth;atch0i8UoG;mHrG;are84laci79;ps3sG;en,on;hirDkah9Mnaka,te,varA;a06ch01eYhUiRmOoMtIuHvGzabo;en9Jobod3N;ar7bot4lliv2zuC;aIeHoG;i7Bj4AyanAB;ele,in2FpheBvens25;l8rm0;kol5lovy5re7Tsa,to,uG;ng,sa;iGy72;rn5tG;!h;l71mHnGrbu;at9cla9Egh;moBo7M;aIeGimizu;hu,vchG;en8Luk;la,r1G;gu9infe5YmGoh,pulveA7rra5P;jGyG;on5;evi6iltz,miHneid0roed0uGwarz;be3Elz;dHtG;!t,z;!t;ar4Th8ito,ka4OlJnGr4saCto,unde19v4;ch7dHtGz;a5Le,os;b53e16;as,ihDm4Po0Y;aVeSiPoJuHyG;a6oo,u;bio,iz,sG;so,u;bKc8Fdrigue67ge10j9YmJosevelt,sItHux,wG;e,li6;a9Ch;enb4Usi;a54e4L;erts15i93;bei4JcHes,vGzzo;as,e9;ci,hards12;ag2es,iHut0yG;es,nol5N;s,t0;dImHnGsmu97v6C;tan1;ir7os;ic,u;aUeOhMiJoHrGut8;asad,if6Zochazk27;lishc2GpGrti72u10we76;e3Aov51;cHe45nG;as,to;as70hl0;aGillips;k,m,n6I;a3Hde3Wete0Bna,rJtG;ersHrovGters54;!a,ic;!en,on;eGic,kiBss3;i9ra,tz,z;h86k,padopoulIrk0tHvG;ic,l4N;el,te39;os;bMconn2Ag2TlJnei6PrHsbor6XweBzG;dem7Rturk;ella4DtGwe6N;ega,iz;iGof7Hs8I;vGyn1R;ei9;aSri1;aPeNiJoGune50ym2;rHvGwak;ak4Qik5otn66;odahl,r4S;cholsZeHkolGls4Jx3;ic,ov84;ls1miG;!n1;ils3mG;co4Xec;gy,kaGray2sh,var38;jiGmu9shiG;ma;a07c04eZiWoMuHyeG;rs;lJnIrGssoli6S;atGp03r7C;i,ov4;oz,te58;d0l0;h2lOnNo0RrHsGza1A;er,s;aKeJiIoz5risHtG;e56on;!on;!n7K;au,i9no,t5J;!lA;r1Btgome59;i3El0;cracFhhail5kkeHlG;l0os64;ls1;hmeJiIj30lHn3Krci0ssiGyer2N;!er;n0Po;er,j0;dDti;cartHlG;aughl8e2;hy;dQe7Egnu68i0jer3TkPmNnMrItHyG;er,r;ei,ic,su21thews;iHkDquAroqu8tinG;ez,s;a5Xc,nG;!o;ci5Vn;a5UmG;ad5;ar5e6Kin1;rig77s1;aVeOiLoJuHyG;!nch;k4nGo;d,gu;mbarGpe3Fvr4we;di;!nGu,yana2B;coln,dG;b21holm,strom;bedEfeKhIitn0kaHn8rGw35;oy;!j;m11tG;in1on1;bvGvG;re;iGmmy,ng,rs2Qu,voie,ws3;ne,t1F;aZeYh2iWlUnez50oNrJuHvar2woG;k,n;cerGmar68znets5;a,o34;aHem0isGyeziu;h23t3O;m0sni4Fus3KvG;ch4O;bay57ch,rh0Usk16vaIwalGzl5;czGsC;yk;cIlG;!cGen4K;huk;!ev4ic,s;e8uiveG;rt;eff0kGl4mu9nnun1;ucF;ll0nnedy;hn,llKminsCne,pIrHstra3Qto,ur,yGzl5;a,s0;j0Rls22;l2oG;or;oe;aPenOha6im14oHuG;ng,r4;e32hInHrge32u6vG;anD;es,ss3;anHnsG;en,on,t3;nesGs1R;en,s1;kiBnings,s1;cJkob4EnGrv0E;kDsG;en,sG;en0Ion;ks3obs2A;brahimDglesi5Nke5Fl0Qno07oneIshikHto,vanoG;u,v54;awa;scu;aVeOiNjaltal8oIrist50uG;!aGb0ghAynh;m2ng;a6dz4fIjgaa3Hk,lHpUrGwe,x3X;ak1Gvat;mAt;er,fm3WmG;ann;ggiBtchcock;iJmingw4BnHrGss;nand7re9;deGriks1;rs3;kkiHnG;on1;la,n1;dz4g1lvoQmOns0ZqNrMsJuIwHyG;asFes;kiB;g1ng;anHhiG;mo14;i,ov0J;di6p0r10t;ue;alaG;in1;rs1;aVeorgUheorghe,iSjonRoLrJuGw3;errGnnar3Co,staf3Ctierr7zm2;a,eG;ro;ayli6ee2Lg4iffithGub0;!s;lIme0UnHodGrbachE;e,m2;calvAzale0S;dGubE;bGs0E;erg;aj,i;bs3l,mGordaO;en7;iev3U;gnMlJmaIndFo,rGsFuthi0;cGdn0za;ia;ge;eaHlG;agh0i,o;no;e,on;aVerQiLjeldsted,lKoIrHuG;chs,entAji41ll0;eem2iedm2;ntaGrt8urni0wl0;na;emi6orA;lipIsHtzgeraG;ld;ch0h0;ovG;!ic;hatDnanIrG;arGei9;a,i;deY;ov4;b0rre1D;dKinsJriksIsGvaB;cob3GpGtra3D;inoza,osiQ;en,s3;te8;er,is3warG;ds;aXePiNjurhuMoKrisco15uHvorakG;!oT;arte,boHmitru,nn,rGt3C;and,ic;is;g2he0Omingu7nErd1ItG;to;us;aGcki2Hmitr2Ossanayake,x3;s,z; JbnaIlHmirGrvisFvi,w2;!ov4;gado,ic;th;bo0groot,jo6lHsilGvriA;va;a cruz,e3uG;ca;hl,mcevsCnIt2WviG;dGes,s;ov,s3;ielsGku22;!en;ki;a0Be06hRiobQlarkPoIrGunningh1H;awfo0RivGuz;elli;h1lKntJoIrGs2Nx;byn,reG;a,ia;ke,p0;i,rer2K;em2liB;ns;!e;anu;aOeMiu,oIristGu6we;eGiaG;ns1;i,ng,p9uHwGy;!dH;dGng;huJ;!n,onGu6;!g;kJnIpm2ttHudhGv7;ry;erjee,o14;!d,g;ma,raboG;rty;bJl0Cng4rG;eghetHnG;a,y;ti;an,ota1C;cerAlder3mpbeLrIstGvadi0B;iGro;llo;doHl0Er,t0uGvalho;so;so,zo;ll;a0Fe01hYiXlUoNrKuIyG;rLtyG;qi;chan2rG;ke,ns;ank5iem,oGyant;oks,wG;ne;gdan5nIruya,su,uchaHyKziG;c,n5;rd;darGik;enG;ko;ov;aGond15;nco,zG;ev4;ancFshw16;a08oGuiy2;umGwmG;ik;ckRethov1gu,ktPnNrG;gJisInG;ascoGds1;ni;ha;er,mG;anG;!n;gtGit7nP;ss3;asF;hi;er,hG;am;b4ch,ez,hRiley,kk0ldw8nMrIshHtAu0;es;ir;bInHtlGua;ett;es,i0;ieYosa;dGik;a9yoG;padhyG;ay;ra;k,ng;ic;bb0Acos09d07g04kht05lZnPrLsl2tJyG;aHd8;in;la;chis3kiG;ns3;aImstro6sl2;an;ng;ujo,ya;dJgelHsaG;ri;ovG;!a;ersJov,reG;aGjEws;ss1;en;en,on,s3;on;eksejEiyEmeiIvG;ar7es;ez;da;ev;arwHuilG;ar;al;ams,l0;er;ta;as",Ordinal:"true\xa6eBf7nin5s3t0zeroE;enDhir1we0;lfCn7;d,t3;e0ixt8;cond,vent7;et0th;e6ie7;i2o0;r0urt3;tie4;ft1rst;ight0lev1;e0h,ie1;en0;th",Cardinal:"true\xa6bEeBf5mEnine7one,s4t0zero;en,h2rDw0;e0o;lve,n5;irt6ousands,ree;even2ix2;i3o0;r1ur0;!t2;ty;ft0ve;e2y;ight0lev1;!e0y;en;illions",Multiple:"true\xa6b3hundred,m3qu2se1t0;housand,r2;pt1xt1;adr0int0;illion",City:"true\xa60:74;1:61;2:6G;3:6J;4:5S;a68b53c4Id48e44f3Wg3Hh39i31j2Wk2Fl23m1Mn1Co19p0Wq0Ur0Os05tRuQvLwDxiBy9z5;a7h5i4Muri4O;a5e5ongsh0;ng3H;greb,nzib5G;ang2e5okoha3Sunfu;katerin3Hrev0;a5n0Q;m5Hn;arsBeAi6roclBu5;h0xi,zh5P;c7n5;d5nipeg,terth4;hoek,s1L;hi5Zkl3A;l63xford;aw;a8e6i5ladivost5Molgogr6L;en3lni6S;ni22r5;o3saill4N;lenc4Wncouv3Sr3ughn;lan bat1Crumqi,trecht;aFbilisi,eEheDiBo9r7u5;l21n63r5;in,ku;i5ondh62;es51poli;kyo,m2Zron1Pulo5;n,uS;an5jua3l2Tmisoa6Bra3;j4Tshui; hag62ssaloni2H;gucigal26hr0l av1U;briz,i6llinn,mpe56ng5rtu,shk2R;i3Esh0;an,chu1n0p2Eyu0;aEeDh8kopje,owe1Gt7u5;ra5zh4X;ba0Ht;aten is55ockholm,rasbou67uttga2V;an8e6i5;jiazhua1llo1m5Xy0;f50n5;ya1zh4H;gh3Kt4Q;att45o1Vv44;cramen16int ClBn5o paulo,ppo3Rrajevo; 7aa,t5;a 5o domin3E;a3fe,m1M;antonio,die3Cfrancisco,j5ped3Nsalvad0J;o5u0;se;em,t lake ci5Fz25;lou58peters24;a9e8i6o5;me,t59;ga,o5yadh;! de janei3F;cife,ims,nn3Jykjavik;b4Sip4lei2Inc2Pwalpindi;ingdao,u5;ez2i0Q;aFeEhDiCo9r7u6yong5;ya1;eb59ya1;a5etor3M;g52to;rt5zn0; 5la4Co;au prin0Melizabe24sa03;ls3Prae5Atts26;iladelph3Gnom pe1Aoenix;ki1tah tik3E;dua,lerYnaji,r4Ot5;na,r32;ak44des0Km1Mr6s5ttawa;a3Vlo;an,d06;a7ew5ing2Fovosibir1Jyc; 5cast36;del24orlea44taip14;g8iro4Wn5pl2Wshv33v0;ch6ji1t5;es,o1;a1o1;a6o5p4;ya;no,sa0W;aEeCi9o6u5;mb2Ani26sc3Y;gadishu,nt6s5;c13ul;evideo,pelli1Rre2Z;ami,l6n14s5;kolc,sissauga;an,waukee;cca,d5lbour2Mmph41ndo1Cssi3;an,ell2Xi3;cau,drAkass2Sl9n8r5shh4A;aca6ib5rakesh,se2L;or;i1Sy;a4EchFdal0Zi47;mo;id;aDeAi8o6u5vSy2;anMckn0Odhia3;n5s angel26;d2g bea1N;brev2Be3Lma5nz,sb2verpo28;!ss27; ma39i5;c5pzig;est16; p6g5ho2Wn0Cusan24;os;az,la33;aHharFiClaipeBo9rak0Du7y5;iv,o5;to;ala lump4n5;mi1sh0;hi0Hlka2Xpavog4si5wlo2;ce;da;ev,n5rkuk;gst2sha5;sa;k5toum;iv;bHdu3llakuric0Qmpa3Fn6ohsiu1ra5un1Iwaguc0Q;c0Pj;d5o,p4;ah1Ty;a7e6i5ohannesV;l1Vn0;dd36rusalem;ip4k5;ar2H;bad0mph1OnArkutUs7taXz5;mir,tapala5;pa;fah0l6tanb5;ul;am2Zi2H;che2d5;ianap2Mo20;aAe7o5yder2W; chi mi5ms,nolulu;nh;f6lsin5rakli2;ki;ei;ifa,lifax,mCn5rb1Dva3;g8nov01oi;aFdanEenDhCiPlasgBo9raz,u5;a5jr23;dal6ng5yaquil;zh1J;aja2Oupe;ld coa1Bthen5;bu2S;ow;ent;e0Uoa;sk;lw7n5za;dhi5gt1E;nag0U;ay;aisal29es,o8r6ukuya5;ma;ankfu5esno;rt;rt5sh0; wor6ale5;za;th;d5indhov0Pl paso;in5mont2;bur5;gh;aBe8ha0Xisp4o7resd0Lu5;b5esseldorf,nkirk,rb0shanbe;ai,l0I;ha,nggu0rtmu13;hradSl6nv5troit;er;hi;donghIe6k09l5masc1Zr es sala1KugavpiY;i0lU;gu,je2;aJebu,hAleve0Vo5raio02uriti1Q;lo7n6penhag0Ar5;do1Ok;akKst0V;gUm5;bo;aBen8i6ongqi1ristchur5;ch;ang m7ca5ttago1;go;g6n5;ai;du,zho1;ng5ttogr14;ch8sha,zh07;gliari,i9lga8mayenJn6pe town,r5tanO;acCdiff;ber1Ac5;un;ry;ro;aWeNhKirmingh0WoJr9u5;chareTdapeTenos air7r5s0tu0;g5sa;as;es;a9is6usse5;ls;ba6t5;ol;ne;sil8tisla7zzav5;il5;le;va;ia;goZst2;op6ubaneshw5;ar;al;iCl9ng8r5;g6l5n;in;en;aluru,hazi;fa6grade,o horizon5;te;st;ji1rut;ghd0BkFn9ot8r7s6yan n4;ur;el,r07;celo3i,ranquil09;ou;du1g6ja lu5;ka;alo6k5;ok;re;ng;ers5u;field;a05b02cc01ddis aba00gartaZhmedXizawl,lSmPnHqa00rEsBt7uck5;la5;nd;he7l5;an5;ta;ns;h5unci2;dod,gab5;at;li5;ngt2;on;a8c5kaOtwerp;hora6o3;na;ge;h7p5;ol5;is;eim;aravati,m0s5;terd5;am; 7buquerq6eppo,giers,ma5;ty;ue;basrah al qadim5mawsil al jadid5;ah;ab5;ad;la;ba;ra;idj0u dha5;bi;an;lbo6rh5;us;rg",Region:"true\xa60:2O;1:2L;2:2U;3:2F;a2Sb2Fc21d1Wes1Vf1Tg1Oh1Ki1Fj1Bk16l13m0Sn09o07pYqVrSsJtEuBverAw6y4zacatec2W;akut0o0Fu4;cat1k09;a5est 4isconsin,yomi1O;bengal,virgin0;rwick3shington4;! dc;acruz,mont;dmurt0t4;ah,tar4; 2Pa12;a6e5laxca1Vripu21u4;scaEva;langa2nnessee,x2J;bas10m4smQtar29;aulip2Hil nadu;a9elang07i7o5taf16u4ylh1J;ff02rr09s1E;me1Gno1Uuth 4;cZdY;ber0c4kkim,naloa;hu1ily;n5rawak,skatchew1xo4;ny; luis potosi,ta catari2;a4hodeA;j4ngp0C;asth1shahi;ingh29u4;e4intana roo;bec,en6retaro;aAe6rince edward4unjab; i4;sl0G;i,n5r4;ak,nambu0F;a0Rnsylv4;an0;ha0Pra4;!na;axa0Zdisha,h4klaho21ntar4reg7ss0Dx0I;io;aLeEo6u4;evo le4nav0X;on;r4tt18va scot0;f9mandy,th4; 4ampton3;c6d5yo4;rk3;ako1O;aroli2;olk;bras1Nva0Dw4; 6foundland4;! and labrad4;or;brunswick,hamp3jers5mexiTyork4;! state;ey;galPyarit;aAeghala0Mi6o4;nta2r4;dov0elos;ch6dlanDn5ss4zor11;issippi,ouri;as geraPneso18;ig1oac1;dhy12harasht0Gine,lac07ni5r4ssachusetts;anhao,i el,ylG;p4toba;ur;anca3e4incoln3ouisI;e4iR;ds;a6e5h4omi;aka06ul2;dah,lant1ntucky,ra01;bardino,lmyk0ns0Qr4;achay,el0nata0X;alis6har4iangxi;kh4;and;co;daho,llino7n4owa;d5gush4;et0;ia2;is;a6ert5i4un1;dalFm0D;ford3;mp3rya2waii;ansu,eorg0lou7oa,u4;an4izhou,jarat;ajuato,gdo4;ng;cester3;lori4uji1;da;sex;ageUe7o5uran4;go;rs4;et;lawaMrby3;aFeaEh9o4rim08umbr0;ahui7l6nnectic5rsi4ventry;ca;ut;i03orado;la;e5hattisgarh,i4uvash0;apRhuahua;chn5rke4;ss0;ya;ra;lGm4;bridge3peche;a9ihar,r8u4;ck4ryat0;ingham3;shi4;re;emen,itish columb0;h0ja cal8lk7s4v7;hkorto4que;st1;an;ar0;iforn0;ia;dygHguascalientes,lBndhr9r5ss4;am;izo2kans5un4;achal 7;as;na;a 4;pradesh;a6ber5t4;ai;ta;ba5s4;ka;ma;ea",Place:"true\xa60:4T;1:4V;2:44;3:4B;4:3I;a4Eb3Gc2Td2Ge26f25g1Vh1Ji1Fk1Cl14m0Vn0No0Jp08r04sTtNuLvJw7y5;a5o0Syz;kut1Bngtze;aDeChitBi9o5upatki,ycom2P;ki26o5;d5l1B;b3Ps5;i4to3Y;c0SllowbroCn5;c2Qgh2;by,chur1P;ed0ntw3Gs22;ke6r3St5;erf1f1; is0Gf3V;auxha3Mirgin is0Jost5;ok;laanbaatar,pto5xb3E;n,wn;a9eotihuac43h7ive49o6ru2Nsarskoe selo,u5;l2Dzigo47;nto,rquay,tt2J;am3e 5orn3E;bronx,hamptons;hiti,j mah0Iu1N;aEcotts bluff,eCfo,herbroQoApring9t7u5yd2F;dbu1Wn5;der03set3B;aff1ock2Nr5;atf1oud;hi37w24;ho,uth5; 1Iam1Zwo3E;a5i2O;f2Tt0;int lawrence riv3Pkhal2D;ayleigh,ed7i5oc1Z;chmo1Eo gran4ver5;be1Dfr09si4; s39cliffe,hi2Y;aCe9h8i5ompeii,utn2;c6ne5tcai2T; 2Pc0G;keri13t0;l,x;k,lh2mbr6n5r2J;n1Hzance;oke;cif38pahanaumokuak30r5;k5then0;si4w1K;ak7r6x5;f1l2X;ange county,d,f1inoco;mTw1G;e8i1Uo5;r5tt2N;th5wi0E; 0Sam19;uschwanste1Pw5; eng6a5h2market,po36;rk;la0P;a8co,e6i5uc;dt1Yll0Z;adow5ko0H;lands;chu picchu,gad2Ridsto1Ql8n7ple6r5;kh2; g1Cw11;hatt2Osf2B;ibu,t0ve1Z;a8e7gw,hr,in5owlOynd02;coln memori5dl2C;al;asi4w3;kefr7mbe1On5s,x;ca2Ig5si05;f1l27t0;ont;azan kreml14e6itchen2Gosrae,rasnoyar5ul;sk;ns0Hs1U;ax,cn,lf1n6ps5st;wiN;d5glew0Lverness;ian27ochina;aDeBi6kg,nd,ov5unti2H;d,enweep;gh6llc5;reL;bu03l5;and5;!s;r5yw0C;ef1tf1;libu24mp6r5stings;f1lem,row;stead,t0;aDodavari,r5uelph;avenAe5imsS;at 8en5; 6f1Fwi5;ch;acr3vall1H;brita0Flak3;hur5;st;ng3y villa0W;airhavHco,ra;aAgli9nf17ppi8u7ver6x5;et1Lf1;glad3t0;rope,st0;ng;nt0;rls1Ls5;t 5;e5si4;nd;aCe9fw,ig8o7ryd6u5xb;mfri3nstab00rh2tt0;en;nca18rcKv19wnt0B;by;n6r5vonpo1D;ry;!h2;nu8r5;l6t5;f1moor;ingt0;be;aLdg,eIgk,hClBo5royd0;l6m5rnwa0B;pt0;c7lingw6osse5;um;ood;he0S;earwat0St;a8el6i5uuk;chen itza,mney ro07natSricahua;m0Zt5;enh2;mor5rlottetPth2;ro;dar 5ntervilA;breaks,faZg5;rove;ld9m8r5versh2;lis6rizo pla5;in;le;bLpbellf1;weQ;aZcn,eNingl01kk,lackLolt0r5uckV;aGiAo5;ckt0ok5wns cany0;lyn,s5;i4to5;ne;de;dge6gh5;am,t0;n6t5;own;or5;th;ceb6m5;lNpt0;rid5;ge;bu5pool,wa8;rn;aconsfEdf1lBr9verly7x5;hi5;ll; hi5;lls;wi5;ck; air,l5;ingh2;am;ie5;ld;ltimore,rnsl6tters5;ea;ey;bLct0driadic,frica,ginJlGmFn9rc8s7tl6yleOzor3;es;!ant8;hcroft,ia; de triomphe,t6;adyr,ca8dov9tarct5;ic5; oce5;an;st5;er;ericas,s;be6dersh5hambra,list0;ot;rt0;cou5;rt;bot7i5;ngd0;on;sf1;ord",Country:"true\xa60:38;1:2L;2:3B;a2Xb2Ec22d1Ye1Sf1Mg1Ch1Ai14j12k0Zl0Um0Gn05om2pZqat1KrXsKtCu7v5wal4yemTz3;a25imbabwe;es,lis and futu2Y;a3enezue32ietnam;nuatu,tican city;gTk6nited 4ruXs3zbeE; 2Ca,sr;arab emirat0Kkingdom,states3;! of am2Y;!raiV;a8haCimor les0Co7rinidad 5u3;nis0rk3valu;ey,me2Zs and caic1V;and t3t3;oba1L;go,kel10nga;iw2ji3nz2T;ki2V;aDcotl1eCi9lov8o6pa2Dri lanka,u5w3yr0;az3edAitzerl1;il1;d2riname;lomon1Xmal0uth 3;afr2KkMsud2;ak0en0;erra leoFn3;gapo1Yt maart3;en;negLrb0ychellZ;int 3moa,n marino,udi arab0;hele26luc0mart21;epublic of ir0Eom2Euss0w3;an27;a4eIhilippinUitcairn1Mo3uerto riN;l1rtugF;ki2Dl4nama,pua new0Vra3;gu7;au,esti3;ne;aBe9i7or3;folk1Ith4w3;ay; k3ern mariana1D;or0O;caragua,ger3ue;!ia;p3ther1Aw zeal1;al;mib0u3;ru;a7exi6icro0Bo3yanm06;ldova,n3roc5zambA;a4gol0t3;enegro,serrat;co;cAdagasc01l7r5urit4yot3;te;an0i16;shall0Xtin3;ique;a4div3i,ta;es;wi,ys0;ao,ed02;a6e5i3uxembourg;b3echtenste12thu1G;er0ya;ban0Isotho;os,tv0;azakh1Fe4iriba04o3uwait,yrgyz1F;rXsovo;eling0Knya;a3erG;ma16p2;c7nd6r4s3taly,vory coast;le of m2rael;a3el1;n,q;ia,oJ;el1;aiTon3ungary;dur0Ng kong;aBermany,ha0QibraltAre8u3;a6ern5inea3ya0P;! biss3;au;sey;deloupe,m,tema0Q;e3na0N;ce,nl1;ar;bUmb0;a7i6r3;ance,ench 3;guia0Epoly3;nes0;ji,nl1;lklandUroeU;ast tim7cu6gypt,l salv6ngl1quatorial4ritr5st3thiop0;on0; guin3;ea;ad3;or;enmark,jibou5ominica4r con3;go;!n C;ti;aBentral african Ah8o5roat0u4yprRzech3; 9ia;ba,racao;c4lo3morQngo brazzaville,okGsta r04te de ivoiL;mb0;osE;i3ristmasG;le,na;republic;m3naUpe verde,ymanA;bod0ero3;on;aGeDhut2o9r5u3;lgar0r3;kina faso,ma,undi;azil,itish 3unei;virgin3; is3;lands;liv0nai5snia and herzegoviHtswaHuvet3; isl1;and;re;l3n8rmuG;ar3gium,ize;us;h4ngladesh,rbad3;os;am4ra3;in;as;fghaGlDmBn6r4ustr3zerbaij2;al0ia;genti3men0uba;na;dorra,g5t3;arct7igua and barbu3;da;o3uil3;la;er3;ica;b3ger0;an0;ia;ni3;st2;an",FirstName:"true\xa6aTblair,cQdOfrancoZgabMhinaLilya,jHkClBm6ni4quinn,re3s0;h0umit,yd;ay,e0iloh;a,lby;g9ne;co,ko0;!s;a1el0ina,org6;!okuhF;ds,naia,r1tt0xiB;i,y;ion,lo;ashawn,eif,uca;a3e1ir0rM;an;lsFn0rry;dall,yat5;i,sD;a0essIie,ude;i1m0;ie,mG;me;ta;rie0y;le;arcy,ev0;an,on;as1h0;arl8eyenne;ey,sidy;drien,kira,l4nd1ubr0vi;ey;i,r0;a,e0;a,y;ex2f1o0;is;ie;ei,is",WeekDay:"true\xa6fri2mon2s1t0wednesd3;hurs1ues1;aturd1und1;!d0;ay0;!s",Month:"true\xa6dec0february,july,nov0octo1sept0;em0;ber",Date:"true\xa6ago,on4som4t1week0yesterd5; end,ends;mr1o0;d2morrow;!w;ed0;ay",Duration:"true\xa6centurAd8h7m5q4se3w1y0;ear8r8;eek0k7;!end,s;ason,c5;tr,uarter;i0onth3;llisecond2nute2;our1r1;ay0ecade0;!s;ies,y",FemaleName:"true\xa60:J7;1:JB;2:IJ;3:IK;4:J1;5:IO;6:JS;7:JO;8:HB;9:JK;A:H4;B:I2;C:IT;D:JH;E:IX;F:BA;G:I4;aGTbFLcDRdD0eBMfB4gADh9Ti9Gj8Dk7Cl5Wm48n3Lo3Hp33qu32r29s15t0Eu0Cv02wVxiTyOzH;aLeIineb,oHsof3;e3Sf3la,ra;h2iKlIna,ynH;ab,ep;da,ma;da,h2iHra;nab;aKeJi0FolB7uIvH;et8onDP;i0na;le0sen3;el,gm3Hn,rGLs8W;aoHme0nyi;m5XyAD;aMendDZhiDGiH;dele9lJnH;if48niHo0;e,f47;a,helmi0lHma;a,ow;ka0nB;aNeKiHusa5;ck84kIl8oleAviH;anFenJ4;ky,toriBK;da,lA8rHs0;a,nHoniH9;a,iFR;leHnesH9;nILrH;i1y;g9rHs6xHA;su5te;aYeUhRiNoLrIuHy2;i,la;acJ3iHu0J;c3na,sH;hFta;nHr0F;iFya;aJffaEOnHs6;a,gtiH;ng;!nFSra;aIeHomasi0;a,l9Oo8Ares1;l3ndolwethu;g9Fo88rIssH;!a,ie;eHi,ri7;sa,za;bOlMmKnIrHs6tia0wa0;a60yn;iHya;a,ka,s6;arFe2iHm77ra;!ka;a,iH;a,t6;at6it6;a0Ecarlett,e0AhWiSkye,neza0oQri,tNuIyH;bIGlvi1;ha,mayIJniAsIzH;an3Net8ie,y;anHi7;!a,e,nH;aCe;aIeH;fan4l5Dphan6E;cI5r5;b3fiAAm0LnHphi1;d2ia,ja,ya;er2lJmon1nIobh8QtH;a,i;dy;lETv3;aMeIirHo0risFDy5;a,lDM;ba,e0i5lJrH;iHr6Jyl;!d8Ifa;ia,lDZ;hd,iMki2nJrIu0w0yH;la,ma,na;i,le9on,ron,yn;aIda,ia,nHon;a,on;!ya;k6mH;!aa;lJrItaye82vH;da,inj;e0ife;en1i0ma;anA9bLd5Oh1SiBkKlJmInd2rHs6vannaC;aCi0;ant6i2;lDOma,ome;ee0in8Tu2;in1ri0;a05eZhXiUoHuthDM;bScRghQl8LnPsJwIxH;anB3ie,y;an,e0;aIeHie,lD;ann7ll1marDGtA;!lHnn1;iHyn;e,nH;a,dF;da,i,na;ayy8G;hel67io;bDRerAyn;a,cIkHmas,nFta,ya;ki,o;h8Xki;ea,iannGMoH;da,n1P;an0bJemFgi0iInHta,y0;a8Bee;han86na;a,eH;cHkaC;a,ca;bi0chIe,i0mo0nHquETy0;di,ia;aERelHiB;!e,le;een4ia0;aPeOhMiLoJrHute6A;iHudenCV;scil3LyamvaB;lHrt3;i0ly;a,paluk;ilome0oebe,ylH;is,lis;ggy,nelope,r5t2;ige,m0VnKo5rvaDMtIulH;a,et8in1;ricHt4T;a,e,ia;do2i07;ctav3dIfD3is6ksa0lHphD3umC5yunbileg;a,ga,iv3;eHvAF;l3t8;aWeUiMoIurHy5;!ay,ul;a,eJor,rIuH;f,r;aCeEma;ll1mi;aNcLhariBQkKlaJna,sHta,vi;anHha;ur;!y;a,iDZki;hoGk9YolH;a,e4P;!mh;hir,lHna,risDEsreE;!a,lBV;asuMdLh3i6Dl5nKomi7rgEVtH;aHhal4;lHs6;i1ya;cy,et8;e9iF0ya;nngu2X;a0Ackenz4e02iMoJrignayani,uriDJyH;a,rH;a,iOlNna,tG;bi0i2llBJnH;a,iH;ca,ka,qD9;a,cUdo4ZkaTlOmi,nMrItzi,yH;ar;aJiIlH;anET;am;!l,nB;dy,eHh,n4;nhGrva;aKdJe0iCUlH;iHy;cent,e;red;!gros;!e5;ae5hH;ae5el3Z;ag5DgNi,lKrH;edi7AiIjem,on,yH;em,l;em,sCG;an4iHliCF;nHsCJ;a,da;!an,han;b09cASd07e,g05ha,i04ja,l02n00rLsoum5YtKuIv84xBKyHz4;bell,ra,soBB;d7rH;a,eE;h8Gild1t4;a,cUgQiKjor4l7Un4s6tJwa,yH;!aHbe6Xja9lAE;m,nBL;a,ha,in1;!aJbCGeIja,lDna,sHt63;!a,ol,sa;!l1D;!h,mInH;!a,e,n1;!awit,i;arJeIie,oHr48ueri8;!t;!ry;et46i3B;el4Xi7Cy;dHon,ue5;akranAy;ak,en,iHlo3S;a,ka,nB;a,re,s4te;daHg4;!l3E;alDd4elHge,isDJon0;ei9in1yn;el,le;a0Ne0CiXoQuLyH;d3la,nH;!a,dIe2OnHsCT;!a,e2N;a,sCR;aD4cJel0Pis1lIna,pHz;e,iA;a,u,wa;iHy;a0Se,ja,l2NnB;is,l1UrItt1LuHvel4;el5is1;aKeIi7na,rH;aADi7;lHn1tA;ei;!in1;aTbb9HdSepa,lNnKsJvIzH;!a,be5Ret8z4;!ia;a,et8;!a,dH;a,sHy;ay,ey,i,y;a,iJja,lH;iHy;aA8e;!aH;!nF;ia,ya;!nH;!a,ne;aPda,e0iNjYla,nMoKsJtHx93y5;iHt4;c3t3;e2PlCO;la,nHra;a,ie,o2;a,or1;a,gh,laH;!ni;!h,nH;a,d2e,n5V;cOdon9DiNkes6mi9Gna,rMtJurIvHxmi,y5;ern1in3;a,e5Aie,yn;as6iIoH;nya,ya;fa,s6;a,isA9;a,la;ey,ie,y;a04eZhXiOlASoNrJyH;lHra;a,ee,ie;istHy6I;a,en,iIyH;!na;!e,n5F;nul,ri,urtnB8;aOerNlB7mJrHzzy;a,stH;en,in;!berlImernH;aq;eHi,y;e,y;a,stE;!na,ra;aHei2ongordzol;dij1w5;el7UiKjsi,lJnIrH;a,i,ri;d2na,za;ey,i,lBLs4y;ra,s6;biAcARdiat7MeBAiSlQmPnyakuma1DrNss6NtKviAyH;!e,lH;a,eH;e,i8T;!a6HeIhHi4TlDri0y;ar8Her8Hie,leErBAy;!lyn8Ori0;a,en,iHl5Xoli0yn;!ma,nFs95;a5il1;ei8Mi,lH;e,ie;a,tl6O;a0AeZiWoOuH;anMdLlHst88;es,iH;a8NeHs8X;!n9tH;!a,te;e5Mi3My;a,iA;!anNcelDdMelGhan7VleLni,sIva0yH;a,ce;eHie;fHlDph7Y;a,in1;en,n1;i7y;!a,e,n45;lHng;!i1DlH;!i1C;anNle0nKrJsH;i8JsH;!e,i8I;i,ri;!a,elGif2CnH;a,et8iHy;!e,f2A;a,eJiInH;a,eIiH;e,n1;!t8;cMda,mi,nIque4YsminFvie2y9zH;min7;a7eIiH;ce,e,n1s;!lHs82t0F;e,le;inIk6HlDquelH;in1yn;da,ta;da,lRmPnOo0rNsIvaHwo0zaro;!a0lu,na;aJiIlaHob89;!n9R;do2;belHdo2;!a,e,l3B;a7Ben1i0ma;di2es,gr72ji;a9elBogH;en1;a,e9iHo0se;a0na;aSeOiJoHus7Kyacin2C;da,ll4rten24snH;a,i9U;lImaH;ri;aIdHlaI;a,egard;ry;ath1BiJlInrietArmi9sH;sa,t1A;en2Uga,mi;di;bi2Fil8MlNnMrJsItHwa,yl8M;i5Tt4;n60ti;iHmo51ri53;etH;!te;aCnaC;a,ey,l4;a02eWiRlPoNrKunJwH;enHyne1R;!dolD;ay,el;acieIetHiselB;a,chE;!la;ld1CogooH;sh;adys,enHor3yn2K;a,da,na;aKgi,lIna,ov8EselHta;a,e,le;da,liH;an;!n0;mLnJorgIrH;ald5Si,m3Etrud7;et8i4X;a,eHna;s29vieve;ma;bIle,mHrnet,yG;al5Si5;iIrielH;a,l1;!ja;aTeQiPlorOoz3rH;anJeIiH;da,eB;da,ja;!cH;esIiHoi0P;n1s66;!ca;a,enc3;en,o0;lIn0rnH;anB;ec3ic3;jr,nArKtHy7;emIiHma,oumaA;ha,ma,n;eh;ah,iBrah,za0;cr4Rd0Re0Qi0Pk0Ol07mXn54rUsOtNuMvHwa;aKelIiH;!e,ta;inFyn;!a;!ngel4V;geni1ni47;h5Yien9ta;mLperanKtH;eIhHrel5;er;l31r7;za;a,eralB;iHma,ne4Lyn;cHka,n;a,ka;aPeNiKmH;aHe21ie,y;!li9nuH;elG;lHn1;e7iHy;a,e,ja;lHrald;da,y;!nue5;aWeUiNlMma,no2oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c3da,e,f,nMsJzaH;!betHveA;e,h;aHe,ka;!beH;th;!a,or;anor,nH;!a,i;!in1na;ate1Rta;leEs6;vi;eIiHna,wi0;e,th;l,n;aYeMh3iLjeneKoH;lor5Vminiq4Ln3FrHtt4;a,eEis,la,othHthy;ea,y;ba;an09naCon9ya;anQbPde,eOiMlJmetr3nHsir5M;a,iH;ce,se;a,iIla,orHphi9;es,is;a,l6F;dHrdH;re;!d5Ena;!b2ForaCraC;a,d2nH;!a,e;hl3i0l0GmNnLphn1rIvi1WyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,et8iH;!ca,el1Aka,z;arHia;is;a0Re0Nh04i02lUoJristIynH;di,th3;al,i0;lPnMrIurH;tn1D;aJd2OiHn2Ori9;!nH;a,e,n1;!l4;cepci5Cn4sH;tanHuelo;ce,za;eHleE;en,t8;aJeoIotH;il54;!pat2;ir7rJudH;et8iH;a,ne;a,e,iH;ce,sZ;a2er2ndH;i,y;aReNloe,rH;isJyH;stH;al;sy,tH;a1Sen,iHy;an1e,n1;deJlseIrH;!i7yl;a,y;li9;nMrH;isKlImH;ai9;a,eHot8;n1t8;!sa;d2elGtH;al,elG;cIlH;es8i47;el3ilH;e,ia,y;itlYlXmilWndVrMsKtHy5;aIeIhHri0;er1IleErDy;ri0;a38sH;a37ie;a,iOlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eIie,otHy;a,ta;ne,y;na,s1X;a0Ii0I;a,e,l1;isAl4;in,yn;a0Ke02iZlXoUrH;andi7eRiJoIyH;an0nn;nwDoke;an3HdgMgiLtH;n31tH;!aInH;ey,i,y;ny;d,t8;etH;!t7;an0e,nH;da,na;bbi7glarIlo07nH;iAn4;ka;ancHythe;a,he;an1Clja0nHsm3M;iAtH;ou;aWcVlinUniArPssOtJulaCvH;!erlH;ey,y;hJsy,tH;e,iHy7;e,na;!anH;ie,y;!ie;nItHyl;ha,ie;adIiH;ce;et8i9;ay,da;ca,ky;!triH;ce,z;rbJyaH;rmH;aa;a2o2ra;a2Ub2Od25g21i1Sj5l18m0Zn0Boi,r06sWtVuPvOwa,yIzH;ra,u0;aKes6gJlIn,seH;!l;in;un;!nH;a,na;a,i2K;drLguJrIsteH;ja;el3;stH;in1;a,ey,i,y;aahua,he0;hIi2Gja,miAs2DtrH;id;aMlIraqHt21;at;eIi7yH;!n;e,iHy;gh;!nH;ti;iJleIo6piA;ta;en,n1t8;aHelG;!n1J;a01dje5eZgViTjRnKohito,toHya;inet8nH;el5ia;te;!aKeIiHmJ;e,ka;!mHtt7;ar4;!belIliHmU;sa;!l1;a,eliH;ca;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!tH;a,te;!bImHstasiMya;ar3;el;aLberKeliJiHy;e,l3naH;!ta;a,ja;!ly;hGiIl3nB;da;a,ra;le;aWba,ePiMlKthJyH;a,c3sH;a,on,sa;ea;iHys0N;e,s0M;a,cIn1sHza;a,e,ha,on,sa;e,ia,ja;c3is6jaKksaKna,sJxH;aHia;!nd2;ia,saH;nd2;ra;ia;i0nIyH;ah,na;a,is,naCoud;la;c6da,leEmNnLsH;haClH;inHyY;g,n;!h;a,o,slH;ey;ee;en;at6g4nIusH;ti0;es;ie;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;!aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lDsH;on;yn;!lH;i9yn;ne;aKbIiHrL;!e,gaK;ey,i7y;!e;gaH;il;dKliyJradhIs6;ha;ya;ah;a,ya",Honorific:"true\xa6director1field marsh2lieutenant1rear0sergeant major,vice0; admir1; gener0;al","Adj|Gerund":"true\xa60:3F;1:3H;2:31;3:2X;4:35;5:33;6:3C;7:2Z;8:36;9:29;a33b2Tc2Bd1Te1If19g12h0Zi0Rl0Nm0Gnu0Fo0Ap04rYsKtEuBvAw1Ayiel3;ar6e08;nBpA;l1Rs0B;fol3n1Zsett2;aEeDhrBi4ouc7rAwis0;e0Bif2oub2us0yi1;ea1SiA;l2vi1;l2mp0rr1J;nt1Vxi1;aMcreec7enten2NhLkyrocke0lo0Vmi2oJpHtDuBweA;e0Ul2;pp2ArA;gi1pri5roun3;aBea8iAri2Hun9;mula0r4;gge4rA;t2vi1;ark2eAraw2;e3llb2F;aAot7;ki1ri1;i9oc29;dYtisf6;aEeBive0oAus7;a4l2;assu4defi9fres7ig9juve07mai9s0vAwar3;ea2italiAol1G;si1zi1;gi1ll6mb2vi1;a6eDier23lun1VrAun2C;eBoA;mi5vo1Z;ce3s5vai2;n3rpleA;xi1;ffCpWutBverAwi1;arc7lap04p0Pri3whel8;goi1l6st1J;en3sA;et0;m2Jrtu4;aEeDiCoBuAyst0L;mb2;t1Jvi1;s5tiga0;an1Rl0n3smeri26;dAtu4;de9;aCeaBiAo0U;fesa0Tvi1;di1ni1;c1Fg19s0;llumiGmFnArri0R;cDfurHsCtBviA;go23ti1;e1Oimi21oxica0rig0V;pi4ul0;orpo20r0K;po5;na0;eaBorr02umilA;ia0;li1rtwar8;lFrA;atiDipCoBuelA;i1li1;undbrea10wi1;pi1;f6ng;a4ea8;a3etc7it0lEoCrBulfA;il2;ee1FighXust1L;rAun3;ebo3thco8;aCoA;a0wA;e4i1;mi1tte4;lectrJmHnExA;aCci0hBis0pA;an3lo3;aOila1B;c0spe1A;ab2coura0CdBergi13ga0Clive9ric7s02tA;hral2i0J;ea4u4;barras5er09pA;owe4;if6;aQeIiBrA;if0;sAzz6;aEgDhearCsen0tA;rAur11;ac0es5;te9;us0;ppoin0r8;biliGcDfi9gra3ligh0mBpres5sAvasG;erE;an3ea9orA;ali0L;a6eiBli9rA;ea5;vi1;ta0;maPri1s7un0zz2;aPhMlo5oAripp2ut0;mGnArrespon3;cer9fDspi4tA;inBrA;as0ibu0ol2;ui1;lic0u5;ni1;fDmCpA;eAromi5;l2ti1;an3;or0;aAil2;llenAnAr8;gi1;l8ptAri1;iva0;aff2eGin3lFoDrBuA;d3st2;eathtaAui5;ki1;gg2i2o8ri1unA;ci1;in3;co8wiA;lAtc7;de4;bsorVcOgonMlJmHnno6ppea2rFsA;pi4su4toA;nBun3;di1;is7;hi1;res0;li1;aFu5;si1;ar8lu4;ri1;mi1;iAzi1;zi1;cAhi1;eleDomA;moBpan6;yi1;da0;ra0;ti1;bi1;ng",Comparable:"true\xa60:3C;1:3Q;2:3F;a3Tb3Cc33d2Te2Mf2Ag1Wh1Li1Fj1Ek1Bl13m0Xn0So0Rp0Iqu0Gr07sHtCug0vAw4y3za0Q;el10ouN;ary,e6hi5i3ry;ck0Cde,l3n1ry,se;d,y;ny,te;a3i3R;k,ry;a3erda2ulgar;gue,in,st;a6en2Xhi5i4ouZr3;anqu2Cen1ue;dy,g36me0ny;ck,rs28;ll,me,rt,wd3I;aRcaPeOhMiLkin0BlImGoEpDt6u4w3;eet,ift;b3dd0Wperfi21rre28;sta26t21;a8e7iff,r4u3;pUr1;a4ict,o3;ng;ig2Vn0N;a1ep,rn;le,rk,te0;e1Si2Vright0;ci1Yft,l3on,re;emn,id;a3el0;ll,rt;e4i3y;g2Mm0Z;ek,nd2T;ck24l0mp1L;a3iRrill,y;dy,l01rp;ve0Jxy;n1Jr3;ce,y;d,fe,int0l1Hv0V;a8e6i5o3ude;mantic,o19sy,u3;gh;pe,t1P;a3d,mo0A;dy,l;gg4iFndom,p3re,w;id;ed;ai2i3;ck,et;hoAi1Fl9o8r5u3;ny,r3;e,p11;egna2ic4o3;fouSud;ey,k0;liXor;ain,easa2;ny;dd,i0ld,ranL;aive,e5i4o3u14;b0Sisy,rm0Ysy;bb0ce,mb0R;a3r1w;r,t;ad,e5ild,o4u3;nda12te;ist,o1;a4ek,l3;low;s0ty;a8e7i6o3ucky;f0Jn4o15u3ve0w10y0N;d,sy;e0g;ke0l,mp,tt0Eve0;e1Qwd;me,r3te;ge;e4i3;nd;en;ol0ui19;cy,ll,n3;secu6t3;e3ima4;llege2rmedia3;te;re;aAe7i6o5u3;ge,m3ng1C;bYid;me0t;gh,l0;a3fXsita2;dy,rWv3;en0y;nd13ppy,r3;d3sh;!y;aFenEhCiBlAoofy,r3;a8e6i5o3ue0Z;o3ss;vy;m,s0;at,e3y;dy,n;nd,y;ad,ib,ooD;a2d1;a3o3;st0;tDuiS;u1y;aCeebBi9l8o6r5u3;ll,n3r0N;!ny;aCesh,iend0;a3nd,rmD;my;at,ir7;erce,nan3;ci9;le;r,ul3;ty;a6erie,sse4v3xtre0B;il;nti3;al;r4s3;tern,y;ly,th0;appZe9i5ru4u3;mb;nk;r5vi4z3;zy;ne;e,ty;a3ep,n9;d3f,r;!ly;agey,h8l7o5r4u3;dd0r0te;isp,uel;ar3ld,mmon,st0ward0zy;se;evKou1;e3il0;ap,e3;sy;aHiFlCoAr5u3;ff,r0sy;ly;a6i3oad;g4llia2;nt;ht;sh,ve;ld,un3;cy;a4o3ue;nd,o1;ck,nd;g,tt3;er;d,ld,w1;dy;bsu6ng5we3;so3;me;ry;rd",Adverb:"true\xa6a08b05d00eYfSheQinPjustOkinda,likewiZmMnJoEpCquite,r9s5t2u0very,well;ltima01p0; to,wards5;h1iny bit,o0wiO;o,t6;en,us;eldom,o0uch;!me1rt0; of;how,times,w0C;a1e0;alS;ndomRth05;ar excellenEer0oint blank; Lhaps;f3n0utright;ce0ly;! 0;ag05moX; courGten;ewJo0; longWt 0;onHwithstand9;aybe,eanwhiNore0;!ovT;! aboX;deed,steY;lla,n0;ce;or3u0;ck1l9rther0;!moK;ing; 0evK;exampCgood,suH;n mas0vI;se;e0irect2; 2fini0;te0;ly;juAtrop;ackward,y 0;far,no0; means,w; GbroFd nauseam,gEl7ny5part,s4t 2w0;ay,hi0;le;be7l0mo7wor7;arge,ea6; soon,i4;mo0way;re;l 3mo2ongsi1ready,so,togeth0ways;er;de;st;b1t0;hat;ut;ain;ad;lot,posteriori",Conjunction:"true\xa6aXbTcReNhowMiEjust00noBo9p8supposing,t5wh0yet;e1il0o3;e,st;n1re0thN; if,by,vM;evL;h0il,o;erefOo0;!uU;lus,rovided th9;r0therwiM;! not; mattEr,w0;! 0;since,th4w7;f4n0; 0asmuch;as mIcaForder t0;h0o;at;! 0;only,t0w0;hen;!ev3;ith2ven0;! 0;if,tB;er;o0uz;s,z;e0ut,y the time;cau1f0;ore;se;lt3nd,s 0;far1if,m0soon1t2;uch0; as;hou0;gh",Currency:"true\xa6$,aud,bQcOdJeurIfHgbp,hkd,iGjpy,kElDp8r7s3usd,x2y1z0\xa2,\xa3,\xa5,\u0434\u0435\u043d,\u043b\u0432,\u0440\u0443\u0431,\u0e3f,\u20a1,\u20a8,\u20ac,\u20ad,\ufdfc;lotyQ\u0142;en,uanP;af,of;h0t5;e0il5;k0q0;elK;oubleJp,upeeJ;e2ound st0;er0;lingG;n0soF;ceEnies;empi7i7;n,r0wanzaCyatC;!onaBw;ls,nr;ori7ranc9;!os;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;e0ny;nt1;aht,itcoin0;!s",Determiner:"true\xa6aBboth,d9e6few,le5mu8neiDplenty,s4th2various,wh0;at0ich0;evC;a0e4is,ose;!t;everal,ome;!ast,s;a1l0very;!se;ch;e0u;!s;!n0;!o0y;th0;er","Adj|Present":"true\xa6a07b04cVdQeNfJhollIidRlEmCnarrIoBp9qua8r7s3t2uttFw0;aKet,ro0;ng,u08;endChin;e2hort,l1mooth,our,pa9tray,u0;re,speU;i2ow;cu6da02leSpaN;eplica01i02;ck;aHerfePr0;eseUime,omV;bscu1pen,wn;atu0e3odeH;re;a2e1ive,ow0;er;an;st,y;ow;a2i1oul,r0;ee,inge;rm;iIke,ncy,st;l1mpty,x0;emHpress;abo4ic7;amp,e2i1oub0ry,ull;le;ffu9re6;fu8libe0;raE;alm,l5o0;mpleCn3ol,rr1unterfe0;it;e0u7;ct;juga8sum7;ea1o0;se;n,r;ankru1lu0;nt;pt;li2pproxi0rticula1;ma0;te;ght","Person|Adj":"true\xa6b3du2earnest,frank,mi2r0san1woo1;an0ich,u1;dy;sty;ella,rown",Modal:"true\xa6c5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to,a;ight,ust;an,o0;uld",Verb:"true\xa6born,cannot,gonna,has,keep tabs,msg","Person|Verb":"true\xa6b8ch7dr6foster,gra5ja9lan4ma2ni9ollie,p1rob,s0wade;kip,pike,t5ue;at,eg,ier2;ck,r0;k,shal;ce;ce,nt;ew;ase,u1;iff,l1ob,u0;ck;aze,ossom","Person|Date":"true\xa6a2j0sep;an0une;!uary;p0ugust,v0;ril"},e3=36,t3="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",n3=t3.split("").reduce(function(e,t,n){return e[t]=n,e},{}),r3=function(e){if(void 0!==n3[e])return n3[e];let t=0,n=1,r=e3,i=1;for(;n<e.length;t+=r,n++,r*=e3);for(let a=e.length-1;a>=0;a--,i*=e3){let n=e.charCodeAt(a)-48;n>10&&(n-=7),t+=n*i}return t},i3=function(e){const t=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let n=0;n<e.nodes.length;n++){const r=t.exec(e.nodes[n]);if(!r){e.symCount=n;break}e.syms[r3(r[1])]=r3(r[2])}e.nodes=e.nodes.slice(e.symCount,e.nodes.length)},a3=function(e,t,n){const r=r3(t);return r<e.symCount?e.syms[r]:n+r+1-e.symCount},o3=function(e){const t={nodes:e.split(";"),syms:[],symCount:0};return e.match(":")&&i3(t),function(e){const t=[],n=(r,i)=>{let a=e.nodes[r];"!"===a[0]&&(t.push(i),a=a.slice(1));const o=a.split(/([A-Z0-9,]+)/g);for(let s=0;s<o.length;s+=2){const a=o[s],u=o[s+1];if(!a)continue;const l=i+a;if(","===u||void 0===u){t.push(l);continue}const c=a3(e,u,r);n(c,l)}};return n(0,""),t}(t)},s3=function(e){if(!e)return{};const t=e.split("|").reduce((e,t)=>{const n=t.split("\xa6");return e[n[0]]=n[1],e},{}),n={};return Object.keys(t).forEach(function(e){const r=o3(t[e]);"true"===e&&(e=!0);for(let t=0;t<r.length;t++){const i=r[t];!0===n.hasOwnProperty(i)?!1===Array.isArray(n[i])?n[i]=[n[i],e]:n[i].push(e):n[i]=e}}),n},u3=["Possessive","Pronoun"];const l3={a:[[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/ia$/i,"ia"]],e:[[/(kn|l|w)ife$/i,"$1ives"],[/(hive)$/i,"$1s"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"]],f:[[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"]],i:[[/(octop|vir)i$/i,"$1i"]],m:[[/([ti])um$/i,"$1a"]],n:[[/^(oxen)$/i,"$1"]],o:[[/(al|ad|at|er|et|ed)o$/i,"$1oes"]],s:[[/(ax|test)is$/i,"$1es"],[/(alias|status)$/i,"$1es"],[/sis$/i,"ses"],[/(bu)s$/i,"$1ses"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"]],x:[[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/^(ox)$/i,"$1en"]],y:[[/([^aeiouy]|qu)y$/i,"$1ies"]],z:[[/(quiz)$/i,"$1zes"]]},c3=/([xsz]|ch|sh)$/,h3=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,{irregularPlurals:n,uncountable:r}=t.two;if(r.hasOwnProperty(e))return e;if(n.hasOwnProperty(e))return n[e];let i=function(e){let t=e[e.length-1];if(!0===l3.hasOwnProperty(t))for(let n=0;n<l3[t].length;n+=1){let r=l3[t][n][0];if(!0===r.test(e))return e.replace(r,l3[t][n][1])}return null}(e);return null!==i?i:c3.test(e)?e+"es":e+"s"},d3=/\|/;let p3={"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization",g8:"Organization",vh1:"Organization","76ers":"SportsTeam","49ers":"SportsTeam",q1:"Date",q2:"Date",q3:"Date",q4:"Date",km2:"Unit",m2:"Unit",dm2:"Unit",cm2:"Unit",mm2:"Unit",mile2:"Unit",in2:"Unit",yd2:"Unit",ft2:"Unit",m3:"Unit",dm3:"Unit",cm3:"Unit",in3:"Unit",ft3:"Unit",yd3:"Unit","at&t":"Organization","black & decker":"Organization","h & m":"Organization","johnson & johnson":"Organization","procter & gamble":"Organization","ben & jerry's":"Organization","&":"Conjunction",i:["Pronoun","Singular"],he:["Pronoun","Singular"],she:["Pronoun","Singular"],it:["Pronoun","Singular"],they:["Pronoun","Plural"],we:["Pronoun","Plural"],was:["Copula","PastTense"],is:["Copula","PresentTense"],are:["Copula","PresentTense"],am:["Copula","PresentTense"],were:["Copula","PastTense"],her:u3,his:u3,hers:u3,their:u3,theirs:u3,themselves:u3,your:u3,our:u3,ours:u3,my:u3,its:u3,vs:["Conjunction","Abbreviation"],if:["Condition","Preposition"],closer:"Comparative",closest:"Superlative",much:"Adverb",may:"Modal",babysat:"PastTense",blew:"PastTense",drank:"PastTense",drove:"PastTense",forgave:"PastTense",skiied:"PastTense",spilt:"PastTense",stung:"PastTense",swam:"PastTense",swung:"PastTense",guaranteed:"PastTense",shrunk:"PastTense",nears:"PresentTense",nearing:"Gerund",neared:"PastTense",no:["Negative","Expression"]},f3={};const m3={two:{irregularPlurals:Q2,uncountable:{}}};Object.keys(Z2).forEach(e=>{let t=s3(Z2[e]);d3.test(e)?Object.keys(t).forEach(t=>{if(f3[t]=e,"Noun|Verb"===e){let e=h3(t,m3);f3[e]="Plural|Verb"}}):Object.keys(t).forEach(t=>{p3[t]=e})}),[":(",":)",":P",":p",":O",";(",";)",";P",";p",";O",":3",":|",":/",":\\",":$",":*",":@",":-(",":-)",":-P",":-p",":-O",":-3",":-|",":-/",":-\\",":-$",":-*",":-@",":^(",":^)",":^P",":^p",":^O",":^3",":^|",":^/",":^\\",":^$",":^*",":^@","):","(:","$:","*:",")-:","(-:","$-:","*-:",")^:","(^:","$^:","*^:","<3","</3","<\\3","=("].forEach(e=>p3[e]="Emoticon"),delete p3[""],delete p3.null,delete p3[" "];const g3="Singular",v3={beforeTags:{Determiner:g3,Possessive:g3,Acronym:g3,Noun:g3,Adjective:g3,PresentTense:g3,Gerund:g3,PastTense:g3,Infinitive:g3,Date:g3,Ordinal:g3,Demonym:g3},afterTags:{Value:g3,Modal:g3,Copula:g3,PresentTense:g3,PastTense:g3,Demonym:g3,Actor:g3},beforeWords:{the:g3,with:g3,without:g3,of:g3,for:g3,any:g3,all:g3,on:g3,cut:g3,cuts:g3,increase:g3,decrease:g3,raise:g3,drop:g3,save:g3,saved:g3,saves:g3,make:g3,makes:g3,made:g3,minus:g3,plus:g3,than:g3,another:g3,versus:g3,neither:g3,about:g3,favorite:g3,best:g3,daily:g3,weekly:g3,linear:g3,binary:g3,mobile:g3,lexical:g3,technical:g3,computer:g3,scientific:g3,security:g3,government:g3,popular:g3,formal:g3,no:g3,more:g3,one:g3,let:g3,her:g3,his:g3,their:g3,our:g3,us:g3,sheer:g3,monthly:g3,yearly:g3,current:g3,previous:g3,upcoming:g3,last:g3,next:g3,main:g3,initial:g3,final:g3,beginning:g3,end:g3,top:g3,bottom:g3,future:g3,past:g3,major:g3,minor:g3,side:g3,central:g3,peripheral:g3,public:g3,private:g3},afterWords:{of:g3,system:g3,aid:g3,method:g3,utility:g3,tool:g3,reform:g3,therapy:g3,philosophy:g3,room:g3,authority:g3,says:g3,said:g3,wants:g3,wanted:g3,is:g3,did:g3,do:g3,can:g3,wise:g3}},D3="Infinitive",y3={beforeTags:{Modal:D3,Adverb:D3,Negative:D3,Plural:D3},afterTags:{Determiner:D3,Adverb:D3,Possessive:D3,Reflexive:D3,Preposition:D3,Cardinal:D3,Comparative:D3,Superlative:D3},beforeWords:{i:D3,we:D3,you:D3,they:D3,to:D3,please:D3,will:D3,have:D3,had:D3,would:D3,could:D3,should:D3,do:D3,did:D3,does:D3,can:D3,must:D3,us:D3,me:D3,let:D3,even:D3,when:D3,help:D3,he:D3,she:D3,it:D3,being:D3,bi:D3,co:D3,contra:D3,de:D3,inter:D3,intra:D3,mis:D3,pre:D3,out:D3,counter:D3,nobody:D3,somebody:D3,anybody:D3,everybody:D3},afterWords:{the:D3,me:D3,you:D3,him:D3,us:D3,her:D3,his:D3,them:D3,they:D3,it:D3,himself:D3,herself:D3,itself:D3,myself:D3,ourselves:D3,themselves:D3,something:D3,anything:D3,a:D3,an:D3,up:D3,down:D3,by:D3,out:D3,off:D3,under:D3,what:D3,all:D3,to:D3,because:D3,although:D3,how:D3,otherwise:D3,together:D3,though:D3,into:D3,yet:D3,more:D3,here:D3,there:D3,away:D3}},E3={beforeTags:Object.assign({},y3.beforeTags,v3.beforeTags,{}),afterTags:Object.assign({},y3.afterTags,v3.afterTags,{}),beforeWords:Object.assign({},y3.beforeWords,v3.beforeWords,{}),afterWords:Object.assign({},y3.afterWords,v3.afterWords,{})},A3="Adjective",C3={beforeTags:{Determiner:A3,Possessive:A3,Hyphenated:A3},afterTags:{Adjective:A3},beforeWords:{seem:A3,seemed:A3,seems:A3,feel:A3,feels:A3,felt:A3,stay:A3,appear:A3,appears:A3,appeared:A3,also:A3,over:A3,under:A3,too:A3,it:A3,but:A3,still:A3,really:A3,quite:A3,well:A3,very:A3,truly:A3,how:A3,deeply:A3,hella:A3,profoundly:A3,extremely:A3,so:A3,badly:A3,mostly:A3,totally:A3,awfully:A3,rather:A3,nothing:A3,something:A3,anything:A3,not:A3,me:A3,is:A3,face:A3,faces:A3,faced:A3,look:A3,looks:A3,looked:A3,reveal:A3,reveals:A3,revealed:A3,sound:A3,sounded:A3,sounds:A3,remains:A3,remained:A3,prove:A3,proves:A3,proved:A3,becomes:A3,stays:A3,tastes:A3,taste:A3,smells:A3,smell:A3,gets:A3,grows:A3,as:A3,rings:A3,radiates:A3,conveys:A3,convey:A3,conveyed:A3,of:A3},afterWords:{too:A3,also:A3,or:A3,enough:A3,as:A3}},_3="Gerund",b3={beforeTags:{Adverb:_3,Preposition:_3,Conjunction:_3},afterTags:{Adverb:_3,Possessive:_3,Person:_3,Pronoun:_3,Determiner:_3,Copula:_3,Preposition:_3,Conjunction:_3,Comparative:_3},beforeWords:{been:_3,keep:_3,continue:_3,stop:_3,am:_3,be:_3,me:_3,began:_3,start:_3,starts:_3,started:_3,stops:_3,stopped:_3,help:_3,helps:_3,avoid:_3,avoids:_3,love:_3,loves:_3,loved:_3,hate:_3,hates:_3,hated:_3},afterWords:{you:_3,me:_3,her:_3,him:_3,his:_3,them:_3,their:_3,it:_3,this:_3,there:_3,on:_3,about:_3,for:_3,up:_3,down:_3}},x3="Gerund",F3="Adjective",w3={beforeTags:Object.assign({},C3.beforeTags,b3.beforeTags,{Imperative:x3,Infinitive:F3,Plural:x3}),afterTags:Object.assign({},C3.afterTags,b3.afterTags,{Noun:F3}),beforeWords:Object.assign({},C3.beforeWords,b3.beforeWords,{is:F3,are:x3,was:F3,of:F3,suggest:x3,suggests:x3,suggested:x3,recommend:x3,recommends:x3,recommended:x3,imagine:x3,imagines:x3,imagined:x3,consider:x3,considered:x3,considering:x3,resist:x3,resists:x3,resisted:x3,avoid:x3,avoided:x3,avoiding:x3,except:F3,accept:F3,assess:x3,explore:x3,fear:x3,fears:x3,appreciate:x3,question:x3,help:x3,embrace:x3,with:F3}),afterWords:Object.assign({},C3.afterWords,b3.afterWords,{to:x3,not:x3,the:x3})},S3={beforeTags:{Determiner:void 0,Cardinal:"Noun",PhrasalVerb:"Adjective"},afterTags:{}},T3={beforeTags:Object.assign({},C3.beforeTags,v3.beforeTags,S3.beforeTags),afterTags:Object.assign({},C3.afterTags,v3.afterTags,S3.afterTags),beforeWords:Object.assign({},C3.beforeWords,v3.beforeWords,{are:"Adjective",is:"Adjective",was:"Adjective",be:"Adjective",off:"Adjective",out:"Adjective"}),afterWords:Object.assign({},C3.afterWords,v3.afterWords)};let M3="PastTense",B3="Adjective";const P3={beforeTags:{Adverb:M3,Pronoun:M3,ProperNoun:M3,Auxiliary:M3,Noun:M3},afterTags:{Possessive:M3,Pronoun:M3,Determiner:M3,Adverb:M3,Comparative:M3,Date:M3,Gerund:M3},beforeWords:{be:M3,who:M3,get:B3,had:M3,has:M3,have:M3,been:M3,it:M3,as:M3,for:B3,more:B3,always:B3},afterWords:{by:M3,back:M3,out:M3,in:M3,up:M3,down:M3,before:M3,after:M3,for:M3,the:M3,with:M3,as:M3,on:M3,at:M3,between:M3,to:M3,into:M3,us:M3,them:M3,his:M3,her:M3,their:M3,our:M3,me:M3,about:B3}},N3={beforeTags:Object.assign({},C3.beforeTags,P3.beforeTags),afterTags:Object.assign({},C3.afterTags,P3.afterTags),beforeWords:Object.assign({},C3.beforeWords,P3.beforeWords),afterWords:Object.assign({},C3.afterWords,P3.afterWords)},R3={afterTags:{Noun:"Adjective",Conjunction:void 0}},L3={beforeTags:Object.assign({},C3.beforeTags,y3.beforeTags,{Adverb:void 0,Negative:void 0}),afterTags:Object.assign({},C3.afterTags,y3.afterTags,R3.afterTags),beforeWords:Object.assign({},C3.beforeWords,y3.beforeWords,{have:void 0,had:void 0,not:void 0,went:"Adjective",goes:"Adjective",got:"Adjective",be:"Adjective"}),afterWords:Object.assign({},C3.afterWords,y3.afterWords,{to:void 0,as:"Adjective"})},I3={Copula:"Gerund",PastTense:"Gerund",PresentTense:"Gerund",Infinitive:"Gerund"},k3={Value:"Gerund"},O3={are:"Gerund",were:"Gerund",be:"Gerund",no:"Gerund",without:"Gerund",you:"Gerund",we:"Gerund",they:"Gerund",he:"Gerund",she:"Gerund",us:"Gerund",them:"Gerund"},U3={the:"Gerund",this:"Gerund",that:"Gerund",me:"Gerund",us:"Gerund",them:"Gerund"},z3={beforeTags:Object.assign({},b3.beforeTags,v3.beforeTags,I3),afterTags:Object.assign({},b3.afterTags,v3.afterTags,k3),beforeWords:Object.assign({},b3.beforeWords,v3.beforeWords,O3),afterWords:Object.assign({},b3.afterWords,v3.afterWords,U3)},V3="Singular",G3="Infinitive",H3={beforeTags:Object.assign({},y3.beforeTags,v3.beforeTags,{Adjective:V3,Particle:V3}),afterTags:Object.assign({},y3.afterTags,v3.afterTags,{ProperNoun:G3,Gerund:G3,Adjective:G3,Copula:V3}),beforeWords:Object.assign({},y3.beforeWords,v3.beforeWords,{is:V3,was:V3,of:V3,have:null}),afterWords:Object.assign({},y3.afterWords,v3.afterWords,{instead:G3,about:G3,his:G3,her:G3,to:null,by:null,in:null})},j3="Person",W3={beforeTags:{Honorific:j3,Person:j3},afterTags:{Person:j3,ProperNoun:j3,Verb:j3},ownTags:{ProperNoun:j3},beforeWords:{hi:j3,hey:j3,yo:j3,dear:j3,hello:j3},afterWords:{said:j3,says:j3,told:j3,tells:j3,feels:j3,felt:j3,seems:j3,thinks:j3,thought:j3,spends:j3,spendt:j3,plays:j3,played:j3,sing:j3,sang:j3,learn:j3,learned:j3,wants:j3,wanted:j3}},q3="Month",X3={beforeTags:{Date:q3,Value:q3},afterTags:{Date:q3,Value:q3},beforeWords:{by:q3,in:q3,on:q3,during:q3,after:q3,before:q3,between:q3,until:q3,til:q3,sometime:q3,of:q3,this:q3,next:q3,last:q3,previous:q3,following:q3,with:"Person"},afterWords:{sometime:q3,in:q3,of:q3,until:q3,the:q3}},K3={beforeTags:Object.assign({},W3.beforeTags,X3.beforeTags),afterTags:Object.assign({},W3.afterTags,X3.afterTags),beforeWords:Object.assign({},W3.beforeWords,X3.beforeWords),afterWords:Object.assign({},W3.afterWords,X3.afterWords)},Y3="Place",J3={beforeTags:{Place:Y3},afterTags:{Place:Y3,Abbreviation:Y3},beforeWords:{in:Y3,by:Y3,near:Y3,from:Y3,to:Y3},afterWords:{in:Y3,by:Y3,near:Y3,from:Y3,to:Y3,government:Y3,council:Y3,region:Y3,city:Y3}};let $3="Unit";const Q3={"Actor|Verb":E3,"Adj|Gerund":w3,"Adj|Noun":T3,"Adj|Past":N3,"Adj|Present":L3,"Noun|Verb":H3,"Noun|Gerund":z3,"Person|Noun":{beforeTags:Object.assign({},v3.beforeTags,W3.beforeTags),afterTags:Object.assign({},v3.afterTags,W3.afterTags),beforeWords:Object.assign({},v3.beforeWords,W3.beforeWords,{i:"Infinitive",we:"Infinitive"}),afterWords:Object.assign({},v3.afterWords,W3.afterWords)},"Person|Date":K3,"Person|Verb":{beforeTags:Object.assign({},v3.beforeTags,W3.beforeTags,y3.beforeTags),afterTags:Object.assign({},v3.afterTags,W3.afterTags,y3.afterTags),beforeWords:Object.assign({},v3.beforeWords,W3.beforeWords,y3.beforeWords),afterWords:Object.assign({},v3.afterWords,W3.afterWords,y3.afterWords)},"Person|Place":{beforeTags:Object.assign({},J3.beforeTags,W3.beforeTags),afterTags:Object.assign({},J3.afterTags,W3.afterTags),beforeWords:Object.assign({},J3.beforeWords,W3.beforeWords),afterWords:Object.assign({},J3.afterWords,W3.afterWords)},"Person|Adj":{beforeTags:Object.assign({},W3.beforeTags,C3.beforeTags),afterTags:Object.assign({},W3.afterTags,C3.afterTags),beforeWords:Object.assign({},W3.beforeWords,C3.beforeWords),afterWords:Object.assign({},W3.afterWords,C3.afterWords)},"Unit|Noun":{beforeTags:{Value:$3},afterTags:{},beforeWords:{per:$3,every:$3,each:$3,square:$3,cubic:$3,sq:$3,metric:$3},afterWords:{per:$3,squared:$3,cubed:$3,long:$3}}},Z3=(e,t)=>{let n=Object.keys(e).reduce((t,n)=>(t[n]="Infinitive"===e[n]?"PresentTense":"Plural",t),{});return Object.assign(n,t)};Q3["Plural|Verb"]={beforeWords:Z3(Q3["Noun|Verb"].beforeWords,{had:"Plural",have:"Plural"}),afterWords:Z3(Q3["Noun|Verb"].afterWords,{his:"PresentTense",her:"PresentTense",its:"PresentTense",in:null,to:null,is:"PresentTense",by:"PresentTense"}),beforeTags:Z3(Q3["Noun|Verb"].beforeTags,{Conjunction:"PresentTense",Noun:void 0,ProperNoun:"PresentTense"}),afterTags:Z3(Q3["Noun|Verb"].afterTags,{Gerund:"Plural",Noun:"PresentTense",Value:"PresentTense"})};const e4=Q3,t4="Adjective",n4="Infinitive",r4="PresentTense",i4="Singular",a4="PastTense",o4="Adverb",s4="Plural",u4="Actor",l4="Verb",c4="Noun",h4="LastName",d4="Modal",p4="Place",f4="Participle",m4=[null,null,{ea:i4,ia:c4,ic:t4,ly:o4,"'n":l4,"'t":l4},{oed:a4,ued:a4,xed:a4," so":o4,"'ll":d4,"'re":"Copula",azy:t4,eer:c4,end:l4,ped:a4,ffy:t4,ify:n4,ing:"Gerund",ize:n4,ibe:n4,lar:t4,mum:t4,nes:r4,nny:t4,ous:t4,que:t4,ger:c4,ber:c4,rol:i4,sis:i4,ogy:i4,oid:i4,ian:i4,zes:r4,eld:a4,ken:f4,ven:f4,ten:f4,ect:n4,ict:n4,ign:n4,oze:n4,ful:t4,bal:t4,ton:c4,pur:p4},{amed:a4,aped:a4,ched:a4,lked:a4,rked:a4,reed:a4,nded:a4,mned:t4,cted:a4,dged:a4,ield:i4,akis:h4,cede:n4,chuk:h4,czyk:h4,ects:r4,iend:i4,ends:l4,enko:h4,ette:i4,iary:i4,wner:i4,fies:r4,fore:o4,gate:n4,gone:t4,ices:s4,ints:s4,ruct:n4,ines:s4,ions:s4,ners:s4,pers:s4,lers:s4,less:t4,llen:t4,made:t4,nsen:h4,oses:r4,ould:d4,some:t4,sson:h4,ians:s4,tion:i4,tage:c4,ique:i4,tive:t4,tors:c4,vice:i4,lier:i4,fier:i4,wned:a4,gent:i4,tist:u4,pist:u4,rist:u4,mist:u4,yist:u4,vist:u4,ists:u4,lite:i4,site:i4,rite:i4,mite:i4,bite:i4,mate:i4,date:i4,ndal:i4,vent:i4,uist:u4,gist:u4,note:i4,cide:i4,ence:i4,wide:t4,vide:n4,ract:n4,duce:n4,pose:n4,eive:n4,lyze:n4,lyse:n4,iant:t4,nary:t4,ghty:t4,uent:t4,erer:u4,bury:p4,dorf:c4,esty:c4,wych:p4,dale:p4,folk:p4,vale:p4,abad:p4,sham:p4,wick:p4,view:p4},{elist:u4,holic:i4,phite:i4,tized:a4,urned:a4,eased:a4,ances:s4,bound:t4,ettes:s4,fully:o4,ishes:r4,ities:s4,marek:h4,nssen:h4,ology:c4,osome:i4,tment:i4,ports:s4,rough:t4,tches:r4,tieth:"Ordinal",tures:s4,wards:o4,where:o4,archy:c4,pathy:c4,opoly:c4,embly:c4,phate:c4,ndent:i4,scent:i4,onist:u4,anist:u4,alist:u4,olist:u4,icist:u4,ounce:n4,iable:t4,borne:t4,gnant:t4,inant:t4,igent:t4,atory:t4,rient:i4,dient:i4,maker:u4,burgh:p4,mouth:p4,ceter:p4,ville:p4,hurst:p4,stead:p4,endon:p4,brook:p4,shire:p4,worth:c4,field:"ProperNoun",ridge:p4},{auskas:h4,parent:i4,cedent:i4,ionary:i4,cklist:i4,brooke:p4,keeper:u4,logist:u4,teenth:"Value",worker:u4,master:u4,writer:u4,brough:p4,cester:p4,ington:p4,cliffe:p4,ingham:p4},{chester:p4,logists:u4,opoulos:h4,borough:p4,sdottir:h4}],g4="Adjective",v4="Noun",D4="Verb",y4=[null,null,{},{neo:v4,bio:v4,"de-":D4,"re-":D4,"un-":D4,"ex-":v4},{anti:v4,auto:v4,faux:g4,hexa:v4,kilo:v4,mono:v4,nano:v4,octa:v4,poly:v4,semi:g4,tele:v4,"pro-":g4,"mis-":D4,"dis-":D4,"pre-":g4},{anglo:v4,centi:v4,ethno:v4,ferro:v4,grand:v4,hepta:v4,hydro:v4,intro:v4,macro:v4,micro:v4,milli:v4,nitro:v4,penta:v4,quasi:g4,radio:v4,tetra:v4,"omni-":g4,"post-":g4},{pseudo:g4,"extra-":g4,"hyper-":g4,"inter-":g4,"intra-":g4,"deca-":g4},{electro:v4}],E4="Adjective",A4="Infinitive",C4="PresentTense",_4="Singular",b4="PastTense",x4="Adverb",F4="Expression",w4="Actor",S4="Verb",T4="Noun",M4="LastName",B4={a:[[/.[aeiou]na$/,T4,"tuna"],[/.[oau][wvl]ska$/,M4],[/.[^aeiou]ica$/,_4,"harmonica"],[/^([hyj]a+)+$/,F4,"haha"]],c:[[/.[^aeiou]ic$/,E4]],d:[[/[aeiou](pp|ll|ss|ff|gg|tt|rr|bb|nn|mm)ed$/,b4,"popped"],[/.[aeo]{2}[bdgmnprvz]ed$/,b4,"rammed"],[/.[aeiou][sg]hed$/,b4,"gushed"],[/.[aeiou]red$/,b4,"hired"],[/.[aeiou]r?ried$/,b4,"hurried"],[/[^aeiou]ard$/,_4,"steward"],[/[aeiou][^aeiou]id$/,E4,""],[/.[vrl]id$/,E4,"livid"],[/..led$/,b4,"hurled"],[/.[iao]sed$/,b4,""],[/[aeiou]n?[cs]ed$/,b4,""],[/[aeiou][rl]?[mnf]ed$/,b4,""],[/[aeiou][ns]?c?ked$/,b4,"bunked"],[/[aeiou]gned$/,b4],[/[aeiou][nl]?ged$/,b4],[/.[tdbwxyz]ed$/,b4],[/[^aeiou][aeiou][tvx]ed$/,b4],[/.[cdflmnprstv]ied$/,b4,"emptied"]],e:[[/.[lnr]ize$/,A4,"antagonize"],[/.[^aeiou]ise$/,A4,"antagonise"],[/.[aeiou]te$/,A4,"bite"],[/.[^aeiou][ai]ble$/,E4,"fixable"],[/.[^aeiou]eable$/,E4,"maleable"],[/.[ts]ive$/,E4,"festive"],[/[a-z]-like$/,E4,"woman-like"]],h:[[/.[^aeiouf]ish$/,E4,"cornish"],[/.v[iy]ch$/,M4,"..ovich"],[/^ug?h+$/,F4,"ughh"],[/^uh[ -]?oh$/,F4,"uhoh"],[/[a-z]-ish$/,E4,"cartoon-ish"]],i:[[/.[oau][wvl]ski$/,M4,"polish-male"]],k:[[/^(k){2}$/,F4,"kkkk"]],l:[[/.[gl]ial$/,E4,"familial"],[/.[^aeiou]ful$/,E4,"fitful"],[/.[nrtumcd]al$/,E4,"natal"],[/.[^aeiou][ei]al$/,E4,"familial"]],m:[[/.[^aeiou]ium$/,_4,"magnesium"],[/[^aeiou]ism$/,_4,"schism"],[/^[hu]m+$/,F4,"hmm"],[/^\d+ ?[ap]m$/,"Date","3am"]],n:[[/.[lsrnpb]ian$/,E4,"republican"],[/[^aeiou]ician$/,w4,"musician"],[/[aeiou][ktrp]in'$/,"Gerund","cookin'"]],o:[[/^no+$/,F4,"noooo"],[/^(yo)+$/,F4,"yoo"],[/^wo{2,}[pt]?$/,F4,"woop"]],r:[[/.[bdfklmst]ler$/,"Noun"],[/[aeiou][pns]er$/,_4],[/[^i]fer$/,A4],[/.[^aeiou][ao]pher$/,w4],[/.[lk]er$/,"Noun"],[/.ier$/,"Comparative"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,E4],[/[aeiou].*ist$/,E4],[/^[a-z]et$/,S4]],s:[[/.[^aeiou]ises$/,C4],[/.[rln]ates$/,C4],[/.[^z]ens$/,S4],[/.[lstrn]us$/,_4],[/.[aeiou]sks$/,C4],[/.[aeiou]kes$/,C4],[/[aeiou][^aeiou]is$/,_4],[/[a-z]'s$/,T4],[/^yes+$/,F4]],v:[[/.[^aeiou][ai][kln]ov$/,M4]],y:[[/.[cts]hy$/,E4],[/.[st]ty$/,E4],[/.[tnl]ary$/,E4],[/.[oe]ry$/,_4],[/[rdntkbhs]ly$/,x4],[/.(gg|bb|zz)ly$/,E4],[/...lly$/,x4],[/.[gk]y$/,E4],[/[bszmp]{2}y$/,E4],[/.[ai]my$/,E4],[/[ea]{2}zy$/,E4],[/.[^aeiou]ity$/,_4]]},P4="Verb",N4="Noun",R4={leftTags:[["Adjective",N4],["Possessive",N4],["Determiner",N4],["Adverb",P4],["Pronoun",P4],["Value",N4],["Ordinal",N4],["Modal",P4],["Superlative",N4],["Demonym",N4],["Honorific","Person"]],leftWords:[["i",P4],["first",N4],["it",P4],["there",P4],["not",P4],["because",N4],["if",N4],["but",N4],["who",P4],["this",N4],["his",N4],["when",N4],["you",P4],["very","Adjective"],["old",N4],["never",P4],["before",N4],["a",N4],["the",N4],["been",P4]],rightTags:[["Copula",N4],["PastTense",N4],["Conjunction",N4],["Modal",N4]],rightWords:[["there",P4],["me",P4],["man","Adjective"],["him",P4],["it",P4],["were",N4],["took",N4],["himself",P4],["went",N4],["who",N4],["jr","Person"]]},L4={fwd:"3:ser,ier\xa61er:h,t,f,l,n\xa61r:e\xa62er:ss,or,om",both:"3er:ver,ear,alm\xa63ner:hin\xa63ter:lat\xa62mer:im\xa62er:ng,rm,mb\xa62ber:ib\xa62ger:ig\xa61er:w,p,k,d\xa6ier:y",rev:"1:tter,yer\xa62:uer,ver,ffer,oner,eler,ller,iler,ster,cer,uler,sher,ener,gher,aner,adder,nter,eter,rter,hter,rner,fter\xa63:oser,ooler,eafer,user,airer,bler,maler,tler,eater,uger,rger,ainer,urer,ealer,icher,pler,emner,icter,nser,iser\xa64:arser,viner,ucher,rosser,somer,ndomer,moter,oother,uarer,hiter\xa65:nuiner,esser,emier\xa6ar:urther",ex:"worse:bad\xa6better:good\xa64er:fair,gray,poor\xa61urther:far\xa63ter:fat,hot,wet\xa63der:mad,sad\xa63er:shy,fun\xa64der:glad\xa6:\xa64r:cute,dire,fake,fine,free,lame,late,pale,rare,ripe,rude,safe,sore,tame,wide\xa65r:eerie,stale"},I4={fwd:"1:nning,tting,rring,pping,eing,mming,gging,dding,bbing,kking\xa62:eking,oling,eling,eming\xa63:velling,siting,uiting,fiting,loting,geting,ialing,celling\xa64:graming",both:"1:aing,iing,fing,xing,ying,oing,hing,wing\xa62:tzing,rping,izzing,bting,mning,sping,wling,rling,wding,rbing,uping,lming,wning,mping,oning,lting,mbing,lking,fting,hting,sking,gning,pting,cking,ening,nking,iling,eping,ering,rting,rming,cting,lping,ssing,nting,nding,lding,sting,rning,rding,rking\xa63:belling,siping,toming,yaking,uaking,oaning,auling,ooping,aiding,naping,euring,tolling,uzzing,ganing,haning,ualing,halling,iasing,auding,ieting,ceting,ouling,voring,ralling,garing,joring,oaming,oaking,roring,nelling,ooring,uelling,eaming,ooding,eaping,eeting,ooting,ooming,xiting,keting,ooking,ulling,airing,oaring,biting,outing,oiting,earing,naling,oading,eeding,ouring,eaking,aiming,illing,oining,eaning,onging,ealing,aining,eading\xa64:thoming,melling,aboring,ivoting,weating,dfilling,onoring,eriting,imiting,tialling,rgining,otoring,linging,winging,lleting,louding,spelling,mpelling,heating,feating,opelling,choring,welling,ymaking,ctoring,calling,peating,iloring,laiting,utoring,uditing,mmaking,loating,iciting,waiting,mbating,voiding,otalling,nsoring,nselling,ocusing,itoring,eloping\xa65:rselling,umpeting,atrolling,treating,tselling,rpreting,pringing,ummeting,ossoming,elmaking,eselling,rediting,totyping,onmaking,rfeiting,ntrolling\xa65e:chmaking,dkeeping,severing,erouting,ecreting,ephoning,uthoring,ravening,reathing,pediting,erfering,eotyping,fringing,entoring,ombining,ompeting\xa64e:emaking,eething,twining,rruling,chuting,xciting,rseding,scoping,edoring,pinging,lunging,agining,craping,pleting,eleting,nciting,nfining,ncoding,tponing,ecoding,writing,esaling,nvening,gnoring,evoting,mpeding,rvening,dhering,mpiling,storing,nviting,ploring\xa63e:tining,nuring,saking,miring,haling,ceding,xuding,rining,nuting,laring,caring,miling,riding,hoking,piring,lading,curing,uading,noting,taping,futing,paring,hading,loding,siring,guring,vading,voking,during,niting,laning,caping,luting,muting,ruding,ciding,juring,laming,caling,hining,uoting,liding,ciling,duling,tuting,puting,cuting,coring,uiding,tiring,turing,siding,rading,enging,haping,buting,lining,taking,anging,haring,uiring,coming,mining,moting,suring,viding,luding\xa62e:tring,zling,uging,oging,gling,iging,vring,fling,lging,obing,psing,pling,ubing,cling,dling,wsing,iking,rsing,dging,kling,ysing,tling,rging,eging,nsing,uning,osing,uming,using,ibing,bling,aging,ising,asing,ating\xa62ie:rlying\xa61e:zing,uing,cing,ving",rev:"ying:ie\xa61ing:se,ke,te,we,ne,re,de,pe,me,le,c,he\xa62ing:ll,ng,dd,ee,ye,oe,rg,us\xa62ning:un\xa62ging:og,ag,ug,ig,eg\xa62ming:um\xa62bing:ub,ab,eb,ob\xa63ning:lan,can,hin,pin,win\xa63ring:cur,lur,tir,tar,pur,car\xa63ing:ait,del,eel,fin,eat,oat,eem,lel,ool,ein,uin\xa63ping:rop,rap,top,uip,wap,hip,hop,lap,rip,cap\xa63ming:tem,wim,rim,kim,lim\xa63ting:mat,cut,pot,lit,lot,hat,set,pit,put\xa63ding:hed,bed,bid\xa63king:rek\xa63ling:cil,pel\xa63bing:rib\xa64ning:egin\xa64ing:isit,ruit,ilot,nsit,dget,rkel,ival,rcel\xa64ring:efer,nfer\xa64ting:rmit,mmit,ysit,dmit,emit,bmit,tfit,gret\xa64ling:evel,xcel,ivel\xa64ding:hred\xa65ing:arget,posit,rofit\xa65ring:nsfer\xa65ting:nsmit,orget,cquit\xa65ling:ancel,istil",ex:"3:adding,eating,aiming,aiding,airing,outing,gassing,setting,getting,putting,cutting,winning,sitting,betting,mapping,tapping,letting,bidding,hitting,tanning,netting,popping,fitting,capping,lapping,barring,banning,vetting,topping,rotting,tipping,potting,wetting,pitting,dipping,budding,hemming,pinning,jetting,kidding,padding,podding,sipping,wedding,bedding,donning,warring,penning,gutting,cueing,wadding,petting,ripping,napping,matting,tinning,binning,dimming,hopping,mopping,nodding,panning,rapping,ridding,sinning\xa64:selling,falling,calling,waiting,editing,telling,rolling,heating,boating,hanging,beating,coating,singing,tolling,felling,polling,discing,seating,voiding,gelling,yelling,baiting,reining,ruining,seeking,spanning,stepping,knitting,emitting,slipping,quitting,dialing,omitting,clipping,shutting,skinning,abutting,flipping,trotting,cramming,fretting,suiting\xa65:bringing,treating,spelling,stalling,trolling,expelling,rivaling,wringing,deterring,singeing,befitting,refitting\xa66:enrolling,distilling,scrolling,strolling,caucusing,travelling\xa67:installing,redefining,stencilling,recharging,overeating,benefiting,unraveling,programing\xa69:reprogramming\xa6is:being\xa62e:using,aging,owing\xa63e:making,taking,coming,noting,hiring,filing,coding,citing,doping,baking,coping,hoping,lading,caring,naming,voting,riding,mining,curing,lining,ruling,typing,boring,dining,firing,hiding,piling,taping,waning,baling,boning,faring,honing,wiping,luring,timing,wading,piping,fading,biting,zoning,daring,waking,gaming,raking,ceding,tiring,coking,wining,joking,paring,gaping,poking,pining,coring,liming,toting,roping,wiring,aching\xa64e:writing,storing,eroding,framing,smoking,tasting,wasting,phoning,shaking,abiding,braking,flaking,pasting,priming,shoring,sloping,withing,hinging\xa65e:defining,refining,renaming,swathing,fringing,reciting\xa61ie:dying,tying,lying,vying\xa67e:sunbathing"},k4={fwd:"1:mt\xa62:llen\xa63:iven,aken\xa6:ne\xa6y:in",both:"1:wn\xa62:me,aten\xa63:seen,bidden,isen\xa64:roven,asten\xa63l:pilt\xa63d:uilt\xa62e:itten\xa61im:wum\xa61eak:poken\xa61ine:hone\xa61ose:osen\xa61in:gun\xa61ake:woken\xa6ear:orn\xa6eal:olen\xa6eeze:ozen\xa6et:otten\xa6ink:unk\xa6ing:ung",rev:"2:un\xa6oken:eak\xa6ought:eek\xa6oven:eave\xa61ne:o\xa61own:ly\xa61den:de\xa61in:ay\xa62t:am\xa62n:ee\xa63en:all\xa64n:rive,sake,take\xa65n:rgive",ex:"2:been\xa63:seen,run\xa64:given,taken\xa65:shaken\xa62eak:broken\xa61ive:dove\xa62y:flown\xa63e:hidden,ridden\xa61eek:sought\xa61ake:woken\xa61eave:woven"},O4={fwd:"1:oes\xa61ve:as",both:"1:xes\xa62:zzes,ches,shes,sses\xa63:iases\xa62y:llies,plies\xa61y:cies,bies,ties,vies,nies,pies,dies,ries,fies\xa6:s",rev:"1ies:ly\xa62es:us,go,do\xa63es:cho,eto",ex:"2:does,goes\xa63:gasses\xa65:focuses\xa6is:are\xa63y:relies\xa62y:flies\xa62ve:has"},U4={fwd:"1st:e\xa61est:l,m,f,s\xa61iest:cey\xa62est:or,ir\xa63est:ver",both:"4:east\xa65:hwest\xa65lest:erful\xa64est:weet,lgar,tter,oung\xa64most:uter\xa63est:ger,der,rey,iet,ong,ear\xa63test:lat\xa63most:ner\xa62est:pt,ft,nt,ct,rt,ht\xa62test:it\xa62gest:ig\xa61est:b,k,n,p,h,d,w\xa6iest:y",rev:"1:ttest,nnest,yest\xa62:sest,stest,rmest,cest,vest,lmest,olest,ilest,ulest,ssest,imest,uest\xa63:rgest,eatest,oorest,plest,allest,urest,iefest,uelest,blest,ugest,amest,yalest,ealest,illest,tlest,itest\xa64:cerest,eriest,somest,rmalest,ndomest,motest,uarest,tiffest\xa65:leverest,rangest\xa6ar:urthest\xa63ey:riciest",ex:"best:good\xa6worst:bad\xa65est:great\xa64est:fast,full,fair,dull\xa63test:hot,wet,fat\xa64nest:thin\xa61urthest:far\xa63est:gay,shy,ill\xa64test:neat\xa64st:late,wide,fine,safe,cute,fake,pale,rare,rude,sore,ripe,dire\xa66st:severe"},z4={fwd:"1:tistic,eable,lful,sful,ting,tty\xa62:onate,rtable,geous,ced,seful,ctful\xa63:ortive,ented\xa6arity:ear\xa6y:etic\xa6fulness:begone\xa61ity:re\xa61y:tiful,gic\xa62ity:ile,imous,ilous,ime\xa62ion:ated\xa62eness:iving\xa62y:trious\xa62ation:iring\xa62tion:vant\xa63ion:ect\xa63ce:mant,mantic\xa63tion:irable\xa63y:est,estic\xa63m:mistic,listic\xa63ess:ning\xa64n:utious\xa64on:rative,native,vative,ective\xa64ce:erant",both:"1:king,wing\xa62:alous,ltuous,oyful,rdous\xa63:gorous,ectable,werful,amatic\xa64:oised,usical,agical,raceful,ocused,lined,ightful\xa65ness:stful,lding,itous,nuous,ulous,otous,nable,gious,ayful,rvous,ntous,lsive,peful,entle,ciful,osive,leful,isive,ncise,reful,mious\xa65ty:ivacious\xa65ties:ubtle\xa65ce:ilient,adiant,atient\xa65cy:icient\xa65sm:gmatic\xa65on:sessive,dictive\xa65ity:pular,sonal,eative,entic\xa65sity:uminous\xa65ism:conic\xa65nce:mperate\xa65ility:mitable\xa65ment:xcited\xa65n:bitious\xa64cy:brant,etent,curate\xa64ility:erable,acable,icable,ptable\xa64ty:nacious,aive,oyal,dacious\xa64n:icious\xa64ce:vient,erent,stent,ndent,dient,quent,ident\xa64ness:adic,ound,hing,pant,sant,oing,oist,tute\xa64icity:imple\xa64ment:fined,mused\xa64ism:otic\xa64ry:dantic\xa64ity:tund,eral\xa64edness:hand\xa64on:uitive\xa64lity:pitable\xa64sm:eroic,namic\xa64sity:nerous\xa63th:arm\xa63ility:pable,bable,dable,iable\xa63cy:hant,nant,icate\xa63ness:red,hin,nse,ict,iet,ite,oud,ind,ied,rce\xa63ion:lute\xa63ity:ual,gal,volous,ial\xa63ce:sent,fensive,lant,gant,gent,lent,dant\xa63on:asive\xa63m:fist,sistic,iastic\xa63y:terious,xurious,ronic,tastic\xa63ur:amorous\xa63e:tunate\xa63ation:mined\xa63sy:rteous\xa63ty:ain\xa63ry:ave\xa63ment:azed\xa62ness:de,on,ue,rn,ur,ft,rp,pe,om,ge,rd,od,ay,ss,er,ll,oy,ap,ht,ld,ad,rt\xa62inousness:umous\xa62ity:neous,ene,id,ane\xa62cy:bate,late\xa62ation:ized\xa62ility:oble,ible\xa62y:odic\xa62e:oving,aring\xa62s:ost\xa62itude:pt\xa62dom:ee\xa62ance:uring\xa62tion:reet\xa62ion:oted\xa62sion:ending\xa62liness:an\xa62or:rdent\xa61th:ung\xa61e:uable\xa61ness:w,h,k,f\xa61ility:mble\xa61or:vent\xa61ement:ging\xa61tiquity:ncient\xa61ment:hed\xa6verty:or\xa6ength:ong\xa6eat:ot\xa6pth:ep\xa6iness:y",rev:"",ex:"5:forceful,humorous\xa68:charismatic\xa613:understanding\xa65ity:active\xa611ness:adventurous,inquisitive,resourceful\xa68on:aggressive,automatic,perceptive\xa67ness:amorous,fatuous,furtive,ominous,serious\xa65ness:ample,sweet\xa612ness:apprehensive,cantankerous,contemptuous,ostentatious\xa613ness:argumentative,conscientious\xa69ness:assertive,facetious,imperious,inventive,oblivious,rapacious,receptive,seditious,whimsical\xa610ness:attractive,expressive,impressive,loquacious,salubrious,thoughtful\xa63edom:boring\xa64ness:calm,fast,keen,tame\xa68ness:cheerful,gracious,specious,spurious,timorous,unctuous\xa65sity:curious\xa69ion:deliberate\xa68ion:desperate\xa66e:expensive\xa67ce:fragrant\xa63y:furious\xa69ility:ineluctable\xa66ism:mystical\xa68ity:physical,proactive,sensitive,vertical\xa65cy:pliant\xa67ity:positive\xa69ity:practical\xa612ism:professional\xa66ce:prudent\xa63ness:red\xa66cy:vagrant\xa63dom:wise"},V4=/^([0-9]+)/,G4=function(e){let t=function(e){let t={};return e.split("\xa6").forEach(e=>{let[n,r]=e.split(":");r=(r||"").split(","),r.forEach(e=>{t[e]=n})}),t}(e);return Object.keys(t).reduce((e,n)=>(e[n]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t=String(t);let n=t.match(V4);if(null===n)return t;let r=Number(n[1])||0;return e.substring(0,r)+t.replace(V4,"")}(n,t[n]),e),{})},H4=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"string"===typeof e&&(e=JSON.parse(e)),e.fwd=G4(e.fwd||""),e.both=G4(e.both||""),e.rev=G4(e.rev||""),e.ex=G4(e.ex||""),e},j4=function(e){return Object.entries(e).reduce((e,t)=>(e[t[1]]=t[0],e),{})},W4=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{reversed:!0,both:j4(e.both),ex:j4(e.ex),fwd:e.rev||{}}},q4=H4({fwd:"1:tted,wed,gged,nned,een,rred,pped,yed,bbed,oed,dded,rd,wn,mmed\xa62:eed,nded,et,hted,st,oled,ut,emed,eled,lded,ken,rt,nked,apt,ant,eped,eked\xa63:eared,eat,eaded,nelled,ealt,eeded,ooted,eaked,eaned,eeted,mited,bid,uit,ead,uited,ealed,geted,velled,ialed,belled\xa64:ebuted,hined,comed\xa6y:ied\xa6ome:ame\xa6ear:ore\xa6ind:ound\xa6ing:ung,ang\xa6ep:pt\xa6ink:ank,unk\xa6ig:ug\xa6all:ell\xa6ee:aw\xa6ive:ave\xa6eeze:oze\xa6old:eld\xa6ave:ft\xa6ake:ook\xa6ell:old\xa6ite:ote\xa6ide:ode\xa6ine:one\xa6in:un,on\xa6eal:ole\xa6im:am\xa6ie:ay\xa6and:ood\xa61ise:rose\xa61eak:roke\xa61ing:rought\xa61ive:rove\xa61el:elt\xa61id:bade\xa61et:got\xa61y:aid\xa61it:sat\xa63e:lid\xa63d:pent",both:"1:aed,fed,xed,hed\xa62:sged,xted,wled,rped,lked,kied,lmed,lped,uped,bted,rbed,rked,wned,rled,mped,fted,mned,mbed,zzed,omed,ened,cked,gned,lted,sked,ued,zed,nted,ered,rted,rmed,ced,sted,rned,ssed,rded,pted,ved,cted\xa63:cled,eined,siped,ooned,uked,ymed,jored,ouded,ioted,oaned,lged,asped,iged,mured,oided,eiled,yped,taled,moned,yled,lit,kled,oaked,gled,naled,fled,uined,oared,valled,koned,soned,aided,obed,ibed,meted,nicked,rored,micked,keted,vred,ooped,oaded,rited,aired,auled,filled,ouled,ooded,ceted,tolled,oited,bited,aped,tled,vored,dled,eamed,nsed,rsed,sited,owded,pled,sored,rged,osed,pelled,oured,psed,oated,loned,aimed,illed,eured,tred,ioned,celled,bled,wsed,ooked,oiled,itzed,iked,iased,onged,ased,ailed,uned,umed,ained,auded,nulled,ysed,eged,ised,aged,oined,ated,used,dged,doned\xa64:ntied,efited,uaked,caded,fired,roped,halled,roked,himed,culed,tared,lared,tuted,uared,routed,pited,naked,miled,houted,helled,hared,cored,caled,tired,peated,futed,ciled,called,tined,moted,filed,sided,poned,iloted,honed,lleted,huted,ruled,cured,named,preted,vaded,sured,talled,haled,peded,gined,nited,uided,ramed,feited,laked,gured,ctored,unged,pired,cuted,voked,eloped,ralled,rined,coded,icited,vided,uaded,voted,mined,sired,noted,lined,nselled,luted,jured,fided,puted,piled,pared,olored,cided,hoked,enged,tured,geoned,cotted,lamed,uiled,waited,udited,anged,luded,mired,uired,raded\xa65:modelled,izzled,eleted,umpeted,ailored,rseded,treated,eduled,ecited,rammed,eceded,atrolled,nitored,basted,twined,itialled,ncited,gnored,ploded,xcited,nrolled,namelled,plored,efeated,redited,ntrolled,nfined,pleted,llided,lcined,eathed,ibuted,lloted,dhered,cceded\xa63ad:sled\xa62aw:drew\xa62ot:hot\xa62ke:made\xa62ow:hrew,grew\xa62ose:hose\xa62d:ilt\xa62in:egan\xa61un:ran\xa61ink:hought\xa61ick:tuck\xa61ike:ruck\xa61eak:poke,nuck\xa61it:pat\xa61o:did\xa61ow:new\xa61ake:woke\xa6go:went",rev:"3:rst,hed,hut,cut,set\xa64:tbid\xa65:dcast,eread,pread,erbid\xa6ought:uy,eek\xa61ied:ny,ly,dy,ry,fy,py,vy,by,ty,cy\xa61ung:ling,ting,wing\xa61pt:eep\xa61ank:rink\xa61ore:bear,wear\xa61ave:give\xa61oze:reeze\xa61ound:rind,wind\xa61ook:take,hake\xa61aw:see\xa61old:sell\xa61ote:rite\xa61ole:teal\xa61unk:tink\xa61am:wim\xa61ay:lie\xa61ood:tand\xa61eld:hold\xa62d:he,ge,re,le,leed,ne,reed,be,ye,lee,pe,we\xa62ed:dd,oy,or,ey,gg,rr,us,ew,to\xa62ame:ecome,rcome\xa62ped:ap\xa62ged:ag,og,ug,eg\xa62bed:ub,ab,ib,ob\xa62lt:neel\xa62id:pay\xa62ang:pring\xa62ove:trive\xa62med:um\xa62ode:rride\xa62at:ysit\xa63ted:mit,hat,mat,lat,pot,rot,bat\xa63ed:low,end,tow,und,ond,eem,lay,cho,dow,xit,eld,ald,uld,law,lel,eat,oll,ray,ank,fin,oam,out,how,iek,tay,haw,ait,vet,say,cay,bow\xa63d:ste,ede,ode,ete,ree,ude,ame,oke,ote,ime,ute,ade\xa63red:lur,cur,pur,car\xa63ped:hop,rop,uip,rip,lip,tep,top\xa63ded:bed,rod,kid\xa63ade:orbid\xa63led:uel\xa63ned:lan,can,kin,pan,tun\xa63med:rim,lim\xa64ted:quit,llot\xa64ed:pear,rrow,rand,lean,mand,anel,pand,reet,link,abel,evel,imit,ceed,ruit,mind,peal,veal,hool,head,pell,well,mell,uell,band,hear,weak\xa64led:nnel,qual,ebel,ivel\xa64red:nfer,efer,sfer\xa64n:sake,trew\xa64d:ntee\xa64ded:hred\xa64ned:rpin\xa65ed:light,nceal,right,ndear,arget,hread,eight,rtial,eboot\xa65d:edite,nvite\xa65ted:egret\xa65led:ravel",ex:"2:been,upped\xa63:added,aged,aided,aimed,aired,bid,died,dyed,egged,erred,eyed,fit,gassed,hit,lied,owed,pent,pied,tied,used,vied,oiled,outed,banned,barred,bet,canned,cut,dipped,donned,ended,feed,inked,jarred,let,manned,mowed,netted,padded,panned,pitted,popped,potted,put,set,sewn,sowed,tanned,tipped,topped,vowed,weed,bowed,jammed,binned,dimmed,hopped,mopped,nodded,pinned,rigged,sinned,towed,vetted\xa64:ached,baked,baled,boned,bored,called,caned,cared,ceded,cited,coded,cored,cubed,cured,dared,dined,edited,exited,faked,fared,filed,fined,fired,fuelled,gamed,gelled,hired,hoped,joked,lined,mined,named,noted,piled,poked,polled,pored,pulled,reaped,roamed,rolled,ruled,seated,shed,sided,timed,tolled,toned,voted,waited,walled,waned,winged,wiped,wired,zoned,yelled,tamed,lubed,roped,faded,mired,caked,honed,banged,culled,heated,raked,welled,banded,beat,cast,cooled,cost,dealt,feared,folded,footed,handed,headed,heard,hurt,knitted,landed,leaked,leapt,linked,meant,minded,molded,neared,needed,peaked,plodded,plotted,pooled,quit,read,rooted,sealed,seeded,seeped,shipped,shunned,skimmed,slammed,sparred,stemmed,stirred,suited,thinned,twinned,swayed,winked,dialed,abutted,blotted,fretted,healed,heeded,peeled,reeled\xa65:basted,cheated,equalled,eroded,exiled,focused,opined,pleated,primed,quoted,scouted,shored,sloped,smoked,sniped,spelled,spouted,routed,staked,stored,swelled,tasted,treated,wasted,smelled,dwelled,honored,prided,quelled,eloped,scared,coveted,sweated,breaded,cleared,debuted,deterred,freaked,modeled,pleaded,rebutted,speeded\xa66:anchored,defined,endured,impaled,invited,refined,revered,strolled,cringed,recast,thrust,unfolded\xa67:authored,combined,competed,conceded,convened,excreted,extruded,redefined,restored,secreted,rescinded,welcomed\xa68:expedited,infringed\xa69:interfered,intervened,persevered\xa610:contravened\xa6eat:ate\xa6is:was\xa6go:went\xa6are:were\xa63d:bent,lent,rent,sent\xa63e:bit,fled,hid,lost\xa63ed:bled,bred\xa62ow:blew,grew\xa61uy:bought\xa62tch:caught\xa61o:did\xa61ive:dove,gave\xa62aw:drew\xa62ed:fed\xa62y:flew,laid,paid,said\xa61ight:fought\xa61et:got\xa62ve:had\xa61ang:hung\xa62ad:led\xa62ght:lit\xa62ke:made\xa62et:met\xa61un:ran\xa61ise:rose\xa61it:sat\xa61eek:sought\xa61each:taught\xa61ake:woke,took\xa61eave:wove\xa62ise:arose\xa61ear:bore,tore,wore\xa61ind:bound,found,wound\xa62eak:broke\xa62ing:brought,wrung\xa61ome:came\xa62ive:drove\xa61ig:dug\xa61all:fell\xa62el:felt\xa64et:forgot\xa61old:held\xa62ave:left\xa61ing:rang,sang\xa61ide:rode\xa61ink:sank\xa61ee:saw\xa62ine:shone\xa64e:slid\xa61ell:sold,told\xa64d:spent\xa62in:spun\xa61in:won"}),X4=H4(O4),K4=H4(I4),Y4=H4(k4),J4=W4(q4),$4=W4(X4),Q4=W4(K4),Z4=W4(Y4),e5=H4(L4),t5=H4(U4),n5={fromPast:q4,fromPresent:X4,fromGerund:K4,fromParticiple:Y4,toPast:J4,toPresent:$4,toGerund:Q4,toParticiple:Z4,toComparative:e5,toSuperlative:t5,fromComparative:W4(e5),fromSuperlative:W4(t5),adjToNoun:H4(z4)},r5=["academy","administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","bureau","cafe","co","caisse","capital","care","cathedral","center","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","data","departement","department","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","faculty","faction","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","llc","ltd","limited","machines","magazine","management","marine","marketing","markets","media","memorial","ministere","ministry","military","mobile","motor","motors","musee","museum","news","observatory","office","oil","optical","orchestra","organization","partners","partnership","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","politburo","polytechnic","post","power","press","productions","quartet","radio","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","societe","subsidiary","society","sons","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce((e,t)=>(e[t]=!0,e),{}),i5=["atoll","basin","bay","beach","bluff","bog","camp","canyon","canyons","cape","cave","caves","cliffs","coast","cove","coves","crater","crossing","creek","desert","dune","dunes","downs","estates","escarpment","estuary","falls","fjord","fjords","forest","forests","glacier","gorge","gorges","grove","gulf","gully","highland","heights","hollow","hill","hills","inlet","island","islands","isthmus","junction","knoll","lagoon","lake","lakeshore","marsh","marshes","mount","mountain","mountains","narrows","peninsula","plains","plateau","pond","rapids","ravine","reef","reefs","ridge","river","rivers","sandhill","shoal","shore","shoreline","shores","strait","straits","springs","stream","swamp","tombolo","trail","trails","trench","valley","vallies","village","volcano","waterfall","watershed","wetland","woods","acres","burough","county","district","municipality","prefecture","province","region","reservation","state","territory","borough","metropolis","downtown","uptown","midtown","city","town","township","hamlet","country","kingdom","enclave","neighbourhood","neighborhood","kingdom","ward","zone","airport","amphitheater","arch","arena","auditorium","bar","barn","basilica","battlefield","bridge","building","castle","centre","coliseum","cineplex","complex","dam","farm","field","fort","garden","gardens","gymnasium","hall","house","levee","library","manor","memorial","monument","museum","gallery","palace","pillar","pits","plantation","playhouse","quarry","sportsfield","sportsplex","stadium","terrace","terraces","theater","tower","park","parks","site","ranch","raceway","sportsplex","ave","st","street","rd","road","lane","landing","crescent","cr","way","tr","terrace","avenue"].reduce((e,t)=>(e[t]=!0,e),{}),a5=[[/([^v])ies$/i,"$1y"],[/(ise)s$/i,"$1"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(ause)s$/i,"$1"],[/(ease)s$/i,"$1"],[/(ious)es$/i,"$1"],[/(ouse)s$/i,"$1"],[/(ose)s$/i,"$1"],[/(..ase)s$/i,"$1"],[/(..[aeiu]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/([xo]|ch|ss|sh)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ic)s$/i,"$1"],[/s$/i,""]],o5=function(e,t){const{irregularPlurals:n}=t.two;let r=(i=n,Object.keys(i).reduce((e,t)=>(e[i[t]]=t,e),{}));var i;if(r.hasOwnProperty(e))return r[e];for(let a=0;a<a5.length;a++)if(!0===a5[a][0].test(e))return e=e.replace(a5[a][0],a5[a][1]);return e},s5={toPlural:h3,toSingular:o5,all:function(e,t){let n=[e],r=h3(e,t);r!==e&&n.push(r);let i=o5(e,t);return i!==e&&n.push(i),n}},u5=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.hasOwnProperty(e)?t[e]:null}(e,t.ex);return n=n||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(let n=0;n<t.length;n+=1)if(e.endsWith(t[n]))return e;return null}(e,t.same),n=n||function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=t||{};for(let r=e.length-1;r>=1;r-=1){let i=e.length-r,a=e.substring(i,e.length);if(!0===t.hasOwnProperty(a))return e.slice(0,i)+t[a];if(!0===n.hasOwnProperty(a))return e.slice(0,i)+n[a]}return t.hasOwnProperty("")?e+t[""]:n.hasOwnProperty("")?e+n[""]:null}(e,t.fwd,t.both),n=n||e,n};let l5={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","unk","ung","upt","en"],PastTense:["ept","ed","lt","nt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns"],Participle:["ken","wn"]};l5=Object.keys(l5).reduce((e,t)=>(l5[t].forEach(n=>e[n]=t),e),{});const c5=l5,h5=function(e){let t=e.substring(e.length-3);if(!0===c5.hasOwnProperty(t))return c5[t];let n=e.substring(e.length-2);return!0===c5.hasOwnProperty(n)?c5[n]:"s"===e.substring(e.length-1)?"PresentTense":null},d5={are:"be",were:"be",been:"be",is:"be",am:"be",was:"be",be:"be",being:"be"},p5=function(e,t,n){const{fromPast:r,fromPresent:i,fromGerund:a,fromParticiple:o}=t.two.models;let{prefix:s,verb:u,particle:l}=function(e,t){let n="",r={};t.one&&t.one.prefixes&&(r=t.one.prefixes);let[i,a]=e.split(/ /);return a&&!0===r[i]&&(n=i,i=a,a=""),{prefix:n,verb:i,particle:a}}(e,t),c="";if(n||(n=h5(e)),d5.hasOwnProperty(e))c=d5[e];else if("Participle"===n)c=u5(u,o);else if("PastTense"===n)c=u5(u,r);else if("PresentTense"===n)c=u5(u,i);else{if("Gerund"!==n)return e;c=u5(u,a)}return l&&(c+=" "+l),s&&(c=s+" "+c),c},f5=function(e,t){const{toPast:n,toPresent:r,toGerund:i,toParticiple:a}=t.two.models;if("be"===e)return{Infinitive:e,Gerund:"being",PastTense:"was",PresentTense:"is"};let[o,s]=(e=>/ /.test(e)?e.split(/ /):[e,""])(e),u={Infinitive:o,PastTense:u5(o,n),PresentTense:u5(o,r),Gerund:u5(o,i),FutureTense:"will "+o},l=u5(o,a);if(l!==e&&l!==u.PastTense){let n=t.one.lexicon||{};"Participle"!==n[l]&&"Adjective"!==n[l]||("play"===e&&(l="played"),u.Participle=l)}return s&&Object.keys(u).forEach(e=>{u[e]+=" "+s}),u},m5={toInfinitive:p5,conjugate:f5,all:function(e,t){let n=f5(e,t);return delete n.FutureTense,Object.values(n).filter(e=>e)}},g5=function(e,t){const n=t.two.models.toSuperlative;return u5(e,n)},v5=function(e,t){const n=t.two.models.toComparative;return u5(e,n)},D5=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=e.length;for(let r=n<=6?n-1:6;r>=1;r-=1){let i=e.substring(n-r,e.length);if(!0===t[i.length].hasOwnProperty(i)){return e.slice(0,n-r)+t[i.length][i]}}return null},y5="ically",E5=new Set(["analyt"+y5,"chem"+y5,"class"+y5,"clin"+y5,"crit"+y5,"ecolog"+y5,"electr"+y5,"empir"+y5,"frant"+y5,"grammat"+y5,"ident"+y5,"ideolog"+y5,"log"+y5,"mag"+y5,"mathemat"+y5,"mechan"+y5,"med"+y5,"method"+y5,"method"+y5,"mus"+y5,"phys"+y5,"phys"+y5,"polit"+y5,"pract"+y5,"rad"+y5,"satir"+y5,"statist"+y5,"techn"+y5,"technolog"+y5,"theoret"+y5,"typ"+y5,"vert"+y5,"whims"+y5]),A5=[null,{},{ly:""},{ily:"y",bly:"ble",ply:"ple"},{ally:"al",rply:"rp"},{ually:"ual",ially:"ial",cally:"cal",eally:"eal",rally:"ral",nally:"nal",mally:"mal",eeply:"eep",eaply:"eap"},{ically:"ic"}],C5=new Set(["early","only","hourly","daily","weekly","monthly","yearly","mostly","duly","unduly","especially","undoubtedly","conversely","namely","exceedingly","presumably","accordingly","overly","best","latter","little","long","low"]),_5={wholly:"whole",fully:"full",truly:"true",gently:"gentle",singly:"single",customarily:"customary",idly:"idle",publically:"public",quickly:"quick",superbly:"superb",cynically:"cynical",well:"good"},b5=[null,{y:"ily"},{ly:"ly",ic:"ically"},{ial:"ially",ual:"ually",tle:"tly",ble:"bly",ple:"ply",ary:"arily"},{},{},{}],x5={cool:"cooly",whole:"wholly",full:"fully",good:"well",idle:"idly",public:"publicly",single:"singly",special:"especially"},F5=function(e){if(x5.hasOwnProperty(e))return x5[e];let t=D5(e,b5);return t||(t=e+"ly"),t},w5={toSuperlative:g5,toComparative:v5,toAdverb:F5,toNoun:function(e,t){const n=t.two.models.adjToNoun;return u5(e,n)},fromAdverb:function(e){return e.endsWith("ly")?E5.has(e)?e.replace(/ically/,"ical"):C5.has(e)?null:_5.hasOwnProperty(e)?_5[e]:D5(e,A5)||e:null},fromSuperlative:function(e,t){const n=t.two.models.fromSuperlative;return u5(e,n)},fromComparative:function(e,t){const n=t.two.models.fromComparative;return u5(e,n)},all:function(e,t){let n=[e];return n.push(g5(e,t)),n.push(v5(e,t)),n.push(F5(e)),n=n.filter(e=>e),n=new Set(n),Array.from(n)}},S5={noun:s5,verb:m5,adjective:w5},T5={Singular:(e,t,n,r)=>{let i=r.one.lexicon,a=n.two.transform.noun.toPlural(e,r);i[a]||(t[a]=t[a]||"Plural")},Actor:(e,t,n,r)=>{let i=r.one.lexicon,a=n.two.transform.noun.toPlural(e,r);i[a]||(t[a]=t[a]||["Plural","Actor"])},Comparable:(e,t,n,r)=>{let i=r.one.lexicon,{toSuperlative:a,toComparative:o}=n.two.transform.adjective,s=a(e,r);i[s]||(t[s]=t[s]||"Superlative");let u=o(e,r);i[u]||(t[u]=t[u]||"Comparative"),t[e]="Adjective"},Demonym:(e,t,n,r)=>{let i=n.two.transform.noun.toPlural(e,r);t[i]=t[i]||["Demonym","Plural"]},Infinitive:(e,t,n,r)=>{let i=r.one.lexicon,a=n.two.transform.verb.conjugate(e,r);Object.entries(a).forEach(e=>{i[e[1]]||t[e[1]]||"FutureTense"===e[0]||(t[e[1]]=e[0])})},PhrasalVerb:(e,t,n,r)=>{let i=r.one.lexicon;t[e]=["PhrasalVerb","Infinitive"];let a=r.one._multiCache,[o,s]=e.split(" ");i[o]||(t[o]=t[o]||"Infinitive");let u=n.two.transform.verb.conjugate(o,r);delete u.FutureTense,Object.entries(u).forEach(e=>{if("Actor"===e[0]||""===e[1])return;t[e[1]]||i[e[1]]||(t[e[1]]=e[0]),a[e[1]]=2;let n=e[1]+" "+s;t[n]=t[n]||[e[0],"PhrasalVerb"]})},Multiple:(e,t)=>{t[e]=["Multiple","Cardinal"],t[e+"th"]=["Multiple","Ordinal"],t[e+"ths"]=["Multiple","Fraction"]},Cardinal:(e,t)=>{t[e]=["TextValue","Cardinal"]},Ordinal:(e,t)=>{t[e]=["TextValue","Ordinal"],t[e+"s"]=["TextValue","Fraction"]},Place:(e,t)=>{t[e]=["Place","ProperNoun"]},Region:(e,t)=>{t[e]=["Region","ProperNoun"]}},M5=function(e,t){const{methods:n,model:r}=t;let i={},a={};return Object.keys(e).forEach(t=>{let o=e[t],s=(t=(t=t.toLowerCase().trim()).replace(/'s\b/,"")).split(/ /);s.length>1&&(void 0===a[s[0]]||s.length>a[s[0]])&&(a[s[0]]=s.length),!0===T5.hasOwnProperty(o)&&T5[o](t,i,n,r),i[t]=i[t]||o}),delete i[""],delete i.null,delete i[" "],{lex:i,_multi:a}},B5=function(e){const t=/[,:;]/;let n=[];return e.forEach(e=>{let r=0;e.forEach((i,a)=>{t.test(i.post)&&function(e,t){const n=/^[0-9]+$/;let r=e[t];if(!r)return!1;const i=new Set(["may","april","august","jan"]);if("like"===r.normal||i.has(r.normal))return!1;if(r.tags.has("Place")||r.tags.has("Date"))return!1;if(e[t-1]){let n=e[t-1];if(n.tags.has("Date")||i.has(n.normal))return!1;if(n.tags.has("Adjective")||r.tags.has("Adjective"))return!1}let a=r.normal;return 1!==a.length&&2!==a.length&&4!==a.length||!n.test(a)}(e,a+1)&&(n.push(e.slice(r,a+1)),r=a+1)}),r<e.length&&n.push(e.slice(r,e.length))}),n},P5={e:["mice","louse","antennae","formulae","nebulae","vertebrae","vitae"],i:["tia","octopi","viri","radii","nuclei","fungi","cacti","stimuli"],n:["men"],t:["feet"]},N5=new Set(["israelis","menus","logos"]),R5=["bus","mas","was","ias","xas","vas","cis","lis","nis","ois","ris","sis","tis","xis","aus","cus","eus","fus","gus","ius","lus","nus","das","ous","pus","rus","sus","tus","xus","aos","igos","ados","ogos","'s","ss"],L5=function(e){if(!e||e.length<=3)return!1;if(N5.has(e))return!0;let t=e[e.length-1];return P5.hasOwnProperty(t)?P5[t].find(t=>e.endsWith(t)):"s"===t&&!R5.find(t=>e.endsWith(t))},I5={two:{quickSplit:B5,expandLexicon:M5,transform:S5,looksPlural:L5}},k5=function(e){const{irregularPlurals:t}=e.two,{lexicon:n}=e.one;return Object.entries(t).forEach(e=>{n[e[0]]=n[e[0]]||"Singular",n[e[1]]=n[e[1]]||"Plural"}),e};let O5={one:{lexicon:{}},two:{models:n5}};const U5={"Actor|Verb":"Actor","Adj|Gerund":"Adjective","Adj|Noun":"Adjective","Adj|Past":"Adjective","Adj|Present":"Adjective","Noun|Verb":"Singular","Noun|Gerund":"Gerund","Person|Noun":"Noun","Person|Date":"Month","Person|Verb":"FirstName","Person|Place":"Person","Person|Adj":"Comparative","Plural|Verb":"Plural","Unit|Noun":"Noun"},z5=function(e,t){const n={model:t,methods:I5};let{lex:r,_multi:i}=I5.two.expandLexicon(e,n);return Object.assign(t.one.lexicon,r),Object.assign(t.one._multiCache,i),t},V5=function(e,t,n){let r=f5(e,O5);t[r.PastTense]=t[r.PastTense]||"PastTense",t[r.Gerund]=t[r.Gerund]||"Gerund",!0===n&&(t[r.PresentTense]=t[r.PresentTense]||"PresentTense")},G5=function(e,t,n){let r=g5(e,n);t[r]=t[r]||"Superlative";let i=v5(e,n);t[i]=t[i]||"Comparative"},H5=function(e,t){let n={};const r=t.one.lexicon;return Object.keys(e).forEach(i=>{const a=e[i];if(n[i]=U5[a],"Noun|Verb"!==a&&"Person|Verb"!==a&&"Actor|Verb"!==a||V5(i,r,!1),"Adj|Present"===a&&(V5(i,r,!0),G5(i,r,t)),"Person|Adj"===a&&G5(i,r,t),"Adj|Gerund"===a||"Noun|Gerund"===a){let e=p5(i,O5,"Gerund");r[e]||(n[e]="Infinitive")}if("Noun|Gerund"!==a&&"Adj|Noun"!==a&&"Person|Noun"!==a||function(e,t,n){let r=h3(e,n);t[r]=t[r]||"Plural"}(i,r,t),"Adj|Past"===a){let e=p5(i,O5,"PastTense");r[e]||(n[e]="Infinitive")}}),t=z5(n,t)},j5=function(e){return e=function(e,t){return Object.keys(e).forEach(n=>{"Uncountable"===e[n]&&(t.two.uncountable[n]=!0,e[n]="Uncountable")}),t}((e=z5(e.one.lexicon,e)).one.lexicon,e),e=H5(e.two.switches,e),e=k5(e)};let W5={one:{_multiCache:{},lexicon:p3,frozenLex:{"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization","excuse me":"Expression","financial times":"Organization","guns n roses":"Organization","la z boy":"Organization","labour party":"Organization","new kids on the block":"Organization","new york times":"Organization","the guess who":"Organization","thin lizzy":"Organization","prime minister":"Actor","free market":"Singular","lay up":"Singular","living room":"Singular","living rooms":"Plural","spin off":"Singular","appeal court":"Uncountable","cold war":"Uncountable","gene pool":"Uncountable","machine learning":"Uncountable","nail polish":"Uncountable","time off":"Uncountable","take part":"Infinitive","bill gates":"Person","doctor who":"Person","dr who":"Person","he man":"Person","iron man":"Person","kid cudi":"Person","run dmc":"Person","rush limbaugh":"Person","snow white":"Person","tiger woods":"Person","brand new":"Adjective","en route":"Adjective","left wing":"Adjective","off guard":"Adjective","on board":"Adjective","part time":"Adjective","right wing":"Adjective","so called":"Adjective","spot on":"Adjective","straight forward":"Adjective","super duper":"Adjective","tip top":"Adjective","top notch":"Adjective","up to date":"Adjective","win win":"Adjective","brooklyn nets":"SportsTeam","chicago bears":"SportsTeam","houston astros":"SportsTeam","houston dynamo":"SportsTeam","houston rockets":"SportsTeam","houston texans":"SportsTeam","minnesota twins":"SportsTeam","orlando magic":"SportsTeam","san antonio spurs":"SportsTeam","san diego chargers":"SportsTeam","san diego padres":"SportsTeam","iron maiden":"ProperNoun","isle of man":"Country","united states":"Country","united states of america":"Country","prince edward island":"Region","cedar breaks":"Place","cedar falls":"Place","point blank":"Adverb","tiny bit":"Adverb","by the time":"Conjunction","no matter":"Conjunction","civil wars":"Plural","credit cards":"Plural","default rates":"Plural","free markets":"Plural","head starts":"Plural","home runs":"Plural","lay ups":"Plural","phone calls":"Plural","press releases":"Plural","record labels":"Plural","soft serves":"Plural","student loans":"Plural","tax returns":"Plural","tv shows":"Plural","video games":"Plural","took part":"PastTense","takes part":"PresentTense","taking part":"Gerund","taken part":"Participle","light bulb":"Noun","rush hour":"Noun","fluid ounce":"Unit","the rolling stones":"Organization"}},two:{irregularPlurals:Q2,models:n5,suffixPatterns:m4,prefixPatterns:y4,endsWith:B4,neighbours:R4,regexNormal:[[/^[\w.]+@[\w.]+\.[a-z]{2,3}$/,"Email"],[/^(https?:\/\/|www\.)+\w+\.[a-z]{2,3}/,"Url","http.."],[/^[a-z0-9./].+\.(com|net|gov|org|ly|edu|info|biz|dev|ru|jp|de|in|uk|br|io|ai)/,"Url",".com"],[/^[PMCE]ST$/,"Timezone","EST"],[/^ma?c'[a-z]{3}/,"LastName","mc'neil"],[/^o'[a-z]{3}/,"LastName","o'connor"],[/^ma?cd[aeiou][a-z]{3}/,"LastName","mcdonald"],[/^(lol)+[sz]$/,"Expression","lol"],[/^wo{2,}a*h?$/,"Expression","wooah"],[/^(hee?){2,}h?$/,"Expression","hehe"],[/^(un|de|re)\\-[a-z\u00C0-\u00FF]{2}/,"Verb","un-vite"],[/^(m|k|cm|km)\/(s|h|hr)$/,"Unit","5 k/m"],[/^(ug|ng|mg)\/(l|m3|ft3)$/,"Unit","ug/L"],[/(?:[\0-\.0-9;-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])/,"SlashedTerm","love/hate"]],regexText:[[/^#(?:[0-9_\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDD40-\uDD49\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDED0-\uDEE3\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59\uDFF0-\uDFF9]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDF50-\uDF59\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD818[\uDD30-\uDD39]|\uD81A[\uDE60-\uDE69\uDEC0-\uDEC9\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDD70-\uDD79\uDE80-\uDE96]|\uD833[\uDCF0-\uDCF9]|\uD834[\uDEC0-\uDED3\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD839[\uDCF0-\uDCF9\uDDF1-\uDDFA]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9])*(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])/,"HashTag"],[/^@\w{2,}$/,"AtMention"],[/^([A-Z]\.){2}[A-Z]?/i,["Acronym","Noun"],"F.B.I"],[/.{3}[lkmnp]in['\u2018\u2019\u201b\u2035\u2032`\xb4]$/,"Gerund","chillin'"],[/.{4}s['\u2018\u2019\u201b\u2035\u2032`\xb4]$/,"Possessive","flanders'"],[/^(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDFF\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFF]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])/,"Emoji","emoji-class"]],regexNumbers:[[/^@1?[0-9](am|pm)$/i,"Time","3pm"],[/^@1?[0-9]:[0-9]{2}(am|pm)?$/i,"Time","3:30pm"],[/^'[0-9]{2}$/,"Year"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$/,"Time","3:12:31"],[/^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$/i,"Time","1:12pm"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$/i,"Time","1:12:31pm"],[/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}/i,"Date","iso-date"],[/^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$/,"Date","iso-dash"],[/^[0-9]{1,4}\/[0-9]{1,2}\/([0-9]{4}|[0-9]{2})$/,"Date","iso-slash"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date","iso-dot"],[/^[0-9]{1,4}-[a-z]{2,9}-[0-9]{1,4}$/i,"Date","12-dec-2019"],[/^utc ?[+-]?[0-9]+$/,"Timezone","utc-9"],[/^(gmt|utc)[+-][0-9]{1,2}$/i,"Timezone","gmt-3"],[/^[0-9]{3}-[0-9]{4}$/,"PhoneNumber","421-0029"],[/^(\+?[0-9][ -])?[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$/,"PhoneNumber","1-800-"],[/^[\+\x2D]?(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20C0\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)[\+\x2D]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?([bkm]|bn)?\+?$/,["Money","Value"],"$5.30"],[/^[\+\x2D]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20C0\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)\+?$/,["Money","Value"],"5.30\xa3"],[/^[-+]?[$\xa3]?[0-9]([0-9,.])+(usd|eur|jpy|gbp|cad|aud|chf|cny|hkd|nzd|kr|rub)$/i,["Money","Value"],"$400usd"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\+?$/,["Cardinal","NumericValue"],"5,999"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(st|nd|rd|r?th)$/,["Ordinal","NumericValue"],"53rd"],[/^\.[0-9]+\+?$/,["Cardinal","NumericValue"],".73th"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?%\+?$/,["Percent","Cardinal","NumericValue"],"-4%"],[/^\.[0-9]+%$/,["Percent","Cardinal","NumericValue"],".3%"],[/^[0-9]{1,4}\/[0-9]{1,4}(st|nd|rd|th)?s?$/,["Fraction","NumericValue"],"2/3rds"],[/^[0-9.]{1,3}[a-z]{0,2}[-\u2013\u2014][0-9]{1,3}[a-z]{0,2}$/,["Value","NumberRange"],"3-4"],[/^[0-9]{1,2}(:[0-9][0-9])?(am|pm)? ?[-\u2013\u2014] ?[0-9]{1,2}(:[0-9][0-9])?(am|pm)$/,["Time","NumberRange"],"3-4pm"],[/^[0-9.]+([a-z\xb0]{1,4})$/,"NumericValue","9km"]],switches:f3,clues:e4,uncountable:{},orgWords:r5,placeWords:i5}};W5=j5(W5);const q5=W5,X5=function(e,t,n,r){const i=r.methods.one.setTag;if(0===t&&e.length>=3){const t=/:/;if(e[0].post.match(t)){let t=e[1];if(t.tags.has("Value")||t.tags.has("Email")||t.tags.has("PhoneNumber"))return;i([e[0]],"Expression",r,null,"2-punct-colon''")}}},K5=function(e,t,n,r){const i=r.methods.one.setTag;"-"===e[t].post&&e[t+1]&&i([e[t],e[t+1]],"Hyphenated",r,null,"1-punct-hyphen''")},Y5=/^(under|over|mis|re|un|dis|semi)-?/,J5=function(e,t,n){const r=n.two.switches;let i=e[t];if(r.hasOwnProperty(i.normal))i.switch=r[i.normal];else if(Y5.test(i.normal)){let e=i.normal.replace(Y5,"");e.length>3&&r.hasOwnProperty(e)&&(i.switch=r[e])}},$5=function(e,t,n){if(!t||0===t.length)return;if(!0===e.frozen)return;const r="undefined"===typeof process?self.env||{}:{NODE_ENV:"production",PUBLIC_URL:"/gaia_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0};r&&r.DEBUG_TAGS&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=e.text||"["+e.implicit+"]";var i;"string"!==typeof t&&t.length>2&&(t=t.slice(0,2).join(", #")+" +"),t="string"!==typeof t?t.join(", #"):t,console.log(" ".concat((i=r,"\x1b[33m\x1b[3m"+i+"\x1b[0m").padEnd(24)," \x1b[32m\u2192\x1b[0m #").concat(t.padEnd(22),"  ").concat((e=>"\x1b[3m"+e+"\x1b[0m")(n)))}(e,t,n),e.tags=e.tags||new Set,"string"===typeof t?e.tags.add(t):t.forEach(t=>e.tags.add(t))},Q5=["Acronym","Abbreviation","ProperNoun","Uncountable","Possessive","Pronoun","Activity","Honorific","Month"],Z5=function(e,t,n){let r=e[t],i=Array.from(r.tags);for(let a=0;a<i.length;a+=1)if(n.one.tagSet[i[a]]){let e=n.one.tagSet[i[a]].parents;$5(r,e," -inferred by #".concat(i[a]))}!function(e){!e.tags.has("Noun")||e.tags.has("Plural")||e.tags.has("Singular")||Q5.find(t=>e.tags.has(t))||(L5(e.normal)?$5(e,"Plural","3-plural-guess"):$5(e,"Singular","3-singular-guess"))}(r),function(e){let t=e.tags;if(t.has("Verb")&&1===t.size){let t=h5(e.normal);t&&$5(e,t,"3-verb-tense-guess")}}(r)},e6=/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])(?:['a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u2019\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/,t6=/[0-9]/,n6=["Date","Month","WeekDay","Unit","Expression"],r6=/[IVX]/,i6=/^[IVXLCDM]{2,}$/,a6=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,o6={li:!0,dc:!0,md:!0,dm:!0,ml:!0},s6=function(e,t,n){let r=e[t];r.index=r.index||[0,0];let i=r.index[1],a=r.text||"";return 0!==i&&!0===e6.test(a)&&!1===t6.test(a)?n6.find(e=>r.tags.has(e))||r.pre.match(/["']$/)||"the"===r.normal?null:(Z5(e,t,n),r.tags.has("Noun")||r.frozen||r.tags.clear(),$5(r,"ProperNoun","2-titlecase"),!0):a.length>=2&&i6.test(a)&&r6.test(a)&&a6.test(a)&&!o6[r.normal]?($5(r,"RomanNumeral","2-xvii"),!0):null},u6=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=e.length;let r=7;n<=r&&(r=n-1);for(let i=r;i>1;i-=1){let r=e.substring(n-i,n);if(!0===t[r.length].hasOwnProperty(r)){return t[r.length][r]}}return null},l6=function(e,t,n){let r=e[t];if(0===r.tags.size){let e=u6(r.normal,n.two.suffixPatterns);if(null!==e)return $5(r,e,"2-suffix"),r.confidence=.7,!0;if(r.implicit&&(e=u6(r.implicit,n.two.suffixPatterns),null!==e))return $5(r,e,"2-implicit-suffix"),r.confidence=.7,!0}return null},c6=/['\u2018\u2019\u201b\u2035\u2032`\xb4]/,h6=function(e,t){for(let n=0;n<t.length;n+=1)if(!0===t[n][0].test(e))return t[n];return null},d6=function(e,t,n,r){const i=r.methods.one.setTag;let{regexText:a,regexNormal:o,regexNumbers:s,endsWith:u}=n.two,l=e[t],c=l.machine||l.normal,h=l.text;c6.test(l.post)&&!c6.test(l.pre)&&(h+=l.post.trim());let d=h6(h,a)||h6(c,o);return!d&&/[0-9]/.test(c)&&(d=h6(c,s)),d||0!==l.tags.size||(d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=e[e.length-1];if(!0===t.hasOwnProperty(n)){let r=t[n]||[];for(let t=0;t<r.length;t+=1)if(!0===r[t][0].test(e))return r[t]}return null}(c,u)),d?(i([l],d[1],r,null,"2-regex-'".concat(d[2]||d[0],"'")),l.confidence=.6,!0):null},p6=function(e,t,n){let r=e[t];if(0===r.tags.size){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=e.length;let r=7;r>n-3&&(r=n-3);for(let i=r;i>2;i-=1){let n=e.substring(0,i);if(!0===t[n.length].hasOwnProperty(n))return t[n.length][n]}return null}(r.normal,n.two.prefixPatterns);if(null!==e)return $5(r,e,"2-prefix"),r.confidence=.5,!0}return null},f6=new Set(["in","on","by","until","for","to","during","throughout","through","within","before","after","of","this","next","last","circa","around","post","pre","budget","classic","plan","may"]),m6=function(e){if(!e)return!1;let t=e.normal||e.implicit;return!!f6.has(t)||(!!(e.tags.has("Date")||e.tags.has("Month")||e.tags.has("WeekDay")||e.tags.has("Year"))||!!e.tags.has("ProperNoun"))},g6=function(e){return!!e&&(!!e.tags.has("Ordinal")||(!!(e.tags.has("Cardinal")&&e.normal.length<3)||("is"===e.normal||"was"===e.normal)))},v6=function(e){return e&&(e.tags.has("Date")||e.tags.has("Month")||e.tags.has("WeekDay")||e.tags.has("Year"))},D6=function(e,t){const n=e[t];if(n.tags.has("NumericValue")&&n.tags.has("Cardinal")&&4===n.normal.length){let r=Number(n.normal);if(r&&!isNaN(r)&&r>1400&&r<2100){let i=e[t-1],a=e[t+1];if(m6(i)||m6(a))return $5(n,"Year","2-tagYear");if(r>=1920&&r<2025){if(g6(i)||g6(a))return $5(n,"Year","2-tagYear-close");if(v6(e[t-2])||v6(e[t+2]))return $5(n,"Year","2-tagYear-far");if(i&&(i.tags.has("Determiner")||i.tags.has("Possessive"))&&a&&a.tags.has("Noun")&&!a.tags.has("Plural"))return $5(n,"Year","2-tagYear-noun")}}}return null},y6=function(e,t,n,r){const i=r.methods.one.setTag,a=e[t],o=["PastTense","PresentTense","Auxiliary","Modal","Particle"];if(a.tags.has("Verb")){o.find(e=>a.tags.has(e))||i([a],"Infinitive",r,null,"2-verb-type''")}},E6=/^[A-Z]('s|,)?$/,A6=/^[A-Z-]+$/,C6=/^[A-Z]+s$/,_6=/([A-Z]\.)+[A-Z]?,?$/,b6=/[A-Z]{2,}('s|,)?$/,x6=/([a-z]\.)+[a-z]\.?$/,F6={I:!0,A:!0},w6={la:!0,ny:!0,us:!0,dc:!0,gb:!0},S6=function(e,t,n){let r=e[t];return r.tags.has("RomanNumeral")||r.tags.has("Acronym")||r.frozen?null:function(e,t){let n=e.text;if(!1===A6.test(n)){if(!(n.length>3&&!0===C6.test(n)))return!1;n=n.replace(/s$/,"")}return!(n.length>5)&&!F6.hasOwnProperty(n)&&!t.one.lexicon.hasOwnProperty(e.normal)&&(!0===_6.test(n)||!0===x6.test(n)||!0===E6.test(n)||!0===b6.test(n))}(r,n)?(r.tags.clear(),$5(r,["Acronym","Noun"],"3-no-period-acronym"),!0===w6[r.normal]&&$5(r,"Place","3-place-acronym"),!0===C6.test(r.text)&&$5(r,"Plural","3-plural-acronym"),!0):!F6.hasOwnProperty(r.text)&&E6.test(r.text)?(r.tags.clear(),$5(r,["Acronym","Noun"],"3-one-letter-acronym"),!0):r.tags.has("Organization")&&r.text.length<=3?($5(r,"Acronym","3-org-acronym"),!0):r.tags.has("Organization")&&A6.test(r.text)&&r.text.length<=6?($5(r,"Acronym","3-titlecase-acronym"),!0):null},T6=function(e,t){if(!e)return null;let n=t.find(t=>e.normal===t[0]);return n?n[1]:null},M6=function(e,t){if(!e)return null;let n=t.find(t=>e.tags.has(t[0]));return n?n[1]:null},B6=function(e,t,n){const{leftTags:r,leftWords:i,rightWords:a,rightTags:o}=n.two.neighbours;let s=e[t];if(0===s.tags.size){let u=null;if(u=u||T6(e[t-1],i),u=u||T6(e[t+1],a),u=u||M6(e[t-1],r),u=u||M6(e[t+1],o),u)return $5(s,u,"3-[neighbour]"),Z5(e,t,n),e[t].confidence=.2,!0}return null},P6=function(e,t,n){return!!e&&(!e.tags.has("FirstName")&&!e.tags.has("Place")&&(!!(e.tags.has("ProperNoun")||e.tags.has("Organization")||e.tags.has("Acronym"))||!(n||(r=e.text,!/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])(?:['a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u2019\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/.test(r)))&&(0!==t||e.tags.has("Singular"))));var r},N6=function(e,t,n,r){const i=n.model.two.orgWords,a=n.methods.one.setTag;let o=e[t];if(!0===i[o.machine||o.normal]&&P6(e[t-1],t-1,r)){a([e[t]],"Organization",n,null,"3-[org-word]");for(let i=t;i>=0&&P6(e[i],i,r);i-=1)a([e[i]],"Organization",n,null,"3-[org-word]")}return null},R6=/'s$/,L6=new Set(["athletic","city","community","eastern","federal","financial","great","historic","historical","local","memorial","municipal","national","northern","provincial","southern","state","western","spring","pine","sunset","view","oak","maple","spruce","cedar","willow"]),I6=new Set(["center","centre","way","range","bar","bridge","field","pit"]),k6=function(e,t,n){if(!e)return!1;let r=e.tags;return!(r.has("Organization")||r.has("Possessive")||R6.test(e.normal))&&(!(!r.has("ProperNoun")&&!r.has("Place"))||!(n||(i=e.text,!/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])(?:['a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u2019\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/.test(i)))&&(0!==t||r.has("Singular")));var i},O6=function(e,t,n,r){const i=n.model.two.placeWords,a=n.methods.one.setTag;let o=e[t],s=o.machine||o.normal;if(!0===i[s]){for(let i=t-1;i>=0;i-=1)if(!L6.has(e[i].normal)){if(!k6(e[i],i,r))break;a(e.slice(i,t+1),"Place",n,null,"3-[place-of-foo]")}if(I6.has(s))return!1;for(let i=t+1;i<e.length;i+=1){if(k6(e[i],i,r))return a(e.slice(t,i+1),"Place",n,null,"3-[foo-place]"),!0;if("of"!==e[i].normal&&!L6.has(e[i].normal))break}}return null},U6=function(e,t,n){let r=!1,i=e[t].tags;(0===i.size||1===i.size&&(i.has("Hyphenated")||i.has("HashTag")||i.has("Prefix")||i.has("SlashedTerm")))&&(r=!0),r&&($5(e[t],"Noun","3-[fallback]"),Z5(e,t,n),e[t].confidence=.1)},z6=/^[A-Z][a-z]/,V6=(e,t)=>e[t].tags.has("ProperNoun")&&z6.test(e[t].text)?"Noun":null,G6=(e,t,n)=>0!==t||e[1]?null:n,H6={"Adj|Gerund":(e,t)=>V6(e,t),"Adj|Noun":(e,t)=>V6(e,t)||function(e,t){return!e[t+1]&&e[t-1]&&e[t-1].tags.has("Determiner")?"Noun":null}(e,t),"Actor|Verb":(e,t)=>V6(e,t),"Adj|Past":(e,t)=>V6(e,t),"Adj|Present":(e,t)=>V6(e,t),"Noun|Gerund":(e,t)=>V6(e,t),"Noun|Verb":(e,t)=>t>0&&V6(e,t)||G6(e,t,"Infinitive"),"Plural|Verb":(e,t)=>V6(e,t)||G6(e,t,"PresentTense")||function(e,t,n){return 0===t&&e.length>3?n:null}(e,t,"Plural"),"Person|Noun":(e,t)=>V6(e,t),"Person|Verb":(e,t)=>0!==t?V6(e,t):null,"Person|Adj":(e,t)=>0===t&&e.length>1||V6(e,t)?"Person":null},j6=H6,W6="undefined"===typeof process?self.env||{}:{NODE_ENV:"production",PUBLIC_URL:"/gaia_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},q6=/^(under|over|mis|re|un|dis|semi)-?/,X6=(e,t)=>{if(!e||!t)return null;let n=e.normal||e.implicit,r=null;return t.hasOwnProperty(n)&&(r=t[n]),r&&W6.DEBUG_TAGS&&console.log("\n  \x1b[2m\x1b[3m     \u2193 - '".concat(n,"' \x1b[0m")),r},K6=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!e||!t)return null;let r=Array.from(e.tags).sort((e,t)=>(n[e]?n[e].parents.length:0)>(n[t]?n[t].parents.length:0)?-1:1),i=r.find(e=>t[e]);return i&&W6.DEBUG_TAGS&&console.log("  \x1b[2m\x1b[3m      \u2193 - '".concat(e.normal||e.implicit,"' (#").concat(i,")  \x1b[0m")),i=t[i],i},Y6=function(e,t,n){const r=n.model,i=n.methods.one.setTag,{switches:a,clues:o}=r.two,s=e[t];let u=s.normal||s.implicit||"";if(q6.test(u)&&!a[u]&&(u=u.replace(q6,"")),s.switch){let a=s.switch;if(s.tags.has("Acronym")||s.tags.has("PhrasalVerb"))return;let l=function(e,t,n,r){var i;if(!n)return null;const a="also"!==(null===(i=e[t-1])||void 0===i?void 0:i.text)?t-1:Math.max(0,t-2),o=r.one.tagSet;let s=X6(e[t+1],n.afterWords);return s=s||X6(e[a],n.beforeWords),s=s||K6(e[a],n.beforeTags,o),s=s||K6(e[t+1],n.afterTags,o),s}(e,t,o[a],r);j6[a]&&(l=j6[a](e,t)||l),l?(i([s],l,n,null,"3-[switch] (".concat(a,")")),Z5(e,t,r)):W6.DEBUG_TAGS&&console.log("\n -> X  - '".concat(u,"'  : (").concat(a,")  "))}},J6={there:!0,this:!0,it:!0,him:!0,her:!0,us:!0},$6=function(e,t){const n=t.methods.one.setTag,r=t.model.one._multiCache||{};let i=e[0];if(("Noun|Verb"===i.switch||i.tags.has("Infinitive"))&&e.length>=2){if(e.length<4&&!J6[e[1].normal])return;if(!i.tags.has("PhrasalVerb")&&r.hasOwnProperty(i.normal))return;if(e[1].tags.has("Noun")||e[1].tags.has("Determiner")){e.slice(1,3).some(e=>e.tags.has("Verb"))&&!i.tags.has("#PhrasalVerb")||n([i],"Imperative",t,null,"3-[imperative]")}}},Q6=function(e){if(e.filter(e=>!e.tags.has("ProperNoun")).length<=3)return!1;const t=/^[a-z]/;return e.every(e=>!t.test(e.text))},Z6=function(e,t,n,r){for(let i=0;i<e.length;i+=1)!0!==e[i].frozen&&(J5(e,i,t),!1===r&&s6(e,i,t),l6(e,i,t),d6(e,i,t,n),p6(e,i,t),D6(e,i,t))},e8=function(e,t,n,r){for(let i=0;i<e.length;i+=1){let n=S6(e,i,t);Z5(e,i,t),n=n||B6(e,i,t),n=n||U6(e,i,t)}for(let i=0;i<e.length;i+=1)!0!==e[i].frozen&&(N6(e,i,n,r),O6(e,i,n,r),Y6(e,i,n),y6(e,i,t,n),K5(e,i,t,n));$6(e,n)},t8=function(e){const{methods:t,model:n,world:r}=e;let i=e.docs;!function(e,t,n){e.forEach(e=>{X5(e,0,t,n)})}(i,n,r);let a=t.two.quickSplit(i);for(let o=0;o<a.length;o+=1){let e=a[o];const t=Q6(e);Z6(e,n,r,t),e8(e,n,r,t)}return a},n8={Possessive:e=>{let t=e.machine||e.normal||e.text;return t=t.replace(/'s$/,""),t},Plural:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.noun.toSingular(n,t.model)},Copula:()=>"is",PastTense:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.verb.toInfinitive(n,t.model,"PastTense")},Gerund:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.verb.toInfinitive(n,t.model,"Gerund")},PresentTense:(e,t)=>{let n=e.machine||e.normal||e.text;return e.tags.has("Infinitive")?n:t.methods.two.transform.verb.toInfinitive(n,t.model,"PresentTense")},Comparative:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.adjective.fromComparative(n,t.model)},Superlative:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.adjective.fromSuperlative(n,t.model)},Adverb:(e,t)=>{const{fromAdverb:n}=t.methods.two.transform.adjective;return n(e.machine||e.normal||e.text)}},r8=function(e){const t=e.world,n=Object.keys(n8);e.docs.forEach(e=>{for(let r=0;r<e.length;r+=1){const i=e[r];for(let e=0;e<n.length;e+=1)if(i.tags.has(n[e])){let r=(0,n8[n[e]])(i,t);i.normal!==r&&(i.root=r);break}}})},i8={Adverb:"RB",Comparative:"JJR",Superlative:"JJS",Adjective:"JJ",TO:"Conjunction",Modal:"MD",Auxiliary:"MD",Gerund:"VBG",PastTense:"VBD",Participle:"VBN",PresentTense:"VBZ",Infinitive:"VB",Particle:"RP",Verb:"VB",Pronoun:"PRP",Cardinal:"CD",Conjunction:"CC",Determiner:"DT",Preposition:"IN",QuestionWord:"WP",Expression:"UH",Possessive:"POS",ProperNoun:"NNP",Person:"NNP",Place:"NNP",Organization:"NNP",Singular:"NN",Plural:"NNS",Noun:"NN",There:"EX"},a8=function(e){e.compute("tagRank"),e.docs.forEach(e=>{e.forEach(e=>{e.penn=function(e){if(e.tags.has("ProperNoun")&&e.tags.has("Plural"))return"NNPS";if(e.tags.has("Possessive")&&e.tags.has("Pronoun"))return"PRP$";if("there"===e.normal)return"EX";if("to"===e.normal)return"TO";let t=e.tagRank||[];for(let n=0;n<t.length;n+=1)if(i8.hasOwnProperty(t[n]))return i8[t[n]];return null}(e)})})},o8={preTagger:t8,root:r8,penn:a8},s8=["Person","Place","Organization"],u8={Noun:{not:["Verb","Adjective","Adverb","Value","Determiner"]},Singular:{is:"Noun",not:["Plural","Uncountable"]},ProperNoun:{is:"Noun"},Person:{is:"Singular",also:["ProperNoun"],not:["Place","Organization","Date"]},FirstName:{is:"Person"},MaleName:{is:"FirstName",not:["FemaleName","LastName"]},FemaleName:{is:"FirstName",not:["MaleName","LastName"]},LastName:{is:"Person",not:["FirstName"]},Honorific:{is:"Person",not:["FirstName","LastName","Value"]},Place:{is:"Singular",not:["Person","Organization"]},Country:{is:"Place",also:["ProperNoun"],not:["City"]},City:{is:"Place",also:["ProperNoun"],not:["Country"]},Region:{is:"Place",also:["ProperNoun"]},Address:{},Organization:{is:"ProperNoun",not:["Person","Place"]},SportsTeam:{is:"Organization"},School:{is:"Organization"},Company:{is:"Organization"},Plural:{is:"Noun",not:["Singular","Uncountable"]},Uncountable:{is:"Noun"},Pronoun:{is:"Noun",not:s8},Actor:{is:"Noun",not:["Place","Organization"]},Activity:{is:"Noun",not:["Person","Place"]},Unit:{is:"Noun",not:s8},Demonym:{is:"Noun",also:["ProperNoun"],not:s8},Possessive:{is:"Noun"},Reflexive:{is:"Pronoun"}},l8={Adjective:{not:["Noun","Verb","Adverb","Value"]},Comparable:{is:"Adjective"},Comparative:{is:"Adjective"},Superlative:{is:"Adjective",not:["Comparative"]},NumberRange:{},Adverb:{not:["Noun","Verb","Adjective","Value"]},Determiner:{not:["Noun","Verb","Adjective","Adverb","QuestionWord","Conjunction"]},Conjunction:{not:["Noun","Verb","Adjective","Adverb","Value","QuestionWord"]},Preposition:{not:["Noun","Verb","Adjective","Adverb","QuestionWord","Determiner"]},QuestionWord:{not:["Determiner"]},Currency:{is:"Noun"},Expression:{not:["Noun","Adjective","Verb","Adverb"]},Abbreviation:{},Url:{not:["HashTag","PhoneNumber","Verb","Adjective","Value","AtMention","Email","SlashedTerm"]},PhoneNumber:{not:["HashTag","Verb","Adjective","Value","AtMention","Email"]},HashTag:{},AtMention:{is:"Noun",not:["HashTag","Email"]},Emoji:{not:["HashTag","Verb","Adjective","Value","AtMention"]},Emoticon:{not:["HashTag","Verb","Adjective","Value","AtMention","SlashedTerm"]},SlashedTerm:{not:["Emoticon","Url","Value"]},Email:{not:["HashTag","Verb","Adjective","Value","AtMention"]},Acronym:{not:["Plural","RomanNumeral","Pronoun","Date"]},Negative:{not:["Noun","Adjective","Value","Expression"]},Condition:{not:["Verb","Adjective","Noun","Value"]},There:{not:["Verb","Adjective","Noun","Value","Conjunction","Preposition"]},Prefix:{not:["Abbreviation","Acronym","ProperNoun"]},Hyphenated:{}};let c8=Object.assign({},u8,{Verb:{not:["Noun","Adjective","Adverb","Value","Expression"]},PresentTense:{is:"Verb",not:["PastTense","FutureTense"]},Infinitive:{is:"PresentTense",not:["Gerund"]},Imperative:{is:"Verb",not:["PastTense","Gerund","Copula"]},Gerund:{is:"PresentTense",not:["Copula"]},PastTense:{is:"Verb",not:["PresentTense","Gerund","FutureTense"]},FutureTense:{is:"Verb",not:["PresentTense","PastTense"]},Copula:{is:"Verb"},Modal:{is:"Verb",not:["Infinitive"]},Participle:{is:"PastTense"},Auxiliary:{is:"Verb",not:["PastTense","PresentTense","Gerund","Conjunction"]},PhrasalVerb:{is:"Verb"},Particle:{is:"PhrasalVerb",not:["PastTense","PresentTense","Copula","Gerund"]},Passive:{is:"Verb"}},{Value:{not:["Verb","Adjective","Adverb"]},Ordinal:{is:"Value",not:["Cardinal"]},Cardinal:{is:"Value",not:["Ordinal"]},Fraction:{is:"Value",not:["Noun"]},Multiple:{is:"TextValue"},RomanNumeral:{is:"Cardinal",not:["TextValue"]},TextValue:{is:"Value",not:["NumericValue"]},NumericValue:{is:"Value",not:["TextValue"]},Money:{is:"Cardinal"},Percent:{is:"Value"}},{Date:{not:["Verb","Adverb","Adjective"]},Month:{is:"Date",also:["Noun"],not:["Year","WeekDay","Time"]},WeekDay:{is:"Date",also:["Noun"]},Year:{is:"Date",not:["RomanNumeral"]},FinancialQuarter:{is:"Date",not:"Fraction"},Holiday:{is:"Date",also:["Noun"]},Season:{is:"Date"},Timezone:{is:"Date",also:["Noun"],not:["ProperNoun"]},Time:{is:"Date",not:["AtMention"]},Duration:{is:"Date",also:["Noun"]}},l8);const h8={compute:o8,methods:I5,model:q5,tags:c8,hooks:["preTagger"]},d8=/[,)"';:\-\u2013\u2014.\u2026]/,p8=function(e,t){if(!e.found)return;let n=e.termList();for(let r=0;r<n.length-1;r++){const e=n[r];if(d8.test(e.post))return}n[0].implicit=n[0].normal,n[0].text+=t,n[0].normal+=t,n.slice(1).forEach(e=>{e.implicit=e.normal,e.text="",e.normal=""});for(let r=0;r<n.length-1;r++)n[r].post=n[r].post.replace(/ /,"")},f8=function(){let e=this.not("@hasContraction"),t=e.match("(we|they|you) are");return p8(t,"'re"),t=e.match("(he|she|they|it|we|you) will"),p8(t,"'ll"),t=e.match("(he|she|they|it|we) is"),p8(t,"'s"),t=e.match("#Person is"),p8(t,"'s"),t=e.match("#Person would"),p8(t,"'d"),t=e.match("(is|was|had|would|should|could|do|does|have|has|can) not"),p8(t,"n't"),t=e.match("(i|we|they) have"),p8(t,"'ve"),t=e.match("(would|should|could) have"),p8(t,"'ve"),t=e.match("i am"),p8(t,"'m"),t=e.match("going to"),this},m8=/^(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C89\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7CB\uA7CC\uA7D0\uA7D6\uA7D8\uA7DA\uA7DC\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2\uDD50-\uDD65]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])(?:['a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1C8A\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u2019\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7CD\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7DB\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2\uDD70-\uDD85]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E\uDF25-\uDF2A]|\uD83A[\uDD22-\uDD43])/,g8=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Contraction"}expand(){return this.docs.forEach(e=>{let t=m8.test(e[0].text);e.forEach((t,n)=>{t.text=t.implicit||"",delete t.implicit,n<e.length-1&&""===t.post&&(t.post+=" "),t.dirty=!0}),t&&(e[0].text=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e=e.replace(/^ *[a-z\u00C0-\u00FF]/,e=>e.toUpperCase()),e}(e[0].text))}),this.compute("normal"),this}}e.prototype.contractions=function(){let e=this.match("@hasContraction+");return new t(this.document,e.pointer)},e.prototype.contract=f8},v8=function(e,t,n){let[r,i]=t;n&&0!==n.length&&(n=n.map((e,t)=>(e.implicit=e.text,e.machine=e.text,e.pre="",e.post="",e.text="",e.normal="",e.index=[r,i+t],e)),n[0]&&(n[0].pre=e[r][i].pre,n[n.length-1].post=e[r][i].post,n[0].text=e[r][i].text,n[0].normal=e[r][i].normal),e[r].splice(i,1,...n))},D8=/'/,y8=new Set(["been","become"]),E8=new Set(["what","how","when","if","too"]);let A8=new Set(["too","also","enough"]);const C8=function(e,t){let n=e[t].normal.split(D8)[0];if("let"===n)return[n,"us"];if("there"===n){let r=e[t+1];if(r&&r.tags.has("Plural"))return[n,"are"]}return"has"===((e,t)=>{for(let n=t+1;n<e.length;n+=1){let t=e[n];if(y8.has(t.normal))return"has";if(E8.has(t.normal))return"is";if(t.tags.has("Gerund"))return"is";if(t.tags.has("Determiner"))return"is";if(t.tags.has("Adjective"))return"is";if("Adj|Past"===t.switch&&e[n+1]){if(A8.has(e[n+1].normal))return"is";if(e[n+1].tags.has("Preposition"))return"is"}if(t.tags.has("PastTense"))return e[n+1]&&"for"===e[n+1].normal?"is":"has"}return"is"})(e,t)?[n,"has"]:[n,"is"]},_8=/'/,b8=new Set(["better","done","before","it","had"]),x8=new Set(["have","be"]),F8=function(e,t){let n=e[t].normal.split(_8)[0];return"how"===n||"what"===n?[n,"did"]:"had"===((e,t)=>{for(let n=t+1;n<e.length;n+=1){let t=e[n];if(b8.has(t.normal))return"had";if(x8.has(t.normal))return"would";if(t.tags.has("PastTense")||"Adj|Past"===t.switch)return"had";if(t.tags.has("PresentTense")||t.tags.has("Infinitive"))return"would";if(t.tags.has("#Determiner"))return"had";if(t.tags.has("Adjective"))return"would"}return!1})(e,t)?[n,"had"]:[n,"would"]},w8=function(e,t){if("ain't"===e[t].normal||"aint"===e[t].normal){if(e[t+1]&&"never"===e[t+1].normal)return["have"];let n=function(e,t){for(let n=t-1;n>=0;n-=1)if(e[n].tags.has("Noun")||e[n].tags.has("Pronoun")||e[n].tags.has("Plural")||e[n].tags.has("Singular"))return e[n];return null}(e,t);if(n){if("we"===n.normal||"they"===n.normal)return["are","not"];if("i"===n.normal)return["am","not"];if(n.tags&&n.tags.has("Plural"))return["are","not"]}return["is","not"]}return[e[t].normal.replace(/n't/,""),"not"]},S8={that:!0,there:!0,let:!0,here:!0,everywhere:!0},T8={in:!0,by:!0,for:!0};let M8=new Set(["too","also","enough","about"]),B8=new Set(["is","are","did","were","could","should","must","had","have"]);const P8=(e,t)=>{let n=e[t];if(S8.hasOwnProperty(n.machine||n.normal))return!1;if(n.tags.has("Possessive"))return!0;if(n.tags.has("QuestionWord"))return!1;if("he's"===n.normal||"she's"===n.normal)return!1;let r=e[t+1];if(!r)return!0;if("it's"===n.normal)return!!r.tags.has("#Noun");if("Noun|Gerund"==r.switch){let r=e[t+2];return r?!!r.tags.has("Copula")||("on"===r.normal||r.normal,!1):!(!n.tags.has("Actor")&&!n.tags.has("ProperNoun"))}if(r.tags.has("Verb"))return!!r.tags.has("Infinitive")||!r.tags.has("Gerund")&&!!r.tags.has("PresentTense");if("Adj|Noun"===r.switch){let n=e[t+2];if(!n)return!1;if(B8.has(n.normal))return!0;if(M8.has(n.normal))return!1}if(r.tags.has("Noun")){let e=r.machine||r.normal;return"here"!==e&&"there"!==e&&"everywhere"!==e&&(!r.tags.has("Possessive")&&!(r.tags.has("ProperNoun")&&!n.tags.has("ProperNoun")))}if(e[t-1]&&!0===T8[e[t-1].normal])return!0;if(r.tags.has("Adjective")){let n=e[t+2];if(!n)return!1;if(n.tags.has("Noun")&&!n.tags.has("Pronoun")){let e=r.normal;return"above"!==e&&"below"!==e&&"behind"!==e}return"Noun|Verb"===n.switch}return!!r.tags.has("Value")},N8=/'/,R8=function(e,t,n,r){let i=t.update();i.document=[e];let a=n+r;n>0&&(n-=1),e[a]&&(a+=1),i.ptrs=[[0,n,a]],i.compute(["freeze","lexicon","preTagger","unfreeze"]),function(e){e.forEach((e,t)=>{e.index&&(e.index[1]=t)})}(e)},L8={d:(e,t)=>F8(e,t),t:(e,t)=>w8(e,t),s:(e,t,n)=>P8(e,t)?n.methods.one.setTag([e[t]],"Possessive",n,null,"2-contraction"):C8(e,t)},I8=function(e,t){let n=t.fromText(e.join(" "));return n.compute("id"),n.docs[0]},k8={contractionTwo:e=>{let{world:t,document:n}=e;n.forEach((r,i)=>{for(let a=r.length-1;a>=0;a-=1){if(r[a].implicit)continue;let o=null;!0===N8.test(r[a].normal)&&(o=r[a].normal.split(N8)[1]);let s=null;L8.hasOwnProperty(o)&&(s=L8[o](r,a,t)),s&&(s=I8(s,e),v8(n,[i,a],s),R8(n[i],e,a,s.length))}})}},O8={compute:k8,api:g8,hooks:["contractionTwo"]},U8="(hard|fast|late|early|high|right|deep|close|direct)",z8=[{match:"#Adverb [#Adverb] (and|or|then)",group:0,tag:"Adjective",reason:"kinda-sparkly-and"},{match:"[".concat("(dark|bright|flat|light|soft|pale|dead|dim|faux|little|wee|sheer|most|near|good|extra|all)","] #Adjective"),group:0,tag:"Adverb",reason:"dark-green"},{match:"#Copula [far too] #Adjective",group:0,tag:"Adverb",reason:"far-too"},{match:"#Copula [still] (in|#Gerund|#Adjective)",group:0,tag:"Adverb",reason:"was-still-walking"},{match:"#Plural ".concat(U8),tag:"#PresentTense #Adverb",reason:"studies-hard"},{match:"#Verb [".concat(U8,"] !#Noun?"),group:0,notIf:"(#Copula|get|got|getting|become|became|becoming|feel|feels|feeling|#Determiner|#Preposition)",tag:"Adverb",reason:"shops-direct"},{match:"[#Plural] a lot",tag:"PresentTense",reason:"studies-a-lot"}],V8=[{match:"(the|any) [more]",group:0,tag:"Singular",reason:"more-noun"},{match:"[more] #Noun",group:0,tag:"Adjective",reason:"more-noun"},{match:"(right|rights) of .",tag:"Noun",reason:"right-of"},{match:"a [bit]",group:0,tag:"Singular",reason:"bit-2"},{match:"a [must]",group:0,tag:"Singular",reason:"must-2"},{match:"(we|us) [all]",group:0,tag:"Noun",reason:"we all"},{match:"due to [#Verb]",group:0,tag:"Noun",reason:"due-to"},{match:"some [#Verb] #Plural",group:0,tag:"Noun",reason:"determiner6"},{match:"#Possessive #Ordinal [#PastTense]",group:0,tag:"Noun",reason:"first-thought"},{match:"(the|this|those|these) #Adjective [%Verb|Noun%]",group:0,tag:"Noun",notIf:"#Copula",reason:"the-adj-verb"},{match:"(the|this|those|these) #Adverb #Adjective [#Verb]",group:0,tag:"Noun",reason:"determiner4"},{match:"the [#Verb] #Preposition .",group:0,tag:"Noun",reason:"determiner1"},{match:"(a|an|the) [#Verb] of",group:0,tag:"Noun",reason:"the-verb-of"},{match:"#Determiner #Noun of [#Verb]",group:0,tag:"Noun",notIf:"#Gerund",reason:"noun-of-noun"},{match:"#PastTense #Preposition [#PresentTense]",group:0,notIf:"#Gerund",tag:"Noun",reason:"ended-in-ruins"},{match:"#Conjunction [u]",group:0,tag:"Pronoun",reason:"u-pronoun-2"},{match:"[u] #Verb",group:0,tag:"Pronoun",reason:"u-pronoun-1"},{match:"#Determiner [(western|eastern|northern|southern|central)] #Noun",group:0,tag:"Noun",reason:"western-line"},{match:"(#Singular && @hasHyphen) #PresentTense",tag:"Noun",reason:"hyphen-verb"},{match:"is no [#Verb]",group:0,tag:"Noun",reason:"is-no-verb"},{match:"do [so]",group:0,tag:"Noun",reason:"so-noun"},{match:"#Determiner [(shit|damn|hell)]",group:0,tag:"Noun",reason:"swears-noun"},{match:"to [(shit|hell)]",group:0,tag:"Noun",reason:"to-swears"},{match:"(the|these) [#Singular] (were|are)",group:0,tag:"Plural",reason:"singular-were"},{match:"a #Noun+ or #Adverb+? [#Verb]",group:0,tag:"Noun",reason:"noun-or-noun"},{match:"(the|those|these|a|an) #Adjective? [#PresentTense #Particle?]",group:0,tag:"Noun",notIf:"(seem|appear|include|#Gerund|#Copula)",reason:"det-inf"},{match:"#Noun #Actor",tag:"Actor",notIf:"(#Person|#Pronoun)",reason:"thing-doer"},{match:"#Gerund #Actor",tag:"Actor",reason:"gerund-doer"},{match:"co #Singular",tag:"Actor",reason:"co-noun"},{match:"[#Noun+] #Actor",group:0,tag:"Actor",notIf:"(#Honorific|#Pronoun|#Possessive)",reason:"air-traffic-controller"},{match:"(urban|cardiac|cardiovascular|respiratory|medical|clinical|visual|graphic|creative|dental|exotic|fine|certified|registered|technical|virtual|professional|amateur|junior|senior|special|pharmaceutical|theoretical)+ #Noun? #Actor",tag:"Actor",reason:"fine-artist"},{match:"#Noun+ (coach|chef|king|engineer|fellow|personality|boy|girl|man|woman|master)",tag:"Actor",reason:"dance-coach"},{match:"chief . officer",tag:"Actor",reason:"chief-x-officer"},{match:"chief of #Noun+",tag:"Actor",reason:"chief-of-police"},{match:"senior? vice? president of #Noun+",tag:"Actor",reason:"president-of"},{match:"#Determiner [sun]",group:0,tag:"Singular",reason:"the-sun"},{match:"#Verb (a|an) [#Value]$",group:0,tag:"Singular",reason:"did-a-value"},{match:"the [(can|will|may)]",group:0,tag:"Singular",reason:"the can"},{match:"#FirstName #Acronym? (#Possessive && #LastName)",tag:"Possessive",reason:"name-poss"},{match:"#Organization+ #Possessive",tag:"Possessive",reason:"org-possessive"},{match:"#Place+ #Possessive",tag:"Possessive",reason:"place-possessive"},{match:"#Possessive #PresentTense #Particle?",notIf:"(#Gerund|her)",tag:"Noun",reason:"possessive-verb"},{match:"(my|our|their|her|his|its) [(#Plural && #Actor)] #Noun",tag:"Possessive",reason:"my-dads"},{match:"#Value of a [second]",group:0,unTag:"Value",tag:"Singular",reason:"10th-of-a-second"},{match:"#Value [seconds]",group:0,unTag:"Value",tag:"Plural",reason:"10-seconds"},{match:"in [#Infinitive]",group:0,tag:"Singular",reason:"in-age"},{match:"a [#Adjective] #Preposition",group:0,tag:"Noun",reason:"a-minor-in"},{match:"#Determiner [#Singular] said",group:0,tag:"Actor",reason:"the-actor-said"},{match:"#Determiner #Noun [".concat("(feel|sense|process|rush|side|bomb|bully|challenge|cover|crush|dump|exchange|flow|function|issue|lecture|limit|march|process)","] !(#Preposition|to|#Adverb)?"),group:0,tag:"Noun",reason:"the-noun-sense"},{match:"[#PresentTense] (of|by|for) (a|an|the) #Noun #Copula",group:0,tag:"Plural",reason:"photographs-of"},{match:"#Infinitive and [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"fight and win"},{match:"#Noun and [#Verb] and #Noun",group:0,tag:"Noun",reason:"peace-and-flowers"},{match:"the #Cardinal [%Adj|Noun%]",group:0,tag:"Noun",reason:"the-1992-classic"},{match:"#Copula the [%Adj|Noun%] #Noun",group:0,tag:"Adjective",reason:"the-premier-university"},{match:"i #Verb [me] #Noun",group:0,tag:"Possessive",reason:"scottish-me"},{match:"[#PresentTense] (music|class|lesson|night|party|festival|league|ceremony)",group:0,tag:"Noun",reason:"dance-music"},{match:"[wit] (me|it)",group:0,tag:"Presposition",reason:"wit-me"},{match:"#PastTense #Possessive [#Verb]",group:0,tag:"Noun",notIf:"(saw|made)",reason:"left-her-boots"},{match:"#Value [%Plural|Verb%]",group:0,tag:"Plural",notIf:"(one|1|a|an)",reason:"35-signs"},{match:"had [#PresentTense]",group:0,tag:"Noun",notIf:"(#Gerund|come|become)",reason:"had-time"},{match:"%Adj|Noun% %Noun|Verb%",tag:"#Adjective #Noun",notIf:"#ProperNoun #Noun",reason:"instant-access"},{match:"#Determiner [%Adj|Noun%] #Conjunction",group:0,tag:"Noun",reason:"a-rep-to"},{match:"#Adjective #Noun [%Plural|Verb%]$",group:0,tag:"Plural",notIf:"#Pronoun",reason:"near-death-experiences"},{match:"#Possessive #Noun [%Plural|Verb%]$",group:0,tag:"Plural",reason:"your-guild-colors"}],G8="(i|we|they)";let H8=[].concat([{match:"(got|were|was|is|are|am) (#PastTense|#Participle)",tag:"Passive",reason:"got-walked"},{match:"(was|were|is|are|am) being (#PastTense|#Participle)",tag:"Passive",reason:"was-being"},{match:"(had|have|has) been (#PastTense|#Participle)",tag:"Passive",reason:"had-been"},{match:"will be being? (#PastTense|#Participle)",tag:"Passive",reason:"will-be-cleaned"},{match:"#Noun [(#PastTense|#Participle)] by (the|a) #Noun",group:0,tag:"Passive",reason:"suffered-by"}],[{match:"[(all|both)] #Determiner #Noun",group:0,tag:"Noun",reason:"all-noun"},{match:"#Copula [(just|alone)]$",group:0,tag:"Adjective",reason:"not-adverb"},{match:"#Singular is #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"is-filled"},{match:"[#PastTense] #Singular is",group:0,tag:"Adjective",reason:"smoked-poutine"},{match:"[#PastTense] #Plural are",group:0,tag:"Adjective",reason:"baked-onions"},{match:"well [#PastTense]",group:0,tag:"Adjective",reason:"well-made"},{match:"#Copula [fucked up?]",group:0,tag:"Adjective",reason:"swears-adjective"},{match:"#Singular (seems|appears) #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"seems-filled"},{match:"#Copula #Adjective? [(out|in|through)]$",group:0,tag:"Adjective",reason:"still-out"},{match:"^[#Adjective] (the|your) #Noun",group:0,notIf:"(all|even)",tag:"Infinitive",reason:"shut-the"},{match:"the [said] #Noun",group:0,tag:"Adjective",reason:"the-said-card"},{match:"[#Hyphenated (#Hyphenated && #PastTense)] (#Noun|#Conjunction)",group:0,tag:"Adjective",notIf:"#Adverb",reason:"faith-based"},{match:"[#Hyphenated (#Hyphenated && #Gerund)] (#Noun|#Conjunction)",group:0,tag:"Adjective",notIf:"#Adverb",reason:"self-driving"},{match:"[#PastTense (#Hyphenated && #PhrasalVerb)] (#Noun|#Conjunction)",group:0,tag:"Adjective",reason:"dammed-up"},{match:"(#Hyphenated && #Value) fold",tag:"Adjective",reason:"two-fold"},{match:"must (#Hyphenated && #Infinitive)",tag:"Adjective",reason:"must-win"},{match:"(#Hyphenated && #Infinitive) #Hyphenated",tag:"Adjective",notIf:"#PhrasalVerb",reason:"vacuum-sealed"},{match:"too much",tag:"Adverb Adjective",reason:"bit-4"},{match:"a bit much",tag:"Determiner Adverb Adjective",reason:"bit-3"},{match:"[(un|contra|extra|inter|intra|macro|micro|mid|mis|mono|multi|pre|sub|tri|ex)] #Adjective",group:0,tag:["Adjective","Prefix"],reason:"un-skilled"}],z8,[{match:"as [#Gerund] as",group:0,tag:"Adjective",reason:"as-gerund-as"},{match:"more [#Gerund] than",group:0,tag:"Adjective",reason:"more-gerund-than"},{match:"(so|very|extremely) [#Gerund]",group:0,tag:"Adjective",reason:"so-gerund"},{match:"(found|found) it #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"found-it-gerund"},{match:"a (little|bit|wee) bit? [#Gerund]",group:0,tag:"Adjective",reason:"a-bit-gerund"},{match:"#Gerund [#Gerund]",group:0,tag:"Adjective",notIf:"(impersonating|practicing|considering|assuming)",reason:"looking-annoying"},{match:"(looked|look|looks) #Adverb? [%Adj|Gerund%]",group:0,tag:"Adjective",notIf:"(impersonating|practicing|considering|assuming)",reason:"looked-amazing"},{match:"[%Adj|Gerund%] #Determiner",group:0,tag:"Gerund",reason:"developing-a"},{match:"#Possessive [%Adj|Gerund%] #Noun",group:0,tag:"Adjective",reason:"leading-manufacturer"},{match:"%Noun|Gerund% %Adj|Gerund%",tag:"Gerund #Adjective",reason:"meaning-alluring"},{match:"(face|embrace|reveal|stop|start|resume) %Adj|Gerund%",tag:"#PresentTense #Adjective",reason:"face-shocking"},{match:"(are|were) [%Adj|Gerund%] #Plural",group:0,tag:"Adjective",reason:"are-enduring-symbols"}],[{match:"#Determiner [#Adjective] #Copula",group:0,tag:"Noun",reason:"the-adj-is"},{match:"#Adjective [#Adjective] #Copula",group:0,tag:"Noun",reason:"adj-adj-is"},{match:"(his|its) [%Adj|Noun%]",group:0,tag:"Noun",notIf:"#Hyphenated",reason:"his-fine"},{match:"#Copula #Adverb? [all]",group:0,tag:"Noun",reason:"is-all"},{match:"(have|had) [#Adjective] #Preposition .",group:0,tag:"Noun",reason:"have-fun"},{match:"#Gerund (giant|capital|center|zone|application)",tag:"Noun",reason:"brewing-giant"},{match:"#Preposition (a|an) [#Adjective]$",group:0,tag:"Noun",reason:"an-instant"},{match:"no [#Adjective] #Modal",group:0,tag:"Noun",reason:"no-golden"},{match:"[brand #Gerund?] new",group:0,tag:"Adverb",reason:"brand-new"},{match:"(#Determiner|#Comparative|new|different) [kind]",group:0,tag:"Noun",reason:"some-kind"},{match:"#Possessive [%Adj|Noun%] #Noun",group:0,tag:"Adjective",reason:"her-favourite"},{match:"must && #Hyphenated .",tag:"Adjective",reason:"must-win"},{match:"#Determiner [#Adjective]$",tag:"Noun",notIf:"(this|that|#Comparative|#Superlative)",reason:"the-south"},{match:"(#Noun && #Hyphenated) (#Adjective && #Hyphenated)",tag:"Adjective",notIf:"(this|that|#Comparative|#Superlative)",reason:"company-wide"},{match:"#Determiner [#Adjective] (#Copula|#Determiner)",notIf:"(#Comparative|#Superlative)",group:0,tag:"Noun",reason:"the-poor"},{match:"[%Adj|Noun%] #Noun",notIf:"(#Pronoun|#ProperNoun)",group:0,tag:"Adjective",reason:"stable-foundations"}],[{match:"[still] #Adjective",group:0,tag:"Adverb",reason:"still-advb"},{match:"[still] #Verb",group:0,tag:"Adverb",reason:"still-verb"},{match:"[so] #Adjective",group:0,tag:"Adverb",reason:"so-adv"},{match:"[way] #Comparative",group:0,tag:"Adverb",reason:"way-adj"},{match:"[way] #Adverb #Adjective",group:0,tag:"Adverb",reason:"way-too-adj"},{match:"[all] #Verb",group:0,tag:"Adverb",reason:"all-verb"},{match:"#Verb  [like]",group:0,notIf:"(#Modal|#PhrasalVerb)",tag:"Adverb",reason:"verb-like"},{match:"(barely|hardly) even",tag:"Adverb",reason:"barely-even"},{match:"[even] #Verb",group:0,tag:"Adverb",reason:"even-walk"},{match:"[even] #Comparative",group:0,tag:"Adverb",reason:"even-worse"},{match:"[even] (#Determiner|#Possessive)",group:0,tag:"#Adverb",reason:"even-the"},{match:"even left",tag:"#Adverb #Verb",reason:"even-left"},{match:"[way] #Adjective",group:0,tag:"#Adverb",reason:"way-over"},{match:"#PresentTense [(hard|quick|bright|slow|fast|backwards|forwards)]",notIf:"#Copula",group:0,tag:"Adverb",reason:"lazy-ly"},{match:"[much] #Adjective",group:0,tag:"Adverb",reason:"bit-1"},{match:"#Copula [#Adverb]$",group:0,tag:"Adjective",reason:"is-well"},{match:"a [(little|bit|wee) bit?] #Adjective",group:0,tag:"Adverb",reason:"a-bit-cold"},{match:"[(super|pretty)] #Adjective",group:0,tag:"Adverb",reason:"super-strong"},{match:"(become|fall|grow) #Adverb? [#PastTense]",group:0,tag:"Adjective",reason:"overly-weakened"},{match:"(a|an) #Adverb [#Participle] #Noun",group:0,tag:"Adjective",reason:"completely-beaten"},{match:"#Determiner #Adverb? [close]",group:0,tag:"Adjective",reason:"a-close"},{match:"#Gerund #Adverb? [close]",group:0,tag:"Adverb",notIf:"(getting|becoming|feeling)",reason:"being-close"},{match:"(the|those|these|a|an) [#Participle] #Noun",group:0,tag:"Adjective",reason:"blown-motor"},{match:"(#PresentTense|#PastTense) [back]",group:0,tag:"Adverb",notIf:"(#PhrasalVerb|#Copula)",reason:"charge-back"},{match:"#Verb [around]",group:0,tag:"Adverb",notIf:"#PhrasalVerb",reason:"send-around"},{match:"[later] #PresentTense",group:0,tag:"Adverb",reason:"later-say"},{match:"#Determiner [well] !#PastTense?",group:0,tag:"Noun",reason:"the-well"},{match:"#Adjective [enough]",group:0,tag:"Adverb",reason:"high-enough"}],[{match:"[sun] the #Ordinal",tag:"WeekDay",reason:"sun-the-5th"},{match:"[sun] #Date",group:0,tag:"WeekDay",reason:"sun-feb"},{match:"#Date (on|this|next|last|during)? [sun]",group:0,tag:"WeekDay",reason:"1pm-sun"},{match:"(in|by|before|during|on|until|after|of|within|all) [sat]",group:0,tag:"WeekDay",reason:"sat"},{match:"(in|by|before|during|on|until|after|of|within|all) [wed]",group:0,tag:"WeekDay",reason:"wed"},{match:"(in|by|before|during|on|until|after|of|within|all) [march]",group:0,tag:"Month",reason:"march"},{match:"[sat] #Date",group:0,tag:"WeekDay",reason:"sat-feb"},{match:"#Preposition [(march|may)]",group:0,tag:"Month",reason:"in-month"},{match:"(this|next|last) (march|may) !#Infinitive?",tag:"#Date #Month",reason:"this-month"},{match:"(march|may) the? #Value",tag:"#Month #Date #Date",reason:"march-5th"},{match:"#Value of? (march|may)",tag:"#Date #Date #Month",reason:"5th-of-march"},{match:"[(march|may)] .? #Date",group:0,tag:"Month",reason:"march-and-feb"},{match:"#Date .? [(march|may)]",group:0,tag:"Month",reason:"feb-and-march"},{match:"#Adverb [(march|may)]",group:0,tag:"Verb",reason:"quickly-march"},{match:"[(march|may)] #Adverb",group:0,tag:"Verb",reason:"march-quickly"},{match:"#Value (am|pm)",tag:"Time",reason:"2-am"}],[{match:"#Holiday (day|eve)",tag:"Holiday",reason:"holiday-day"},{match:"#Value of #Month",tag:"Date",reason:"value-of-month"},{match:"#Cardinal #Month",tag:"Date",reason:"cardinal-month"},{match:"#Month #Value to #Value",tag:"Date",reason:"value-to-value"},{match:"#Month the #Value",tag:"Date",reason:"month-the-value"},{match:"(#WeekDay|#Month) #Value",tag:"Date",reason:"date-value"},{match:"#Value (#WeekDay|#Month)",tag:"Date",reason:"value-date"},{match:"(#TextValue && #Date) #TextValue",tag:"Date",reason:"textvalue-date"},{match:"#Month #NumberRange",tag:"Date",reason:"aug 20-21"},{match:"#WeekDay #Month #Ordinal",tag:"Date",reason:"week mm-dd"},{match:"#Month #Ordinal #Cardinal",tag:"Date",reason:"mm-dd-yyy"},{match:"(#Place|#Demonmym|#Time) (standard|daylight|central|mountain)? time",tag:"Timezone",reason:"std-time"},{match:"(eastern|mountain|pacific|central|atlantic) (standard|daylight|summer)? time",tag:"Timezone",reason:"eastern-time"},{match:"#Time [(eastern|mountain|pacific|central|est|pst|gmt)]",group:0,tag:"Timezone",reason:"5pm-central"},{match:"(central|western|eastern) european time",tag:"Timezone",reason:"cet"}],V8,[{match:"(this|that|the|a|an) [#Gerund #Infinitive]",group:0,tag:"Singular",reason:"the-planning-process"},{match:"(that|the) [#Gerund #PresentTense]",group:0,ifNo:"#Copula",tag:"Plural",reason:"the-paving-stones"},{match:"#Determiner [#Gerund] #Noun",group:0,tag:"Adjective",reason:"the-gerund-noun"},{match:"#Pronoun #Infinitive [#Gerund] #PresentTense",group:0,tag:"Noun",reason:"tipping-sucks"},{match:"#Adjective [#Gerund]",group:0,tag:"Noun",notIf:"(still|even|just)",reason:"early-warning"},{match:"[#Gerund] #Adverb? not? #Copula",group:0,tag:"Activity",reason:"gerund-copula"},{match:"#Copula [(#Gerund|#Activity)] #Copula",group:0,tag:"Gerund",reason:"are-doing-is"},{match:"[#Gerund] #Modal",group:0,tag:"Activity",reason:"gerund-modal"},{match:"#Singular for [%Noun|Gerund%]",group:0,tag:"Gerund",reason:"noun-for-gerund"},{match:"#Comparative (for|at) [%Noun|Gerund%]",group:0,tag:"Gerund",reason:"better-for-gerund"},{match:"#PresentTense the [#Gerund]",group:0,tag:"Noun",reason:"keep-the-touching"}],[{match:"#Infinitive (this|that|the) [#Infinitive]",group:0,tag:"Noun",reason:"do-this-dance"},{match:"#Gerund #Determiner [#Infinitive]",group:0,tag:"Noun",reason:"running-a-show"},{match:"#Determiner (only|further|just|more|backward) [#Infinitive]",group:0,tag:"Noun",reason:"the-only-reason"},{match:"(the|this|a|an) [#Infinitive] #Adverb? #Verb",group:0,tag:"Noun",reason:"determiner5"},{match:"#Determiner #Adjective #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"a-nice-inf"},{match:"#Determiner #Demonym [#PresentTense]",group:0,tag:"Noun",reason:"mexican-train"},{match:"#Adjective #Noun+ [#Infinitive] #Copula",group:0,tag:"Noun",reason:"career-move"},{match:"at some [#Infinitive]",group:0,tag:"Noun",reason:"at-some-inf"},{match:"(go|goes|went) to [#Infinitive]",group:0,tag:"Noun",reason:"goes-to-verb"},{match:"(a|an) #Adjective? #Noun [#Infinitive] (#Preposition|#Noun)",group:0,notIf:"from",tag:"Noun",reason:"a-noun-inf"},{match:"(a|an) #Noun [#Infinitive]$",group:0,tag:"Noun",reason:"a-noun-inf2"},{match:"#Gerund #Adjective? for [#Infinitive]",group:0,tag:"Noun",reason:"running-for"},{match:"about [#Infinitive]",group:0,tag:"Singular",reason:"about-love"},{match:"#Plural on [#Infinitive]",group:0,tag:"Noun",reason:"on-stage"},{match:"any [#Infinitive]",group:0,tag:"Noun",reason:"any-charge"},{match:"no [#Infinitive]",group:0,tag:"Noun",reason:"no-doubt"},{match:"number of [#PresentTense]",group:0,tag:"Noun",reason:"number-of-x"},{match:"(taught|teaches|learns|learned) [#PresentTense]",group:0,tag:"Noun",reason:"teaches-x"},{match:"(try|use|attempt|build|make) [#Verb #Particle?]",notIf:"(#Copula|#Noun|sure|fun|up)",group:0,tag:"Noun",reason:"do-verb"},{match:"^[#Infinitive] (is|was)",group:0,tag:"Noun",reason:"checkmate-is"},{match:"#Infinitive much [#Infinitive]",group:0,tag:"Noun",reason:"get-much"},{match:"[cause] #Pronoun #Verb",group:0,tag:"Conjunction",reason:"cause-cuz"},{match:"the #Singular [#Infinitive] #Noun",group:0,tag:"Noun",notIf:"#Pronoun",reason:"cardio-dance"},{match:"#Determiner #Modal [#Noun]",group:0,tag:"PresentTense",reason:"should-smoke"},{match:"this [#Plural]",group:0,tag:"PresentTense",notIf:"(#Preposition|#Date)",reason:"this-verbs"},{match:"#Noun that [#Plural]",group:0,tag:"PresentTense",notIf:"(#Preposition|#Pronoun|way)",reason:"voice-that-rocks"},{match:"that [#Plural] to",group:0,tag:"PresentTense",notIf:"#Preposition",reason:"that-leads-to"},{match:"(let|make|made) (him|her|it|#Person|#Place|#Organization)+ [#Singular] (a|an|the|it)",group:0,tag:"Infinitive",reason:"let-him-glue"},{match:"#Verb (all|every|each|most|some|no) [#PresentTense]",notIf:"#Modal",group:0,tag:"Noun",reason:"all-presentTense"},{match:"(had|have|#PastTense) #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"better",reason:"adj-presentTense"},{match:"#Value #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"one-big-reason"},{match:"#PastTense #Adjective+ [#PresentTense]",group:0,tag:"Noun",notIf:"(#Copula|better)",reason:"won-wide-support"},{match:"(many|few|several|couple) [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"many-poses"},{match:"#Determiner #Adverb #Adjective [%Noun|Verb%]",group:0,tag:"Noun",notIf:"#Copula",reason:"very-big-dream"},{match:"from #Noun to [%Noun|Verb%]",group:0,tag:"Noun",reason:"start-to-finish"},{match:"(for|with|of) #Noun (and|or|not) [%Noun|Verb%]",group:0,tag:"Noun",notIf:"#Pronoun",reason:"for-food-and-gas"},{match:"#Adjective #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"adorable-little-store"},{match:"#Gerund #Adverb? #Comparative [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"higher-costs"},{match:"(#Noun && @hasComma) #Noun (and|or) [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"noun-list"},{match:"(many|any|some|several) [#PresentTense] for",group:0,tag:"Noun",reason:"any-verbs-for"},{match:"to #PresentTense #Noun [#PresentTense] #Preposition",group:0,tag:"Noun",reason:"gas-exchange"},{match:"#PastTense (until|as|through|without) [#PresentTense]",group:0,tag:"Noun",reason:"waited-until-release"},{match:"#Gerund like #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"like-hot-cakes"},{match:"some #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"some-reason"},{match:"for some [#PresentTense]",group:0,tag:"Noun",reason:"for-some-reason"},{match:"(same|some|the|that|a) kind of [#PresentTense]",group:0,tag:"Noun",reason:"some-kind-of"},{match:"(same|some|the|that|a) type of [#PresentTense]",group:0,tag:"Noun",reason:"some-type-of"},{match:"#Gerund #Adjective #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"doing-better-for-x"},{match:"(get|got|have) #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"got-better-aim"},{match:"whose [#PresentTense] #Copula",group:0,tag:"Noun",reason:"whos-name-was"},{match:"#PhrasalVerb #Particle #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"given-up-on-x"},{match:"there (are|were) #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"there-are"},{match:"#Value [#PresentTense] of",group:0,notIf:"(one|1|#Copula|#Infinitive)",tag:"Plural",reason:"2-trains"},{match:"[#PresentTense] (are|were) #Adjective",group:0,tag:"Plural",reason:"compromises-are-possible"},{match:"^[(hope|guess|thought|think)] #Pronoun #Verb",group:0,tag:"Infinitive",reason:"suppose-i"},{match:"#Possessive #Adjective [#Verb]",group:0,tag:"Noun",notIf:"#Copula",reason:"our-full-support"},{match:"[(tastes|smells)] #Adverb? #Adjective",group:0,tag:"PresentTense",reason:"tastes-good"},{match:"#Copula #Gerund [#PresentTense] !by?",group:0,tag:"Noun",notIf:"going",reason:"ignoring-commute"},{match:"#Determiner #Adjective? [(shed|thought|rose|bid|saw|spelt)]",group:0,tag:"Noun",reason:"noun-past"},{match:"how to [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"how-to-noun"},{match:"which [%Noun|Verb%] #Noun",group:0,tag:"Infinitive",reason:"which-boost-it"},{match:"#Gerund [%Plural|Verb%]",group:0,tag:"Plural",reason:"asking-questions"},{match:"(ready|available|difficult|hard|easy|made|attempt|try) to [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"ready-to-noun"},{match:"(bring|went|go|drive|run|bike) to [%Noun|Verb%]",group:0,tag:"Noun",reason:"bring-to-noun"},{match:"#Modal #Noun [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"would-you-look"},{match:"#Copula just [#Infinitive]",group:0,tag:"Noun",reason:"is-just-spam"},{match:"^%Noun|Verb% %Plural|Verb%",tag:"Imperative #Plural",reason:"request-copies"},{match:"#Adjective #Plural and [%Plural|Verb%]",group:0,tag:"#Plural",reason:"pickles-and-drinks"},{match:"#Determiner #Year [#Verb]",group:0,tag:"Noun",reason:"the-1968-film"},{match:"#Determiner [#PhrasalVerb #Particle]",group:0,tag:"Noun",reason:"the-break-up"},{match:"#Determiner [%Adj|Noun%] #Noun",group:0,tag:"Adjective",notIf:"(#Pronoun|#Possessive|#ProperNoun)",reason:"the-individual-goals"},{match:"[%Noun|Verb%] or #Infinitive",group:0,tag:"Infinitive",reason:"work-or-prepare"},{match:"to #Infinitive [#PresentTense]",group:0,tag:"Noun",notIf:"(#Gerund|#Copula|help)",reason:"to-give-thanks"},{match:"[#Noun] me",group:0,tag:"Verb",reason:"kills-me"},{match:"%Plural|Verb% %Plural|Verb%",tag:"#PresentTense #Plural",reason:"removes-wrinkles"}],[{match:"#Money and #Money #Currency?",tag:"Money",reason:"money-and-money"},{match:"#Value #Currency [and] #Value (cents|ore|centavos|sens)",group:0,tag:"money",reason:"and-5-cents"},{match:"#Value (mark|rand|won|rub|ore)",tag:"#Money #Currency",reason:"4-mark"},{match:"a pound",tag:"#Money #Unit",reason:"a-pound"},{match:"#Value (pound|pounds)",tag:"#Money #Unit",reason:"4-pounds"}],[{match:"[(half|quarter)] of? (a|an)",group:0,tag:"Fraction",reason:"millionth"},{match:"#Adverb [half]",group:0,tag:"Fraction",reason:"nearly-half"},{match:"[half] the",group:0,tag:"Fraction",reason:"half-the"},{match:"#Cardinal and a half",tag:"Fraction",reason:"and-a-half"},{match:"#Value (halves|halfs|quarters)",tag:"Fraction",reason:"two-halves"},{match:"a #Ordinal",tag:"Fraction",reason:"a-quarter"},{match:"[#Cardinal+] (#Fraction && /s$/)",tag:"Fraction",reason:"seven-fifths"},{match:"[#Cardinal+ #Ordinal] of .",group:0,tag:"Fraction",reason:"ordinal-of"},{match:"[(#NumericValue && #Ordinal)] of .",group:0,tag:"Fraction",reason:"num-ordinal-of"},{match:"(a|one) #Cardinal?+ #Ordinal",tag:"Fraction",reason:"a-ordinal"},{match:"#Cardinal+ out? of every? #Cardinal",tag:"Fraction",reason:"out-of"}],[{match:"#Cardinal [second]",tag:"Unit",reason:"one-second"},{match:"!once? [(a|an)] (#Duration|hundred|thousand|million|billion|trillion)",group:0,tag:"Value",reason:"a-is-one"},{match:"1 #Value #PhoneNumber",tag:"PhoneNumber",reason:"1-800-Value"},{match:"#NumericValue #PhoneNumber",tag:"PhoneNumber",reason:"(800) PhoneNumber"},{match:"#Demonym #Currency",tag:"Currency",reason:"demonym-currency"},{match:"#Value [(buck|bucks|grand)]",group:0,tag:"Currency",reason:"value-bucks"},{match:"[#Value+] #Currency",group:0,tag:"Money",reason:"15 usd"},{match:"[second] #Noun",group:0,tag:"Ordinal",reason:"second-noun"},{match:"#Value+ [#Currency]",group:0,tag:"Unit",reason:"5-yan"},{match:"#Value [(foot|feet)]",group:0,tag:"Unit",reason:"foot-unit"},{match:"#Value [#Abbreviation]",group:0,tag:"Unit",reason:"value-abbr"},{match:"#Value [k]",group:0,tag:"Unit",reason:"value-k"},{match:"#Unit an hour",tag:"Unit",reason:"unit-an-hour"},{match:"(minus|negative) #Value",tag:"Value",reason:"minus-value"},{match:"#Value (point|decimal) #Value",tag:"Value",reason:"value-point-value"},{match:"#Determiner [(half|quarter)] #Ordinal",group:0,tag:"Value",reason:"half-ordinal"},{match:"#Multiple+ and #Value",tag:"Value",reason:"magnitude-and-value"},{match:"#Value #Unit [(per|an) (hr|hour|sec|second|min|minute)]",group:0,tag:"Unit",reason:"12-miles-per-second"},{match:"#Value [(square|cubic)] #Unit",group:0,tag:"Unit",reason:"square-miles"}],[{match:"#Copula [(#Noun|#PresentTense)] #LastName",group:0,tag:"FirstName",reason:"copula-noun-lastname"},{match:"(sister|pope|brother|father|aunt|uncle|grandpa|grandfather|grandma) #ProperNoun",tag:"Person",reason:"lady-titlecase",safe:!0},{match:"#FirstName [#Determiner #Noun] #LastName",group:0,tag:"Person",reason:"first-noun-last"},{match:"#ProperNoun (b|c|d|e|f|g|h|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z) #ProperNoun",tag:"Person",reason:"titlecase-acronym-titlecase",safe:!0},{match:"#Acronym #LastName",tag:"Person",reason:"acronym-lastname",safe:!0},{match:"#Person (jr|sr|md)",tag:"Person",reason:"person-honorific"},{match:"#Honorific #Acronym",tag:"Person",reason:"Honorific-TitleCase"},{match:"#Person #Person the? #RomanNumeral",tag:"Person",reason:"roman-numeral"},{match:"#FirstName [/^[^aiurck]$/]",group:0,tag:["Acronym","Person"],reason:"john-e"},{match:"#Noun van der? #Noun",tag:"Person",reason:"van der noun",safe:!0},{match:"(king|queen|prince|saint|lady) of #Noun",tag:"Person",reason:"king-of-noun",safe:!0},{match:"(prince|lady) #Place",tag:"Person",reason:"lady-place"},{match:"(king|queen|prince|saint) #ProperNoun",tag:"Person",notIf:"#Place",reason:"saint-foo"},{match:"al (#Person|#ProperNoun)",tag:"Person",reason:"al-borlen",safe:!0},{match:"#FirstName de #Noun",tag:"Person",reason:"bill-de-noun"},{match:"#FirstName (bin|al) #Noun",tag:"Person",reason:"bill-al-noun"},{match:"#FirstName #Acronym #ProperNoun",tag:"Person",reason:"bill-acronym-title"},{match:"#FirstName #FirstName #ProperNoun",tag:"Person",reason:"bill-firstname-title"},{match:"#Honorific #FirstName? #ProperNoun",tag:"Person",reason:"dr-john-Title"},{match:"#FirstName the #Adjective",tag:"Person",reason:"name-the-great"},{match:"#ProperNoun (van|al|bin) #ProperNoun",tag:"Person",reason:"title-van-title",safe:!0},{match:"#ProperNoun (de|du) la? #ProperNoun",tag:"Person",notIf:"#Place",reason:"title-de-title"},{match:"#Singular #Acronym #LastName",tag:"#FirstName #Person .",reason:"title-acro-noun",safe:!0},{match:"[#ProperNoun] #Person",group:0,tag:"Person",reason:"proper-person",safe:!0},{match:"#Person [#ProperNoun #ProperNoun]",group:0,tag:"Person",notIf:"#Possessive",reason:"three-name-person",safe:!0},{match:"#FirstName #Acronym? [#ProperNoun]",group:0,tag:"LastName",notIf:"#Possessive",reason:"firstname-titlecase"},{match:"#FirstName [#FirstName]",group:0,tag:"LastName",reason:"firstname-firstname"},{match:"#FirstName #Acronym #Noun",tag:"Person",reason:"n-acro-noun",safe:!0},{match:"#FirstName [(de|di|du|van|von)] #Person",group:0,tag:"LastName",reason:"de-firstname"},{match:"[(lieutenant|corporal|sergeant|captain|qeen|king|admiral|major|colonel|marshal|president|queen|king)+] #ProperNoun",group:0,tag:"Honorific",reason:"seargeant-john"},{match:"[(private|general|major|rear|prime|field|count|miss)] #Honorific? #Person",group:0,tag:["Honorific","Person"],reason:"ambg-honorifics"},{match:"#Honorific #FirstName [#Singular]",group:0,tag:"LastName",notIf:"#Possessive",reason:"dr-john-foo",safe:!0},{match:"[(his|her) (majesty|honour|worship|excellency|honorable)] #Person",group:0,tag:"Honorific",reason:"his-excellency"},{match:"#Honorific #Actor",tag:"Honorific",reason:"Lieutenant colonel"},{match:"(first|second|third|1st|2nd|3rd) #Actor",tag:"Honorific",reason:"first lady"},{match:"#Person #RomanNumeral",tag:"Person",reason:"louis-IV"}],[{match:"#FirstName #Noun$",tag:". #LastName",notIf:"(#Possessive|#Organization|#Place|#Pronoun|@hasTitleCase)",reason:"firstname-noun"},{match:"%Person|Date% #Acronym? #ProperNoun",tag:"Person",reason:"jan-thierson"},{match:"%Person|Noun% #Acronym? #ProperNoun",tag:"Person",reason:"switch-person",safe:!0},{match:"%Person|Noun% #Organization",tag:"Organization",reason:"olive-garden"},{match:"%Person|Verb% #Acronym? #ProperNoun",tag:"Person",reason:"verb-propernoun",ifNo:"#Actor"},{match:"[%Person|Verb%] (will|had|has|said|says|told|did|learned|wants|wanted)",group:0,tag:"Person",reason:"person-said"},{match:"[%Person|Place%] (harbor|harbour|pier|town|city|place|dump|landfill)",group:0,tag:"Place",reason:"sydney-harbour"},{match:"(west|east|north|south) [%Person|Place%]",group:0,tag:"Place",reason:"east-sydney"},{match:"#Modal [%Person|Verb%]",group:0,tag:"Verb",reason:"would-mark"},{match:"#Adverb [%Person|Verb%]",group:0,tag:"Verb",reason:"really-mark"},{match:"[%Person|Verb%] (#Adverb|#Comparative)",group:0,tag:"Verb",reason:"drew-closer"},{match:"%Person|Verb% #Person",tag:"Person",reason:"rob-smith"},{match:"%Person|Verb% #Acronym #ProperNoun",tag:"Person",reason:"rob-a-smith"},{match:"[will] #Verb",group:0,tag:"Modal",reason:"will-verb"},{match:"(will && @isTitleCase) #ProperNoun",tag:"Person",reason:"will-name"},{match:"(#FirstName && !#Possessive) [#Singular] #Verb",group:0,safe:!0,tag:"LastName",reason:"jack-layton"},{match:"^[#Singular] #Person #Verb",group:0,safe:!0,tag:"Person",reason:"sherwood-anderson"},{match:"(a|an) [#Person]$",group:0,unTag:"Person",reason:"a-warhol"}],[{match:"#Copula (pretty|dead|full|well|sure) (#Adjective|#Noun)",tag:"#Copula #Adverb #Adjective",reason:"sometimes-adverb"},{match:"(#Pronoun|#Person) (had|#Adverb)? [better] #PresentTense",group:0,tag:"Modal",reason:"i-better"},{match:"(#Modal|i|they|we|do) not? [like]",group:0,tag:"PresentTense",reason:"modal-like"},{match:"#Noun #Adverb? [left]",group:0,tag:"PastTense",reason:"left-verb"},{match:"will #Adverb? not? #Adverb? [be] #Gerund",group:0,tag:"Copula",reason:"will-be-copula"},{match:"will #Adverb? not? #Adverb? [be] #Adjective",group:0,tag:"Copula",reason:"be-copula"},{match:"[march] (up|down|back|toward)",notIf:"#Date",group:0,tag:"Infinitive",reason:"march-to"},{match:"#Modal [march]",group:0,tag:"Infinitive",reason:"must-march"},{match:"[may] be",group:0,tag:"Verb",reason:"may-be"},{match:"[(subject|subjects|subjected)] to",group:0,tag:"Verb",reason:"subject to"},{match:"[home] to",group:0,tag:"PresentTense",reason:"home to"},{match:"[open] #Determiner",group:0,tag:"Infinitive",reason:"open-the"},{match:"(were|was) being [#PresentTense]",group:0,tag:"PastTense",reason:"was-being"},{match:"(had|has|have) [been /en$/]",group:0,tag:"Auxiliary Participle",reason:"had-been-broken"},{match:"(had|has|have) [been /ed$/]",group:0,tag:"Auxiliary PastTense",reason:"had-been-smoked"},{match:"(had|has) #Adverb? [been] #Adverb? #PastTense",group:0,tag:"Auxiliary",reason:"had-been-adj"},{match:"(had|has) to [#Noun] (#Determiner|#Possessive)",group:0,tag:"Infinitive",reason:"had-to-noun"},{match:"have [#PresentTense]",group:0,tag:"PastTense",notIf:"(come|gotten)",reason:"have-read"},{match:"(does|will|#Modal) that [work]",group:0,tag:"PastTense",reason:"does-that-work"},{match:"[(sound|sounds)] #Adjective",group:0,tag:"PresentTense",reason:"sounds-fun"},{match:"[(look|looks)] #Adjective",group:0,tag:"PresentTense",reason:"looks-good"},{match:"[(start|starts|stop|stops|begin|begins)] #Gerund",group:0,tag:"Verb",reason:"starts-thinking"},{match:"(have|had) read",tag:"Modal #PastTense",reason:"read-read"},{match:"(is|was|were) [(under|over) #PastTense]",group:0,tag:"Adverb Adjective",reason:"was-under-cooked"},{match:"[shit] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear1-verb"},{match:"[damn] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear2-verb"},{match:"[fuck] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear3-verb"},{match:"#Plural that %Noun|Verb%",tag:". #Preposition #Infinitive",reason:"jobs-that-work"},{match:"[works] for me",group:0,tag:"PresentTense",reason:"works-for-me"},{match:"as #Pronoun [please]",group:0,tag:"Infinitive",reason:"as-we-please"},{match:"[(co|mis|de|inter|intra|pre|re|un|out|under|over|counter)] #Verb",group:0,tag:["Verb","Prefix"],notIf:"(#Copula|#PhrasalVerb)",reason:"co-write"},{match:"#PastTense and [%Adj|Past%]",group:0,tag:"PastTense",reason:"dressed-and-left"},{match:"[%Adj|Past%] and #PastTense",group:0,tag:"PastTense",reason:"dressed-and-left"},{match:"#Copula #Pronoun [%Adj|Past%]",group:0,tag:"Adjective",reason:"is-he-stoked"},{match:"to [%Noun|Verb%] #Preposition",group:0,tag:"Infinitive",reason:"to-dream-of"}],[{match:"(slowly|quickly) [#Adjective]",group:0,tag:"Verb",reason:"slowly-adj"},{match:"does (#Adverb|not)? [#Adjective]",group:0,tag:"PresentTense",reason:"does-mean"},{match:"[(fine|okay|cool|ok)] by me",group:0,tag:"Adjective",reason:"okay-by-me"},{match:"i (#Adverb|do)? not? [mean]",group:0,tag:"PresentTense",reason:"i-mean"},{match:"will #Adjective",tag:"Auxiliary Infinitive",reason:"will-adj"},{match:"#Pronoun [#Adjective] #Determiner #Adjective? #Noun",group:0,tag:"Verb",reason:"he-adj-the"},{match:"#Copula [%Adj|Present%] to #Verb",group:0,tag:"Verb",reason:"adj-to"},{match:"#Copula [#Adjective] (well|badly|quickly|slowly)",group:0,tag:"Verb",reason:"done-well"},{match:"#Adjective and [#Gerund] !#Preposition?",group:0,tag:"Adjective",reason:"rude-and-x"},{match:"#Copula #Adverb? (over|under) [#PastTense]",group:0,tag:"Adjective",reason:"over-cooked"},{match:"#Copula #Adjective+ (and|or) [#PastTense]$",group:0,tag:"Adjective",reason:"bland-and-overcooked"},{match:"got #Adverb? [#PastTense] of",group:0,tag:"Adjective",reason:"got-tired-of"},{match:"(seem|seems|seemed|appear|appeared|appears|feel|feels|felt|sound|sounds|sounded) (#Adverb|#Adjective)? [#PastTense]",group:0,tag:"Adjective",reason:"felt-loved"},{match:"(seem|feel|seemed|felt) [#PastTense #Particle?]",group:0,tag:"Adjective",reason:"seem-confused"},{match:"a (bit|little|tad) [#PastTense #Particle?]",group:0,tag:"Adjective",reason:"a-bit-confused"},{match:"not be [%Adj|Past% #Particle?]",group:0,tag:"Adjective",reason:"do-not-be-confused"},{match:"#Copula just [%Adj|Past% #Particle?]",group:0,tag:"Adjective",reason:"is-just-right"},{match:"as [#Infinitive] as",group:0,tag:"Adjective",reason:"as-pale-as"},{match:"[%Adj|Past%] and #Adjective",group:0,tag:"Adjective",reason:"faled-and-oppressive"},{match:"or [#PastTense] #Noun",group:0,tag:"Adjective",notIf:"(#Copula|#Pronoun)",reason:"or-heightened-emotion"},{match:"(become|became|becoming|becomes) [#Verb]",group:0,tag:"Adjective",reason:"become-verb"},{match:"#Possessive [#PastTense] #Noun",group:0,tag:"Adjective",reason:"declared-intentions"},{match:"#Copula #Pronoun [%Adj|Present%]",group:0,tag:"Adjective",reason:"is-he-cool"},{match:"#Copula [%Adj|Past%] with",group:0,tag:"Adjective",notIf:"(associated|worn|baked|aged|armed|bound|fried|loaded|mixed|packed|pumped|filled|sealed)",reason:"is-crowded-with"},{match:"#Copula #Adverb? [%Adj|Present%]$",group:0,tag:"Adjective",reason:"was-empty$"}],[{match:"will (#Adverb|not)+? [have] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"will-have-vb"},{match:"[#Copula] (#Adverb|not)+? (#Gerund|#PastTense)",group:0,tag:"Auxiliary",reason:"copula-walking"},{match:"[(#Modal|did)+] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"modal-verb"},{match:"#Modal (#Adverb|not)+? [have] (#Adverb|not)+? [had] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"[(has|had)] (#Adverb|not)+? #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[(do|does|did|will|have|had|has|got)] (not|#Adverb)+? #Verb",group:0,tag:"Auxiliary",reason:"have-had"},{match:"[about to] #Adverb? #Verb",group:0,tag:["Auxiliary","Verb"],reason:"about-to"},{match:"#Modal (#Adverb|not)+? [be] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-be"},{match:"[(#Modal|had|has)] (#Adverb|not)+? [been] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"had-been"},{match:"[(be|being|been)] #Participle",group:0,tag:"Auxiliary",reason:"being-driven"},{match:"[may] #Adverb? #Infinitive",group:0,tag:"Auxiliary",reason:"may-want"},{match:"#Copula (#Adverb|not)+? [(be|being|been)] #Adverb+? #PastTense",group:0,tag:"Auxiliary",reason:"being-walked"},{match:"will [be] #PastTense",group:0,tag:"Auxiliary",reason:"will-be-x"},{match:"[(be|been)] (#Adverb|not)+? #Gerund",group:0,tag:"Auxiliary",reason:"been-walking"},{match:"[used to] #PresentTense",group:0,tag:"Auxiliary",reason:"used-to-walk"},{match:"#Copula (#Adverb|not)+? [going to] #Adverb+? #PresentTense",group:0,tag:"Auxiliary",reason:"going-to-walk"},{match:"#Imperative [(me|him|her)]",group:0,tag:"Reflexive",reason:"tell-him"},{match:"(is|was) #Adverb? [no]",group:0,tag:"Negative",reason:"is-no"},{match:"[(been|had|became|came)] #PastTense",group:0,notIf:"#PhrasalVerb",tag:"Auxiliary",reason:"been-told"},{match:"[(being|having|getting)] #Verb",group:0,tag:"Auxiliary",reason:"being-born"},{match:"[be] #Gerund",group:0,tag:"Auxiliary",reason:"be-walking"},{match:"[better] #PresentTense",group:0,tag:"Modal",notIf:"(#Copula|#Gerund)",reason:"better-go"},{match:"even better",tag:"Adverb #Comparative",reason:"even-better"}],[{match:"(#Verb && @hasHyphen) up",tag:"PhrasalVerb",reason:"foo-up"},{match:"(#Verb && @hasHyphen) off",tag:"PhrasalVerb",reason:"foo-off"},{match:"(#Verb && @hasHyphen) over",tag:"PhrasalVerb",reason:"foo-over"},{match:"(#Verb && @hasHyphen) out",tag:"PhrasalVerb",reason:"foo-out"},{match:"[#Verb (in|out|up|down|off|back)] (on|in)",notIf:"#Copula",tag:"PhrasalVerb Particle",reason:"walk-in-on"},{match:"(lived|went|crept|go) [on] for",group:0,tag:"PhrasalVerb",reason:"went-on"},{match:"#Verb (up|down|in|on|for)$",tag:"PhrasalVerb #Particle",notIf:"#PhrasalVerb",reason:"come-down$"},{match:"help [(stop|end|make|start)]",group:0,tag:"Infinitive",reason:"help-stop"},{match:"#PhrasalVerb (in && #Particle) #Determiner",tag:"#Verb #Preposition #Determiner",unTag:"PhrasalVerb",reason:"work-in-the"},{match:"[(stop|start|finish|help)] #Gerund",group:0,tag:"Infinitive",reason:"start-listening"},{match:"#Verb (him|her|it|us|himself|herself|itself|everything|something) [(up|down)]",group:0,tag:"Adverb",reason:"phrasal-pronoun-advb"}],[{match:"^do not? [#Infinitive #Particle?]",notIf:G8,group:0,tag:"Imperative",reason:"do-eat"},{match:"^please do? not? [#Infinitive #Particle?]",group:0,tag:"Imperative",reason:"please-go"},{match:"^just do? not? [#Infinitive #Particle?]",group:0,tag:"Imperative",reason:"just-go"},{match:"^[#Infinitive] it #Comparative",notIf:G8,group:0,tag:"Imperative",reason:"do-it-better"},{match:"^[#Infinitive] it (please|now|again|plz)",notIf:G8,group:0,tag:"Imperative",reason:"do-it-please"},{match:"^[#Infinitive] (#Adjective|#Adverb)$",group:0,tag:"Imperative",notIf:"(so|such|rather|enough)",reason:"go-quickly"},{match:"^[#Infinitive] (up|down|over) #Determiner",group:0,tag:"Imperative",reason:"turn-down"},{match:"^[#Infinitive] (your|my|the|a|an|any|each|every|some|more|with|on)",group:0,notIf:"like",tag:"Imperative",reason:"eat-my-shorts"},{match:"^[#Infinitive] (him|her|it|us|me|there)",group:0,tag:"Imperative",reason:"tell-him"},{match:"^[#Infinitive] #Adjective #Noun$",group:0,tag:"Imperative",reason:"avoid-loud-noises"},{match:"^[#Infinitive] (#Adjective|#Adverb)? and #Infinitive",group:0,tag:"Imperative",reason:"call-and-reserve"},{match:"^(go|stop|wait|hurry) please?$",tag:"Imperative",reason:"go"},{match:"^(somebody|everybody) [#Infinitive]",group:0,tag:"Imperative",reason:"somebody-call"},{match:"^let (us|me) [#Infinitive]",group:0,tag:"Imperative",reason:"lets-leave"},{match:"^[(shut|close|open|start|stop|end|keep)] #Determiner #Noun",group:0,tag:"Imperative",reason:"shut-the-door"},{match:"^[#PhrasalVerb #Particle] #Determiner #Noun",group:0,tag:"Imperative",reason:"turn-off-the-light"},{match:"^[go] to .",group:0,tag:"Imperative",reason:"go-to-toronto"},{match:"^#Modal you [#Infinitive]",group:0,tag:"Imperative",reason:"would-you-"},{match:"^never [#Infinitive]",group:0,tag:"Imperative",reason:"never-stop"},{match:"^come #Infinitive",tag:"Imperative",notIf:"on",reason:"come-have"},{match:"^come and? #Infinitive",tag:"Imperative . Imperative",notIf:"#PhrasalVerb",reason:"come-and-have"},{match:"^stay (out|away|back)",tag:"Imperative",reason:"stay-away"},{match:"^[(stay|be|keep)] #Adjective",group:0,tag:"Imperative",reason:"stay-cool"},{match:"^[keep it] #Adjective",group:0,tag:"Imperative",reason:"keep-it-cool"},{match:"^do not [#Infinitive]",group:0,tag:"Imperative",reason:"do-not-be"},{match:"[#Infinitive] (yourself|yourselves)",group:0,tag:"Imperative",reason:"allow-yourself"},{match:"[#Infinitive] what .",group:0,tag:"Imperative",reason:"look-what"},{match:"^[#Infinitive] #Gerund",group:0,tag:"Imperative",reason:"keep-playing"},{match:"^[#Infinitive] (to|for|into|toward|here|there)",group:0,tag:"Imperative",reason:"go-to"},{match:"^[#Infinitive] (and|or) #Infinitive",group:0,tag:"Imperative",reason:"inf-and-inf"},{match:"^[%Noun|Verb%] to",group:0,tag:"Imperative",reason:"commit-to"},{match:"^[#Infinitive] #Adjective? #Singular #Singular",group:0,tag:"Imperative",reason:"maintain-eye-contact"},{match:"do not (forget|omit|neglect) to [#Infinitive]",group:0,tag:"Imperative",reason:"do-not-forget"},{match:"^[(ask|wear|pay|look|help|show|watch|act|fix|kill|stop|start|turn|try|win)] #Noun",group:0,tag:"Imperative",reason:"pay-attention"}],[{match:"(that|which) were [%Adj|Gerund%]",group:0,tag:"Gerund",reason:"that-were-growing"},{match:"#Gerund [#Gerund] #Plural",group:0,tag:"Adjective",reason:"hard-working-fam"}],[{match:"u r",tag:"#Pronoun #Copula",reason:"u r"},{match:"#Noun [(who|whom)]",group:0,tag:"Determiner",reason:"captain-who"},{match:"[had] #Noun+ #PastTense",group:0,tag:"Condition",reason:"had-he"},{match:"[were] #Noun+ to #Infinitive",group:0,tag:"Condition",reason:"were-he"},{match:"some sort of",tag:"Adjective Noun Conjunction",reason:"some-sort-of"},{match:"of some sort",tag:"Conjunction Adjective Noun",reason:"of-some-sort"},{match:"[such] (a|an|is)? #Noun",group:0,tag:"Determiner",reason:"such-skill"},{match:"[right] (before|after|in|into|to|toward)",group:0,tag:"#Adverb",reason:"right-into"},{match:"#Preposition [about]",group:0,tag:"Adjective",reason:"at-about"},{match:"(are|#Modal|see|do|for) [ya]",group:0,tag:"Pronoun",reason:"are-ya"},{match:"[long live] .",group:0,tag:"#Adjective #Infinitive",reason:"long-live"},{match:"[plenty] of",group:0,tag:"#Uncountable",reason:"plenty-of"},{match:"(always|nearly|barely|practically) [there]",group:0,tag:"Adjective",reason:"always-there"},{match:"[there] (#Adverb|#Pronoun)? #Copula",group:0,tag:"There",reason:"there-is"},{match:"#Copula [there] .",group:0,tag:"There",reason:"is-there"},{match:"#Modal #Adverb? [there]",group:0,tag:"There",reason:"should-there"},{match:"^[do] (you|we|they)",group:0,tag:"QuestionWord",reason:"do-you"},{match:"^[does] (he|she|it|#ProperNoun)",group:0,tag:"QuestionWord",reason:"does-he"},{match:"#Determiner #Noun+ [who] #Verb",group:0,tag:"Preposition",reason:"the-x-who"},{match:"#Determiner #Noun+ [which] #Verb",group:0,tag:"Preposition",reason:"the-x-which"},{match:"a [while]",group:0,tag:"Noun",reason:"a-while"},{match:"guess who",tag:"#Infinitive #QuestionWord",reason:"guess-who"},{match:"[fucking] !#Verb",group:0,tag:"#Gerund",reason:"f-as-gerund"}],[{match:"university of #Place",tag:"Organization",reason:"university-of-Foo"},{match:"#Noun (&|n) #Noun",tag:"Organization",reason:"Noun-&-Noun"},{match:"#Organization of the? #ProperNoun",tag:"Organization",reason:"org-of-place",safe:!0},{match:"#Organization #Country",tag:"Organization",reason:"org-country"},{match:"#ProperNoun #Organization",tag:"Organization",notIf:"#FirstName",reason:"titlecase-org"},{match:"#ProperNoun (ltd|co|inc|dept|assn|bros)",tag:"Organization",reason:"org-abbrv"},{match:"the [#Acronym]",group:0,tag:"Organization",reason:"the-acronym",safe:!0},{match:"government of the? [#Place+]",tag:"Organization",reason:"government-of-x"},{match:"(health|school|commerce) board",tag:"Organization",reason:"school-board"},{match:"(nominating|special|conference|executive|steering|central|congressional) committee",tag:"Organization",reason:"special-comittee"},{match:"(world|global|international|national|#Demonym) #Organization",tag:"Organization",reason:"global-org"},{match:"#Noun+ (public|private) school",tag:"School",reason:"noun-public-school"},{match:"#Place+ #SportsTeam",tag:"SportsTeam",reason:"place-sportsteam"},{match:"(dc|atlanta|minnesota|manchester|newcastle|sheffield) united",tag:"SportsTeam",reason:"united-sportsteam"},{match:"#Place+ fc",tag:"SportsTeam",reason:"fc-sportsteam"},{match:"#Place+ #Noun{0,2} (club|society|group|team|committee|commission|association|guild|crew)",tag:"Organization",reason:"place-noun-society"}],[{match:"(west|north|south|east|western|northern|southern|eastern)+ #Place",tag:"Region",reason:"west-norfolk"},{match:"#City [(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|pa|sc|tn|tx|ut|vt|pr)]",group:0,tag:"Region",reason:"us-state"},{match:"portland [or]",group:0,tag:"Region",reason:"portland-or"},{match:"#ProperNoun+ (cliff|place|range|pit|place|point|room|grounds|ruins)",tag:"Place",reason:"foo-point"},{match:"in [#ProperNoun] #Place",group:0,tag:"Place",reason:"propernoun-place"},{match:"#Value #Noun (st|street|rd|road|crescent|cr|way|tr|terrace|avenue|ave)",tag:"Address",reason:"address-st"},{match:"(port|mount|mt) #ProperName",tag:"Place",reason:"port-name"}],[{match:"[so] #Noun",group:0,tag:"Conjunction",reason:"so-conj"},{match:"[(who|what|where|why|how|when)] #Noun #Copula #Adverb? (#Verb|#Adjective)",group:0,tag:"Conjunction",reason:"how-he-is-x"},{match:"#Copula [(who|what|where|why|how|when)] #Noun",group:0,tag:"Conjunction",reason:"when-he"},{match:"#Verb [that] #Pronoun",group:0,tag:"Conjunction",reason:"said-that-he"},{match:"#Noun [that] #Copula",group:0,tag:"Conjunction",reason:"that-are"},{match:"#Noun [that] #Verb #Adjective",group:0,tag:"Conjunction",reason:"that-seem"},{match:"#Noun #Copula not? [that] #Adjective",group:0,tag:"Adverb",reason:"that-adj"},{match:"#Verb #Adverb? #Noun [(that|which)]",group:0,tag:"Preposition",reason:"that-prep"},{match:"@hasComma [which] (#Pronoun|#Verb)",group:0,tag:"Preposition",reason:"which-copula"},{match:"#Noun [like] #Noun",group:0,tag:"Preposition",reason:"noun-like"},{match:"^[like] #Determiner",group:0,tag:"Preposition",reason:"like-the"},{match:"a #Noun [like] (#Noun|#Determiner)",group:0,tag:"Preposition",reason:"a-noun-like"},{match:"#Adverb [like]",group:0,tag:"Verb",reason:"really-like"},{match:"(not|nothing|never) [like]",group:0,tag:"Preposition",reason:"nothing-like"},{match:"#Infinitive #Pronoun [like]",group:0,tag:"Preposition",reason:"treat-them-like"},{match:"[#QuestionWord] (#Pronoun|#Determiner)",group:0,tag:"Preposition",reason:"how-he"},{match:"[#QuestionWord] #Participle",group:0,tag:"Preposition",reason:"when-stolen"},{match:"[how] (#Determiner|#Copula|#Modal|#PastTense)",group:0,tag:"QuestionWord",reason:"how-is"},{match:"#Plural [(who|which|when)] .",group:0,tag:"Preposition",reason:"people-who"}],[{match:"holy (shit|fuck|hell)",tag:"Expression",reason:"swears-expression"},{match:"^[(well|so|okay|now)] !#Adjective?",group:0,tag:"Expression",reason:"well-"},{match:"^come on",tag:"Expression",reason:"come-on"},{match:"(say|says|said) [sorry]",group:0,tag:"Expression",reason:"say-sorry"},{match:"^(ok|alright|shoot|hell|anyways)",tag:"Expression",reason:"ok-"},{match:"^(say && @hasComma)",tag:"Expression",reason:"say-"},{match:"^(like && @hasComma)",tag:"Expression",reason:"like-"},{match:"^[(dude|man|girl)] #Pronoun",group:0,tag:"Expression",reason:"dude-i"}]);let j8=null;const W8={postTagger:function(e){const{world:t}=e,{model:n,methods:r}=t;j8=j8||r.one.buildNet(n.two.matches,t);let i=r.two.quickSplit(e.document).map(e=>{let t=e[0];return[t.index[0],t.index[1],t.index[1]+e.length]}),a=e.update(i);return a.cache(),a.sweep(j8),e.uncache(),e.unfreeze(),e},tagger:e=>e.compute(["freeze","lexicon","preTagger","postTagger","unfreeze"])};const q8={api:function(e){e.prototype.confidence=function(){let e=0,t=0;return this.docs.forEach(n=>{n.forEach(n=>{t+=1,e+=n.confidence||1})}),0===t?1:(e=>Math.round(100*e)/100)(e/t)},e.prototype.tagger=function(){return this.compute(["tagger"])}},compute:W8,model:{two:{matches:H8}},hooks:["postTagger"]},X8=q8,K8=function(e,t){let n=function(e){return Object.keys(e.hooks).filter(e=>!e.startsWith("#")&&!e.startsWith("%"))}(t);if(0===n.length)return e;e._cache||e.cache();let r=e._cache;return e.filter((e,t)=>n.some(e=>r[t].has(e)))},Y8=function(e,t){let n=t;"string"===typeof t&&(n=this.buildNet([{match:t}]));let r=this.tokenize(e),i=K8(r,n);return i.found?(i.compute(["index","tagger"]),i.match(t)):r.none()},J8={lib:{lazy:Y8}},$8=function(e,t){let n=t;return e.forEach(e=>{e.has("#Infinitive")||(n=function(e,t){let n=(0,e.methods.two.transform.verb.conjugate)(t,e.model);return e.has("#Gerund")?n.Gerund:e.has("#PastTense")?n.PastTense:e.has("#PresentTense")?n.PresentTense:e.has("#Gerund")?n.Gerund:t}(e,t)),e.replaceWith(n)}),e},Q8=function(e,t,n){let r=e.split(/ /g).map(e=>e.toLowerCase().trim());r=r.filter(e=>e),r=r.map(e=>"{".concat(e,"}")).join(" ");let i=this.match(r);return n&&(i=i.if(n)),i.has("#Verb")?$8(i,t):i.has("#Noun")?function(e,t){let n=t;e.has("#Plural")&&(n=(0,e.methods.two.transform.noun.toPlural)(t,e.model));e.replaceWith(n,{possessives:!0})}(i,t):i.has("#Adverb")?function(e,t){const{toAdverb:n}=e.methods.two.transform.adjective;let r=n(t);r&&e.replaceWith(r)}(i,t):i.has("#Adjective")?function(e,t){const{toComparative:n,toSuperlative:r}=e.methods.two.transform.adjective;let i=t;e.has("#Comparative")?i=n(i,e.model):e.has("#Superlative")&&(i=r(i,e.model)),i&&e.replaceWith(i)}(i,t):this},Z8={api:function(e){e.prototype.swap=Q8}};$2.plugin(h8),$2.plugin(O8),$2.plugin(X8),$2.plugin(J8),$2.plugin(Z8);const e7=$2,t7=function(e){const{fromComparative:t,fromSuperlative:n}=e.methods.two.transform.adjective;let r=e.text("normal");return e.has("#Comparative")?t(r,e.model):e.has("#Superlative")?n(r,e.model):r},n7={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Adjectives"}json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{toAdverb:t,toNoun:n,toSuperlative:r,toComparative:i}=this.methods.two.transform.adjective;return e.normal=!0,this.map(a=>{let o=a.toView().json(e)[0]||{},s=t7(a);return o.adjective={adverb:t(s,this.model),noun:n(s,this.model),superlative:r(s,this.model),comparative:i(s,this.model)},o},[])}adverbs(){return this.before("#Adverb+$").concat(this.after("^#Adverb+"))}conjugate(e){const{toComparative:t,toSuperlative:n,toNoun:r,toAdverb:i}=this.methods.two.transform.adjective;return this.getNth(e).map(e=>{let a=t7(e);return{Adjective:a,Comparative:t(a,this.model),Superlative:n(a,this.model),Noun:r(a,this.model),Adverb:i(a,this.model)}},[])}toComparative(e){const{toComparative:t}=this.methods.two.transform.adjective;return this.getNth(e).map(e=>{let n=t7(e),r=t(n,this.model);return e.replaceWith(r)})}toSuperlative(e){const{toSuperlative:t}=this.methods.two.transform.adjective;return this.getNth(e).map(e=>{let n=t7(e),r=t(n,this.model);return e.replaceWith(r)})}toAdverb(e){const{toAdverb:t}=this.methods.two.transform.adjective;return this.getNth(e).map(e=>{let n=t7(e),r=t(n,this.model);return e.replaceWith(r)})}toNoun(e){const{toNoun:t}=this.methods.two.transform.adjective;return this.getNth(e).map(e=>{let n=t7(e),r=t(n,this.model);return e.replaceWith(r)})}}e.prototype.adjectives=function(e){let n=this.match("#Adjective");return n=n.getNth(e),new t(n.document,n.pointer)},e.prototype.superlatives=function(e){let n=this.match("#Superlative");return n=n.getNth(e),new t(n.document,n.pointer)},e.prototype.comparatives=function(e){let n=this.match("#Comparative");return n=n.getNth(e),new t(n.document,n.pointer)}}},r7={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Adverbs"}conjugate(e){return this.getNth(e).map(e=>{let t=function(e){return e.compute("root").text("root")}(e);return{Adverb:e.text("normal"),Adjective:t}},[])}json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.methods.two.transform.adjective.fromAdverb;return e.normal=!0,this.map(n=>{let r=n.toView().json(e)[0]||{};return r.adverb={adjective:t(r.normal)},r},[])}}e.prototype.adverbs=function(e){let n=this.match("#Adverb");return n=n.getNth(e),new t(n.document,n.pointer)}}},i7=function(e){let t=this;t=function(e){let t=e.parentheses();return t=t.filter(e=>e.wordCount()>=3&&e.has("#Verb")&&e.has("#Noun")),e.splitOn(t)}(t),t=function(e){let t=e.quotations();return t=t.filter(e=>e.wordCount()>=3&&e.has("#Verb")&&e.has("#Noun")),e.splitOn(t)}(t),t=function(e){let t=e.match("@hasComma");return t=t.filter(e=>{if(1===e.growLeft(".").wordCount())return!1;if(1===e.growRight(". .").wordCount())return!1;let t=e.grow(".");return t=t.ifNo("@hasComma @hasComma"),t=t.ifNo("@hasComma (and|or) ."),t=t.ifNo("(#City && @hasComma) #Country"),t=t.ifNo("(#WeekDay && @hasComma) #Date"),t=t.ifNo("(#Date+ && @hasComma) #Value"),t=t.ifNo("(#Adjective && @hasComma) #Adjective"),t.found}),e.splitAfter(t)}(t),t=t.splitAfter("(@hasEllipses|@hasSemicolon|@hasDash|@hasColon)"),t=t.splitAfter("^#Pronoun (said|says)"),t=t.splitBefore("(said|says) #ProperNoun$"),t=t.splitBefore(". . if .{4}"),t=t.splitBefore("and while"),t=t.splitBefore("now that"),t=t.splitBefore("ever since"),t=t.splitBefore("(supposing|although)"),t=t.splitBefore("even (while|if|though)"),t=t.splitBefore("(whereas|whose)"),t=t.splitBefore("as (though|if)"),t=t.splitBefore("(til|until)");let n=t.match("#Verb .* [but] .* #Verb",0);n.found&&(t=t.splitBefore(n));let r=t.if("if .{2,9} then .").match("then");return t=t.splitBefore(r),"number"===typeof e&&(t=t.get(e)),t},a7=function(e){let t=[],n=null;return e.clauses().docs.forEach(e=>{e.forEach(e=>{e.chunk&&e.chunk===n?t[t.length-1][2]=e.index[1]+1:(n=e.chunk,t.push([e.index[0],e.index[1],e.index[1]+1]))}),n=null}),e.update(t)},o7=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Chunks"}isVerb(){return this.filter(e=>e.has("<Verb>"))}isNoun(){return this.filter(e=>e.has("<Noun>"))}isAdjective(){return this.filter(e=>e.has("<Adjective>"))}isPivot(){return this.filter(e=>e.has("<Pivot>"))}debug(){return this.toView().debug("chunks"),this}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.chunks=function(e){let n=a7(this);return n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.clauses=i7},s7={this:"Noun",then:"Pivot"},u7=function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];!0!==s7.hasOwnProperty(r.normal)?r.tags.has("Verb")?r.chunk="Verb":r.tags.has("Noun")||r.tags.has("Determiner")||r.tags.has("Value")?r.chunk="Noun":r.tags.has("QuestionWord")&&(r.chunk="Pivot"):r.chunk=s7[r.normal]}},l7=function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];if(r.chunk)continue;let i=e[t][n+1],a=e[t][n-1];if(r.tags.has("Adjective")){if(a&&a.tags.has("Copula")){r.chunk="Adjective";continue}if(a&&a.tags.has("Determiner")){r.chunk="Noun";continue}if(i&&i.tags.has("Noun")){r.chunk="Noun";continue}}else if(r.tags.has("Adverb")||r.tags.has("Negative")){if(a&&a.tags.has("Adjective")){r.chunk="Adjective";continue}if(a&&a.tags.has("Verb")){r.chunk="Verb";continue}if(i&&i.tags.has("Adjective")){r.chunk="Adjective";continue}if(i&&i.tags.has("Verb")){r.chunk="Verb";continue}}}},c7=[{match:"[that] #Determiner #Noun",group:0,chunk:"Pivot"},{match:"#PastTense [that]",group:0,chunk:"Pivot"},{match:"[so] #Determiner",group:0,chunk:"Pivot"},{match:"#Copula #Adverb+? [#Adjective]",group:0,chunk:"Adjective"},{match:"#Adjective and #Adjective",chunk:"Adjective"},{match:"#Adverb+ and #Adverb #Verb",chunk:"Verb"},{match:"#Gerund #Adjective$",chunk:"Verb"},{match:"#Gerund to #Verb",chunk:"Verb"},{match:"#PresentTense and #PresentTense",chunk:"Verb"},{match:"#Adverb #Negative",chunk:"Verb"},{match:"(want|wants|wanted) to #Infinitive",chunk:"Verb"},{match:"#Verb #Reflexive",chunk:"Verb"},{match:"#Verb [to] #Adverb? #Infinitive",group:0,chunk:"Verb"},{match:"[#Preposition] #Gerund",group:0,chunk:"Verb"},{match:"#Infinitive [that] <Noun>",group:0,chunk:"Verb"},{match:"#Noun of #Determiner? #Noun",chunk:"Noun"},{match:"#Value+ #Adverb? #Adjective",chunk:"Noun"},{match:"the [#Adjective] #Noun",chunk:"Noun"},{match:"#Singular in #Determiner? #Singular",chunk:"Noun"},{match:"#Plural [in] #Determiner? #Noun",group:0,chunk:"Pivot"},{match:"#Noun and #Determiner? #Noun",notIf:"(#Possessive|#Pronoun)",chunk:"Noun"}];let h7=null;const d7=function(e,t,n){const{methods:r}=n;h7=h7||r.one.buildNet(c7,n),e.sweep(h7)},p7=function(e,t){if(("undefined"===typeof process?self.env||{}:{NODE_ENV:"production",PUBLIC_URL:"/gaia_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).DEBUG_CHUNKS){let n=(e.normal+"'").padEnd(8);console.log("  | '".concat(n,"  \u2192  \x1b[34m").concat(t.padEnd(12),"\x1b[0m \x1b[2m -fallback- \x1b[0m"))}e.chunk=t},f7=function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];void 0===r.chunk&&(r.tags.has("Conjunction")||r.tags.has("Preposition")?p7(r,"Pivot"):r.tags.has("Adverb")?p7(r,"Verb"):r.chunk="Noun")}},m7=function(e){let t=[],n=null;e.forEach(e=>{for(let r=0;r<e.length;r+=1){let i=e[r];n&&i.chunk===n?t[t.length-1].terms.push(i):(t.push({chunk:i.chunk,terms:[i]}),n=i.chunk)}}),t.forEach(e=>{if("Verb"===e.chunk){const t=e.terms.find(e=>e.tags.has("Verb"));t||e.terms.forEach(e=>e.chunk=null)}})},g7={chunks:function(e){const{document:t,world:n}=e;u7(t),l7(t),d7(e,t,n),f7(t,n),m7(t,n)}},v7={compute:g7,api:o7,hooks:["chunks"]},D7=/\./g,y7=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Acronyms"}strip(){return this.docs.forEach(e=>{e.forEach(e=>{e.text=e.text.replace(D7,""),e.normal=e.normal.replace(D7,"")})}),this}addPeriods(){return this.docs.forEach(e=>{e.forEach(e=>{e.text=e.text.replace(D7,""),e.normal=e.normal.replace(D7,""),e.text=e.text.split("").join(".")+".",e.normal=e.normal.split("").join(".")+"."})}),this}}e.prototype.acronyms=function(e){let n=this.match("#Acronym");return n=n.getNth(e),new t(n.document,n.pointer)}},E7=/\(/,A7=/\)/,C7=function(e,t){for(;t<e.length;t+=1)if(e[t].post&&A7.test(e[t].post)){let[,n]=e[t].index;return n=n||0,n}return null},_7=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return function(e){return e.docs.forEach(e=>{e[0].pre=e[0].pre.replace(E7,"");let t=e[e.length-1];t.post=t.post.replace(A7,"")}),e}(this)}}e.prototype.parentheses=function(e){let n=function(e){let t=[];return e.docs.forEach(e=>{for(let n=0;n<e.length;n+=1){let r=e[n];if(r.pre&&E7.test(r.pre)){let r=C7(e,n);if(null!==r){let[i,a]=e[n].index;t.push([i,a,r+1,e[n].id]),n=r}}}}),e.update(t)}(this);return n=n.getNth(e),new t(n.document,n.pointer)}},b7=/'s$/,x7=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return this.docs.forEach(e=>{e.forEach(e=>{e.text=e.text.replace(b7,""),e.normal=e.normal.replace(b7,"")})}),this}}e.prototype.possessives=function(e){let n=function(e){let t=e.match("#Possessive+");return t.has("#Person")&&(t=t.growLeft("#Person+")),t.has("#Place")&&(t=t.growLeft("#Place+")),t.has("#Organization")&&(t=t.growLeft("#Organization+")),t}(this);return n=n.getNth(e),new t(n.document,n.pointer)}},F7={'"':'"',"\uff02":"\uff02","'":"'","\u201c":"\u201d","\u2018":"\u2019","\u201f":"\u201d","\u201b":"\u2019","\u201e":"\u201d","\u2e42":"\u201d","\u201a":"\u2019","\xab":"\xbb","\u2039":"\u203a","\u2035":"\u2032","\u2036":"\u2033","\u2037":"\u2034","\u301d":"\u301e","`":"\xb4","\u301f":"\u301e"},w7=RegExp("["+Object.keys(F7).join("")+"]"),S7=RegExp("["+Object.values(F7).join("")+"]"),T7=function(e,t){const n=e[t].pre.match(w7)[0]||"";if(!n||!F7[n])return null;const r=F7[n];for(;t<e.length;t+=1)if(e[t].post&&e[t].post.match(r))return t;return null},M7=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return function(e){e.docs.forEach(e=>{e[0].pre=e[0].pre.replace(w7,"");let t=e[e.length-1];t.post=t.post.replace(S7,"")})}(this)}}e.prototype.quotations=function(e){let n=function(e){let t=[];return e.docs.forEach(e=>{for(let n=0;n<e.length;n+=1){let r=e[n];if(r.pre&&w7.test(r.pre)){let r=T7(e,n);if(null!==r){let[i,a]=e[n].index;t.push([i,a,r+1,e[n].id]),n=r}}}}),e.update(t)}(this);return n=n.getNth(e),new t(n.document,n.pointer)}},B7=function(e){let t=this.splitAfter("@hasComma");return t=t.match("#PhoneNumber+"),t=t.getNth(e),t},P7=[["hyphenated","@hasHyphen ."],["hashTags","#HashTag"],["emails","#Email"],["emoji","#Emoji"],["emoticons","#Emoticon"],["atMentions","#AtMention"],["urls","#Url"],["conjunctions","#Conjunction"],["prepositions","#Preposition"],["abbreviations","#Abbreviation"],["honorifics","#Honorific"]];let N7=[["emojis","emoji"],["atmentions","atMentions"]];const R7=function(e){P7.forEach(t=>{e.prototype[t[0]]=function(e){let n=this.match(t[1]);return"number"===typeof e?n.get(e):n}}),e.prototype.phoneNumbers=B7,N7.forEach(t=>{e.prototype[t[0]]=e.prototype[t[1]]})},L7=/\//,I7=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Slashes"}split(){return this.map(e=>{let t=e.text().split(L7);return(e=e.replaceWith(t.join(" "))).growRight("("+t.join("|")+")+")})}}e.prototype.slashes=function(e){let n=this.match("#SlashedTerm");return n=n.getNth(e),new t(n.document,n.pointer)}},k7={api:function(e){y7(e),_7(e),x7(e),M7(e),R7(e),I7(e)}},O7=function(e,t){e.docs.forEach(e=>{e.forEach(t)})},U7={case:e=>{O7(e,e=>{e.text=e.text.toLowerCase()})},unicode:e=>{const t=e.world,n=t.methods.one.killUnicode;O7(e,e=>e.text=n(e.text,t))},whitespace:e=>{O7(e,e=>{e.post=e.post.replace(/\s+/g," "),e.post=e.post.replace(/\s([.,?!:;])/g,"$1"),e.pre=e.pre.replace(/\s+/g,"")})},punctuation:e=>{O7(e,e=>{e.post=e.post.replace(/[\u2013\u2014-]/g," "),e.post=e.post.replace(/[,:;]/g,""),e.post=e.post.replace(/\.{2,}/g,""),e.post=e.post.replace(/\?{2,}/g,"?"),e.post=e.post.replace(/!{2,}/g,"!"),e.post=e.post.replace(/\?!+/g,"?")});let t=e.docs,n=t[t.length-1];if(n&&n.length>0){let e=n[n.length-1];e.post=e.post.replace(/ /g,"")}},contractions:e=>{e.contractions().expand()},acronyms:e=>{e.acronyms().strip()},parentheses:e=>{e.parentheses().strip()},possessives:e=>{e.possessives().strip()},quotations:e=>{e.quotations().strip()},emoji:e=>{e.emojis().remove()},honorifics:e=>{e.match("#Honorific+ #Person").honorifics().remove()},adverbs:e=>{e.adverbs().remove()},nouns:e=>{e.nouns().toSingular()},verbs:e=>{e.verbs().toInfinitive()},numbers:e=>{e.numbers().toNumber()},debullet:e=>{const t=/^\s*([-\u2013\u2014*\u2022])\s*$/;return e.docs.forEach(e=>{t.test(e[0].pre)&&(e[0].pre=e[0].pre.replace(t,""))}),e}},z7=e=>e.split("|").reduce((e,t)=>(e[t]=!0,e),{}),V7="unicode|punctuation|whitespace|acronyms",G7="|case|contractions|parentheses|quotations|emoji|honorifics|debullet",H7={light:z7(V7),medium:z7(V7+G7),heavy:z7(V7+G7+"|possessives|adverbs|nouns|verbs")};const j7={api:function(e){e.prototype.normalize=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light";return"string"===typeof e&&(e=H7[e]),Object.keys(e).forEach(t=>{U7.hasOwnProperty(t)&&U7[t](this,e[t])}),this}}},W7=function(e){let t=e.clauses().match("<Noun>"),n=t.match("@hasComma");return n=n.not("#Place"),n.found&&(t=t.splitAfter(n)),t=t.splitOn("#Expression"),t=t.splitOn("(he|she|we|you|they|i)"),t=t.splitOn("(#Noun|#Adjective) [(he|him|she|it)]",0),t=t.splitOn("[(he|him|she|it)] (#Determiner|#Value)",0),t=t.splitBefore("#Noun [(the|a|an)] #Adjective? #Noun",0),t=t.splitOn("[(here|there)] #Noun",0),t=t.splitOn("[#Noun] (here|there)",0),t=t.splitBefore("(our|my|their|your)"),t=t.splitOn("#Noun [#Determiner]",0),t=t.if("#Noun"),t},q7=["after","although","as if","as long as","as","because","before","even if","even though","ever since","if","in order that","provided that","since","so that","than","that","though","unless","until","what","whatever","when","whenever","where","whereas","wherever","whether","which","whichever","who","whoever","whom","whomever","whose"],X7=function(e){if(e.before("#Preposition$").found)return!0;if(!e.before().found)return!1;for(let t=0;t<q7.length;t+=1)if(e.has(q7[t]))return!0;return!1},K7=function(e,t){if(e.has("#Plural"))return!0;if(e.has("#Noun and #Noun"))return!0;if(e.has("(we|they)"))return!0;if(!0===t.has("(#Pronoun|#Place|#Value|#Person|#Uncountable|#Month|#WeekDay|#Holiday|#Possessive)"))return!1;if(e.has("#Singular"))return!1;let n=t.text("normal");return n.length>3&&n.endsWith("s")&&!n.endsWith("ss")},Y7=function(e){let t=function(e){let t=e.clone();return t=t.match("#Noun+"),t=t.remove("(#Adjective|#Preposition|#Determiner|#Value)"),t=t.not("#Possessive"),t=t.first(),t.found?t:e}(e);return{determiner:e.match("#Determiner").eq(0),adjectives:e.match("#Adjective"),number:e.values(),isPlural:K7(e,t),isSubordinate:X7(e),root:t}},J7=e=>e.text(),$7=e=>e.json({terms:!1,normal:!0}).map(e=>e.normal),Q7=function(e){if(!e.found)return null;let t=e.values(0);if(t.found){return(t.parse()[0]||{}).num}return null},Z7=function(e){let t=Y7(e);return{root:J7(t.root),number:Q7(t.number),determiner:J7(t.determiner),adjectives:$7(t.adjectives),isPlural:t.isPlural,isSubordinate:t.isSubordinate}},e9=function(e){return!e.has("^(#Uncountable|#ProperNoun|#Place|#Pronoun|#Acronym)+$")},t9={tags:!0},n9=function(e,t){if(!0===t.isPlural)return e;if(t.root.has("#Possessive")&&(t.root=t.root.possessives().strip()),!e9(t.root))return e;const{methods:n,model:r}=e.world,{toPlural:i}=n.two.transform.noun;let a=i(t.root.text({keepPunct:!1}),r);e.match(t.root).replaceWith(a,t9).tag("Plural","toPlural"),t.determiner.has("(a|an)")&&e.remove(t.determiner);let o=t.root.after("not? #Adverb+? [#Copula]",0);return o.found&&(o.has("is")?e.replace(o,"are"):o.has("was")&&e.replace(o,"were")),e},r9={tags:!0},i9=function(e,t){if(!1===t.isPlural)return e;const{methods:n,model:r}=e.world,{toSingular:i}=n.two.transform.noun;let a=i(t.root.text("normal"),r);return e.replace(t.root,a,r9).tag("Singular","toPlural"),e},a9=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Nouns"}parse(e){return this.getNth(e).map(Y7)}json(e){let t="object"===typeof e?e:{};return this.getNth(e).map(e=>{let n=e.toView().json(t)[0]||{};return t&&!1!==t.noun&&(n.noun=Z7(e)),n},[])}conjugate(e){const t=this.world.methods.two.transform.noun;return this.getNth(e).map(e=>{let n=Y7(e),r=n.root.compute("root").text("root"),i={Singular:r};return e9(n.root)&&(i.Plural=t.toPlural(r,this.model)),i.Singular===i.Plural&&delete i.Plural,i},[])}isPlural(e){let t=this.filter(e=>Y7(e).isPlural);return t.getNth(e)}isSingular(e){let t=this.filter(e=>!Y7(e).isPlural);return t.getNth(e)}adjectives(e){let t=this.update([]);return this.forEach(e=>{let n=Y7(e).adjectives;n.found&&(t=t.concat(n))}),t.getNth(e)}toPlural(e){return this.getNth(e).map(e=>n9(e,Y7(e)))}toSingular(e){return this.getNth(e).map(e=>{let t=Y7(e);return i9(e,t)})}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.nouns=function(e){let n=W7(this);return n=n.getNth(e),new t(this.document,n.pointer)}},o9={api:a9},s9=function(e,t){let n=e.match("#Fraction+");return n=n.filter(e=>!e.lookBehind("#Value and$").found),n=n.notIf("#Value seconds"),"number"===typeof t&&(n=n.eq(t)),n},u9=e=>{const t=[{reg:/^(minus|negative)[\s-]/i,mult:-1},{reg:/^(a\s)?half[\s-](of\s)?/i,mult:.5}];for(let n=0;n<t.length;n++)if(!0===t[n].reg.test(e))return{amount:t[n].mult,str:e.replace(t[n].reg,"")};return{amount:1,str:e}},l9={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90,twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24,hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,grand:1e3}},c9=(e,t)=>{if(l9.ones.hasOwnProperty(e)){if(t.ones||t.teens)return!1}else if(l9.teens.hasOwnProperty(e)){if(t.ones||t.teens||t.tens)return!1}else if(l9.tens.hasOwnProperty(e)&&(t.ones||t.teens||t.tens))return!1;return!0},h9=function(e){let t="0.";for(let n=0;n<e.length;n++){let r=e[n];if(!0===l9.ones.hasOwnProperty(r))t+=l9.ones[r];else if(!0===l9.teens.hasOwnProperty(r))t+=l9.teens[r];else if(!0===l9.tens.hasOwnProperty(r))t+=l9.tens[r];else{if(!0!==/^[0-9]$/.test(r))return 0;t+=r}}return parseFloat(t)},d9=e=>e=(e=(e=(e=(e=(e=(e=(e=e.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$\u20ac\xa5\xa3\xa2]/,"")).replace(/[%$\u20ac\xa5\xa3\xa2]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z\u00C0-\u00FF]{1,2})$/,"$1"),p9=/^([0-9,. ]+)\/([0-9,. ]+)$/,f9={"a few":3,"a couple":2,"a dozen":12,"two dozen":24,zero:0},m9=e=>Object.keys(e).reduce((t,n)=>t+=e[n],0),g9=function(e){if(!0===f9.hasOwnProperty(e))return f9[e];if("a"===e||"an"===e)return 1;const t=u9(e);let n=null,r={},i=0,a=!1;const o=(e=t.str).split(/[ -]/);for(let s=0;s<o.length;s++){let e=o[s];if(e=d9(e),!e||"and"===e)continue;if("-"===e||"negative"===e){a=!0;continue}if("-"===e.charAt(0)&&(a=!0,e=e.substring(1)),"point"===e)return i+=m9(r),i+=h9(o.slice(s+1,o.length)),i*=t.amount,i;const u=e.match(p9);if(u){const e=parseFloat(u[1].replace(/[, ]/g,"")),t=parseFloat(u[2].replace(/[, ]/g,""));t&&(i+=e/t||0)}else{if(l9.tens.hasOwnProperty(e)&&r.ones&&1===Object.keys(r).length&&(i=100*r.ones,r={}),!1===c9(e,r))return null;if(/^[0-9.]+$/.test(e))r.ones=parseFloat(e);else if(!0===l9.ones.hasOwnProperty(e))r.ones=l9.ones[e];else if(!0===l9.teens.hasOwnProperty(e))r.teens=l9.teens[e];else if(!0===l9.tens.hasOwnProperty(e))r.tens=l9.tens[e];else if(!0===l9.multiples.hasOwnProperty(e)){let t=l9.multiples[e];if(t===n)return null;if(100===t&&void 0!==o[s+1]){const e=o[s+1];l9.multiples[e]&&(t*=l9.multiples[e],s+=1)}null===n||t<n?(i+=(m9(r)||1)*t,n=t,r={}):(i+=m9(r),n=t,i=(i||1)*t,r={})}}}return i+=m9(r),i*=t.amount,i*=a?-1:1,0===i&&0===Object.keys(r).length?null:i},v9=/s$/,D9=function(e){let t=e.text("reduced");return g9(t)};let y9={half:2,halve:2,quarter:4};const E9=function(e){let t=function(e){let t=e.text("reduced");return y9.hasOwnProperty(t)?{numerator:1,denominator:y9[t]}:null}(e=e.clone())||function(e){let t=e.text("reduced").match(/^([-+]?[0-9]+)\/([-+]?[0-9]+)(st|nd|rd|th)?s?$/);return t&&t[1]&&t[0]?{numerator:Number(t[1]),denominator:Number(t[2])}:null}(e)||function(e){let t=e.match("[<num>#Value+] out of every? [<den>#Value+]");if(!0!==t.found)return null;let{num:n,den:r}=t.groups();return n&&r?(n=D9(n),r=D9(r),n&&r&&"number"===typeof n&&"number"===typeof r?{numerator:n,denominator:r}:null):null}(e)||function(e){let t=e.match("[<num>(#Cardinal|a)+] [<den>#Fraction+]");if(!0!==t.found)return null;let{num:n,den:r}=t.groups();n=n.has("a")?1:D9(n);let i=r.text("reduced");return v9.test(i)&&(i=i.replace(v9,""),r=r.replaceWith(i)),r=y9.hasOwnProperty(i)?y9[i]:D9(r),"number"===typeof n&&"number"===typeof r?{numerator:n,denominator:r}:null}(e)||function(e){let t=e.match("^#Ordinal$");if(!0!==t.found)return null;if(e.lookAhead("^of ."))return{numerator:1,denominator:D9(t)};return null}(e)||null;return null!==t&&t.numerator&&t.denominator&&(t.decimal=t.numerator/t.denominator,t.decimal=(e=>{let t=Math.round(1e3*e)/1e3;return 0===t&&0!==e?e:t})(t.decimal)),t},A9=function(e){if(e<1e6)return String(e);let t;return t="number"===typeof e?e.toFixed(0):e,-1===t.indexOf("e+")?t:t.replace(".","").split("e+").reduce(function(e,t){return e+Array(t-e.length+2).join(0)})},C9=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],_9=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],b9=[[1e24,"septillion"],[1e20,"hundred sextillion"],[1e21,"sextillion"],[1e20,"hundred quintillion"],[1e18,"quintillion"],[1e17,"hundred quadrillion"],[1e15,"quadrillion"],[1e14,"hundred trillion"],[1e12,"trillion"],[1e11,"hundred billion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],x9=function(e){let t=[];if(e>100)return t;for(let n=0;n<C9.length;n++)e>=C9[n][1]&&(e-=C9[n][1],t.push(C9[n][0]));return _9[e]&&t.push(_9[e]),t},F9=function(e){let t=e.num;if(0===t||"0"===t)return"zero";t>1e21&&(t=A9(t));let n=[];t<0&&(n.push("minus"),t=Math.abs(t));let r=function(e){let t=e,n=[];return b9.forEach(r=>{if(e>=r[0]){let e=Math.floor(t/r[0]);t-=e*r[0],e&&n.push({unit:r[1],count:e})}}),n}(t);for(let i=0;i<r.length;i++){let e=r[i].unit;"one"===e&&(e="",n.length>1&&n.push("and")),n=n.concat(x9(r[i].count)),n.push(e)}return n=n.concat((e=>{const t=["zero","one","two","three","four","five","six","seven","eight","nine"];let n=[],r=A9(e).match(/\.([0-9]+)/);if(!r||!r[0])return n;n.push("point");let i=r[0].split("");for(let a=0;a<i.length;a++)n.push(t[i[a]]);return n})(t)),n=n.filter(e=>e),0===n.length&&(n[0]=""),n.join(" ")},w9=function(e){if(!e.numerator||!e.denominator)return"";let t=F9({num:e.numerator}),n=F9({num:e.denominator});return"".concat(t," out of ").concat(n)},S9={one:"first",two:"second",three:"third",five:"fifth",eight:"eighth",nine:"ninth",twelve:"twelfth",twenty:"twentieth",thirty:"thirtieth",forty:"fortieth",fourty:"fourtieth",fifty:"fiftieth",sixty:"sixtieth",seventy:"seventieth",eighty:"eightieth",ninety:"ninetieth"},T9=e=>{let t=F9(e).split(" "),n=t[t.length-1];return S9.hasOwnProperty(n)?t[t.length-1]=S9[n]:t[t.length-1]=n.replace(/y$/,"i")+"th",t.join(" ")},M9=function(e){if(!e.numerator||!e.denominator)return"";let t=F9({num:e.numerator}),n=T9({num:e.denominator});return 2===e.denominator&&(n="half"),t&&n?(1!==e.numerator&&(n+="s"),"".concat(t," ").concat(n)):""},B9=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Fractions"}parse(e){return this.getNth(e).map(E9)}get(e){return this.getNth(e).map(E9)}json(e){return this.getNth(e).map(t=>{let n=t.toView().json(e)[0],r=E9(t);return n.fraction=r,n},[])}toDecimal(e){return this.getNth(e).forEach(e=>{let{decimal:t}=E9(e);(e=e.replaceWith(String(t),!0)).tag("NumericValue"),e.unTag("Fraction")}),this}toFraction(e){return this.getNth(e).forEach(e=>{let t=E9(e);if(t&&"number"===typeof t.numerator&&"number"===typeof t.denominator){let n="".concat(t.numerator,"/").concat(t.denominator);this.replace(e,n)}}),this}toOrdinal(e){return this.getNth(e).forEach(e=>{let t=E9(e),n=M9(t);e.after("^#Noun").found&&(n+=" of"),e.replaceWith(n)}),this}toCardinal(e){return this.getNth(e).forEach(e=>{let t=E9(e),n=w9(t);e.replaceWith(n)}),this}toPercentage(e){return this.getNth(e).forEach(e=>{let{decimal:t}=E9(e),n=100*t;n=Math.round(100*n)/100,e.replaceWith("".concat(n,"%"))}),this}}e.prototype.fractions=function(e){let n=s9(this);return n=n.getNth(e),new t(this.document,n.pointer)}},P9="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty",N9=function(e){let t=e.match("#Value+");if(t.has("#NumericValue #NumericValue")&&(t.has("#Value @hasComma #Value")?t.splitAfter("@hasComma"):t.has("#NumericValue #Fraction")?t.splitAfter("#NumericValue #Fraction"):t=t.splitAfter("#NumericValue")),t.has("#Value #Value #Value")&&!t.has("#Multiple")&&t.has("("+P9+") #Cardinal #Cardinal")&&(t=t.splitAfter("("+P9+") #Cardinal")),t.has("#Value #Value")){t.has("#NumericValue #NumericValue")&&(t=t.splitOn("#Year")),t.has("("+P9+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&&(t=t.splitAfter("("+P9+")"));let e=t.match("#Cardinal #Cardinal");if(e.found&&!t.has("(point|decimal|#Fraction)")&&!e.has("#Cardinal (#Multiple|point|decimal)")){let n=t.has("(".concat("one|two|three|four|five|six|seven|eight|nine",") (").concat(P9,")")),r=e.has("("+P9+") #Cardinal"),i=e.has("#Multiple #Value");n||r||i||e.terms().forEach(e=>{t=t.splitOn(e)})}t.match("#Ordinal #Ordinal").match("#TextValue").found&&!t.has("#Multiple")&&(t.has("("+P9+") #Ordinal")||(t=t.splitAfter("#Ordinal"))),t=t.splitBefore("#Ordinal [#Cardinal]",0),t.has("#TextValue #NumericValue")&&!t.has("("+P9+"|#Multiple)")&&(t=t.splitBefore("#TextValue #NumericValue"))}return t=t.splitAfter("#NumberRange"),t=t.splitBefore("#Year"),t},R9=function(e){if("string"===typeof e)return{num:g9(e)};let t=e.text("reduced"),n=e.growRight("#Unit").match("#Unit$").text("machine"),r=/[0-9],[0-9]/.test(e.text("text"));if(1===e.terms().length&&!e.has("#Multiple")){let i=function(e,t){let n=(e=e.replace(/,/g,"")).split(/([0-9.,]*)/),[r,i]=n,a=n.slice(2).join("");return""!==i&&t.length<2?(i=Number(i||e),"number"!==typeof i&&(i=null),a=a||"","st"!==a&&"nd"!==a&&"rd"!==a&&"th"!==a||(a=""),{prefix:r||"",num:i,suffix:a}):null}(t,e);if(null!==i)return i.hasComma=r,i.unit=n,i}let i=e.match("#Fraction{2,}$");i=!1===i.found?e.match("^#Fraction$"):i;let a=null;i.found&&(i.has("#Value and #Value #Fraction")&&(i=i.match("and #Value #Fraction")),a=E9(i),t=(e=(e=e.not(i)).not("and$")).text("reduced"));let o=0;return t&&(o=g9(t)||0),a&&a.decimal&&(o+=a.decimal),{hasComma:r,prefix:"",num:o,suffix:"",isOrdinal:e.has("#Ordinal"),isText:e.has("#TextValue"),isFraction:e.has("#Fraction"),isMoney:e.has("#Money"),unit:n}},L9=function(e){let t=e.num;if(!t&&0!==t)return null;let n=t%100;if(n>10&&n<20)return String(t)+"th";const r={0:"th",1:"st",2:"nd",3:"rd"};let i=A9(t),a=i.slice(i.length-1,i.length);return i+=r[a]?r[a]:"th",i},I9={"\xa2":"cents",$:"dollars","\xa3":"pounds","\xa5":"yen","\u20ac":"euros","\u20a1":"col\xf3n","\u0e3f":"baht","\u20ad":"kip","\u20a9":"won","\u20b9":"rupees","\u20bd":"ruble","\u20ba":"liras"},k9={"%":"percent","\xb0":"degrees"},O9=function(e){let t={suffix:"",prefix:e.prefix};return I9.hasOwnProperty(e.prefix)&&(t.suffix+=" "+I9[e.prefix],t.prefix=""),k9.hasOwnProperty(e.suffix)&&(t.suffix+=" "+k9[e.suffix]),t.suffix&&1===e.num&&(t.suffix=t.suffix.replace(/s$/,"")),!t.suffix&&e.suffix&&(t.suffix+=" "+e.suffix),t},U9=function(e,t){if("TextOrdinal"===t){let{prefix:t,suffix:n}=O9(e);return t+T9(e)+n}if("Ordinal"===t)return e.prefix+L9(e)+e.suffix;if("TextCardinal"===t){let{prefix:t,suffix:n}=O9(e);return t+F9(e)+n}let n=e.num;return e.hasComma&&(n=n.toLocaleString()),e.prefix+String(n)+e.suffix},z9=function(e){if("string"===typeof e||"number"===typeof e){let t={};return t[e]=!0,t}return t=e,"[object Array]"===Object.prototype.toString.call(t)?e.reduce((e,t)=>(e[t]=!0,e),{}):e||{};var t},V9=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=z9(t),e.filter(e=>{let{unit:n}=R9(e);return!(!n||!0!==t[n])})},G9=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Numbers"}parse(e){return this.getNth(e).map(R9)}get(e){return this.getNth(e).map(R9).map(e=>e.num)}json(e){let t="object"===typeof e?e:{};return this.getNth(e).map(e=>{let n=e.toView().json(t)[0],r=R9(e);return n.number={prefix:r.prefix,num:r.num,suffix:r.suffix,hasComma:r.hasComma,unit:r.unit},n},[])}units(){return this.growRight("#Unit").match("#Unit$")}isUnit(e){return V9(this,e)}isOrdinal(){return this.if("#Ordinal")}isCardinal(){return this.if("#Cardinal")}toNumber(){let e=this.map(e=>{if(!this.has("#TextValue"))return e;let t=R9(e);if(null===t.num)return e;let n=e.has("#Ordinal")?"Ordinal":"Cardinal",r=U9(t,n);return e.replaceWith(r,{tags:!0}),e.tag("NumericValue")});return new t(e.document,e.pointer)}toLocaleString(){return this.forEach(e=>{let t=R9(e);if(null===t.num)return;let n=t.num.toLocaleString();if(e.has("#Ordinal")){let e=U9(t,"Ordinal").match(/[a-z]+$/);e&&(n+=e[0]||"")}e.replaceWith(n,{tags:!0})}),this}toText(){let e=this.map(e=>{if(e.has("#TextValue"))return e;let t=R9(e);if(null===t.num)return e;let n=e.has("#Ordinal")?"TextOrdinal":"TextCardinal",r=U9(t,n);return e.replaceWith(r,{tags:!0}),e.tag("TextValue"),e});return new t(e.document,e.pointer)}toCardinal(){let e=this.map(e=>{if(!e.has("#Ordinal"))return e;let t=R9(e);if(null===t.num)return e;let n=e.has("#TextValue")?"TextCardinal":"Cardinal",r=U9(t,n);return e.replaceWith(r,{tags:!0}),e.tag("Cardinal"),e});return new t(e.document,e.pointer)}toOrdinal(){let e=this.map(e=>{if(e.has("#Ordinal"))return e;let t=R9(e);if(null===t.num)return e;let n=e.has("#TextValue")?"TextOrdinal":"Ordinal",r=U9(t,n);return e.replaceWith(r,{tags:!0}),e.tag("Ordinal"),e});return new t(e.document,e.pointer)}isEqual(e){return this.filter(t=>R9(t).num===e)}greaterThan(e){return this.filter(t=>R9(t).num>e)}lessThan(e){return this.filter(t=>R9(t).num<e)}between(e,t){return this.filter(n=>{let r=R9(n).num;return r>e&&r<t})}set(e){if(void 0===e)return this;"string"===typeof e&&(e=R9(e).num);let n=this.map(t=>{let n=R9(t);if(n.num=e,null===n.num)return t;let r=t.has("#Ordinal")?"Ordinal":"Cardinal";t.has("#TextValue")&&(r=t.has("#Ordinal")?"TextOrdinal":"TextCardinal");let i=U9(n,r);return n.hasComma&&"Cardinal"===r&&(i=Number(i).toLocaleString()),(t=t.not("#Currency")).replaceWith(i,{tags:!0}),t});return new t(n.document,n.pointer)}add(e){if(!e)return this;"string"===typeof e&&(e=R9(e).num);let n=this.map(t=>{let n=R9(t);if(null===n.num)return t;n.num+=e;let r=t.has("#Ordinal")?"Ordinal":"Cardinal";n.isText&&(r=t.has("#Ordinal")?"TextOrdinal":"TextCardinal");let i=U9(n,r);return t.replaceWith(i,{tags:!0}),t});return new t(n.document,n.pointer)}subtract(e,t){return this.add(-1*e,t)}increment(e){return this.add(1,e)}decrement(e){return this.add(-1,e)}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toNice=t.prototype.toLocaleString,t.prototype.isBetween=t.prototype.between,t.prototype.minus=t.prototype.subtract,t.prototype.plus=t.prototype.add,t.prototype.equals=t.prototype.isEqual,e.prototype.numbers=function(e){let n=N9(this);return n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.percentages=function(e){let n=N9(this);return n=n.filter(e=>e.has("#Percent")||e.after("^percent")),n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.money=function(e){let n=N9(this);return n=n.filter(e=>e.has("#Money")||e.after("^#Currency")),n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.values=e.prototype.numbers},H9={api:function(e){B9(e),G9(e)}},j9={people:!0,emails:!0,phoneNumbers:!0,places:!0},W9=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=Object.assign({},j9,e),!1!==e.people&&this.people().replaceWith("\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588"),!1!==e.emails&&this.emails().replaceWith("\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588"),!1!==e.places&&this.places().replaceWith("\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588"),!1!==e.phoneNumbers&&this.phoneNumbers().replaceWith("\u2588\u2588\u2588\u2588\u2588\u2588\u2588"),this},q9={api:function(e){e.prototype.redact=W9}},X9=q9,K9=function(e){const t=/\?/,{document:n}=e;return e.filter(e=>{let r=e.docs[0]||[],i=r[r.length-1];return!(!i||n[i.index[0]].length!==r.length)&&(!!t.test(i.post)||function(e){let t=e.clauses();return!/\.\.$/.test(e.out("text"))&&(!e.has("^#QuestionWord")||!e.has("@hasComma"))&&(!!e.has("or not$")||!!e.has("^#QuestionWord")||!!e.has("^(do|does|did|is|was|can|could|will|would|may) #Noun")||!!e.has("^(have|must) you")||!!t.has("(do|does|is|was) #Noun+ #Adverb? (#Adjective|#Infinitive)$"))}(e))})},Y9=function(e){let t=e;return 1===t.length?t:(t=t.if("#Verb"),1===t.length?t:(t=t.ifNo("(after|although|as|because|before|if|since|than|that|though|when|whenever|where|whereas|wherever|whether|while|why|unless|until|once)"),t=t.ifNo("^even (if|though)"),t=t.ifNo("^so that"),t=t.ifNo("^rather than"),t=t.ifNo("^provided that"),1===t.length?t:(t=t.ifNo("(that|which|whichever|who|whoever|whom|whose|whomever)"),1===t.length?t:(t=t.ifNo("(^despite|^during|^before|^through|^throughout)"),1===t.length?t:(t=t.ifNo("^#Gerund"),1===t.length?t:(0===t.length&&(t=e),t.eq(0)))))))},J9=function(e){let t=null;return e.has("#PastTense")?t="PastTense":e.has("#FutureTense")?t="FutureTense":e.has("#PresentTense")&&(t="PresentTense"),{tense:t}},$9=function(e){let t=e.clauses(),n=Y9(t).chunks(),r=e.none(),i=e.none(),a=e.none();return n.forEach((e,t)=>{0!==t||e.has("<Verb>")?i.found||!e.has("<Verb>")?i.found&&(a=a.concat(e)):i=e:r=e}),i.found&&!r.found&&(r=i.before("<Noun>+").first()),{subj:r,verb:i,pred:a,grammar:J9(i)}},Q9=function(e){let t=e.verbs(),n=t.eq(0);if(n.has("#PastTense"))return e;if(n.toPastTense(),t.length>1){t=t.slice(1),t=t.filter(e=>!e.lookBehind("to$").found),t=t.if("#PresentTense"),t=t.notIf("#Gerund");let n=e.match("to #Verb+ #Conjunction #Verb").terms();t=t.not(n),t.found&&t.verbs().toPastTense()}return e},Z9=function(e){let t=e.verbs();return t.eq(0).toPresentTense(),t.length>1&&(t=t.slice(1),t=t.filter(e=>!e.lookBehind("to$").found),t=t.notIf("#Gerund"),t.found&&t.verbs().toPresentTense()),e},eee=function(e){let t=e.verbs();if(t.eq(0).toFutureTense(),t=(e=e.fullSentence()).verbs(),t.length>1){t=t.slice(1);let e=t.filter(e=>!e.lookBehind("to$").found&&(!!e.has("#Copula #Gerund")||!e.has("#Gerund")&&(!!e.has("#Copula")||!(e.has("#PresentTense")&&!e.has("#Infinitive")&&e.lookBefore("(he|she|it|that|which)$").found))));e.found&&e.forEach(e=>{if(e.has("#Copula"))return e.match("was").replaceWith("is"),void e.match("is").replaceWith("will be");e.toInfinitive()})}return e},tee=function(e){return e.verbs().toInfinitive(),e},nee=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Sentences"}json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.map(t=>{let n=t.toView().json(e)[0]||{},{subj:r,verb:i,pred:a,grammar:o}=$9(t);return n.sentence={subject:r.text("normal"),verb:i.text("normal"),predicate:a.text("normal"),grammar:o},n},[])}toPastTense(e){return this.getNth(e).map(e=>{let t=$9(e);return Q9(e,t)})}toPresentTense(e){return this.getNth(e).map(e=>{let t=$9(e);return Z9(e,t)})}toFutureTense(e){return this.getNth(e).map(e=>{let t=$9(e);return e=eee(e,t)})}toInfinitive(e){return this.getNth(e).map(e=>{let t=$9(e);return tee(e,t)})}toNegative(e){return this.getNth(e).map(e=>{$9(e);return function(e){return e.verbs().first().toNegative().compute("chunks"),e}(e)})}toPositive(e){return this.getNth(e).map(e=>{$9(e);return function(e){return e.verbs().first().toPositive().compute("chunks"),e}(e)})}isQuestion(e){return this.questions(e)}isExclamation(e){let t=this.filter(e=>e.lastTerm().has("@hasExclamation"));return t.getNth(e)}isStatement(e){let t=this.filter(e=>!e.isExclamation().found&&!e.isQuestion().found);return t.getNth(e)}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toPresent=t.prototype.toPresentTense,t.prototype.toPast=t.prototype.toPastTense,t.prototype.toFuture=t.prototype.toFutureTense;const n={sentences:function(e){let n=this.map(e=>e.fullSentence());return n=n.getNth(e),new t(this.document,n.pointer)},questions:function(e){return K9(this).getNth(e)}};Object.assign(e.prototype,n)},ree={api:nee},iee=function(e){let t=e.splitAfter("@hasComma");t=t.match("#Honorific+? #Person+");let n=t.match("#Possessive").notIf("(his|her)");return t=t.splitAfter(n),t},aee=function(e){let t={};t.firstName=e.match("#FirstName+"),t.lastName=e.match("#LastName+"),t.honorific=e.match("#Honorific+");let n=t.lastName,r=t.firstName;return r.found&&n.found||r.found||n.found||!e.has("^#Honorific .$")||(t.lastName=e.match(".$")),t},oee="male",see="female",uee={mr:oee,mrs:see,miss:see,madam:see,king:oee,queen:see,duke:oee,duchess:see,baron:oee,baroness:see,count:oee,countess:see,prince:oee,princess:see,sire:oee,dame:see,lady:see,ayatullah:oee,congressman:oee,congresswoman:see,"first lady":see,mx:null},lee=function(e,t){let{firstName:n,honorific:r}=e;if(n.has("#FemaleName"))return see;if(n.has("#MaleName"))return oee;if(r.found){let e=r.text("normal");if(e=e.replace(/\./g,""),uee.hasOwnProperty(e))return uee[e];if(/^her /.test(e))return see;if(/^his /.test(e))return oee}let i=t.after();if(!i.has("#Person")&&i.has("#Pronoun")){let e=i.match("#Pronoun");if(e.has("(they|their)"))return null;let t=e.has("(he|his)"),n=e.has("(she|her|hers)");if(t&&!n)return oee;if(n&&!t)return see}return null},cee=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="People"}parse(e){return this.getNth(e).map(aee)}json(e){let t="object"===typeof e?e:{};return this.getNth(e).map(e=>{let n=e.toView().json(t)[0],r=aee(e);return n.person={firstName:r.firstName.text("normal"),lastName:r.lastName.text("normal"),honorific:r.honorific.text("normal"),presumed_gender:lee(r,e)},n},[])}presumedMale(){return this.filter(e=>e.has("(#MaleName|mr|mister|sr|jr|king|pope|prince|sir)"))}presumedFemale(){return this.filter(e=>e.has("(#FemaleName|mrs|miss|queen|princess|madam)"))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.people=function(e){let n=iee(this);return n=n.getNth(e),new t(this.document,n.pointer)}},hee=function(e){let t=e.match("(#Place|#Address)+"),n=t.match("@hasComma");return n=n.filter(e=>!!e.has("(asia|africa|europe|america)$")||(!e.has("(#City|#Region|#ProperNoun)$")||!e.after("^(#Country|#Region)").found)),t=t.splitAfter(n),t},dee=function(e){e.prototype.places=function(t){let n=hee(this);return n=n.getNth(t),new e(this.document,n.pointer)}},pee=function(e){e.prototype.organizations=function(e){return this.match("#Organization+").getNth(e)}},fee=function(e){let t=this.clauses(),n=t.people();return n=n.concat(t.places()),n=n.concat(t.organizations()),n=n.not("(someone|man|woman|mother|brother|sister|father)"),n=n.sort("seq"),n=n.getNth(e),n},mee=function(e){e.prototype.topics=fee},gee={api:function(e){cee(e),dee(e),pee(e),mee(e)}},vee=function(e){let t=e.match("<Verb>");return t=t.not("#Conjunction"),t=t.not("#Preposition"),t=t.splitAfter("@hasComma"),t=t.splitAfter("[(do|did|am|was|is|will)] (is|was)",0),t=t.splitBefore("(#Verb && !#Copula) [being] #Verb",0),t=t.splitBefore("#Verb [to be] #Verb",0),t=t.splitAfter("[help] #PresentTense",0),t=t.splitBefore("(#PresentTense|#PastTense) [#Copula]$",0),t=t.splitBefore("(#PresentTense|#PastTense) [will be]$",0),t=t.splitBefore("(#PresentTense|#PastTense) [(had|has)]",0),t=t.not("#Reflexive$"),t=t.not("#Adjective"),t=t.splitAfter("[#PastTense] #PastTense",0),t=t.splitAfter("[#PastTense] #Auxiliary+ #PastTense",0),t=t.splitAfter("#Copula [#Gerund] #PastTense",0),t=t.if("#Verb"),t.has("(#Verb && !#Auxiliary) #Adverb+? #Copula")&&(t=t.splitBefore("#Copula")),t},Dee=function(e){let t=e;return e.wordCount()>1&&(t=e.not("(#Negative|#Auxiliary|#Modal|#Adverb|#Prefix)")),t.length>1&&!t.has("#Phrasal #Particle")&&(t=t.last()),t=t.not("(want|wants|wanted) to"),t.found||(t=e.not("#Negative")),t},yee=function(e,t){let n={pre:e.none(),post:e.none()};if(!e.has("#Adverb"))return n;let r=e.splitOn(t);return 3===r.length?{pre:r.eq(0).adverbs(),post:r.eq(2).adverbs()}:r.eq(0).isDoc(t)?(n.post=r.eq(1).adverbs(),n):(n.pre=r.eq(0).adverbs(),n)},Eee=function(e,t){let n=e.splitBefore(t);if(n.length<=1)return e.none();let r=n.eq(0);return r=r.not("(#Adverb|#Negative|#Prefix)"),r},Aee=function(e){return e.match("#Negative")},Cee=function(e){if(!e.has("(#Particle|#PhrasalVerb)"))return{verb:e.none(),particle:e.none()};let t=e.match("#Particle$");return{verb:e.not(t),particle:t}},_ee=function(e){let t=e.clone();t.contractions().expand();const n=Dee(t);return{root:n,prefix:t.match("#Prefix"),adverbs:yee(t,n),auxiliary:Eee(t,n),negative:Aee(t),phrasal:Cee(n)}},bee={tense:"PresentTense"},xee={conditional:!0},Fee={tense:"FutureTense"},wee={progressive:!0},See={tense:"PastTense"},Tee={complete:!0,progressive:!1},Mee={passive:!0},Bee=function(e){let t={};return e.forEach(e=>{Object.assign(t,e)}),t},Pee={imperative:[["#Imperative",[]]],"want-infinitive":[["^(want|wants|wanted) to #Infinitive$",[bee]],["^wanted to #Infinitive$",[See]],["^will want to #Infinitive$",[Fee]]],"gerund-phrase":[["^#PastTense #Gerund$",[See]],["^#PresentTense #Gerund$",[bee]],["^#Infinitive #Gerund$",[bee]],["^will #Infinitive #Gerund$",[Fee]],["^have #PastTense #Gerund$",[See]],["^will have #PastTense #Gerund$",[See]]],"simple-present":[["^#PresentTense$",[bee]],["^#Infinitive$",[bee]]],"simple-past":[["^#PastTense$",[See]]],"simple-future":[["^will #Adverb? #Infinitive",[Fee]]],"present-progressive":[["^(is|are|am) #Gerund$",[bee,wee]]],"past-progressive":[["^(was|were) #Gerund$",[See,wee]]],"future-progressive":[["^will be #Gerund$",[Fee,wee]]],"present-perfect":[["^(has|have) #PastTense$",[See,Tee]]],"past-perfect":[["^had #PastTense$",[See,Tee]],["^had #PastTense to #Infinitive",[See,Tee]]],"future-perfect":[["^will have #PastTense$",[Fee,Tee]]],"present-perfect-progressive":[["^(has|have) been #Gerund$",[See,wee]]],"past-perfect-progressive":[["^had been #Gerund$",[See,wee]]],"future-perfect-progressive":[["^will have been #Gerund$",[Fee,wee]]],"passive-past":[["(got|were|was) #Passive",[See,Mee]],["^(was|were) being #Passive",[See,Mee]],["^(had|have) been #Passive",[See,Mee]]],"passive-present":[["^(is|are|am) #Passive",[bee,Mee]],["^(is|are|am) being #Passive",[bee,Mee]],["^has been #Passive",[bee,Mee]]],"passive-future":[["will have been #Passive",[Fee,Mee,xee]],["will be being? #Passive",[Fee,Mee,xee]]],"present-conditional":[["would be #PastTense",[bee,xee]]],"past-conditional":[["would have been #PastTense",[See,xee]]],"auxiliary-future":[["(is|are|am|was) going to (#Infinitive|#PresentTense)",[Fee]]],"auxiliary-past":[["^did #Infinitive$",[See,{plural:!1}]],["^used to #Infinitive$",[See,Tee]]],"auxiliary-present":[["^(does|do) #Infinitive$",[bee,Tee,{plural:!0}]]],"modal-past":[["^(could|must|should|shall) have #PastTense$",[See]]],"modal-infinitive":[["^#Modal #Infinitive$",[]]],infinitive:[["^#Infinitive$",[]]]};let Nee=[];Object.keys(Pee).map(e=>{Pee[e].forEach(t=>{Nee.push({name:e,match:t[0],data:Bee(t[1])})})});const Ree=Nee,Lee=function(e,t){let n={};e=function(e,t){return e=e.clone(),t.adverbs.post&&t.adverbs.post.found&&e.remove(t.adverbs.post),t.adverbs.pre&&t.adverbs.pre.found&&e.remove(t.adverbs.pre),e.has("#Negative")&&(e=e.remove("#Negative")),e.has("#Prefix")&&(e=e.remove("#Prefix")),t.root.has("#PhrasalVerb #Particle")&&e.remove("#Particle$"),e.not("#Adverb")}(e,t);for(let r=0;r<Ree.length;r+=1){let t=Ree[r];if(!0===e.has(t.match)){n.form=t.name,Object.assign(n,t.data);break}}return n.form||e.has("^#Verb$")&&(n.form="infinitive"),n.tense||(n.tense=t.root.has("#PastTense")?"PastTense":"PresentTense"),n.copula=t.root.has("#Copula"),n.isInfinitive=function(e){if(e.has("#Infinitive")&&e.growLeft("to").has("^to #Infinitive"))return!0;return!1}(e),n},Iee=function(e){if(e.length<=1)return!1;return(e.parse()[0]||{}).isSubordinate},kee=function(e,t){return!!t.has("(are|were|does)")||(!!e.has("(those|they|we)")||!(!e.found||!e.isPlural)&&e.isPlural().found)},Oee=function(e){let t=function(e){let t=e.before();t=function(e){let t=e.clauses();return t=t.filter((e,t)=>!e.has("^(if|unless|while|but|for|per|at|by|that|which|who|from)")&&!(t>0&&e.has("^#Verb . #Noun+$"))&&!(t>0&&e.has("^#Adverb"))),0===t.length?e:t}(t);let n=t.nouns(),r=n.last(),i=r.match("(i|he|she|we|you|they)");if(i.found)return i.nouns();let a=n.if("^(that|this|those)");return a.found||!1===n.found&&(a=t.match("^(that|this|those)"),a.found)?a:(r=n.last(),Iee(r)&&(n.remove(r),r=n.last()),Iee(r)&&(n.remove(r),r=n.last()),r)}(e);return{subject:t,plural:kee(t,e)}},Uee=e=>e,zee=(e,t)=>{let n=Oee(e,t),r=n.subject;return!(!r.has("i")&&!r.has("we"))||n.plural},Vee=function(e,t){if(e.has("were"))return"are";let{subject:n,plural:r}=Oee(e,t);return n.has("i")?"am":n.has("we")||r?"are":"is"},Gee=function(e,t){let n=Oee(e,t),r=n.subject;return r.has("i")||r.has("we")||n.plural?"do":"does"},Hee=function(e){return e.has("#Infinitive")?"Infinitive":e.has("#Participle")?"Participle":e.has("#PastTense")?"PastTense":e.has("#Gerund")?"Gerund":e.has("#PresentTense")?"PresentTense":void 0},jee=function(e,t){const{toInfinitive:n}=e.methods.two.transform.verb;let r=t.root.text({keepPunct:!1});return r=n(r,e.model,Hee(e)),r&&e.replace(t.root,r),e},Wee=e=>e.has("will not")?e.replace("will not","have not"):e.remove("will"),qee=function(e){if(!e||!e.isView)return[];return e.json({normal:!0,terms:!1,text:!1}).map(e=>e.normal)},Xee=function(e){return e&&e.isView?e.text("normal"):""},Kee=function(e){const{toInfinitive:t}=e.methods.two.transform.verb;return t(e.text("normal"),e.model,Hee(e))},Yee=function(e){let t=_ee(e);e=e.clone().toView();const n=Lee(e,t);return{root:t.root.text(),preAdverbs:qee(t.adverbs.pre),postAdverbs:qee(t.adverbs.post),auxiliary:Xee(t.auxiliary),negative:t.negative.found,prefix:Xee(t.prefix),infinitive:Kee(t.root),grammar:n}},Jee={tags:!0},$ee=function(e,t){const{toInfinitive:n}=e.methods.two.transform.verb,{root:r,auxiliary:i}=t;let a=i.terms().harden(),o=r.text("normal");if(o=n(o,e.model,Hee(r)),o&&e.replace(r,o,Jee).tag("Verb").firstTerm().tag("Infinitive"),a.found&&e.remove(a),t.negative.found){e.has("not")||e.prepend("not");let n=Gee(e,t);e.prepend(n)}return e.fullSentence().compute(["freeze","lexicon","preTagger","postTagger","unfreeze","chunks"]),e},Qee={tags:!0},Zee={noAux:(e,t)=>(t.auxiliary.found&&(e=e.remove(t.auxiliary)),e),simple:(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;if(i.has("#Modal"))return e;let a=i.text({keepPunct:!1});return a=r(a,e.model,Hee(i)),a=n(a,e.model).PastTense,a="been"===a?"was":a,"was"===a&&(a=((e,t)=>{let{subject:n,plural:r}=Oee(e,t);return r||n.has("we")?"were":"was"})(e,t)),a&&e.replace(i,a,Qee),e},both:function(e,t){return t.negative.found?(e.replace("will","did"),e):(e=Zee.simple(e,t),e=Zee.noAux(e,t))},hasHad:e=>(e.replace("has","had",Qee),e),hasParticiple:(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let a=i.text("normal");return a=r(a,e.model,Hee(i)),n(a,e.model).Participle}},ete={infinitive:Zee.simple,"simple-present":Zee.simple,"simple-past":Uee,"simple-future":Zee.both,"present-progressive":e=>(e.replace("are","were",Qee),e.replace("(is|are|am)","was",Qee),e),"past-progressive":Uee,"future-progressive":(e,t)=>(e.match(t.root).insertBefore("was"),e.remove("(will|be)"),e),"present-perfect":Zee.hasHad,"past-perfect":Uee,"future-perfect":(e,t)=>(e.match(t.root).insertBefore("had"),e.has("will")&&(e=Wee(e)),e.remove("have"),e),"present-perfect-progressive":Zee.hasHad,"past-perfect-progressive":Uee,"future-perfect-progressive":e=>(e.remove("will"),e.replace("have","had",Qee),e),"passive-past":e=>(e.replace("have","had",Qee),e),"passive-present":e=>(e.replace("(is|are)","was",Qee),e),"passive-future":(e,t)=>(t.auxiliary.has("will be")&&(e.match(t.root).insertBefore("had been"),e.remove("(will|be)")),t.auxiliary.has("will have been")&&(e.replace("have","had",Qee),e.remove("will")),e),"present-conditional":e=>(e.replace("be","have been"),e),"past-conditional":Uee,"auxiliary-future":e=>(e.replace("(is|are|am)","was",Qee),e),"auxiliary-past":Uee,"auxiliary-present":e=>(e.replace("(do|does)","did",Qee),e),"modal-infinitive":(e,t)=>(e.has("can")?e.replace("can","could",Qee):(Zee.simple(e,t),e.match("#Modal").insertAfter("have").tag("Auxiliary")),e),"modal-past":Uee,"want-infinitive":e=>(e.replace("(want|wants)","wanted",Qee),e.remove("will"),e),"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),Zee.simple(e,t),Wee(e),e)},tte=function(e,t,n){return ete.hasOwnProperty(n)?((e=ete[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e},nte=function(e,t){let n=Oee(e,t),r=n.subject;return r.has("(i|we|you)")?"have":!1===n.plural||r.has("he")||r.has("she")||r.has("#Person")?"has":"have"},rte=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,{root:i,auxiliary:a}=t;if(i.has("#Modal"))return e;let o=i.text({keepPunct:!1});o=r(o,e.model,Hee(i));let s=n(o,e.model);if(o=s.Participle||s.PastTense,o){e=e.replace(i,o);let n=nte(e,t);e.prepend(n).match(n).tag("Auxiliary"),e.remove(a)}return e},ite={infinitive:rte,"simple-present":rte,"simple-future":(e,t)=>e.replace("will",nte(e,t)),"present-perfect":Uee,"past-perfect":Uee,"future-perfect":(e,t)=>e.replace("will have",nte(e,t)),"present-perfect-progressive":Uee,"past-perfect-progressive":Uee,"future-perfect-progressive":Uee},ate=function(e,t,n){return ite.hasOwnProperty(n)?((e=ite[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):((e=rte(e,t)).fullSentence().compute(["tagger","chunks"]),e)},ote={tags:!0},ste=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let a=i.text("normal");return a=r(a,e.model,Hee(i)),!1===zee(e,t)&&(a=n(a,e.model).PresentTense),i.has("#Copula")&&(a=Vee(e,t)),a&&(e=e.replace(i,a,ote)).not("#Particle").tag("PresentTense"),e},ute=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let a=i.text("normal");return a=r(a,e.model,Hee(i)),!1===zee(e,t)&&(a=n(a,e.model).Gerund),a&&(e=e.replace(i,a,ote)).not("#Particle").tag("Gerund"),e},lte={infinitive:ste,"simple-present":(e,t)=>{const{conjugate:n}=e.methods.two.transform.verb;let{root:r}=t;if(!r.has("#Infinitive"))return ste(e,t);{let i=Oee(e,t).subject;if(zee(e,t)||i.has("i"))return e;let a=r.text("normal"),o=n(a,e.model).PresentTense;a!==o&&e.replace(r,o,ote)}return e},"simple-past":ste,"simple-future":(e,t)=>{const{root:n,auxiliary:r}=t;if(r.has("will")&&n.has("be")){let r=Vee(e,t);e.replace(n,r),(e=e.remove("will")).replace("not "+r,r+" not")}else ste(e,t),e=e.remove("will");return e},"present-progressive":Uee,"past-progressive":(e,t)=>{let n=Vee(e,t);return e.replace("(were|was)",n,ote)},"future-progressive":e=>(e.match("will").insertBefore("is"),e.remove("be"),e.remove("will")),"present-perfect":(e,t)=>(ste(e,t),e=e.remove("(have|had|has)")),"past-perfect":(e,t)=>{let n=Oee(e,t).subject;return zee(e,t)||n.has("i")?((e=jee(e,t)).remove("had"),e):(e.replace("had","has",ote),e)},"future-perfect":e=>(e.match("will").insertBefore("has"),e.remove("have").remove("will")),"present-perfect-progressive":Uee,"past-perfect-progressive":e=>e.replace("had","has",ote),"future-perfect-progressive":e=>(e.match("will").insertBefore("has"),e.remove("have").remove("will")),"passive-past":(e,t)=>{let n=Vee(e,t);return e.has("(had|have|has)")&&e.has("been")?(e.replace("(had|have|has)",n,ote),e.replace("been","being"),e):e.replace("(got|was|were)",n)},"passive-present":Uee,"passive-future":e=>(e.replace("will","is"),e.replace("be","being")),"present-conditional":Uee,"past-conditional":e=>(e.replace("been","be"),e.remove("have")),"auxiliary-future":(e,t)=>(ute(e,t),e.remove("(going|to)"),e),"auxiliary-past":(e,t)=>{if(t.auxiliary.has("did")){let n=Gee(e,t);return e.replace(t.auxiliary,n),e}return ute(e,t),e.replace(t.auxiliary,"is"),e},"auxiliary-present":Uee,"modal-infinitive":Uee,"modal-past":(e,t)=>(((e,t)=>{const{toInfinitive:n}=e.methods.two.transform.verb,r=t.root;let i=t.root.text("normal");i=n(i,e.model,Hee(r)),i&&(e=e.replace(t.root,i,ote))})(e,t),e.remove("have")),"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),ste(e,t),e.remove("(will|have)")),"want-infinitive":(e,t)=>{let n="wants";return zee(e,t)&&(n="want"),e.replace("(want|wanted|wants)",n,ote),e.remove("will"),e}},cte=function(e,t,n){return lte.hasOwnProperty(n)?((e=lte[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e},hte={tags:!0},dte=(e,t)=>{const{toInfinitive:n}=e.methods.two.transform.verb,{root:r,auxiliary:i}=t;if(r.has("#Modal"))return e;let a=r.text("normal");return a=n(a,e.model,Hee(r)),a&&(e=e.replace(r,a,hte)).not("#Particle").tag("Verb"),e.prepend("will").match("will").tag("Auxiliary"),e.remove(i),e},pte=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,{root:i,auxiliary:a}=t;let o=i.text("normal");return o=r(o,e.model,Hee(i)),o&&(o=n(o,e.model).Gerund,e.replace(i,o,hte),e.not("#Particle").tag("PresentTense")),e.remove(a),e.prepend("will be").match("will be").tag("Auxiliary"),e},fte={infinitive:dte,"simple-present":dte,"simple-past":dte,"simple-future":Uee,"present-progressive":pte,"past-progressive":pte,"future-progressive":Uee,"present-perfect":e=>(e.match("(have|has)").replaceWith("will have"),e),"past-perfect":e=>e.replace("(had|has)","will have"),"future-perfect":Uee,"present-perfect-progressive":e=>e.replace("has","will have"),"past-perfect-progressive":e=>e.replace("had","will have"),"future-perfect-progressive":Uee,"passive-past":e=>e.has("got")?e.replace("got","will get"):e.has("(was|were)")?(e.replace("(was|were)","will be"),e.remove("being")):e.has("(have|has|had) been")?e.replace("(have|has|had) been","will be"):e,"passive-present":e=>(e.replace("being","will be"),e.remove("(is|are|am)"),e),"passive-future":Uee,"present-conditional":e=>e.replace("would","will"),"past-conditional":e=>e.replace("would","will"),"auxiliary-future":Uee,"auxiliary-past":e=>e.has("used")&&e.has("to")?(e.replace("used","will"),e.remove("to")):(e.replace("did","will"),e),"auxiliary-present":e=>e.replace("(do|does)","will"),"modal-infinitive":Uee,"modal-past":Uee,"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),dte(e,t),e.remove("(had|have)")),"want-infinitive":e=>(e.replace("(want|wants|wanted)","will want"),e)},mte=function(e,t,n){return e.has("will")||e.has("going to")?e:fte.hasOwnProperty(n)?((e=fte[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e},gte={tags:!0},vte=function(e,t){const{toInfinitive:n,conjugate:r}=e.methods.two.transform.verb,{root:i,auxiliary:a}=t;if(e.has("#Gerund"))return e;let o=i.text("normal");o=n(o,e.model,Hee(i));let s=r(o,e.model).Gerund;if(s){let n=Vee(e,t);e.replace(i,s,gte),e.remove(a),e.prepend(n)}return e.replace("not is","is not"),e.replace("not are","are not"),e.fullSentence().compute(["tagger","chunks"]),e},Dte={tags:!0},yte=function(e,t){let n=Gee(e,t);return e.prepend(n+" not"),e},Ete=function(e){let t=e.match("be");return t.found?(t.prepend("not"),e):(t=e.match("(is|was|am|are|will|were)"),t.found?(t.append("not"),e):e)},Ate=e=>e.has("(is|was|am|are|will|were|be)"),Cte={"simple-present":(e,t)=>!0===Ate(e)?Ete(e):(e=jee(e,t),e=yte(e,t)),"simple-past":(e,t)=>!0===Ate(e)?Ete(e):((e=jee(e,t)).prepend("did not"),e),imperative:e=>(e.prepend("do not"),e),infinitive:(e,t)=>!0===Ate(e)?Ete(e):yte(e,t),"passive-past":e=>{if(e.has("got"))return e.replace("got","get",Dte),e.prepend("did not"),e;let t=e.match("(was|were|had|have)");return t.found&&t.append("not"),e},"auxiliary-past":e=>{if(e.has("used"))return e.prepend("did not"),e;let t=e.match("(did|does|do)");return t.found&&t.append("not"),e},"want-infinitive":(e,t)=>e=(e=yte(e,t)).replace("wants","want",Dte)},_te=function(e,t,n){if(e.has("#Negative"))return e;if(Cte.hasOwnProperty(n))return e=Cte[n](e,t);let r=e.matchOne("be");return r.found?(r.prepend("not"),e):!0===Ate(e)?Ete(e):(r=e.matchOne("(will|had|have|has|did|does|do|#Modal)"),r.found?(r.append("not"),e):e)},bte=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Verbs"}parse(e){return this.getNth(e).map(_ee)}json(e,t){let n=this.getNth(t).map(t=>{let n=t.toView().json(e)[0]||{};return n.verb=Yee(t),n},[]);return n}subjects(e){return this.getNth(e).map(e=>{let t=_ee(e);return Oee(e,t).subject})}adverbs(e){return this.getNth(e).map(e=>e.match("#Adverb"))}isSingular(e){return this.getNth(e).filter(e=>!0!==Oee(e).plural)}isPlural(e){return this.getNth(e).filter(e=>!0===Oee(e).plural)}isImperative(e){return this.getNth(e).filter(e=>e.has("#Imperative"))}toInfinitive(e){return this.getNth(e).map(e=>{let t=_ee(e),n=Lee(e,t);return $ee(e,t,n.form)})}toPresentTense(e){return this.getNth(e).map(e=>{let t=_ee(e),n=Lee(e,t);return n.isInfinitive?e:cte(e,t,n.form)})}toPastTense(e){return this.getNth(e).map(e=>{let t=_ee(e),n=Lee(e,t);return n.isInfinitive?e:tte(e,t,n.form)})}toFutureTense(e){return this.getNth(e).map(e=>{let t=_ee(e),n=Lee(e,t);return n.isInfinitive?e:mte(e,t,n.form)})}toGerund(e){return this.getNth(e).map(e=>{let t=_ee(e),n=Lee(e,t);return n.isInfinitive?e:vte(e,t,n.form)})}toPastParticiple(e){return this.getNth(e).map(e=>{let t=_ee(e),n=Lee(e,t);return n.isInfinitive?e:ate(e,t,n.form)})}conjugate(e){const{conjugate:t,toInfinitive:n}=this.world.methods.two.transform.verb;return this.getNth(e).map(e=>{let r=_ee(e),i=Lee(e,r);"imperative"===i.form&&(i.form="simple-present");let a=r.root.text("normal");if(!r.root.has("#Infinitive")){let t=Hee(r.root);a=n(a,e.model,t)||a}return t(a,e.model)},[])}isNegative(){return this.if("#Negative")}isPositive(){return this.ifNo("#Negative")}toPositive(){let e=this.match("do not #Verb");return e.found&&e.remove("do not"),this.remove("#Negative")}toNegative(e){return this.getNth(e).map(e=>{let t=_ee(e),n=Lee(e,t);return _te(e,t,n.form)})}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toPast=t.prototype.toPastTense,t.prototype.toPresent=t.prototype.toPresentTense,t.prototype.toFuture=t.prototype.toFutureTense,e.prototype.verbs=function(e){let n=vee(this);return n=n.getNth(e),new t(this.document,n.pointer)}},xte={api:bte},Fte=function(e,t){let n=t.match(e);if(n.found){let e=n.pronouns().refersTo();if(e.found)return e}return t.none()},wte=function(e){if(!e.found)return e;let[t]=e.fullPointer[0];return t&&t>0?e.update([[t-1]]):e.none()},Ste=function(e,t){let n=e.people();return n=function(e,t){return"m"===t?e.filter(e=>!e.presumedFemale().found):"f"===t?e.filter(e=>!e.presumedMale().found):e}(n,t),n.found?n.last():(n=e.nouns("#Actor"),n.found?n.last():"f"===t?Fte("(she|her|hers)",e):"m"===t?Fte("(he|him|his)",e):e.none())},Tte=function(e){let t=e.nouns(),n=t.isPlural().notIf("#Pronoun");if(n.found)return n.last();let r=Fte("(they|their|theirs)",e);return r.found?r:(n=t.match("(somebody|nobody|everybody|anybody|someone|noone|everyone|anyone)"),n.found?n.last():e.none())},Mte=function(e,t){let n=e.before(),r=t(n);return r.found?r:(n=wte(e),r=t(n),r.found?r:(n=wte(n),r=t(n),r.found?r:e.none()))},Bte=function(e){e.pronouns().if("(he|him|his|she|her|hers|they|their|theirs|it|its)").forEach(e=>{let t=null;e.has("(he|him|his)")?t=Mte(e,e=>Ste(e,"m")):e.has("(she|her|hers)")?t=Mte(e,e=>Ste(e,"f")):e.has("(they|their|theirs)")&&(t=Mte(e,Tte)),t&&t.found&&function(e,t){t&&t.found&&(e.docs[0][0].reference=t.ptrs[0])}(e,t)})},Pte=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Pronouns"}hasReference(){return this.compute("coreference"),this.filter(e=>e.docs[0][0].reference)}refersTo(){return this.compute("coreference"),this.map(e=>{if(!e.found)return e.none();let t=e.docs[0][0];return t.reference?e.update([t.reference]):e.none()})}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.pronouns=function(e){let n=this.match("#Pronoun");return n=n.getNth(e),new t(n.document,n.pointer)}},Nte={compute:{coreference:Bte},api:Pte};e7.plugin(n7),e7.plugin(r7),e7.plugin(v7),e7.plugin(Nte),e7.plugin(k7),e7.plugin(j7),e7.plugin(o9),e7.plugin(H9),e7.plugin(X9),e7.plugin(ree),e7.plugin(gee),e7.plugin(xte);const Rte=e7;function Lte(e){return Array.isArray?Array.isArray(e):"[object Array]"===Gte(e)}function Ite(e){return"string"===typeof e}function kte(e){return"number"===typeof e}function Ote(e){return!0===e||!1===e||function(e){return Ute(e)&&null!==e}(e)&&"[object Boolean]"==Gte(e)}function Ute(e){return"object"===typeof e}function zte(e){return void 0!==e&&null!==e}function Vte(e){return!e.trim().length}function Gte(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const Hte=Object.prototype.hasOwnProperty;class jte{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(e=>{let n=Wte(e);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight}),this._keys.forEach(e=>{e.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Wte(e){let t=null,n=null,r=null,i=1,a=null;if(Ite(e)||Lte(e))r=e,t=qte(e),n=Xte(e);else{if(!Hte.call(e,"name"))throw new Error((e=>"Missing ".concat(e," property in key"))("name"));const o=e.name;if(r=o,Hte.call(e,"weight")&&(i=e.weight,i<=0))throw new Error((e=>"Property 'weight' in key '".concat(e,"' must be a positive integer"))(o));t=qte(o),n=Xte(o),a=e.getFn}return{path:t,id:n,weight:i,src:r,getFn:a}}function qte(e){return Lte(e)?e:e.split(".")}function Xte(e){return Lte(e)?e.join("."):e}const Kte={useExtendedSearch:!1,getFn:function(e,t){let n=[],r=!1;const i=(e,t,a)=>{if(zte(e))if(t[a]){const o=e[t[a]];if(!zte(o))return;if(a===t.length-1&&(Ite(o)||kte(o)||Ote(o)))n.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(o));else if(Lte(o)){r=!0;for(let e=0,n=o.length;e<n;e+=1)i(o[e],t,a+1)}else t.length&&i(o,t,a+1)}else n.push(e)};return i(e,Ite(t)?t.split("."):t,0),r?n:n[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Yte=s(s(s(s({},{isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),Kte);const Jte=/[^ ]+/g;class $te{constructor(){let{getFn:e=Yte.getFn,fieldNormWeight:t=Yte.fieldNormWeight}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.norm=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const n=new Map,r=Math.pow(10,t);return{get(t){const i=t.match(Jte).length;if(n.has(i))return n.get(i);const a=1/Math.pow(i,.5*e),o=parseFloat(Math.round(a*r)/r);return n.set(i,o),o},clear(){n.clear()}}}(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=e}setIndexRecords(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=e}setKeys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=e,this._keysMap={},e.forEach((e,t)=>{this._keysMap[e.id]=t})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,Ite(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();Ite(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,n=this.size();t<n;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!zte(e)||Vte(e))return;let n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}_addObject(e,t){let n={i:t,$:{}};this.keys.forEach((t,r)=>{let i=t.getFn?t.getFn(e):this.getFn(e,t.path);if(zte(i))if(Lte(i)){let e=[];const t=[{nestedArrIndex:-1,value:i}];for(;t.length;){const{nestedArrIndex:n,value:r}=t.pop();if(zte(r))if(Ite(r)&&!Vte(r)){let t={v:r,i:n,n:this.norm.get(r)};e.push(t)}else Lte(r)&&r.forEach((e,n)=>{t.push({nestedArrIndex:n,value:e})})}n.$[r]=e}else if(Ite(i)&&!Vte(i)){let e={v:i,n:this.norm.get(i)};n.$[r]=e}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function Qte(e,t){let{getFn:n=Yte.getFn,fieldNormWeight:r=Yte.fieldNormWeight}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new $te({getFn:n,fieldNormWeight:r});return i.setKeys(e.map(Wte)),i.setSources(t),i.create(),i}function Zte(e){let{errors:t=0,currentLocation:n=0,expectedLocation:r=0,distance:i=Yte.distance,ignoreLocation:a=Yte.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=t/e.length;if(a)return o;const s=Math.abs(r-n);return i?o+s/i:s?1:o}const ene=32;function tne(e,t,n){let{location:r=Yte.location,distance:i=Yte.distance,threshold:a=Yte.threshold,findAllMatches:o=Yte.findAllMatches,minMatchCharLength:s=Yte.minMatchCharLength,includeMatches:u=Yte.includeMatches,ignoreLocation:l=Yte.ignoreLocation}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length>ene)throw new Error((e=>"Pattern length exceeds max of ".concat(e,"."))(ene));const c=t.length,h=e.length,d=Math.max(0,Math.min(r,h));let p=a,f=d;const m=s>1||u,g=m?Array(h):[];let v;for(;(v=e.indexOf(t,f))>-1;){let e=Zte(t,{currentLocation:v,expectedLocation:d,distance:i,ignoreLocation:l});if(p=Math.min(e,p),f=v+c,m){let e=0;for(;e<c;)g[v+e]=1,e+=1}}f=-1;let D=[],y=1,E=c+h;const A=1<<c-1;for(let _=0;_<c;_+=1){let r=0,a=E;for(;r<a;){Zte(t,{errors:_,currentLocation:d+a,expectedLocation:d,distance:i,ignoreLocation:l})<=p?r=a:E=a,a=Math.floor((E-r)/2+r)}E=a;let s=Math.max(1,d-a+1),u=o?h:Math.min(d+a,h)+c,v=Array(u+2);v[u+1]=(1<<_)-1;for(let o=u;o>=s;o-=1){let r=o-1,a=n[e.charAt(r)];if(m&&(g[r]=+!!a),v[o]=(v[o+1]<<1|1)&a,_&&(v[o]|=(D[o+1]|D[o])<<1|1|D[o+1]),v[o]&A&&(y=Zte(t,{errors:_,currentLocation:r,expectedLocation:d,distance:i,ignoreLocation:l}),y<=p)){if(p=y,f=r,f<=d)break;s=Math.max(1,2*d-f)}}if(Zte(t,{errors:_+1,currentLocation:d,expectedLocation:d,distance:i,ignoreLocation:l})>p)break;D=v}const C={isMatch:f>=0,score:Math.max(.001,y)};if(m){const e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yte.minMatchCharLength,n=[],r=-1,i=-1,a=0;for(let o=e.length;a<o;a+=1){let o=e[a];o&&-1===r?r=a:o||-1===r||(i=a-1,i-r+1>=t&&n.push([r,i]),r=-1)}return e[a-1]&&a-r>=t&&n.push([r,a-1]),n}(g,s);e.length?u&&(C.indices=e):C.isMatch=!1}return C}function nne(e){let t={};for(let n=0,r=e.length;n<r;n+=1){const i=e.charAt(n);t[i]=(t[i]||0)|1<<r-n-1}return t}const rne=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class ine{constructor(e){let{location:t=Yte.location,threshold:n=Yte.threshold,distance:r=Yte.distance,includeMatches:i=Yte.includeMatches,findAllMatches:a=Yte.findAllMatches,minMatchCharLength:o=Yte.minMatchCharLength,isCaseSensitive:s=Yte.isCaseSensitive,ignoreDiacritics:u=Yte.ignoreDiacritics,ignoreLocation:l=Yte.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.options={location:t,threshold:n,distance:r,includeMatches:i,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:s,ignoreDiacritics:u,ignoreLocation:l},e=s?e:e.toLowerCase(),e=u?rne(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const c=(e,t)=>{this.chunks.push({pattern:e,alphabet:nne(e),startIndex:t})},h=this.pattern.length;if(h>ene){let e=0;const t=h%ene,n=h-t;for(;e<n;)c(this.pattern.substr(e,ene),e),e+=ene;if(t){const e=h-ene;c(this.pattern.substr(e),e)}}else c(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:n,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=n?rne(e):e,this.pattern===e){let t={isMatch:!0,score:0};return r&&(t.indices=[[0,e.length-1]]),t}const{location:i,distance:a,threshold:o,findAllMatches:s,minMatchCharLength:u,ignoreLocation:l}=this.options;let c=[],h=0,d=!1;this.chunks.forEach(t=>{let{pattern:n,alphabet:p,startIndex:f}=t;const{isMatch:m,score:g,indices:v}=tne(e,n,p,{location:i+f,distance:a,threshold:o,findAllMatches:s,minMatchCharLength:u,includeMatches:r,ignoreLocation:l});m&&(d=!0),h+=g,m&&v&&(c=[...c,...v])});let p={isMatch:d,score:d?h/this.chunks.length:1};return d&&r&&(p.indices=c),p}}class ane{constructor(e){this.pattern=e}static isMultiMatch(e){return one(e,this.multiRegex)}static isSingleMatch(e){return one(e,this.singleRegex)}search(){}}function one(e,t){const n=e.match(t);return n?n[1]:null}class sne extends ane{constructor(e){let{location:t=Yte.location,threshold:n=Yte.threshold,distance:r=Yte.distance,includeMatches:i=Yte.includeMatches,findAllMatches:a=Yte.findAllMatches,minMatchCharLength:o=Yte.minMatchCharLength,isCaseSensitive:s=Yte.isCaseSensitive,ignoreDiacritics:u=Yte.ignoreDiacritics,ignoreLocation:l=Yte.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),this._bitapSearch=new ine(e,{location:t,threshold:n,distance:r,includeMatches:i,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:s,ignoreDiacritics:u,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class une extends ane{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,n=0;const r=[],i=this.pattern.length;for(;(t=e.indexOf(this.pattern,n))>-1;)n=t+i,r.push([t,n-1]);const a=!!r.length;return{isMatch:a,score:a?0:1,indices:r}}}const lne=[class extends ane{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},une,class extends ane{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},class extends ane{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends ane{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends ane{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},class extends ane{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},sne],cne=lne.length,hne=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;const dne=new Set([sne.type,une.type]);class pne{constructor(e){let{isCaseSensitive:t=Yte.isCaseSensitive,ignoreDiacritics:n=Yte.ignoreDiacritics,includeMatches:r=Yte.includeMatches,minMatchCharLength:i=Yte.minMatchCharLength,ignoreLocation:a=Yte.ignoreLocation,findAllMatches:o=Yte.findAllMatches,location:s=Yte.location,threshold:u=Yte.threshold,distance:l=Yte.distance}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:n,includeMatches:r,minMatchCharLength:i,findAllMatches:o,ignoreLocation:a,location:s,threshold:u,distance:l},e=t?e:e.toLowerCase(),e=n?rne(e):e,this.pattern=e,this.query=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.split("|").map(e=>{let n=e.trim().split(hne).filter(e=>e&&!!e.trim()),r=[];for(let i=0,a=n.length;i<a;i+=1){const e=n[i];let a=!1,o=-1;for(;!a&&++o<cne;){const n=lne[o];let i=n.isMultiMatch(e);i&&(r.push(new n(i,t)),a=!0)}if(!a)for(o=-1;++o<cne;){const n=lne[o];let i=n.isSingleMatch(e);if(i){r.push(new n(i,t));break}}}return r})}(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:r,ignoreDiacritics:i}=this.options;e=r?e:e.toLowerCase(),e=i?rne(e):e;let a=0,o=[],s=0;for(let u=0,l=t.length;u<l;u+=1){const r=t[u];o.length=0,a=0;for(let t=0,i=r.length;t<i;t+=1){const i=r[t],{isMatch:u,indices:l,score:c}=i.search(e);if(!u){s=0,a=0,o.length=0;break}if(a+=1,s+=c,n){const e=i.constructor.type;dne.has(e)?o=[...o,...l]:o.push(l)}}if(a){let e={isMatch:!0,score:s/a};return n&&(e.indices=o),e}}return{isMatch:!1,score:1}}}const fne=[];function mne(e,t){for(let n=0,r=fne.length;n<r;n+=1){let r=fne[n];if(r.condition(e,t))return new r(e,t)}return new ine(e,t)}const gne="$and",vne="$or",Dne="$path",yne="$val",Ene=e=>!(!e[gne]&&!e[vne]),Ane=e=>({[gne]:Object.keys(e).map(t=>({[t]:e[t]}))});function Cne(e,t){let{auto:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e=>{let i=Object.keys(e);const a=(e=>!!e[Dne])(e);if(!a&&i.length>1&&!Ene(e))return r(Ane(e));if((e=>!Lte(e)&&Ute(e)&&!Ene(e))(e)){const r=a?e[Dne]:i[0],o=a?e[yne]:e[r];if(!Ite(o))throw new Error((e=>"Invalid value for key ".concat(e))(r));const s={keyId:Xte(r),pattern:o};return n&&(s.searcher=mne(o,t)),s}let o={children:[],operator:i[0]};return i.forEach(t=>{const n=e[t];Lte(n)&&n.forEach(e=>{o.children.push(r(e))})}),o};return Ene(e)||(e=Ane(e)),r(e)}function _ne(e,t){const n=e.matches;t.matches=[],zte(n)&&n.forEach(e=>{if(!zte(e.indices)||!e.indices.length)return;const{indices:n,value:r}=e;let i={indices:n,value:r};e.key&&(i.key=e.key.src),e.idx>-1&&(i.refIndex=e.idx),t.matches.push(i)})}function bne(e,t){t.score=e.score}class xne{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.options=s(s({},Yte),t),this.options.useExtendedSearch,this._keyStore=new jte(this.options.keys),this.setCollection(e,n)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof $te))throw new Error("Incorrect 'index' type");this._myIndex=t||Qte(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){zte(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>!1;const t=[];for(let n=0,r=this._docs.length;n<r;n+=1){const i=this._docs[n];e(i,n)&&(this.removeAt(n),n-=1,r-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e){let{limit:t=-1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{includeMatches:n,includeScore:r,shouldSort:i,sortFn:a,ignoreFieldNorm:o}=this.options;let s=Ite(e)?Ite(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,t){let{ignoreFieldNorm:n=Yte.ignoreFieldNorm}=t;e.forEach(e=>{let t=1;e.matches.forEach(e=>{let{key:r,norm:i,score:a}=e;const o=r?r.weight:null;t*=Math.pow(0===a&&o?Number.EPSILON:a,(o||1)*(n?1:i))}),e.score=t})}(s,{ignoreFieldNorm:o}),i&&s.sort(a),kte(t)&&t>-1&&(s=s.slice(0,t)),function(e,t){let{includeMatches:n=Yte.includeMatches,includeScore:r=Yte.includeScore}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=[];return n&&i.push(_ne),r&&i.push(bne),e.map(e=>{const{idx:n}=e,r={item:t[n],refIndex:n};return i.length&&i.forEach(t=>{t(e,r)}),r})}(s,this._docs,{includeMatches:n,includeScore:r})}_searchStringList(e){const t=mne(e,this.options),{records:n}=this._myIndex,r=[];return n.forEach(e=>{let{v:n,i:i,n:a}=e;if(!zte(n))return;const{isMatch:o,score:s,indices:u}=t.searchIn(n);o&&r.push({item:n,idx:i,matches:[{score:s,value:n,norm:a,indices:u}]})}),r}_searchLogical(e){const t=Cne(e,this.options),n=(e,t,r)=>{if(!e.children){const{keyId:n,searcher:i}=e,a=this._findMatches({key:this._keyStore.get(n),value:this._myIndex.getValueForItemAtKeyId(t,n),searcher:i});return a&&a.length?[{idx:r,item:t,matches:a}]:[]}const i=[];for(let a=0,o=e.children.length;a<o;a+=1){const o=e.children[a],s=n(o,t,r);if(s.length)i.push(...s);else if(e.operator===gne)return[]}return i},r=this._myIndex.records,i={},a=[];return r.forEach(e=>{let{$:r,i:o}=e;if(zte(r)){let e=n(t,r,o);e.length&&(i[o]||(i[o]={idx:o,item:r,matches:[]},a.push(i[o])),e.forEach(e=>{let{matches:t}=e;i[o].matches.push(...t)}))}}),a}_searchObjectList(e){const t=mne(e,this.options),{keys:n,records:r}=this._myIndex,i=[];return r.forEach(e=>{let{$:r,i:a}=e;if(!zte(r))return;let o=[];n.forEach((e,n)=>{o.push(...this._findMatches({key:e,value:r[n],searcher:t}))}),o.length&&i.push({idx:a,item:r,matches:o})}),i}_findMatches(e){let{key:t,value:n,searcher:r}=e;if(!zte(n))return[];let i=[];if(Lte(n))n.forEach(e=>{let{v:n,i:a,n:o}=e;if(!zte(n))return;const{isMatch:s,score:u,indices:l}=r.searchIn(n);s&&i.push({score:u,key:t,value:n,idx:a,norm:o,indices:l})});else{const{v:e,n:a}=n,{isMatch:o,score:s,indices:u}=r.searchIn(e);o&&i.push({score:s,key:t,value:e,norm:a,indices:u})}return i}}xne.version="7.1.0",xne.createIndex=Qte,xne.parseIndex=function(e){let{getFn:t=Yte.getFn,fieldNormWeight:n=Yte.fieldNormWeight}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{keys:r,records:i}=e,a=new $te({getFn:t,fieldNormWeight:n});return a.setKeys(r),a.setIndexRecords(i),a},xne.config=Yte,xne.parseQuery=Cne,function(){fne.push(...arguments)}(pne);class Fne{constructor(e){this.pathwayFuse=void 0,this.categoryFuse=void 0,this.geneFuse=void 0,this.omicsTypes=void 0,this.timepoints=void 0,this.pathwayFuse=new xne(xi,{threshold:.6,includeScore:!0,keys:[""]}),this.categoryFuse=new xne(Object.keys(bi),{threshold:.6,includeScore:!0,keys:[""]}),this.geneFuse=new xne(e.nodes,{threshold:.4,includeScore:!0,keys:["name"]}),this.omicsTypes=Object.values(Ai),this.timepoints=["10 min","30 min","90 min","48 hours"]}parseQuery(e,t){const n=Rte(e.toLowerCase()).terms().out("array");console.log("=== QUERY PARSING DEBUG ==="),console.log("Original query:",e),console.log("Tokens:",n),console.log("Total nodes to filter:",t.length),console.log("Sample node types:",t.slice(0,5).map(e=>({name:e.name,type:e.type})));let r=[...t],i=[],a=.8;const o=this.extractQueryComponents(e,n);if(console.log("Extracted components:",o),o.omicsTypes.length>0){console.log("Applying omics type filter:",o.omicsTypes);const e=r.length;r=this.filterByOmicsType(r,o.omicsTypes),console.log("Omics filter: ".concat(e," -> ").concat(r.length," nodes")),i.push("filtered by omics types: ".concat(o.omicsTypes.join(", ")))}if(o.pathways.length>0){console.log("Applying pathway filter:",o.pathways);const e=r.length;r=this.filterByPathways(r,o.pathways),console.log("Pathway filter: ".concat(e," -> ").concat(r.length," nodes")),i.push("filtered by pathways: ".concat(o.pathways.join(", ")))}if(o.categories.length>0){console.log("Applying category filter:",o.categories);const e=r.length;r=this.filterByCategories(r,o.categories),console.log("Category filter: ".concat(e," -> ").concat(r.length," nodes")),i.push("filtered by categories: ".concat(o.categories.join(", ")))}if(o.timepoints.length>0){console.log("Applying timepoint filter:",o.timepoints);const e=r.length;r=this.filterByTimepoints(r,o.timepoints),console.log("Timepoint filter: ".concat(e," -> ").concat(r.length," nodes")),i.push("filtered by timepoints: ".concat(o.timepoints.join(", ")))}if(o.geneNames.length>0){console.log("Applying gene name filter:",o.geneNames);const e=r.length;r=this.filterByGeneNames(r,o.geneNames),console.log("Gene name filter: ".concat(e," -> ").concat(r.length," nodes")),i.push("filtered by gene names: ".concat(o.geneNames.join(", ")))}if(o.expressionFilters.length>0){console.log("Applying expression filter:",o.expressionFilters);const e=r.length;r=this.filterByExpression(r,o.expressionFilters),console.log("Expression filter: ".concat(e," -> ").concat(r.length," nodes")),i.push("filtered by expression: ".concat(o.expressionFilters.join(", ")))}if(o.drugFilters.length>0){console.log("Applying drug effect filter:",o.drugFilters);const e=r.length;r=this.filterByDrugEffects(r,o.drugFilters),console.log("Drug filter: ".concat(e," -> ").concat(r.length," nodes")),i.push("filtered by drug effects: ".concat(o.drugFilters.join(", ")))}const s=i.length>0?"Found ".concat(r.length," nodes ").concat(i.join(", ")):"Found ".concat(r.length," nodes (no specific filters applied)");return 0===r.length?a=.2:r.length===t.length?a=.4:o.categories.length+o.pathways.length+o.omicsTypes.length>0&&(a=.9),console.log("Final result:",{nodeCount:r.length,explanation:s,confidence:a}),console.log("=== END QUERY PARSING DEBUG ==="),{nodes:r,explanation:s,confidence:a}}extractQueryComponents(e,t){const n={omicsTypes:[],pathways:[],categories:[],timepoints:[],geneNames:[],expressionFilters:[],drugFilters:[]},r=e.toLowerCase();r.includes("protein")&&n.omicsTypes.push(Ai.PROTEIN),r.includes("metabolite")&&n.omicsTypes.push(Ai.METABOLITE),r.includes("lipid")&&n.omicsTypes.push(Ai.LIPID),(r.includes("transcript")||r.includes("mrna")||r.includes("gene"))&&n.omicsTypes.push(Ai.mRNA),this.timepoints.forEach(e=>{r.includes(e.toLowerCase())&&n.timepoints.push(e)}),(r.includes("early")||r.includes("immediate"))&&n.timepoints.push("10 min","30 min"),(r.includes("late")||r.includes("long-term"))&&n.timepoints.push("90 min","48 hours"),!r.includes("hours")||r.includes("upregulated")||r.includes("downregulated")||n.timepoints.push("48 hours");this.pathwayFuse.search(e).slice(0,3).forEach(e=>{e.score&&e.score<.5&&n.pathways.push(e.item)});return this.categoryFuse.search(e).slice(0,2).forEach(e=>{e.score&&e.score<.6&&n.categories.push(e.item)}),Object.keys(bi).forEach(e=>{e.toLowerCase().split(" ").some(e=>r.includes(e))&&(n.categories.includes(e)||n.categories.push(e))}),(r.includes("upregulated")||r.includes("increased")||r.includes("higher")||r.includes("up-regulated"))&&n.expressionFilters.push("upregulated"),(r.includes("downregulated")||r.includes("decreased")||r.includes("lower")||r.includes("down-regulated"))&&n.expressionFilters.push("downregulated"),(r.includes("unchanged")||r.includes("stable"))&&n.expressionFilters.push("unchanged"),(r.includes("drug target")||r.includes("affected by")||r.includes("perturbed"))&&n.drugFilters.push("drug_targets"),(r.includes("not affected")||r.includes("unperturbed"))&&n.drugFilters.push("not_drug_targets"),n}filterByOmicsType(e,t){if(console.log("Filtering by omics types:",t),console.log("Sample node types:",e.slice(0,5).map(e=>e.type)),console.log("All unique node types in data:",Array.from(new Set(e.map(e=>e.type)))),0===t.length)return e;const n=e.filter(e=>t.some(t=>{const n=e.type===t;return n&&console.log("\u2713 Matched node ".concat(e.name," (").concat(e.type,") with query type ").concat(t)),n}));return console.log("Filtered ".concat(n.length," nodes out of ").concat(e.length," by omics type")),n}filterByPathways(e,t){return e.filter(e=>t.some(t=>e.pathway.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(e.pathway.toLowerCase())))}filterByCategories(e,t){return console.log("Filtering by categories:",t),console.log("Sample node categories:",e.slice(0,5).map(e=>e.broadCategory)),e.filter(e=>t.some(t=>{const n=Array.isArray(e.broadCategory)?e.broadCategory.map(e=>e.toLowerCase()):e.broadCategory?[e.broadCategory.toLowerCase()]:[],r=t.toLowerCase();console.log("Comparing node categories [".concat(n.join(", "),'] with query category "').concat(r,'"'));const i=n.some(e=>e.includes(r)||r.includes(e));return i&&console.log("  -> Category matched!"),i}))}filterByTimepoints(e,t){if(console.log("Filtering by timepoints:",t),console.log("Sample node timepoints:",e.slice(0,5).map(e=>e.timepoint)),console.log("All unique timepoints in data:",Array.from(new Set(e.map(e=>e.timepoint).filter(Boolean)))),0===t.length)return e;const n=e.filter(e=>{var n;const r=(null===(n=e.timepoint)||void 0===n?void 0:n.toLowerCase())||"",i=t.some(t=>{const n=t.toLowerCase(),i=r.includes(n);return i&&console.log("\u2713 Matched node ".concat(e.name,' timepoint "').concat(r,'" with query timepoint "').concat(n,'"')),i});return i});return console.log("Filtered ".concat(n.length," nodes out of ").concat(e.length," by timepoint")),n}filterByGeneNames(e,t){return e.filter(e=>t.some(t=>e.name.toUpperCase().includes(t)||t.includes(e.name.toUpperCase())))}filterByExpression(e,t){return console.log("Filtering by expression:",t),console.log("Sample nodes with foldChange:",e.slice(0,5).map(e=>({name:e.name,foldChange:e.foldChange,expression:e.expression}))),e.filter(e=>0===t.length||t.some(t=>{switch(t){case"upregulated":return void 0!==e.foldChange?e.foldChange>1.2:void 0!==e.expression&&e.expression>.6;case"downregulated":return void 0!==e.foldChange?e.foldChange<.8:void 0!==e.expression&&e.expression<.4;case"unchanged":return void 0!==e.foldChange?e.foldChange>=.8&&e.foldChange<=1.2:void 0!==e.expression&&(e.expression>=.4&&e.expression<=.6);default:return!0}}))}filterByDrugEffects(e,t){return e.filter(e=>t.some(t=>{switch(t){case"drug_targets":return!0===e.isPerturbationTarget;case"not_drug_targets":return!0!==e.isPerturbationTarget;default:return!0}}))}}const wne=["Show me proteins that are upregulated","Find metabolites in energy metabolism","Which genes are affected by drugs?","Show lipids that decrease after 48 hours","Find proteins in immune response pathways","Show early response genes (10 min)","Which metabolites are drug targets?","Find downregulated proteins in oxidative stress","Show unchanged lipids in circadian rhythm","Find mRNA transcripts in heart rate pathways"],Sne=[{id:"network",title:"Network Explorer",description:"Interactive molecular network visualization with drug perturbation effects",category:"molecular",status:"active",icon:"\ud83c\udf10"},{id:"network3d",title:"3D Force Graph",description:"Professional 3D network visualization with force-directed layout and interactions",category:"molecular",status:"active",icon:"\ud83c\udf0c"},{id:"sankey",title:"Multi-Scale Flow",description:"Sankey diagrams showing molecular \u2192 cellular \u2192 system cascades",category:"system",status:"active",icon:"\ud83c\udf0a"},{id:"radar",title:"Drug Profile Radar",description:"Spider charts comparing drug effects across multiple dimensions",category:"design",status:"preview",icon:"\ud83d\udd78\ufe0f"},{id:"drugdesign",title:"Drug Design Explorer",description:"Interactive parameter space for novel drug design and optimization",category:"design",status:"coming-soon",icon:"\ud83e\uddea"},{id:"featurespace",title:"Feature Space Navigation",description:"Navigate drug feature space with evolutionary optimization visualization",category:"design",status:"coming-soon",icon:"\ud83c\udfaf"}];const Tne=function(){const[t,n]=(0,e.useState)("dashboard"),[r,i]=(0,e.useState)({nodes:[],links:[],pathways:[]}),[a,o]=(0,e.useState)({width:Math.max(2e3,1.8*window.innerWidth),height:Math.max(1800,2*window.innerHeight)}),[u,l]=(0,e.useState)("control"),[c,h]=(0,e.useState)(new Set),[d,p]=(0,e.useState)(new Set([Ai.mRNA,Ai.PROTEIN,Ai.METABOLITE,Ai.LIPID])),[f,m]=(0,e.useState)(!1),[g,v]=(0,e.useState)(new Set(["systems","organs","tissues","cellular","molecular"])),[D,y]=(0,e.useState)(""),[E,A]=(0,e.useState)(null),[C,_]=(0,e.useState)(!1),[b,x]=(0,e.useState)(null),[F,w]=(0,e.useState)(!1);(0,e.useEffect)(()=>{const e=Mi();i(e);const t=new Fne(e);x(t)},[]),(0,e.useEffect)(()=>{const e=()=>{o({width:Math.max(2e3,1.8*window.innerWidth),height:Math.max(1800,2*window.innerHeight)})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,e.useEffect)(()=>{const e=()=>{var e;const t=new URLSearchParams(window.location.search).get("view"),r=(null===(e=Sne.find(e=>e.id===t))||void 0===e?void 0:e.id)||"dashboard";n(r)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]),(0,e.useEffect)(()=>{const e=new URL(window.location.href);"dashboard"===t?e.searchParams.delete("view"):e.searchParams.set("view",t),window.history.replaceState({},"",e.toString())},[t]),(0,e.useEffect)(()=>{document.body.className=f?"dark-mode":"light-mode"},[f]);const S=(0,e.useMemo)(()=>{if(0===c.size||"control"===u)return null;const e={};return c.forEach(t=>{const n=Fi.find(e=>e.id===t);if(n){const i=((e,t)=>{if(!e||!e.nodes||!e.links||!t)return console.error("Invalid data or drug provided to applyDrugPerturbation"),e;const n=e.nodes.map(e=>{if(!e||!e.id||!e.name)return console.warn("Skipping invalid node in perturbation"),e;const n=s({},e),r=t.targetPathways.includes(e.pathway),i=t.targetOmicsTypes.includes(e.type),a=t.targetPathways.some(t=>Object.entries(bi).some(n=>{let[r,i]=n;return i.includes(t)&&i.includes(e.pathway)}));if(r||i||a){const r=t.effects.upregulatedGenes.some(t=>e.name.toUpperCase().includes(t.toUpperCase())||t.toUpperCase().includes(e.name.toUpperCase())),i=t.effects.downregulatedGenes.some(t=>e.name.toUpperCase().includes(t.toUpperCase())||t.toUpperCase().includes(e.name.toUpperCase()));if(r){const t=1.8+1.5*Math.random();n.perturbedExpression=(e.baselineExpression||e.expression||1)*t,n.foldChange=t,n.isPerturbationTarget=!0,n.expression=n.perturbedExpression}else if(i){const t=.15+.45*Math.random();n.perturbedExpression=(e.baselineExpression||e.expression||1)*t,n.foldChange=t,n.isPerturbationTarget=!0,n.expression=n.perturbedExpression}else{const t=Math.random();let r;t<.4?(r=1.5+1*Math.random(),n.isPerturbationTarget=!0):t<.8?(r=.3+.4*Math.random(),n.isPerturbationTarget=!0):r=.85+.3*Math.random(),n.perturbedExpression=(e.baselineExpression||e.expression||1)*r,n.foldChange=r,n.expression=n.perturbedExpression}}else n.perturbedExpression=e.baselineExpression||e.expression,n.foldChange=1,n.expression=n.perturbedExpression;return n}).filter(e=>e&&e.id),r=e.links.map(n=>{if(!n||!n.source||!n.target)return console.warn("Skipping invalid link in perturbation"),n;const r=s({},n),i=e.nodes.find(e=>e&&e.id===("string"===typeof n.source?n.source:n.source.id)),a=e.nodes.find(e=>e&&e.id===("string"===typeof n.target?n.target:n.target.id));if(!i||!a)return n;const o=t.effects.enhancedInteractions.some(e=>e.includes(i.name||"")||e.includes(a.name||"")),u=t.effects.disruptedInteractions.some(e=>e.includes(i.name||"")||e.includes(a.name||""));if(o){const e=1.6+1.2*Math.random();r.perturbedStrength=(n.baselineStrength||n.strength)*e,r.strengthChange=e,r.strength=r.perturbedStrength}else if(u){const e=.1+.3*Math.random();r.perturbedStrength=(n.baselineStrength||n.strength)*e,r.strengthChange=e,r.strength=r.perturbedStrength}else{const e=t.targetPathways.includes(i.pathway||""),o=t.targetPathways.includes(a.pathway||"");if(e||o){const e=Math.random();let t;t=e<.3?1.4+.8*Math.random():e<.6?.2+.4*Math.random():.8+.4*Math.random(),r.perturbedStrength=(n.baselineStrength||n.strength)*t,r.strengthChange=t,r.strength=r.perturbedStrength}else{const e=.95+.1*Math.random();r.perturbedStrength=(n.baselineStrength||n.strength)*e,r.strengthChange=e,r.strength=r.perturbedStrength}}return r}).filter(e=>e&&e.source&&e.target);return{nodes:n,links:r,pathways:xi,broadCategories:Object.keys(bi)}})(r,n);e[t]=i}}),e},[r,c,u]),T=(0,e.useMemo)(()=>r,[r]),M=(0,e.useMemo)(()=>{let e=T;if(D.trim()&&b){const t=b.parseQuery(D,e.nodes);A(t),t.nodes.length>0&&(e=s(s({},e),{},{nodes:t.nodes,links:e.links.filter(e=>{const n="string"===typeof e.source?e.source:e.source.id,r="string"===typeof e.target?e.target:e.target.id;return t.nodes.some(e=>e.id===n||e.id===r)})}))}const t=e.nodes.filter(e=>d.has(e.type)),n=e.links.filter(e=>{const n="string"===typeof e.source?e.source:e.source.id,r="string"===typeof e.target?e.target:e.target.id;return t.some(e=>e.id===n)&&t.some(e=>e.id===r)});return s(s({},e),{},{nodes:t,links:n})},[T,D,b,d]),B=e=>{const t=new Set(d);t.has(e)?t.delete(e):t.add(e),p(t)},P=e=>{const t=new Set(c);t.has(e)?t.delete(e):t.add(e),h(t)},N=e=>{e.preventDefault()},R=()=>{y(""),A(null)},L=e=>{const t=new Set(g);t.has(e)?t.delete(e):t.add(e),v(t)},I=e=>{},k=()=>(0,Bi.jsxs)("div",{className:"dashboard-container",children:[(0,Bi.jsxs)("div",{className:"dashboard-header",children:[(0,Bi.jsxs)("div",{className:"header-subtitle",children:["Data exploration, hypothesis generation, and drug discovery",(0,Bi.jsx)("svg",{viewBox:"0 0 24 24",children:(0,Bi.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7"})})]}),(0,Bi.jsx)("h2",{children:"Exploring the How Behind the What"}),(0,Bi.jsx)("p",{children:"An AI Ecosystem for Exploration of Complex Biological Systems to Accelerate Our Understanding of Anesthetic Drugs and their Mechanism"})]}),(0,Bi.jsx)("div",{className:"tiles-grid",children:Sne.map(e=>(0,Bi.jsx)("div",{className:"dashboard-tile ".concat(e.status," ").concat("active"===e.status||"preview"===e.status?"clickable":""),onClick:()=>(e=>{const t=Sne.find(t=>t.id===e);if("active"===(null===t||void 0===t?void 0:t.status)||"preview"===(null===t||void 0===t?void 0:t.status)){const t=new URL(window.location.href);t.searchParams.set("view",e),window.history.pushState({},"",t.toString()),n(e)}})(e.id),children:(0,Bi.jsxs)("div",{className:"tile-content",children:[(0,Bi.jsxs)("div",{className:"tile-icon",children:["network"===e.id&&"\u26ac","network3d"===e.id&&"\u25c9","sankey"===e.id&&"\u27f6","radar"===e.id&&"\u25c8","drugdesign"===e.id&&"\u25ef","featurespace"===e.id&&"\u25c7"]}),(0,Bi.jsx)("h4",{children:e.title}),(0,Bi.jsx)("p",{children:e.description}),(0,Bi.jsxs)("div",{className:"tile-status ".concat(e.status),children:["active"===e.status&&"Explore Now","preview"===e.status&&"Preview","coming-soon"===e.status&&"Coming Soon"]})]})},e.id))})]});return(0,Bi.jsxs)("div",{className:"app",children:[(0,Bi.jsx)("div",{className:"app-header",children:(0,Bi.jsxs)("div",{className:"header-content",children:[(0,Bi.jsx)("div",{className:"header-left",children:(0,Bi.jsx)("h1",{children:"GAIA"})}),(0,Bi.jsx)("div",{className:"header-center"}),(0,Bi.jsx)("div",{className:"header-right",children:(0,Bi.jsxs)("div",{className:"header-nav",children:[(0,Bi.jsx)("button",{className:"theme-toggle",onClick:()=>{m(!f)},title:"Switch to ".concat(f?"light":"dark"," mode")}),(0,Bi.jsx)("span",{className:"nav-item",children:"Setup"}),(0,Bi.jsx)("span",{className:"nav-item ".concat("dashboard"!==t?"dashboard-nav":""),onClick:()=>{if("dashboard"===t)window.location.reload();else{const e=new URL(window.location.href);e.searchParams.delete("view"),window.history.pushState({},"",e.toString()),n("dashboard")}},style:{cursor:"pointer"},children:"Dashboard"}),(0,Bi.jsx)("span",{className:"nav-item",children:"Sign-In"})]})})]})}),"network"!==t&&"network3d"!==t&&"sankey"!==t&&"radar"!==t?null:"network3d"===t?(0,Bi.jsx)("div",{className:"controls-container network-explorer-controls",children:(0,Bi.jsxs)("div",{className:"controls-content",children:[(0,Bi.jsx)("div",{className:"section-title",style:{textTransform:"none"},children:"3D Network Explorer"}),(0,Bi.jsx)("div",{style:{fontSize:"14px",color:"var(--text-secondary)",lineHeight:"1.5",textAlign:"left",marginBottom:"0"},children:"Hierarchical Network Visualization"}),(0,Bi.jsxs)("div",{className:"controls-row",children:[(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Treatment:"}),(0,Bi.jsxs)("div",{className:"toggle-group",children:[(0,Bi.jsx)("button",{className:"toggle-button ".concat("control"===u?"active":""),onClick:()=>l("control"),children:"Control"}),(0,Bi.jsx)("button",{className:"toggle-button ".concat("drug"===u?"active":""),onClick:()=>l("drug"),children:"Drug"})]})]}),"drug"===u&&(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Drug:"}),(0,Bi.jsx)("div",{className:"drug-toggles",children:Fi.map(e=>(0,Bi.jsxs)("button",{className:"drug-toggle ".concat(c.has(e.id)?"active":""),onClick:()=>{const t=new Set;c.has(e.id)||t.add(e.id),h(t)},title:"Generate network topology optimized for ".concat(e.name," - ").concat(e.mechanism),children:[e.name,c.has(e.id)&&(0,Bi.jsx)("span",{className:"drug-check",children:"\u2713"})]},e.id))})]}),(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Network Layers:"}),(0,Bi.jsx)("div",{className:"layer-controls",children:[{key:"systems",label:"Systems",color:"#E86659"},{key:"organs",label:"Organs",color:"#CCCCFF"},{key:"tissues",label:"Tissues",color:"#FF7F50"},{key:"cellular",label:"Cellular",color:"#9FE2BF"},{key:"molecular",label:"Molecular",color:"#DFFF00"}].map(e=>(0,Bi.jsx)("button",{onClick:()=>L(e.key),className:"layer-toggle ".concat(g.has(e.key)?"active":""),style:{backgroundColor:g.has(e.key)?e.color:"transparent",borderColor:e.color,color:g.has(e.key)?"#000":e.color,fontSize:"12px",padding:"6px 12px",margin:"4px",border:"2px solid ".concat(e.color),borderRadius:"16px",cursor:"pointer",transition:"all 0.2s ease",fontWeight:g.has(e.key)?"bold":"normal"},children:e.label},e.key))})]})]})]})}):"sankey"===t?(0,Bi.jsx)("div",{className:"controls-container network-explorer-controls",children:(0,Bi.jsxs)("div",{className:"controls-content",children:[(0,Bi.jsx)("div",{className:"section-title",style:{color:"#364FA1",textTransform:"none",fontSize:"20px"},children:"Multi-Scale Flow"}),(0,Bi.jsx)("div",{style:{fontSize:"14px",color:"var(--text-secondary)",lineHeight:"1.5",textAlign:"left",marginBottom:"6px"},children:"Sankey diagrams showing molecular \u2192 cellular \u2192 system cascades. Click nodes to expand/collapse sections."}),(0,Bi.jsxs)("div",{className:"controls-row",children:[(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Treatment:"}),(0,Bi.jsxs)("div",{className:"toggle-group",children:[(0,Bi.jsx)("button",{className:"toggle-button ".concat("control"===u?"active":""),onClick:()=>l("control"),children:"Control"}),(0,Bi.jsx)("button",{className:"toggle-button ".concat("drug"===u?"active":""),onClick:()=>l("drug"),children:"Drug"})]})]}),"drug"===u&&(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Drugs:"}),(0,Bi.jsx)("div",{className:"drug-toggles",children:Fi.map(e=>(0,Bi.jsxs)("button",{className:"drug-toggle ".concat(c.has(e.id)?"active":""),onClick:()=>P(e.id),title:"".concat(e.name," - ").concat(e.mechanism),children:[e.name,c.has(e.id)&&(0,Bi.jsx)("span",{className:"drug-check",children:"\u2713"})]},e.id))})]})]})]})}):"radar"===t?(0,Bi.jsx)("div",{className:"controls-container network-explorer-controls",children:(0,Bi.jsxs)("div",{className:"controls-content",children:[(0,Bi.jsx)("div",{className:"section-title",style:{textTransform:"none"},children:"Drug Profile Radar"}),(0,Bi.jsx)("div",{style:{fontSize:"14px",color:"var(--text-secondary)",lineHeight:"1.5",textAlign:"left",marginBottom:"6px",maxWidth:"600px"},children:"Compare drug effects across multiple biological pathways. Each drug shows a unique profile pattern."})]})}):(0,Bi.jsx)("div",{className:"controls-container network-explorer-controls",children:(0,Bi.jsxs)("div",{className:"controls-content",children:[(0,Bi.jsx)("div",{className:"section-title",style:{color:"#364FA1",textTransform:"none",fontSize:"20px"},children:"Network Explorer"}),(0,Bi.jsx)("div",{style:{fontSize:"14px",color:"var(--text-secondary)",lineHeight:"1.5",textAlign:"left",marginBottom:"6px",maxWidth:"600px"},children:"Explore biological pathways through interactive network visualization."}),(0,Bi.jsxs)("div",{className:"controls-row",children:[(0,Bi.jsxs)("div",{className:"control-group query-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Query:"}),(0,Bi.jsxs)("div",{className:"query-input-container",children:[(0,Bi.jsxs)("form",{onSubmit:N,children:[(0,Bi.jsx)("input",{type:"text",className:"query-input",placeholder:"Ask about the network (e.g., 'Show proteins in energy metabolism')",value:D,onChange:e=>y(e.target.value)}),(0,Bi.jsx)("button",{type:"button",className:"query-help-btn",onClick:()=>_(!C),children:"?"}),D&&(0,Bi.jsx)("button",{type:"button",className:"query-clear-btn",onClick:R,children:"\xd7"})]}),C&&(0,Bi.jsxs)("div",{className:"query-help",children:[(0,Bi.jsx)("h4",{children:"Example Queries:"}),(0,Bi.jsx)("div",{className:"query-examples",children:wne.slice(0,6).map((e,t)=>(0,Bi.jsx)("button",{className:"query-example",onClick:()=>(y(e),void _(!1)),children:e},t))})]}),E&&(0,Bi.jsxs)("div",{className:"query-result",children:[(0,Bi.jsx)("span",{className:"query-explanation",children:E.explanation}),(0,Bi.jsxs)("span",{className:"query-confidence ".concat(E.confidence>.7?"high":E.confidence>.4?"medium":"low"),children:[Math.round(100*E.confidence),"% confidence"]})]})]})]}),(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Treatment:"}),(0,Bi.jsxs)("div",{className:"toggle-group",children:[(0,Bi.jsx)("button",{className:"toggle-button ".concat("control"===u?"active":""),onClick:()=>l("control"),children:"Control"}),(0,Bi.jsx)("button",{className:"toggle-button ".concat("drug"===u?"active":""),onClick:()=>l("drug"),children:"Drug"})]})]}),"drug"===u&&(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Drugs:"}),(0,Bi.jsx)("div",{className:"drug-toggles",children:Fi.map(e=>(0,Bi.jsxs)("button",{className:"drug-toggle ".concat(c.has(e.id)?"active":""),onClick:()=>P(e.id),title:"".concat(e.name," - ").concat(e.mechanism),children:[e.name,c.has(e.id)&&(0,Bi.jsx)("span",{className:"drug-check",children:"\u2713"})]},e.id))})]}),(0,Bi.jsxs)("div",{className:"control-group",children:[(0,Bi.jsx)("label",{className:"control-label",children:"Network Layers:"}),(0,Bi.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,Bi.jsxs)("div",{className:"layer-controls",children:[(0,Bi.jsx)("button",{className:"layer-toggle ".concat(d.has(Ai.PROTEIN)?"active":""),onClick:()=>B(Ai.PROTEIN),style:{backgroundColor:d.has(Ai.PROTEIN)?"#CCCCFF":"transparent",borderColor:"#CCCCFF",color:d.has(Ai.PROTEIN)?"#000":"#CCCCFF",fontSize:"12px",padding:"6px 12px",margin:"4px",border:"2px solid #CCCCFF",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s ease",fontWeight:d.has(Ai.PROTEIN)?"bold":"normal"},children:"Proteins"}),(0,Bi.jsx)("button",{className:"layer-toggle ".concat(d.has(Ai.METABOLITE)?"active":""),onClick:()=>B(Ai.METABOLITE),style:{backgroundColor:d.has(Ai.METABOLITE)?"#FF7F50":"transparent",borderColor:"#FF7F50",color:d.has(Ai.METABOLITE)?"#000":"#FF7F50",fontSize:"12px",padding:"6px 12px",margin:"4px",border:"2px solid #FF7F50",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s ease",fontWeight:d.has(Ai.METABOLITE)?"bold":"normal"},children:"Metabolites"}),(0,Bi.jsx)("button",{className:"layer-toggle ".concat(d.has(Ai.LIPID)?"active":""),onClick:()=>B(Ai.LIPID),style:{backgroundColor:d.has(Ai.LIPID)?"#DFFF00":"transparent",borderColor:"#DFFF00",color:d.has(Ai.LIPID)?"#000":"#DFFF00",fontSize:"12px",padding:"6px 12px",margin:"4px",border:"2px solid #DFFF00",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s ease",fontWeight:d.has(Ai.LIPID)?"bold":"normal"},children:"Lipids"}),(0,Bi.jsx)("button",{className:"layer-toggle ".concat(d.has(Ai.mRNA)?"active":""),onClick:()=>B(Ai.mRNA),style:{backgroundColor:d.has(Ai.mRNA)?"#9FE2BF":"transparent",borderColor:"#9FE2BF",color:d.has(Ai.mRNA)?"#000":"#9FE2BF",fontSize:"12px",padding:"6px 12px",margin:"4px",border:"2px solid #9FE2BF",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s ease",fontWeight:d.has(Ai.mRNA)?"bold":"normal"},children:"Transcripts"})]}),(0,Bi.jsx)("button",{className:"info-button-small",onClick:()=>w(!F),title:"Show instructions",style:{width:"32px",height:"32px",fontSize:"14px",marginLeft:"4px"},children:"?"})]})]})]}),F&&(0,Bi.jsxs)("div",{style:{position:"absolute",top:"120px",right:"20px",zIndex:1001,width:"320px",background:f?"rgba(30, 30, 40, 0.95)":"rgba(232, 227, 207, 0.95)",mixBlendMode:"normal",isolation:"isolate",borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",border:"1px solid ".concat(f?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.1)"),overflow:"hidden",padding:"16px",boxSizing:"border-box"},children:[(0,Bi.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px"},children:(0,Bi.jsx)("button",{onClick:()=>w(!1),style:{background:"none",border:"none",fontSize:"18px",cursor:"pointer",color:f?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",padding:"4px",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"},children:"\xd7"})}),(0,Bi.jsx)("h4",{style:{margin:"0 0 12px 0",color:f?"var(--accent-primary)":"#364FA1",fontSize:"16px",fontWeight:"600"},children:"Instructions"}),(0,Bi.jsx)("div",{style:{fontSize:"13px",color:f?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)",lineHeight:"1.5",width:"100%"},children:(0,Bi.jsxs)("ul",{style:{margin:"0",paddingLeft:"20px",width:"100%",boxSizing:"border-box"},children:[(0,Bi.jsxs)("li",{style:{marginBottom:"6px"},children:[(0,Bi.jsx)("strong",{children:"Click nodes"})," to highlight pathways"]}),(0,Bi.jsxs)("li",{style:{marginBottom:"6px"},children:[(0,Bi.jsx)("strong",{children:"Click empty space"})," to deselect"]}),(0,Bi.jsxs)("li",{style:{marginBottom:"6px"},children:[(0,Bi.jsx)("strong",{children:"Node size"})," = confidence in causal chain importance"]}),(0,Bi.jsxs)("li",{style:{marginBottom:"6px"},children:[(0,Bi.jsx)("strong",{children:"Scroll"})," horizontally/vertically to explore the full network"]}),(0,Bi.jsxs)("li",{style:{marginBottom:"6px"},children:[(0,Bi.jsx)("strong",{children:"Drag popups"})," anywhere on the panel to move them around"]}),"drug"===u&&(0,Bi.jsxs)("li",{children:[(0,Bi.jsx)("strong",{children:"Green"})," = upregulated \u2022 ",(0,Bi.jsx)("strong",{children:"Red"})," = downregulated \u2022 ",(0,Bi.jsx)("strong",{children:"Larger"})," = stronger effect"]})]})})]})]})}),(0,Bi.jsx)("div",{className:"app-content",children:(()=>{switch(t){case"dashboard":return k();case"network":return(0,Bi.jsx)("div",{className:"visualization-container-fullwidth",children:M.nodes.length>0&&(0,Bi.jsx)(Pi,{baselineData:M,individualDrugData:S,width:a.width,height:a.height,visualizationMode:"drug"===u?Ci.PERTURBED:Ci.BASELINE,visibleNodeTypes:d,selectedDrugs:c,isDarkMode:f})});case"network3d":return(0,Bi.jsx)("div",{className:"visualization-container-fullwidth",children:(0,Bi.jsx)(vJ,{data:r,drugData:S,selectedDrugs:c,isDarkMode:f,visibleLayers:g,onNodeClick:I,onLayerToggle:L})});case"sankey":return(0,Bi.jsx)("div",{className:"visualization-container-fullwidth",children:(0,Bi.jsx)(DJ,{data:r,drugData:S,isDarkMode:f,selectedDrugs:c,onDrugToggle:P,treatmentMode:u})});case"radar":return(0,Bi.jsx)("div",{className:"visualization-container-fullwidth",children:(0,Bi.jsx)(yJ,{data:r,drugData:S,selectedDrugs:c,isDarkMode:f})});default:return(0,Bi.jsx)("div",{className:"visualization-container-fullwidth",children:(0,Bi.jsxs)("div",{className:"coming-soon-message",children:[(0,Bi.jsx)("h3",{children:"\ud83d\udea7 Coming Soon"}),(0,Bi.jsx)("p",{children:"This visualization is under development."}),(0,Bi.jsx)("button",{className:"back-to-dashboard",onClick:()=>n("dashboard"),children:"\u2190 Back to Dashboard"})]})})}})()}),(0,Bi.jsx)("div",{className:"static-footer",children:(0,Bi.jsx)("p",{children:"Hansj\xf6rg Wyss Institute for Biologically Inspired Engineering at Harvard University"})})]})},Mne=e=>{e&&e instanceof Function&&n.e(206).then(n.bind(n,206)).then(t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:a,getTTFB:o}=t;n(e),r(e),i(e),a(e),o(e)})};t.createRoot(document.getElementById("root")).render((0,Bi.jsx)(e.StrictMode,{children:(0,Bi.jsx)(Tne,{})})),Mne()})()})();